<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625" />

    <meta name="author" content="wander" />
    <meta name="copyright" content="wander" />

    <meta name="description"
        content="datetime模块
简单的日期时间操作用time模块里面的一些函数即可，datetime模块是用类的方式来处理的，适合大量处理日期时间的任务。然后值得一提的是mongodb的python接口 pymongo 里面（连接mongodb的python第三方模块），日期时间的输入输出都是datet..." />


<meta name="keywords" content=", posts, " />

<title>python内置模块datetime  -
    wander的博客</title>

    <link href="https://a358003542.github.io/theme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://a358003542.github.io/theme/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <link href="https://a358003542.github.io/theme/css/base.css" rel="stylesheet">

<link rel="stylesheet" href="https://a358003542.github.io/theme/css/pygments.css">
<link rel="stylesheet" href="https://a358003542.github.io/theme/css/article.css">
</head>

<body>
    <div class="flex-wrapper">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="https://a358003542.github.io/">网站首页</a>

                <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse"
                    data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>


                <div class="navbar-collapse collapse" id="navbarContent">
                    <form action="https://a358003542.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"
                        class="d-flex me-auto">

                        <input type="search" name="q" id="tipue_search_input" class="form-control me-2"
                            placeholder="Search..." aria-label="Search">

                        <button class="btn btn-outline-primary text-nowrap" type="submit">搜索</button>
                        
                    </form>


                    <ul class="navbar-nav mb-lg-0">

                        <li class="nav-item ">
                            <a class="nav-link "
                                href="/archives.html">所有博文</a>
                        </li>

                        <li class="nav-item ">
                            <a class="nav-link "
                                href="/categories.html">博文分类</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link  " href="https://a358003542.github.io/about.html">关于本网站</a>
                        </li>
                    </ul>


                </div>
            </div>
        </nav>

        
        <main>

        <div class="container mt-3">
            <div class="row">
                <div class="col">

                    <div class="card">
                        <div class="card-body">
                          <h3 class="card-title">翻墙软件推荐：</h3>
                          <p class="card-text">V2net翻墙软件是我一直在用的，价格很实惠，有各个档次可以选择，翻墙效果还是很好的。</p>
                          <a button role="button" class="btn btn-outline-success" href="http://xc.v2ray.cx/aff.php?aff=3078">点击查看</a>
                        </div>
                      </div>
                </div>
            </div>

        </div>

<div class="container-xxl mt-3">
    <div class="row">
        <div class="col-md-4 col-lg-3"></div>
        <header class="col-sm-12 col-md-8 col-lg-8 page-header">
            <h1><a href="https://a358003542.github.io/articles/python-builtin-module-datetime.html"> python内置模块datetime  </a></h1>
        </header>
    </div>

    <div class="row">
        <div class="col-sm-12 col-md-4 col-lg-3">
            <div class="p-3 bg-white small">
                <div style="font-size:1.2rem;">目录</div>
                <div class="toc">
<ul>
<li><a href="#datetime模块">datetime模块</a><ul>
<li><a href="#timedelta对象">timedelta对象</a></li>
<li><a href="#datetime对象">datetime对象</a></li>
<li><a href="#struct_time-对象转化成为-datetime-对象">`struct_time`` 对象转化成为 datetime 对象</a></li>
<li><a href="#datetime-对象转化为-time_struct-对象">datetime 对象转化为 `time_struct`` 对象</a></li>
<li><a href="#获取一个月最后的一天">获取一个月最后的一天</a></li>
</ul>
</li>
</ul>
</div>

                <div class="p-1">首发于：<time pubdate="pubdate" datetime="2023-10-19T00:00:00+08:00">2023年 10月 19日 </time>
                </div>

                <div class="p-1">最近更新于：<time datetime="2024-09-08T11:38:27.177051+08:00">2024年 9月 8日 </time>
                </div>


                <div class="p-1">分类：
                <a class="category-link" href="https://a358003542.github.io/categories.html#posts-ref">posts</a>
                </div>
            </div>
        </div>

        <div class="col-sm-12 col-md-8 col-lg-8">
            <div class="article-content">
                
<h2 id="datetime模块">datetime模块</h2>
<p>简单的日期时间操作用time模块里面的一些函数即可，datetime模块是用类的方式来处理的，适合大量处理日期时间的任务。然后值得一提的是mongodb的python接口 <code>pymongo</code> 里面（连接mongodb的python第三方模块），日期时间的输入输出都是datetime 对象的，这很是方便。</p>
<p>下面简要介绍之，更多内容请参看 <a href="https://docs.python.org/3.4/library/datetime.html">官方文档</a> 。</p>
<h3 id="timedelta对象">timedelta对象</h3>
<p>通过timedelta函数返回一个timedelta对象，也就是一个表示时间间隔的对象。函数参数情况如下所示:</p>
<div class="highlight"><pre><span></span><code>class datetime.timedelta([days[, seconds[, microseconds[, milliseconds[, minutes[, hours[, weeks]]]]]]])
</code></pre></div>
<p>其没有必填参数，简单控制的话第一个整数就是多少天的间隔的意思:</p>
<div class="highlight"><pre><span></span><code>datetime.timedelta(10)
</code></pre></div>
<p>两个时间间隔对象可以彼此之间相加或相减，返回的仍是一个时间间隔对象。而更方便的是一个datetime对象如果减去一个时间间隔对象，那么返回的对应减去之后的datetime对象，然后两个datetime对象如果相减返回的是一个时间间隔对象。这很是方便。</p>
<h3 id="datetime对象">datetime对象</h3>
<p>通过datetime函数可以创建一个datetime对象:</p>
<div class="highlight"><pre><span></span><code>class datetime.datetime(year, month, day[, hour[, minute[, second[, microsecond[, tzinfo]]]]])
</code></pre></div>
<p>其中year，month和day是必填参数。下面是一个简单的例子:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; db_t = {
...  "date": datetime.datetime(1777,07,07)
... }
&gt;&gt;&gt; db_t
{'date': datetime.datetime(1777, 7, 7, 0, 0)}
</code></pre></div>
<p>其通过pymongo存入mongodb之后是这样的形式:</p>
<div class="highlight"><pre><span></span><code>ISODate("1777-07-07T00:00:00.000Z")
</code></pre></div>
<h4 id="now和utcnow方法">now和utcnow方法</h4>
<p>datetime对象有 <code>now</code> 和 <code>utcnow</code>
这两个<em>类方法</em>（classmethod）来返回当前日期时间的datetime对象。utcnow不可以接受参数，now方法可以接受一个tz指定时区的参数，我们可以通过
<em>pytz</em> 模块（一个处理时区推荐的第三方模块）来具体指明某个时区。</p>
<h5 id="查看pytz的所有时区">查看pytz的所有时区</h5>
<p>参看<a href="http://stackoverflow.com/questions/13866926/python-pytz-list-of-timezones">这个网页</a>。</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; pytz.all_timezones
['Africa/Abidjan', 'Africa/Accra', 'Africa/Addis_Ababa', 'Africa/Algiers', ......
</code></pre></div>
<h5 id="具体给now方法指定一个时区">具体给now方法指定一个时区</h5>
<p>参看<a href="http://stackoverflow.com/questions/2331592/datetime-datetime-utcnow-why-no-tzinfo">这个网页</a>。</p>
<div class="highlight"><pre><span></span><code>import pytz
datetime.datetime.now(tz = pytz.timezone("Asia/Hong_Kong"))
</code></pre></div>
<h5 id="now方法和utcnow方法区别">now方法和utcnow方法区别</h5>
<p>我们看下面这个例子:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; datetime.now(tz = pytz.timezone("UTC")),datetime.utcnow()
(datetime.datetime(2015, 7, 11, 9, 25, 20, 266863, tzinfo=&lt;UTC&gt;), datetime.datetime(2015, 7, 11, 9, 25, 20, 266888))
</code></pre></div>
<p>如果我们给now方法指定默认的时区是\"UTC\"，那么我们看到其返回的datetime对象和utcnow返回的datetime对象基本上没什么区别，后面的微秒（<span class="math">$10^{-6}$</span>秒）有点区别完全可以理解。然后我们再看now方法如果不加任何参数会如何:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; now
datetime.datetime(2015, 7, 11, 16, 34, 43, 144018)
&gt;&gt;&gt; utcnow
datetime.datetime(2015, 7, 11, 8, 34, 56, 319108)
</code></pre></div>
<p>这里now显示的时间和本地的时间是一致的，说明now默认的时区是本地的时区参数。谈到这里大家应该就明白了，如果是后台数据库有日期时间输入需求，为了保持时间戳的一致性，推荐都使用utcnow方法来生成时间戳，也就是实际上都以UTC格林威治时区为准。如果到前端需要显示给用户具体的日期时间了，如果要引用前端数据库的日期时间，才需要引入时区的考虑进行必要的转换。然后如果前端需要用python生成实时的时间，那么就用now方法再引入pytz的时区控制。</p>
<h4 id="datetime对象的属性">datetime对象的属性</h4>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; d = datetime.now()
&gt;&gt;&gt; d.year
2015
&gt;&gt;&gt; d.month
11
&gt;&gt;&gt; d.day
3
&gt;&gt;&gt; d.hour
18
&gt;&gt;&gt; d.minute
42
&gt;&gt;&gt; d.second
57
&gt;&gt;&gt; d.tzinfo
&gt;&gt;&gt; d
datetime.datetime(2015, 11, 3, 18, 42, 57, 919613)
</code></pre></div>
<p>具体含义如下所示:</p>
<dl>
<dt>year</dt>
<dd>
<p>年</p>
</dd>
<dt>month</dt>
<dd>
<p>月</p>
</dd>
<dt>day</dt>
<dd>
<p>日</p>
</dd>
<dt>hour</dt>
<dd>
<p>时</p>
</dd>
<dt>minute</dt>
<dd>
<p>分</p>
</dd>
<dt>second</dt>
<dd>
<p>秒</p>
</dd>
<dt>microsecond</dt>
<dd>
<p>微秒</p>
</dd>
</dl>
<h4 id="strftime方法">strftime方法</h4>
<p>datetime对象可以如下调用 <code>strftime</code> 方法或者 <code>__format__</code>
方法来得到一个好看的你想要的日期时间字符串格式:</p>
<div class="highlight"><pre><span></span><code>    &gt;&gt;&gt; from datetime import datetime
    &gt;&gt;&gt; d = datetime.now()
    &gt;&gt;&gt; d.strftime('%T')
    '18:52:39'
    &gt;&gt;&gt; d.__format__('%F')
    '2015-11-03'
</code></pre></div>
<p>这里的格式符号python官方文档有所述及，而更实际上是和linux系统下的 <code>date</code>
命令的格式符一致的，读者可以用 <code>date --help</code>
来看一下，就可以看到如下信息:</p>
<div class="highlight"><pre><span></span><code>    %%      一个文字的 %
    %a      当前locale 的星期名缩写(例如： 日，代表星期日)
    %A      当前locale 的星期名全称 (如：星期日)
    %b      当前locale 的月名缩写 (如：一，代表一月)
    %B      当前locale 的月名全称 (如：一月)
    %c      当前locale 的日期和时间 (如：2005年3月3日 星期四 23:05:25)
    %C      世纪；比如 %Y，通常为省略当前年份的后两位数字(例如：20)
    %d      按月计的日期(例如：01)
    %D      按月计的日期；等于%m/%d/%y
    %e      按月计的日期，添加空格，等于%_d
    %F      完整日期格式，等价于 %Y-%m-%d
    %g      ISO-8601 格式年份的最后两位 (参见%G)
    %G      ISO-8601 格式年份 (参见%V)，一般只和 %V 结合使用
    %h      等于%b
    %H      小时(00-23)
    %I      小时(00-12)
    %j      按年计的日期(001-366)
    %k   hour, space padded ( 0..23); same as %_H
    %l   hour, space padded ( 1..12); same as %_I
    %m   month (01..12)
    %M   minute (00..59)
    %n      换行
    %N      纳秒(000000000-999999999)
    %p      当前locale 下的"上午"或者"下午"，未知时输出为空
    %P      与%p 类似，但是输出小写字母
    %r      当前locale 下的 12 小时时钟时间 (如：11:11:04 下午)
    %R      24 小时时间的时和分，等价于 %H:%M
    %s      自UTC 时间 1970-01-01 00:00:00 以来所经过的秒数
    %S      秒(00-60)
    %t      输出制表符 Tab
    %T      时间，等于%H:%M:%S
    %u      星期，1 代表星期一
    %U      一年中的第几周，以周日为每星期第一天(00-53)
    %V      ISO-8601 格式规范下的一年中第几周，以周一为每星期第一天(01-53)
    %w      一星期中的第几日(0-6)，0 代表周一
    %W      一年中的第几周，以周一为每星期第一天(00-53)
    %x      当前locale 下的日期描述 (如：12/31/99)
    %X      当前locale 下的时间描述 (如：23:13:48)
    %y      年份最后两位数位 (00-99)
    %Y      年份
    %z +hhmm                数字时区(例如，-0400)
    %:z +hh:mm              数字时区(例如，-04:00)
    %::z +hh:mm:ss  数字时区(例如，-04:00:00)
    %:::z                   数字时区带有必要的精度 (例如，-04，+05:30)
    %Z                      按字母表排序的时区缩写 (例如，EDT)
</code></pre></div>
<p>其中的 <code>%F</code> 和 <code>%T</code> 在python官方文档中并无说明，可见其内部API是和这个
<code>date</code> 命令一致的。</p>
<h4 id="支持的时间间隔运算">支持的时间间隔运算</h4>
<p>前面提到了一个datetime对象减去一个timedelta对象返回一个datetime对象，然后一个datetime对象减去一个datetime对象返回一个时间间隔对象。比如此时之前一年的时间可以这样表达
<code>datetime.datetime.utcnow() - datetime.timedelta(365)</code>
。然后此时和爱因斯坦的生日时间间隔可以这样表达:</p>
<div class="highlight"><pre><span></span><code>datetime.datetime.utcnow() - datetime.datetime(1879,03,14)
</code></pre></div>
<p>然后我们可以利用这个时间间隔来进行一些操作和判断。</p>
<div class="highlight"><pre><span></span><code>    &gt;&gt;&gt; delta = datetime.datetime.utcnow() - datetime.datetime(1879,03,14)
    &gt;&gt;&gt; delta
    datetime.timedelta(49792, 35970, 903285)
    &gt;&gt;&gt; delta &gt; datetime.timedelta(120*365)
    True
    &gt;&gt;&gt; delta.days // 365
    136
</code></pre></div>
<h3 id="struct_time-对象转化成为-datetime-对象">`struct_time`` 对象转化成为 datetime 对象</h3>
<p>参看<a href="http://stackoverflow.com/questions/1697815/how-do-you-convert-a-python-time-struct-time-object-into-a-datetime-object">这个网页</a></p>
<div class="highlight"><pre><span></span><code>from time import mktime
</code></pre></div>
<p>mktime函数接受time模块的 <code>struct_time</code> object，其可以来自time模块的
<code>gmtime</code> 、<code>localtime</code> 、 <code>strptime</code>
这些函数，mktime函数将返回一个时间戳，然后用datetime模块的
<code>fromtimestamp</code> 函数可以接受这个时间戳。</p>
<p>总的过程即:</p>
<div class="highlight"><pre><span></span><code>from time import mktime
from datetime import datetime

dt = datetime.fromtimestamp(mktime(struct))
</code></pre></div>
<h3 id="datetime-对象转化为-time_struct-对象">datetime 对象转化为 `time_struct`` 对象</h3>
<p>参考了 <a href="http://stackoverflow.com/questions/8022161/python-converting-from-datetime-datetime-to-time-time">这个网页</a></p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; t = datetime.datetime.now()
&gt;&gt;&gt; t
datetime.datetime(2011, 11, 5, 11, 26, 15, 37496)

&gt;&gt;&gt; time.mktime(t.timetuple()) + t.microsecond / 1E6
1320517575.037496
</code></pre></div>
<h3 id="获取一个月最后的一天">获取一个月最后的一天</h3>
<p>首先要说的是利用python的datetime和timedelta对于 <code>days</code> 的加减操作是能够很好地支持跨月问题的:</p>
<div class="highlight"><pre><span></span><code>    &gt;&gt;&gt; from datetime import datetime
    &gt;&gt;&gt; d = datetime.now()
    &gt;&gt;&gt; d
    datetime.datetime(2016, 5, 29, 8, 50, 20, 337204)
    &gt;&gt;&gt; from datetime import timedelta
    &gt;&gt;&gt; d - timedelta(days = 29)
    datetime.datetime(2016, 4, 30, 8, 50, 20, 337204)
    &gt;&gt;&gt; d - timedelta(days = 28)
    datetime.datetime(2016, 5, 1, 8, 50, 20, 337204)
</code></pre></div>
<p>但是有的时候你就是需要直接获知某个月份的最后一天是30还是31等等，然后利用replace来获得一个月的最后一天。这个时候你需要利用 calendar 的 <code>monthrange</code> 函数。参考了 <a href="http://stackoverflow.com/questions/42950/get-last-day-of-the-month-in-python">这个网页</a> 。</p>
<div class="highlight"><pre><span></span><code>    &gt;&gt;&gt; d.replace(year = 2016,month=4,day = monthrange(2016,4)[-1])
    datetime.datetime(2016, 4, 30, 8, 50, 20, 337204)
</code></pre></div>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [["$$", "$$"], ['\\[', '\\]']],
    packages: {
      '[+]': ['mhchem']
    }
  },
  loader: {
    load: ['[tex]/mhchem']
  },
}
</script>
<script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
            </div>
        </div>

    </div>
</div>
        </main>
        
        <footer class="footer">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <span class="nav-link text-muted px-2">Created by Wanze & Companion with</span></li>
                <li class="nav-item">
                    <a class="nav-link text-muted px-2" href="https://python.org/">Python</a></li>
                <li class="nav-item">
                    <a class="nav-link text-muted px-2" href="http://getpelican.com/">Pelican</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-muted px-2" href="https://github.com/Python-Markdown/markdown">Markdown</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-muted px-2" href="http://oncrashreboot.com/pelican-elegant">Elegant</a></li>
                <li class="nav-item">
                    <a class="nav-link text-muted px-2" href="https://www.javascript.com/">Javascript</a></li>
                <li class="nav-item">
                    <a class="nav-link text-muted px-2" href="https://www.mathjax.org/">Mathjax</a>
                </li>
                <li class="nav-item">
                    <span class="nav-link text-muted px-2">etc...</span></li>
            </ul>
        </footer>
    </div>

    <script src="https://a358003542.github.io/theme/lodash/js/lodash.min.js"></script>
    <script src="https://a358003542.github.io/theme/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://a358003542.github.io/theme/js/base.js"></script>

<script src="https://a358003542.github.io/theme/js/article.js"></script>


</body>

</html>