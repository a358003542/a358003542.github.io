<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="D4VqC4HppC"/>
    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625"/>

        <meta name="author" content="cdwanze"/>
        <meta name="copyright" content="cdwanze"/>

        <meta property="og:type" content="article"/>
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", 基础, " />

<meta property="og:title" content="sql数据库基础 "/>
<meta property="og:url" content="/articles/sqlshu-ju-ku-ji-chu.html" />
<meta property="og:description" content="本小节主要结合sqlite3来简要说明sql数据库的一些基本理论知识。至于其他SQL数据库比如mysql，postgresql等具体实现的相关知识本文不会讨论。 基本术语 数据库（database）简单的理解就是一个文件柜。然后DBMS（database management system）是数据库管理系统。而所谓的 table 表你可以将其看作文件柜里的一个结构化了的文件。在表格里面的数据都是 按行存储 的，这个要在头脑中牢记。然后一行数据称之为一个 记录 。SQL（Structured Query Language）的意思是结构化查询语言。 sqlite3的安装就不罗嗦了，若有问题请从网络查阅之。 第一个例子 sqlite3和postgresql不同，其没有客户端/服务器的概念，就是直接的文件管理，sqlite3的数据库就是一个文件，然后如果连接到某个不存在的文件，就会自动创建对应的数据库文件。删除数据库当然就是删除数据库文件即可，这一块sqlite3很简单。 现在我们往这个数据库里面加入一点东西: wanze@wanze-ubuntu64:~/桌面$ sqlite3 mydb SQLite version 3.8.2 …" />
<meta property="og:site_name" content="cdwanze的博文" />
<meta property="og:article:author" content="cdwanze" />
<meta property="og:article:published_time" content="2018-06-24T00:00:00+08:00" />
<meta name="twitter:title" content="sql数据库基础 ">
<meta name="twitter:description" content="本小节主要结合sqlite3来简要说明sql数据库的一些基本理论知识。至于其他SQL数据库比如mysql，postgresql等具体实现的相关知识本文不会讨论。 基本术语 数据库（database）简单的理解就是一个文件柜。然后DBMS（database management system）是数据库管理系统。而所谓的 table 表你可以将其看作文件柜里的一个结构化了的文件。在表格里面的数据都是 按行存储 的，这个要在头脑中牢记。然后一行数据称之为一个 记录 。SQL（Structured Query Language）的意思是结构化查询语言。 sqlite3的安装就不罗嗦了，若有问题请从网络查阅之。 第一个例子 sqlite3和postgresql不同，其没有客户端/服务器的概念，就是直接的文件管理，sqlite3的数据库就是一个文件，然后如果连接到某个不存在的文件，就会自动创建对应的数据库文件。删除数据库当然就是删除数据库文件即可，这一块sqlite3很简单。 现在我们往这个数据库里面加入一点东西: wanze@wanze-ubuntu64:~/桌面$ sqlite3 mydb SQLite version 3.8.2 …">

    <title>
sql数据库基础  · cdwanze的博文
</title>


        <link href="/theme/css/font-awesome.css" rel="stylesheet"
              media="screen">
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet"
              media="screen">

            <link rel="stylesheet" type="text/css"
                  href="/theme/css/pygments.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="/theme/css/elegant.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="/theme/css/custom.css" media="screen">






</head>
<body>

<nav class="navbar">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="https://www.cdwanze.work"><span
                    class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <form action="/search.html"
                  onsubmit="return validateForm(this.elements['q'].value);"
                  class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" name="q" id="tipue_search_input"
                           class="form-control" placeholder="Search..."
                           style="width:430px;">
                </div>
                <button class="btn btn-default" type="submit">搜索</button>
            </form>


            <ul class="nav navbar-nav nav-pills navbar-right">
                <li >
                    <a href="">博文首页</a></li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle"
                           data-toggle="dropdown" role="button"
                           aria-haspopup="true" aria-expanded="false">查找文章<span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a class="slowscroll" href="/categories.html">按分类</a>
                            </li>
                            <li><a class="slowscroll" href="/tags.html">按标签</a>
                            </li>
                        </ul>
                    </li>


                        <li >
                            <a href="/guan-yu-ben-wang-zhan.html">关于本网站</a>
                        </li>
                        <li >
                            <a href="/gong-gao.html">公告</a>
                        </li>
            </ul>


        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">
<article>
<div class="row">
    <header class="page-header col-md-10 col-md-offset-2">
    <h1><a href="/articles/sqlshu-ju-ku-ji-chu.html"> sql数据库基础  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-md-2 table-of-content">
        <nav>
        <h4>目录</h4>
        <div class="toc">
<ul>
<li><a href="#_1">基本术语</a></li>
<li><a href="#_2">第一个例子</a></li>
<li><a href="#create-table">CREATE TABLE</a></li>
<li><a href="#_3">字段数据类型</a></li>
<li><a href="#_4">字段约束词</a><ul>
<li><a href="#primary-key">PRIMARY KEY</a></li>
<li><a href="#not-null">NOT NULL</a></li>
<li><a href="#default">DEFAULT</a></li>
<li><a href="#_5">创建表格如果表格不存在</a></li>
</ul>
</li>
<li><a href="#_6">更改表格属性</a></li>
<li><a href="#_7">删除表格</a></li>
<li><a href="#_8">插入记录</a><ul>
<li><a href="#_9">不重复插入</a></li>
</ul>
</li>
<li><a href="#_10">更新记录</a></li>
<li><a href="#_11">删除记录</a></li>
<li><a href="#_12">查询记录</a><ul>
<li><a href="#_13">排序</a></li>
<li><a href="#_14">按多个列排序</a></li>
<li><a href="#_15">降序排序</a></li>
<li><a href="#_16">过滤数据</a></li>
</ul>
</li>
<li><a href="#_17">外键引用</a></li>
<li><a href="#sql">SQL关系模型浅谈</a><ul>
<li><a href="#_18">内部联接</a></li>
</ul>
</li>
<li><a href="#_19">视图</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="col-md-8 article-content">

            
            
<p>本小节主要结合sqlite3来简要说明sql数据库的一些基本理论知识。至于其他SQL数据库比如mysql，postgresql等具体实现的相关知识本文不会讨论。</p>
<h2 id="_1">基本术语</h2>
<p>数据库（database）简单的理解就是一个文件柜。然后DBMS（database management system）是数据库管理系统。而所谓的 <strong>table</strong> 表你可以将其看作文件柜里的一个结构化了的文件。在表格里面的数据都是 <em>按行存储</em> 的，这个要在头脑中牢记。然后一行数据称之为一个 <strong>记录</strong>  。SQL（Structured Query Language）的意思是结构化查询语言。</p>
<p>sqlite3的安装就不罗嗦了，若有问题请从网络查阅之。</p>
<h2 id="_2">第一个例子</h2>
<p>sqlite3和postgresql不同，其没有客户端/服务器的概念，就是直接的文件管理，sqlite3的数据库就是一个文件，然后如果连接到某个不存在的文件，就会自动创建对应的数据库文件。删除数据库当然就是删除数据库文件即可，这一块sqlite3很简单。</p>
<p>现在我们往这个数据库里面加入一点东西:</p>
<div class="highlight"><pre><span></span><span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>桌面$ <span class="nv">sqlite3</span> <span class="nv">mydb</span>
<span class="nv">SQLite</span> <span class="nv">version</span> <span class="mi">3</span>.<span class="mi">8</span>.<span class="mi">2</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">06</span> <span class="mi">14</span>:<span class="mi">53</span>:<span class="mi">30</span>
<span class="nv">Enter</span> <span class="s2">"</span><span class="s">.help</span><span class="s2">"</span> <span class="k">for</span> <span class="nv">instructions</span>
<span class="nv">Enter</span> <span class="nv">SQL</span> <span class="nv">statements</span> <span class="nv">terminated</span> <span class="nv">with</span> <span class="nv">a</span> <span class="s2">"</span><span class="s">;</span><span class="s2">"</span>
<span class="nv">sqlite</span><span class="o">&gt;</span> <span class="nv">create</span> <span class="nv">table</span> <span class="nv">mytable</span><span class="ss">(</span><span class="nv">id</span> <span class="nv">integer</span> <span class="nv">primary</span> <span class="nv">key</span>, <span class="nv">name</span> <span class="nv">text</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">sqlite</span><span class="o">&gt;</span> <span class="nv">insert</span> <span class="nv">into</span> <span class="nv">mytable</span><span class="ss">(</span><span class="nv">id</span>,<span class="nv">name</span><span class="ss">)</span> <span class="nv">values</span><span class="ss">(</span><span class="mi">1</span>,<span class="s2">"</span><span class="s">Micheal</span><span class="s2">"</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">sqlite</span><span class="o">&gt;</span> <span class="nv">select</span> <span class="o">*</span> <span class="nv">from</span> <span class="nv">mytable</span><span class="c1">;</span>
<span class="mi">1</span><span class="o">|</span><span class="nv">Micheal</span>
<span class="nv">sqlite</span><span class="o">&gt;</span> .<span class="nv">table</span>
<span class="nv">mytable</span>
<span class="nv">sqlite</span><span class="o">&gt;</span> .<span class="nv">database</span>
<span class="nv">seq</span>  <span class="nv">name</span>             <span class="nv">file</span>                                                      
<span class="o">---</span>  <span class="o">---------------</span>  <span class="o">----------------------------------------------------------</span>
<span class="mi">0</span>    <span class="nv">main</span>             <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">wanze</span><span class="o">/</span>桌面<span class="o">/</span><span class="nv">mydb</span>                                   
<span class="nv">sqlite</span><span class="o">&gt;</span> .<span class="nv">header</span> <span class="nv">on</span> 
<span class="nv">sqlite</span><span class="o">&gt;</span> <span class="nv">select</span> <span class="o">*</span> <span class="nv">from</span> <span class="nv">mytable</span><span class="c1">;</span>
<span class="nv">id</span><span class="o">|</span><span class="nv">name</span>
<span class="mi">1</span><span class="o">|</span><span class="nv">Micheal</span>
</pre></div>
<p>这个例子首先连接之前创建的mydb数据库，然后通过CREATE TABLE语句来创建database数据库里面的一个表，接下来用INSERT INTO语句来给某个表插入一些数据，然后用SELECT语句来查看这些数据。</p>
<p>然后</p>
<ul>
<li><code>.database</code> 列出当前连接的数据库信息</li>
<li><code>.table</code> 列出当前表格的信息</li>
<li><code>.header on</code> 显示SQL表格头</li>
<li><code>.quit</code> 退出sqlite3命令行</li>
<li>你还可以通过 <code>.help</code> 来查看更多相关信息。</li>
</ul>
<h2 id="create-table">CREATE TABLE</h2>
<p>如下所示就是创建表格的命令格式:</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mytable</span><span class="p">(</span>
  <span class="n">id</span>     <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> 
  <span class="n">name</span>   <span class="nb">TEXT</span><span class="p">);</span>
</pre></div>
<p>这里的mytable就是具体创建的表格名字，然后接下来每一行定义了具体表格的某一个字段或者说某一列。第一个是字段的名字，第二个是字段的数据类型定义，后面可选的还可以跟上其他一些约束词。下面先就字段的数据类型做出一些说明。</p>
<h2 id="_3">字段数据类型</h2>
<p>按照 <a href="https://www.sqlite.org/datatype3.html">sqlite3官方文档</a> 的介绍 ，其就支持五种数据类型：</p>
<ul>
<li>NULL 空值</li>
<li>INTEGER 整型</li>
<li>REAL 浮点型</li>
<li>TEXT 字符串型</li>
<li>BLOB 字节流型</li>
</ul>
<p>然后sqlite3关于你的类型声明字符串还建立了一套语法糖规则，具体语法糖规则如下所示:</p>
<ul>
<li>如果没有类型声明，则视为none affinity;</li>
<li>如果在声明字符串中看到"int"（不区分大小写）这个子字符串，那么就视为integer affinity；</li>
<li>继续，接下来如果找到"char"或者"clob"或者"text"，则视为text affinity；所以varchar(80)会被简单视为text affinity;</li>
<li>继续，接下来如果找到"blob"，则视为blob，如果没数据类型声明，则视为none affinity;</li>
<li>继续，接下来如果找到"real"或者"floa"或者"doub"，则视为float affinity;</li>
<li>然后其他的都视为numeric affinity。</li>
</ul>
<p>这里什么affinity是sqlite特有的概念，比如text affinity和前面的内置TEXT字符串型是不同的，其可能对应的是NULL，TEXT或BLOB。然后如果输入的数值则会自动将其转换成为字符串型。然后NUMERIC会自动分配成为INTEGER或REAL型，如果输入的字符串还负责转化。等等，总之我们在心里知道sqlite3在类型声明上是很灵活的就行了，具体使用还是严格按照自己喜欢的一套类型声明即可，比如这五个:  <code>null int float text blob</code> 或者 <code>null integer float varchar blob</code> 等等。</p>
<h2 id="_4">字段约束词</h2>
<p>请看下面这个例子:</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span><span class="p">(</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">id</span>  <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">name</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">quantity</span>  <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">1</span><span class="p">,</span>
   <span class="p">...</span><span class="o">&gt;</span>   <span class="n">price</span> <span class="nb">real</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">);</span>
</pre></div>
<h3 id="primary-key">PRIMARY KEY</h3>
<p>一个表格只能有一个PRIMARY KEY，被PRIMARY KEY约束的字段值必须唯一且不为空，从而使其能够成为本表格中各个记录的唯一标识。表格中可以有一个列或者几个列被选定为primary key。值得一提的是 <code>integer primary key</code> 自动有了自动分配的属性，也就是大家清楚的id那一列，即使不赋值，也会自动添加。</p>
<h3 id="not-null">NOT NULL</h3>
<p>约束该字段不可取空值，也就是该字段必须赋值的意思。</p>
<h3 id="default">DEFAULT</h3>
<p>指定该字段的默认值。</p>
<h3 id="_5">创建表格如果表格不存在</h3>
<div class="highlight"><pre><span></span><span class="nv">create</span> <span class="nv">table</span> <span class="k">if</span> <span class="nv">not</span> <span class="nv">exists</span> <span class="nv">department</span>
 <span class="ss">(</span><span class="nv">dept_id</span> <span class="nv">int</span> <span class="nv">primary</span> <span class="nv">key</span>,
  <span class="nv">name</span> <span class="nv">varchar</span> <span class="nv">not</span> <span class="nv">null</span>
 <span class="ss">)</span><span class="c1">;</span>
</pre></div>
<h2 id="_6">更改表格属性</h2>
<p>sqlite3更改表格属性的功能是很有限的，就只有两个，一个是更改表格名字，还一个是新建一个字段。所以sqlite3主要还是靠CREATE TABLE的时候就把各个字段属性设置好（因为后面有迁移需要则需要单独写脚本）。具体使用就是使用 <code>ALTER TABLE</code> 语句，如下所示:</p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tablename</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">new_tablename</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tablename</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">column_name</span> <span class="n">column_datatype</span><span class="p">;</span>
</pre></div>
<h2 id="_7">删除表格</h2>
<p>删除前请慎重。</p>
<div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">tablename</span><span class="p">;</span>
</pre></div>
<h2 id="_8">插入记录</h2>
<p>插入一条记录如前所示使用 <code>INSERT INTO</code> 语句，具体如下所示：</p>
<div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">products</span> <span class="p">(</span><span class="n">product_no</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="err">’</span><span class="n">Cheese</span><span class="err">’</span><span class="p">,</span> <span class="mi">9</span><span class="p">.</span><span class="mi">99</span><span class="p">);</span>
</pre></div>
<p>这是推荐的风格，后面圆括号跟着的列名不一定是按照顺序来，只是和后面的值一一对应，而且一条记录里面的所有列也不需要都列出来，不写的会按照默认值来处理。INSERT INTO语句是通用的。</p>
<p>如果只是需要简单插入新的一行的数据那么可以直接使用之前的insert into语句。</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">mytable</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">mytable</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>        <span class="n">age</span>
<span class="c1">----------  ----------  ----------</span>
<span class="mi">1</span>           <span class="n">Alice</span>
<span class="mi">2</span>           <span class="n">Betty</span>
<span class="mi">3</span>           <span class="n">Cassie</span>
<span class="mi">4</span>           <span class="n">Doris</span>
<span class="mi">5</span>           <span class="n">Emily</span>
<span class="mi">6</span>           <span class="n">Abby</span>
<span class="mi">7</span>           <span class="n">Bella</span>
<span class="mi">8</span>                       <span class="mi">6</span>
</pre></div>
<h3 id="_9">不重复插入</h3>
<p>只有主键值不重复才插入：</p>
<div class="highlight"><pre><span></span><span class="k">insert</span> <span class="k">or</span> <span class="k">ignore</span> <span class="k">into</span> <span class="n">department</span> <span class="p">(</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Operations'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">or</span> <span class="k">ignore</span> <span class="k">into</span> <span class="n">department</span> <span class="p">(</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="k">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Loans'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">or</span> <span class="k">ignore</span> <span class="k">into</span> <span class="n">department</span> <span class="p">(</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="k">values</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'Administration'</span><span class="p">);</span>
</pre></div>
<h2 id="_10">更新记录</h2>
<p>下面的语句用于更新某个特定的表格的数据：</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">18</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">mytable</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>        <span class="n">age</span>
<span class="c1">----------  ----------  ----------</span>
<span class="mi">1</span>           <span class="n">Alice</span>       <span class="mi">18</span>
<span class="mi">2</span>           <span class="n">Betty</span>
<span class="mi">3</span>           <span class="n">Cassie</span>
<span class="mi">4</span>           <span class="n">Doris</span>
<span class="mi">5</span>           <span class="n">Emily</span>
<span class="mi">6</span>           <span class="n">Abby</span>
<span class="mi">7</span>           <span class="n">Bella</span>
<span class="mi">8</span>                       <span class="mi">6</span>
</pre></div>
<h2 id="_11">删除记录</h2>
<div class="highlight"><pre><span></span><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">price</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">products</span><span class="p">;</span>
</pre></div>
<p>注意：第二个语句表内所有记录都将被删除！ DELETE FROM 语句是通用的。</p>
<h2 id="_12">查询记录</h2>
<p>为了后面讲解方便，这里根据前面的第一个例子简单创建一个数据库，具体代码如下：</p>
<div class="highlight"><pre><span></span><span class="o">~</span><span class="err">$</span> <span class="n">sqlite3</span> <span class="n">test</span><span class="p">.</span><span class="n">db</span>

<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">name</span> <span class="nb">TEXT</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'Alice'</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">'Betty'</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">'Cassie'</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s1">'Doris'</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="s1">'Emily'</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">header</span> <span class="k">on</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="k">mode</span> <span class="k">column</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>
<span class="c1">----------  ----------</span>
<span class="mi">1</span>           <span class="n">Alice</span>
<span class="mi">2</span>           <span class="n">Betty</span>
<span class="mi">3</span>           <span class="n">Cassie</span>
<span class="mi">4</span>           <span class="n">Doris</span>
<span class="mi">5</span>           <span class="n">Emilyv</span>
</pre></div>
<p>检索的基本语法如下：</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">mytable</span><span class="p">;</span>
</pre></div>
<p>想要显示多个列则写上多个列名，列名之间用逗号隔开。检索所有列就是列名处用通配符 \verb+*+ 来匹配所有列。</p>
<h3 id="_13">排序</h3>
<p>用SELECT语句默认情况是没有排序的，如果需要排序则需要使用ORDER BY字句。现在又插入几个新名字：</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">'Abby'</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="s1">'Bella'</span><span class="p">);</span>
</pre></div>
<p>如果我们需要输入结果按照name来排序则：</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">name</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>
<span class="c1">----------  ----------</span>
<span class="mi">6</span>           <span class="n">Abby</span>
<span class="mi">1</span>           <span class="n">Alice</span>
<span class="mi">7</span>           <span class="n">Bella</span>
<span class="mi">2</span>           <span class="n">Betty</span>
<span class="mi">3</span>           <span class="n">Cassie</span>
<span class="mi">4</span>           <span class="n">Doris</span>
<span class="mi">5</span>           <span class="n">Emily</span>
</pre></div>
<h3 id="_14">按多个列排序</h3>
<p>首先更新之前的表格的一些数据。</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">mytable</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">age</span> <span class="nb">int</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">UPDATE</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">18</span> <span class="k">WHERE</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">20</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">6</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">25</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">30</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">5</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">66</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">6</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">mytable</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">20</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">7</span><span class="p">;</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">mytable</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="s1">'Alice'</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>        <span class="n">age</span>
<span class="c1">----------  ----------  ----------</span>
<span class="mi">1</span>           <span class="n">Alice</span>       <span class="mi">18</span>
<span class="mi">2</span>           <span class="n">Betty</span>       <span class="mi">20</span>
<span class="mi">3</span>           <span class="n">Cassie</span>      <span class="mi">6</span>
<span class="mi">4</span>           <span class="n">Doris</span>       <span class="mi">25</span>
<span class="mi">5</span>           <span class="n">Emily</span>       <span class="mi">30</span>
<span class="mi">6</span>           <span class="n">Abby</span>        <span class="mi">66</span>
<span class="mi">7</span>           <span class="n">Bella</span>       <span class="mi">20</span>
<span class="mi">8</span>           <span class="n">Alice</span>       <span class="mi">20</span>
</pre></div>
<p>现在开始按多个列排序：</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span> <span class="p">,</span> <span class="n">age</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>        <span class="n">age</span>
<span class="c1">----------  ----------  ----------</span>
<span class="mi">6</span>           <span class="n">Abby</span>        <span class="mi">66</span>
<span class="mi">1</span>           <span class="n">Alice</span>       <span class="mi">18</span>
<span class="mi">8</span>           <span class="n">Alice</span>       <span class="mi">20</span>
<span class="mi">7</span>           <span class="n">Bella</span>       <span class="mi">20</span>
<span class="mi">2</span>           <span class="n">Betty</span>       <span class="mi">20</span>
<span class="mi">3</span>           <span class="n">Cassie</span>      <span class="mi">6</span>
<span class="mi">4</span>           <span class="n">Doris</span>       <span class="mi">25</span>
<span class="mi">5</span>           <span class="n">Emily</span>       <span class="mi">30</span>
</pre></div>
<p>我们看到首先按name排序，如果名字相同则按age排序。</p>
<h3 id="_15">降序排序</h3>
<p>ORDER BY字句默认排序是升序，如果想要其为降序则使用DESC关键词，如下所示:</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span> <span class="p">,</span> <span class="n">age</span> <span class="k">DESC</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>        <span class="n">age</span>
<span class="c1">----------  ----------  ----------</span>
<span class="mi">6</span>           <span class="n">Abby</span>        <span class="mi">66</span>
<span class="mi">8</span>           <span class="n">Alice</span>       <span class="mi">20</span>
<span class="mi">1</span>           <span class="n">Alice</span>       <span class="mi">18</span>
<span class="mi">7</span>           <span class="n">Bella</span>       <span class="mi">20</span>
<span class="mi">2</span>           <span class="n">Betty</span>       <span class="mi">20</span>
<span class="mi">3</span>           <span class="n">Cassie</span>      <span class="mi">6</span>
<span class="mi">4</span>           <span class="n">Doris</span>       <span class="mi">25</span>
<span class="mi">5</span>           <span class="n">Emily</span>       <span class="mi">30</span>
</pre></div>
<p>DESC关键词要放在想要降序排序的列的后面。如果想要多个列降序排序，则那些列 \uline{都要加上DESC关键词} 。</p>
<h3 id="_16">过滤数据</h3>
<p>SQL用WHERE字句来达到查询时过滤数据的功能，如果同时有WHERE字句和ORDER BY字句，则ORDER BY字句要放在后面。</p>
<p>一个简单的例子如下所示:</p>
<div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="k">WHERE</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span>
<span class="n">id</span>          <span class="n">name</span>        <span class="n">age</span>       
<span class="c1">----------  ----------  ----------</span>
<span class="mi">1</span>           <span class="n">Alice</span>       <span class="mi">18</span>        
<span class="mi">2</span>           <span class="n">Betty</span>       <span class="mi">20</span>        
<span class="mi">3</span>           <span class="n">Cassie</span>      <span class="mi">6</span>         
<span class="mi">4</span>           <span class="n">Doris</span>       <span class="mi">25</span>        
<span class="mi">7</span>           <span class="n">Bella</span>       <span class="mi">20</span>        
<span class="mi">8</span>           <span class="n">Alice</span>       <span class="mi">20</span>
</pre></div>
<p>如果后面的值是字符串则需要加上单引号，如:  'string' ，这些比较符号的含义都是一目了然的，如: = , &lt;&gt; , != , &lt; , &lt;= , !&lt; , &gt; , &gt;= ,!&gt; 。此外还有  BETWEEN 在两个值之间， IS NULL 判断是否为NULL值。</p>
<p>BETWEEN的使用如下:</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_price</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="k">BETWEEN</span> <span class="mi">5</span> <span class="k">AND</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
<p>NULL 无值，它与字段包含0，空字符串等不同。 IS NULL 用法如下:</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">prod_name</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span>
</pre></div>
<h2 id="_17">外键引用</h2>
<p>外键引用在sqlite3中必须加上这一行设置:</p>
<div class="highlight"><pre><span></span><span class="n">PRAGMA</span> <span class="n">foreign_keys</span> <span class="o">=</span> <span class="k">ON</span><span class="p">;</span>
</pre></div>
<p>然后后面加入外键引用的语法和mysql有点类似，除了没有 <code>constraint pk_product_type</code> 这一描述外。然后sqlite3里面并没有 \textbf{date} 类型的，其内部会自动处理为text,int或real等类型。但我们在声明的时候还是可以这样写的，然后值得一提的是sqlite3里面有一些date相关函数支持。</p>
<p>关于外键引用更多信息请参看 <a href="https://www.sqlite.org/foreignkeys.html">官方文档的这里</a> 。</p>
<div class="highlight"><pre><span></span><span class="nv">PRAGMA</span> <span class="nv">foreign_keys</span> <span class="o">=</span> <span class="nv">ON</span><span class="c1">;</span>

<span class="nv">create</span> <span class="nv">table</span> <span class="k">if</span> <span class="nv">not</span> <span class="nv">exists</span> <span class="nv">employee</span>
 <span class="ss">(</span><span class="nv">emp_id</span> <span class="nv">int</span>  <span class="nv">primary</span> <span class="nv">key</span>,
  <span class="nv">fname</span> <span class="nv">varchar</span> <span class="nv">not</span> <span class="nv">null</span>,
  <span class="nv">lname</span> <span class="nv">varchar</span> <span class="nv">not</span> <span class="nv">null</span>,
  <span class="nv">start_date</span> <span class="nv">date</span> <span class="nv">not</span> <span class="nv">null</span>,
  <span class="nv">end_date</span> <span class="nv">date</span>,
  <span class="nv">superior_emp_id</span> <span class="nv">int</span> ,
  <span class="nv">dept_id</span> <span class="nv">int</span> ,
  <span class="nv">title</span> <span class="nv">varchar</span>,
  <span class="nv">assigned_branch_id</span> <span class="nv">int</span> ,
    <span class="nv">foreign</span> <span class="nv">key</span> <span class="ss">(</span><span class="nv">superior_emp_id</span><span class="ss">)</span> <span class="nv">references</span> <span class="nv">employee</span> <span class="ss">(</span><span class="nv">emp_id</span><span class="ss">)</span>,
    <span class="nv">foreign</span> <span class="nv">key</span> <span class="ss">(</span><span class="nv">dept_id</span><span class="ss">)</span> <span class="nv">references</span> <span class="nv">department</span> <span class="ss">(</span><span class="nv">dept_id</span><span class="ss">)</span>,
    <span class="nv">foreign</span> <span class="nv">key</span> <span class="ss">(</span><span class="nv">assigned_branch_id</span><span class="ss">)</span> <span class="nv">references</span> <span class="nv">branch</span> <span class="ss">(</span><span class="nv">branch_id</span><span class="ss">)</span>
 <span class="ss">)</span><span class="c1">;</span>
</pre></div>
<h2 id="sql">SQL关系模型浅谈</h2>
<h3 id="_18">内部联接</h3>
<p>关于联接的抽象理论讨论还是很有必要的，这里我也谈论一些，但具体还是需要读者自己沉思。我们把一个SQL表格看作一个对应外部世界的模型，你可以将其看作柏拉图所谈论的理念。然后就作为外部世界各个模型来说，彼此之间有两种关系: 第一种是继承关系，第二种是组合关系。所谓继承关系是指对于每一个苹果实体来说，它有各种各样的属性，我们不可能将其装入一个数据库中，比如说本苹果实体的供应商信息，本苹果的重量颜色信息等等。更合理的做法是我们将描述苹果（或者所有产品）供应商信息单独放入一个模型，然后将描述苹果重量颜色等信息也单独放入一个模型，除此之外还有水果店信息等等。我们在实际处理的时候，常常各个衍生模型都有一个 <code>parent_id</code> 类似这样的字段属性来描述本衍生模型的该记录所对应的实际母体parent是谁，从而将多个衍生模型在一个实体对象上统一起来，从而形成表的联接。你可以看作表的联接的最终成果就是你心目中所想的那个超大型SQL表格，对应的是苹果这个模型，里面存放着所有一切和该苹果相关的属性信息。然后你用SELECT语句查一下即可。</p>
<p>第二个组合关系就是苹果由苹果皮和苹果肉等部分组成，各子部分和母体一样具有某种实体性，这个时候我们应该在苹果这个模型上加入如同 <code>pingguopi_id</code> 和 <code>pingguorou_id</code> 这样的字段属性，然后约定其他以 <code>_id</code> 结尾的都视作本苹果的组成部分，不是的都视作非其他组成部分独独为我苹果模型所有的属性。这个组合关系也很重要，在后面再谈及，下面主要谈论表格的联接，而这里表格的联接主要在描述模型之间的继承关系。</p>
<p>具体语法如下所示:</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span><span class="n">price</span><span class="p">,</span><span class="n">weight</span>
<span class="k">FROM</span> <span class="n">Supplier</span><span class="p">,</span><span class="n">Info</span>
<span class="k">WHERE</span> <span class="n">Supplier</span><span class="p">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="n">parent_id</span>
</pre></div>
<p>这里我们约定Supplier和Info这两个衍生模型内存储的 <code>parent_id</code> 具体就应该Pingguo这个模型中的记录号。然后记录号相等就代表着同一个苹果实体。然后将这同一个苹果实体的name, price, weight 等属性列出来。</p>
<p>如果不使用WHERE字句会执行笛卡尔乘积操作，各个字段属性随意组合，没有任何现实意义了。</p>
<p>按照SQL规范，已经不推荐使用这样的WHERE字句表达了，上面的内部联接（INNER JOIN）语句更推荐的是写成这样的形式:</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span><span class="n">price</span><span class="p">,</span><span class="n">weight</span>
<span class="k">FROM</span> <span class="n">Supplier</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Info</span>
<span class="k">ON</span> <span class="n">Supplier</span><span class="p">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="n">parent_id</span>
</pre></div>
<p>SQL语法里面有一个专门的术语来形容上面的这个SELECT语句，叫做内部联接。注意WHERE变成了ON，然后使用关键词INNER JOIN。SQL联接默认方式就是内部联接。</p>
<h2 id="_19">视图</h2>
<p>视图是虚拟的表，其自身并不包含数据，更确切来说只是一种检索手段。视图可以嵌套视图，但需要注意的是视图因为不包含数据，依赖于检索，所以过多使用视图会很降低性能。</p>
            
            
            <hr/>

        </div>
        <section>
        <div class="col-md-2" style="float:right;font-size:0.9em;">
            <h4>首发于：</h4>
            <time pubdate="pubdate" datetime="2018-06-24T00:00:00+08:00">2018年 6月 24日 </time>
            <h4>分类：</h4>
            <a class="category-link" href="/categories.html#ji-chu-ref">基础</a>
        </div>
        </section>
</div>
</article>
    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>


<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="http://www.cdwanze.work" title="cdwanze Home Page">cdwanze</a></li>
    </ul>
</div>
</footer>

        <script src="/theme/js/jquery.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
    <script>
        function validateForm(query) {
            return (query.length > 0);
        }
    </script>

    <script>
        function adjust_search_width() {
            var w = document.documentElement.clientWidth;
            if ((w > 755) && (w < 975)) {
                plus_width = w - 755;
                $('.navbar-form .form-control').outerWidth(210 + plus_width);
            } else if (w >= 975) {
                $('.navbar-form .form-control').outerWidth(210 + 220);
            } else if (w <= 755) {
                $('.navbar-form .form-control').css('width', '100%')
            }
        }

        $(document).ready(function () {
            adjust_search_width();
        });

        window.onresize = function () {
            adjust_search_width();
        }

    </script>


    



</body>
</html>