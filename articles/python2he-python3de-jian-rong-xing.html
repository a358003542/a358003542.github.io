<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="D4VqC4HppC"/>
    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625"/>

        <meta name="author" content="cdwanze"/>
        <meta name="copyright" content="cdwanze"/>

        <meta property="og:type" content="article"/>
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="python, 存档, " />

<meta property="og:title" content="python2和python3的兼容性 "/>
<meta property="og:url" content="https://docs.cdwanze.work/articles/python2he-python3de-jian-rong-xing.html" />
<meta property="og:description" content="2to3内置模块 python有个 2to3 内置模块可以自动进行python2脚本到python3脚本的移植工作，不过我感觉最好是不要过分依赖这个工具，这只是适合初学者的。因为python2和python3很多地方不一样了。如果你对这个模块有很深的了解，可能自己手工进行修改会更合适一些（其中可能会涉及到新的编写思路）。具体模块的使用请参看官方文档。 // 和 / 在python2中，两个整数相除会返回一个整数，也就是python3的 //。 &gt;&gt;&gt; 5/2 2 兼容方案 在文件头上加上一行： from __future__ import division 这样就都是使用python3的语法规则，即: / 表示常规除法， // 表示整除——返回商。 print函数 这是最常见的错误了，推荐第一步就在文档里面进行find print这个字符串操作，然后将所有： print ... 这样的形式都换成： print(...) 这是目前python2和python3都兼容的形式了，所以没有什么好犹豫的，大胆的修改就是了。 其中python2 print 1, 2, 似乎还有点小复杂，简单的理解就是对应到python3的 print(1, 2, end …" />
<meta property="og:site_name" content="cdwanze的博文" />
<meta property="og:article:author" content="cdwanze" />
<meta property="og:article:published_time" content="2012-12-21T00:00:00+08:00" />
<meta name="twitter:title" content="python2和python3的兼容性 ">
<meta name="twitter:description" content="2to3内置模块 python有个 2to3 内置模块可以自动进行python2脚本到python3脚本的移植工作，不过我感觉最好是不要过分依赖这个工具，这只是适合初学者的。因为python2和python3很多地方不一样了。如果你对这个模块有很深的了解，可能自己手工进行修改会更合适一些（其中可能会涉及到新的编写思路）。具体模块的使用请参看官方文档。 // 和 / 在python2中，两个整数相除会返回一个整数，也就是python3的 //。 &gt;&gt;&gt; 5/2 2 兼容方案 在文件头上加上一行： from __future__ import division 这样就都是使用python3的语法规则，即: / 表示常规除法， // 表示整除——返回商。 print函数 这是最常见的错误了，推荐第一步就在文档里面进行find print这个字符串操作，然后将所有： print ... 这样的形式都换成： print(...) 这是目前python2和python3都兼容的形式了，所以没有什么好犹豫的，大胆的修改就是了。 其中python2 print 1, 2, 似乎还有点小复杂，简单的理解就是对应到python3的 print(1, 2, end …">

    <title>
python2和python3的兼容性  · cdwanze的博文
</title>


        <link href="https://docs.cdwanze.work/theme/css/font-awesome.css" rel="stylesheet"
              media="screen">
        <link href="https://docs.cdwanze.work/theme/css/bootstrap.min.css" rel="stylesheet"
              media="screen">

            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/pygments.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/elegant.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/custom.css" media="screen">






</head>
<body>

<nav class="navbar">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="https://docs.cdwanze.work/"><span
                    class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <form action="https://docs.cdwanze.work/search.html"
                  onsubmit="return validateForm(this.elements['q'].value);"
                  class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" name="q" id="tipue_search_input"
                           class="form-control" placeholder="Search..."
                           style="width:430px;">
                </div>
                <button class="btn btn-default" type="submit">搜索</button>
            </form>


            <ul class="nav navbar-nav nav-pills navbar-right">
                <li >
                    <a href="https://docs.cdwanze.work">博文首页</a></li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle"
                           data-toggle="dropdown" role="button"
                           aria-haspopup="true" aria-expanded="false">查找文章<span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a class="slowscroll" href="/categories.html">按分类</a>
                            </li>
                            <li><a class="slowscroll" href="/tags.html">按标签</a>
                            </li>
                        </ul>
                    </li>


                        <li >
                            <a href="https://docs.cdwanze.work/pdf-ebooks.html">pdf电子书籍</a>
                        </li>
                        <li >
                            <a href="https://docs.cdwanze.work/epub-ebooks.html">epub电子书籍</a>
                        </li>
                        <li >
                            <a href="https://docs.cdwanze.work/about.html">关于本网站</a>
                        </li>
            </ul>


        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">
<article>
<div class="row">
    <header class="page-header col-md-10 col-md-offset-2">
    <h1><a href="https://docs.cdwanze.work/articles/python2he-python3de-jian-rong-xing.html"> python2和python3的兼容性  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-md-2 table-of-content">
        <nav>
        <h4>目录</h4>
        <div class="toc">
<ul>
<li><a href="#2to3">2to3内置模块</a></li>
<li><a href="#_1">// 和 /</a><ul>
<li><a href="#_2">兼容方案</a></li>
</ul>
</li>
<li><a href="#print">print函数</a><ul>
<li><a href="#_3">兼容性方案</a></li>
</ul>
</li>
<li><a href="#unicode">unicode字符串问题</a></li>
<li><a href="#inputraw_input">input和raw_input</a><ul>
<li><a href="#_4">兼容方案</a></li>
</ul>
</li>
<li><a href="#object">所有的类都继承自object</a><ul>
<li><a href="#_5">兼容方案</a></li>
</ul>
</li>
<li><a href="#execfile">execfile函数</a><ul>
<li><a href="#_6">兼容方案</a></li>
</ul>
</li>
<li><a href="#_7">&lt;&gt;替换为 !=</a></li>
<li><a href="#_8">模块包的导入问题</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="col-md-8 article-content">

            
            
<h2 id="2to3">2to3内置模块</h2>
<p>python有个 <strong>2to3</strong> 内置模块可以自动进行python2脚本到python3脚本的移植工作，不过我感觉最好是不要过分依赖这个工具，这只是适合初学者的。因为python2和python3很多地方不一样了。如果你对这个模块有很深的了解，可能自己手工进行修改会更合适一些（其中可能会涉及到新的编写思路）。具体模块的使用请参看官方文档。</p>
<h2 id="_1"><code>//</code> 和 <code>/</code></h2>
<p>在python2中，两个整数相除会返回一个整数，也就是python3的 <code>//</code>。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="mi">5</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">2</span>
</pre></div>
<h3 id="_2">兼容方案</h3>
<p>在文件头上加上一行：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
</pre></div>
<p>这样就都是使用python3的语法规则，即:  <code>/</code> 表示常规除法， <code>//</code> 表示整除——返回商。</p>
<h2 id="print">print函数</h2>
<p>这是最常见的错误了，推荐第一步就在文档里面进行find print这个字符串操作，然后将所有：</p>
<div class="highlight"><pre><span></span>    <span class="n">print</span> <span class="p">...</span>
</pre></div>
<p>这样的形式都换成：</p>
<div class="highlight"><pre><span></span>    <span class="n">print</span><span class="p">(...)</span>
</pre></div>
<p>这是目前python2和python3都兼容的形式了，所以没有什么好犹豫的，大胆的修改就是了。</p>
<p>其中python2 </p>
<div class="highlight"><pre><span></span>    <span class="n">print</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
</pre></div>
<p>似乎还有点小复杂，简单的理解就是对应到python3的</p>
<div class="highlight"><pre><span></span>    <span class="nv">print</span><span class="ss">(</span><span class="mi">1</span>, <span class="mi">2</span>, <span class="k">end</span><span class="o">=</span><span class="s1">'</span><span class="s"> </span><span class="s1">'</span><span class="ss">)</span>
</pre></div>
<p>然后python2支持这样的重定向语法 </p>
<div class="highlight"><pre><span></span><span class="n">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
</pre></div>
<p>其对应python3的就是file选项： </p>
<div class="highlight"><pre><span></span><span class="n">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
</pre></div>
<h3 id="_3">兼容性方案</h3>
<p>目前推荐在模块最上面写上:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</pre></div>
<p>然后使用python3的语法来使用print函数。这样python2里面也能正常运行。</p>
<h2 id="unicode">unicode字符串问题</h2>
<p>首先说一下Unicode字符串问题的历史由来，因为python2诞生的比Unicode字符串（宽字符解决编码方案的统称）要早，所以python2早期是基于ASCII编码的，ASCII编码是8位值编码，那个时候比较单纯，python2就是一个str类型既表示8位字符又表示二进制数据。后来python2才引入unicode字符类型，其就是对应的宽字符文本。</p>
<p>后来python2为了兼容python3也引入了bytes类似和bytearray类型。但只是为了兼容性考虑。目前python2和python3代码兼容上最大的一个坑就是python2的str类型是8位文本和二进制数据的统称，也就是在某些默认是ASCII编码的情况下，可能不知不觉，比如系统的默认编码默认是ASCII，然后这些8位值数据你不知道其到底是不是文本。（python3的str是默认的UTF-8编码，其既支持8位文本也支持宽字符文本，这样其就真的是文本的含义了。）</p>
<p>首先我们要看到大家都同意python3的新分类是很好的： str 文本， bytes 字节流。后面的编程都应该一律采用这种思维。</p>
<p>然后我们现在写python2代码都推荐在文件头上写上：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
</pre></div>
<p>如上面写了之后python2中随便定义的字符串</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span><span class="ss">"test"</span>
<span class="n">u</span><span class="s1">'test'</span>
</pre></div>
<p>返回的将是unicode类型，可以对应于python3的str类型。程序员在 （\cite{高质量python代码}） 编码时应该更多地考虑业务逻辑而不是考虑具体字符是什么编码什么二进制形式存放的。</p>
<p>简单起见字符串都只是简单认为是字符串（或者说文本），然后程序员一般也不会考虑编码问题，只是确实到了某个点，需要直接操作字符的bytes形式，确实有需要，然后再考虑进行转换操作。</p>
<p>具体的转换：</p>
<div class="highlight"><pre><span></span># <span class="nv">python2</span>
<span class="nv">def</span> <span class="nv">to_unicode</span><span class="ss">(</span><span class="nv">unicode_or_str</span><span class="ss">)</span>:
    <span class="k">if</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">unicode_or_str</span>, <span class="nv">str</span><span class="ss">)</span>:
        <span class="nv">value</span> <span class="o">=</span> <span class="nv">unicode_or_str</span>.<span class="nv">decode</span><span class="ss">(</span><span class="s1">'</span><span class="s">utf-8</span><span class="s1">'</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">value</span> <span class="o">=</span> <span class="nv">unicode_or_str</span>
    <span class="k">return</span> <span class="nv">value</span>

<span class="nv">def</span> <span class="nv">to_str</span><span class="ss">(</span><span class="nv">unicode_or_str</span><span class="ss">)</span>:
    <span class="k">if</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">unicode_or_str</span>, <span class="nv">unicode</span><span class="ss">)</span>:
        <span class="nv">value</span> <span class="o">=</span> <span class="nv">unicode_or_str</span>.<span class="nv">encode</span><span class="ss">(</span><span class="s1">'</span><span class="s">utf-8</span><span class="s1">'</span><span class="ss">)</span>
    <span class="k">else</span>:
        <span class="nv">value</span> <span class="o">=</span> <span class="nv">unicode_or_str</span>
    <span class="k">return</span> <span class="nv">value</span>
</pre></div>
<p>而对于那些历史遗留的代码，非常遗憾，考虑到python2和python3在这一块如此巨大的裂痕，更加详细的阅读和修改甚至重写代码恐怕是避免不了的了。</p>
<p>​    </p>
<h2 id="inputraw_input">input和raw_input</h2>
<p>在python2中的raw_input函数对应的就是python3的input函数。然后python2还有一个input函数，具体在python3中对应的是eval(input())，这个函数推荐被废弃掉。</p>
<h3 id="_4">兼容方案</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">input</span>

<span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'What is your name? '</span><span class="p">)</span>
</pre></div>
<h2 id="object">所有的类都继承自object</h2>
<p>python3中所有的类都默认是object的子类。</p>
<h3 id="_5">兼容方案</h3>
<p>兼容方案是引入从builtns引入object，然后都明确指明继承自object。</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">object</span>

<span class="k">class</span> <span class="nc">Upper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>      <span class="c1"># Py3-style iterator interface</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># builtin next() function calls</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>
<h2 id="execfile">execfile函数</h2>
<p>在python2中execfile是个内置函数，可以直接运行，用来执行某个python脚本。</p>
<div class="highlight"><pre><span></span><span class="nv">execfile</span><span class="ss">(</span><span class="nv">join</span><span class="ss">(</span><span class="k">dirname</span><span class="ss">(</span><span class="nv">__file__</span><span class="ss">)</span>, <span class="s1">'</span><span class="s">openerp</span><span class="s1">'</span>, <span class="s1">'</span><span class="s">release.py</span><span class="s1">'</span><span class="ss">))</span>  # <span class="nv">Load</span> <span class="nv">release</span> <span class="nv">variables</span>
<span class="nv">lib_name</span> <span class="o">=</span> <span class="s1">'</span><span class="s">openerp</span><span class="s1">'</span>


<span class="k">exec</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="nv">open</span><span class="ss">(</span><span class="nv">join</span><span class="ss">(</span><span class="k">dirname</span><span class="ss">(</span><span class="nv">__file__</span><span class="ss">)</span>, <span class="s1">'</span><span class="s">openerp</span><span class="s1">'</span>, <span class="s1">'</span><span class="s">release.py</span><span class="s1">'</span><span class="ss">))</span>.<span class="nv">read</span><span class="ss">()</span>, <span class="nv">join</span><span class="ss">(</span><span class="k">dirname</span><span class="ss">(</span><span class="nv">__file__</span><span class="ss">)</span>, <span class="s1">'</span><span class="s">openerp</span><span class="s1">'</span>, <span class="s1">'</span><span class="s">release.py</span><span class="s1">'</span><span class="ss">)</span>, <span class="s1">'</span><span class="s">exec</span><span class="s1">'</span><span class="ss">))</span> 
 <span class="nv">lib_name</span> <span class="o">=</span> <span class="s1">'</span><span class="s">openerp</span><span class="s1">'</span>
</pre></div>
<h3 id="_6">兼容方案</h3>
<div class="highlight"><pre><span></span><span class="k">exec</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="nv">open</span><span class="ss">(</span><span class="s1">'</span><span class="s">myfile.py</span><span class="s1">'</span><span class="ss">)</span>.<span class="nv">read</span><span class="ss">()))</span>
</pre></div>
<h2 id="_7">&lt;&gt;替换为 !=</h2>
<p>不等于号&lt;&gt;被废弃了，推荐用!=，这样python2和python3都是兼容的。</p>
<h2 id="_8">模块包的导入问题</h2>
<p>python2到python3模块包的结构很多地方也发生了变动，实际上即使是python3，随着版本升级，内置模块包内部也在发生着变动，比如新加入的函数类等等。这是不可避免的，同时python2一些模块包已经被官方提醒要被废弃了，这也是值得引起我们的注意的。这一块，当然还是自己平时多阅读官方文档（通常这些变动官方文档都会有所说明的）。</p>
            
            
            <hr/>

        </div>
        <section>
        <div class="col-md-2" style="float:right;font-size:0.9em;">
            <h4>首发于：</h4>
            <time pubdate="pubdate" datetime="2012-12-21T00:00:00+08:00">2012年 12月 21日 </time>
            <h4>分类：</h4>
            <a class="category-link" href="https://docs.cdwanze.work/categories.html#cun-dang-ref">存档</a>
            <h4>标签：</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://docs.cdwanze.work/tags.html#python-ref">python
                    <span>14</span>
</a></li>
            </ul>
        </div>
        </section>
</div>
</article>
    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>


<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="http://docs.cdwanze.work" title="cdwanze Home Page">cdwanze</a></li>
    </ul>
</div>
</footer>

        <script src="https://docs.cdwanze.work/theme/js/jquery.min.js"></script>
    <script src="https://docs.cdwanze.work/theme/js/bootstrap.min.js"></script>
    <script>
        function validateForm(query) {
            return (query.length > 0);
        }
    </script>

    <script>
        function adjust_search_width() {
            var w = document.documentElement.clientWidth;
            if ((w > 755) && (w < 975)) {
                plus_width = w - 755;
                $('.navbar-form .form-control').outerWidth(210 + plus_width);
            } else if (w >= 975) {
                $('.navbar-form .form-control').outerWidth(210 + 220);
            } else if (w <= 755) {
                $('.navbar-form .form-control').css('width', '100%')
            }
        }

        function adjust_markdown_css(){
            $('table').addClass('table');
            $('table').addClass('table-striped');
        }

        $(document).ready(function () {
            adjust_search_width();
            adjust_markdown_css();
        });

        window.onresize = function () {
            adjust_search_width();
        }

    </script>


    



</body>
</html>