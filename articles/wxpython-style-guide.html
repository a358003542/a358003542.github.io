<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="D4VqC4HppC"/>
    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625"/>

        <meta name="author" content="cdwanze"/>
        <meta name="copyright" content="cdwanze"/>

        <meta property="og:type" content="article"/>
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="wxpython, wxpython, " />

<meta property="og:title" content="wxpython编码风格推荐 "/>
<meta property="og:url" content="/articles/wxpython-style-guide.html" />
<meta property="og:description" content="基本建议 使用 import wx 不要使用 from what import * 这样的引入语法。 使用 size=(500,400)，不推荐使用 wx.Size ，这个提法是 这个网页 说的，可能会有点争议性，他说简单比复杂好。因为点就x, y两个值，所以就目前个人使用来说，确实直接用数组对会方便点，而且在编码的时候，具体size参数实际上已经指明了第一个参数是x，第二个参数是y了。 凡是面板都应该子类化，然后面板类的各个控件可以被面板管理。这个不是说要全部这样做，但这样做的好处很多。面板类的控件可管理，对你的后续管理操作编码带来很多便利，而面板的子类化是大型GUI程序的必然道路。 多个按钮推荐使用 StdDialogButtonSizer ， TODO ，后面我个人使用体验之后再讨论几句。 okButton = wx.Button(self, wx.ID_OK, &#34;&amp;OK&#34;) okButton.SetDefault() cancelButton = wx …" />
<meta property="og:site_name" content="cdwanze的博文" />
<meta property="og:article:author" content="cdwanze" />
<meta property="og:article:published_time" content="2018-10-10T00:00:00+08:00" />
<meta property="" content="2018-10-23T00:00:00+08:00" />
<meta name="twitter:title" content="wxpython编码风格推荐 ">
<meta name="twitter:description" content="基本建议 使用 import wx 不要使用 from what import * 这样的引入语法。 使用 size=(500,400)，不推荐使用 wx.Size ，这个提法是 这个网页 说的，可能会有点争议性，他说简单比复杂好。因为点就x, y两个值，所以就目前个人使用来说，确实直接用数组对会方便点，而且在编码的时候，具体size参数实际上已经指明了第一个参数是x，第二个参数是y了。 凡是面板都应该子类化，然后面板类的各个控件可以被面板管理。这个不是说要全部这样做，但这样做的好处很多。面板类的控件可管理，对你的后续管理操作编码带来很多便利，而面板的子类化是大型GUI程序的必然道路。 多个按钮推荐使用 StdDialogButtonSizer ， TODO ，后面我个人使用体验之后再讨论几句。 okButton = wx.Button(self, wx.ID_OK, &#34;&amp;OK&#34;) okButton.SetDefault() cancelButton = wx …">

    <title>
wxpython编码风格推荐  · cdwanze的博文
</title>


        <link href="/theme/css/font-awesome.css" rel="stylesheet"
              media="screen">
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet"
              media="screen">

            <link rel="stylesheet" type="text/css"
                  href="/theme/css/pygments.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="/theme/css/elegant.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="/theme/css/custom.css" media="screen">






</head>
<body>

<nav class="navbar">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="https://www.cdwanze.work"><span
                    class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <form action="/search.html"
                  onsubmit="return validateForm(this.elements['q'].value);"
                  class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" name="q" id="tipue_search_input"
                           class="form-control" placeholder="Search..."
                           style="width:430px;">
                </div>
                <button class="btn btn-default" type="submit">搜索</button>
            </form>


            <ul class="nav navbar-nav nav-pills navbar-right">
                <li >
                    <a href="">博文首页</a></li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle"
                           data-toggle="dropdown" role="button"
                           aria-haspopup="true" aria-expanded="false">查找文章<span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a class="slowscroll" href="/categories.html">按分类</a>
                            </li>
                            <li><a class="slowscroll" href="/tags.html">按标签</a>
                            </li>
                        </ul>
                    </li>


                        <li >
                            <a href="/guan-yu-ben-wang-zhan.html">关于本网站</a>
                        </li>
                        <li >
                            <a href="/gong-gao.html">公告</a>
                        </li>
            </ul>


        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">
<article>
<div class="row">
    <header class="page-header col-md-10 col-md-offset-2">
    <h1><a href="/articles/wxpython-style-guide.html"> wxpython编码风格推荐  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-md-2 table-of-content">
        <nav>
        <h4>目录</h4>
        <div class="toc">
<ul>
<li><a href="#_1">基本建议</a></li>
<li><a href="#_2">代码重构：思考如何视图操作分离</a><ul>
<li><a href="#_3">视图层</a></li>
<li><a href="#_4">控制层</a></li>
<li><a href="#_5">模型层</a></li>
</ul>
</li>
<li><a href="#mvc">二次思考MVC架构</a><ul>
<li><a href="#_6">常量，模型层变量，全局变量分离</a></li>
<li><a href="#_7">模型层和视图层分离</a></li>
<li><a href="#_8">模型层信号规范</a></li>
<li><a href="#_9">代码重构后感</a></li>
</ul>
</li>
<li><a href="#mvcplus">三次思考MVC架构【PLUS】</a></li>
<li><a href="#_10">注意事项</a><ul>
<li><a href="#_11">类变量和实例变量</a></li>
</ul>
</li>
<li><a href="#_12">参考资料</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="col-md-8 article-content">

            
            
<h2 id="_1">基本建议</h2>
<ol>
<li>使用</li>
</ol>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wx</span>
</pre></div>
<p>不要使用 <code>from what import *</code> 这样的引入语法。</p>
<ol>
<li>使用 size=(500,400)，不推荐使用 wx.Size ，这个提法是 <a href="https://wiki.wxpython.org/wxPython%20Style%20Guide">这个网页</a> 说的，可能会有点争议性，他说简单比复杂好。因为点就x, y两个值，所以就目前个人使用来说，确实直接用数组对会方便点，而且在编码的时候，具体size参数实际上已经指明了第一个参数是x，第二个参数是y了。</li>
<li>凡是面板都应该子类化，然后面板类的各个控件可以被面板管理。这个不是说要全部这样做，但这样做的好处很多。面板类的控件可管理，对你的后续管理操作编码带来很多便利，而面板的子类化是大型GUI程序的必然道路。</li>
<li>多个按钮推荐使用 <code>StdDialogButtonSizer</code> ， TODO ，后面我个人使用体验之后再讨论几句。</li>
</ol>
<div class="highlight"><pre><span></span>    okButton = wx.Button(self, wx.ID_OK, "&amp;OK")
    okButton.SetDefault()
    cancelButton = wx.Button(self, wx.ID_CANCEL, "&amp;Cancel")
    btnSizer = wx.StdDialogButtonSizer()
    btnSizer.AddButton(okButton)
    btnSizer.AddButton(cancelButton)
    btnSizer.Realize()
</pre></div>
<h2 id="_2">代码重构：思考如何视图操作分离</h2>
<p>本小节有些是自己思考的，但更多的是学习 <a href="https://wiki.wxpython.org/ModelViewController">这篇文章</a> 提出的架构思路。</p>
<p>首先说一下整个编程世界公认的一些理念，比如DRY原则。</p>
<p>然后在具体编码中wxpython额外有些风格推荐。</p>
<p>按照DIY原则，我们有：</p>
<ul>
<li>
<p>数据和代码分离，不管你的数据以何种方式加载进来的，这个都是后面完善的小细节，因为GUI编码的特殊性，从一开始就要考虑数据和代码的分离。</p>
</li>
<li>
<p>随着GUI程序编码的复杂度提高，请立刻开始重构你的代码，实现面向对象风格的写法，GUI程序内在和面向对象思想是很融洽的，只是一开始程序代码很简单不用考虑上面向对象，稍微写几天之后，就要考虑第一次重构了。请根据你的视图层结构特色，来对应编写你的gui模块的类的结构层次。</p>
</li>
<li>
<p>前面说到数据和代码分离，GUI有很多变量数据实际上是一些常量数据，建议所有后面不会发生变动的这些常量数据都另外再开个模块统一管理。一个不错的风格是这些常量数据包括你的所有变量数据和各种配置数据最终都在你的一个全局变量模块中汇总。既方便代码中的编写引用，也方便后续你写代码时候的debug模式编写，GUI程序运行时，只要写个简单的debug菜单，就可以将程序运行时所有的变量常量参数打印出来。</p>
</li>
<li>
<p>你的程序主要核心面板最好都给他们一个名字，这样后面事件处理的时候，可以直接调用对应的窗体，然后顺着这个窗体，调用目标窗体的子窗体来进行一些操作，但做的完善的，你的窗体应该提供各种方法来操控本窗体的子控件，而不是直接调用子控件。</p>
</li>
</ul>
<p>而上面提到的那篇参考文章更进一步提出了MVC架构，这其中最关键的一点就是利用pypubsub模块，来实现你的程序内部的消息和发送和接收，从而实现视图层和模型层完全解耦。你的模型层只负责管理好本应用程序本地数据，你的控制层负责和模型层和视图层交互，通过控制层，你的视图层是完全不需要和模型层直接交互的。</p>
<p>具体哪个样例代码我就不贴了，而pypubsub模块的基本使用是很简洁的，这里面的关键在于理解MVC层各个层的分工和具体设计思路。仔细分析参考文章的样例代码，我们会发现这里面有一些设计很精妙的地方。首先请读者设想一个问题，这个问题在GUI程序编写或者其他类似的MVC架构中都会出现，那就是如果底层某个模型或者说某个数据或者更精确一点某个变量发生变化了，这种变化可能是内部计算得到的，也可能是从外部API获取到的数据，总之就是我们的GUI程序数据池里面已经有一些变动了，其中有一些数据是直接和视图层相关的，我们是希望视图层做出相应的调整。手工请求数据，再刷新页面的想法实在太愚蠢了，我们应该设计一个控制器，这个控制器负责进行内部某些运算或者从外部获取到某些数据，然后检测某些数据的变化，这些数据的变化首先送给本地模型层，做好变化记录，这时的样例程序是 changing 过程，然后本地模型层数据变化了，就应该改变视图层相应的显示，具体就是通过发送changed 信号来实现页面更新驱动的。</p>
<h3 id="_3">视图层</h3>
<p>你之前写的GUI程序一开始就放在视图层，你的视图层的panel类等，本面板的子控件，主要是那些可变元素，挂在本面板上可以直接调用，后面根据你的业务和GUI显示需求，你需要些更好针对本面板的子控件的组合行为。</p>
<p>面板的属性，利用python的 <code>@property</code> 你将确定一些本面板的属性，通常你的面板的一些可变元素就是调用这些属性来的，而具体引用这些属性的方法，实际指向的是外部的可变内容，这样你的视图层内部代码每次引用 <code>self.what</code> ，都会实际调用你定义的属性的方法，也就是实时再计算一次，得到最新的信息。</p>
<p>然后视图层还有常数信息，按照前面讨论的编码风格推荐，也应该慢慢抽离出来，用某个const常数模块来统一管理之，一句话，努力做到数据和代码分离。</p>
<h3 id="_4">控制层</h3>
<p>控制层的任务有如下：</p>
<ul>
<li>接受本应用模型层，组织好本地常量变量数据</li>
<li>接受好视图层或者模型层发送的消息，针对这些消息进行对应的动作处理</li>
<li>如上所述，视图层引用可变数据的方法支持是控制层提供的</li>
</ul>
<h3 id="_5">模型层</h3>
<p>模型层不和视图层直接进行交互，如前面所说的，只负责管理好本地的数据和发送相应的信号，实际上模型层也没有引入控制层，其只是一个单纯简单的管理本地数据的接口罢了。</p>
<p>一般来说经常变动的一些和业务相关的数据应该进入模型层。</p>
<h2 id="mvc">二次思考MVC架构</h2>
<p>流行的web框架是以一种非常成熟的MVC架构风格，很多东西并没有引起我们太大的注意，加之GUI编程相对于web应用视图层和控制层不太好分离。随着GUI程序越来越复杂，我也确实感觉到有些东西有点杂乱，思路不够清晰，一会这里数据变动了，视图层忘记跟着变动，一会儿那边数据变动了，信号又忘记发送了。</p>
<p>目前我的处理方式，程序常量汇入全局变量池，除了本面板或者控件内自身的GUI要素，其他都汇入全局变量池，这给实际操作带来了很大的便利。然后全局变量池中某些变量进行了特殊的处理，由这种特殊的处理建立起了模型层。</p>
<p>在模型层中对于目标变量，只要发生了变化，就将发送一个对应的信号。</p>
<p>视图层对应监听目标信号，从而实时变动界面来体现数据的变化。</p>
<p>GUI层自身还有一些事件处理。</p>
<p>控制层还可能有其他的处理逻辑和模型层进行交互。</p>
<p>其实上面提到的这些都是正确的，关键在于都混在一起就有点杂乱了，再加上GUI自身的事件信号，让程序员思维有点混乱。</p>
<p>我试着进行如下约定，然后再试着重构整理下代码试试看。</p>
<p><img alt="img" src="/images/wxpython/MVC.png"/></p>
<h3 id="_6">常量，模型层变量，全局变量分离</h3>
<p>程序涉及到的常量，模型层变量，全局变量分离，早期觉得都汇入全局变量挺方便的，但随着全局变量规模变得庞大，需要分离来减轻程序员头脑负担。</p>
<h3 id="_7">模型层和视图层分离</h3>
<ol>
<li>模型层里面不应该有视图层的东西，也就是面板之类的。</li>
<li>视图层里面不应该有模型层的东西，部分全局变量可以进入视图层（但主要要控制好这部分的量），除此之外的变量应该进入模型层。【视图层有时需要使用模型层的数据，推荐通过某个接口统一管理】</li>
<li>模型层不要向视图层发送的消息（name_changing）而只发送（name_changed），控制层直接修改模型层数据。视图层只负责监听 (name_changed) 的消息。控制层只监听(name_changing) 。</li>
</ol>
<h3 id="_8">模型层信号规范</h3>
<ol>
<li>模型层是数据层，不管是业务逻辑也好还是视图层数据显示也好，只要其是数据依赖的，或者说数据驱动的，那么控制层或视图层就应该监听对应的数据模型。</li>
</ol>
<p>监听信号名规范为： </p>
<ol>
<li>变量名_changed  【模型层数据实际发生了变动，changed模式可被控制层或者视图层监听】</li>
<li>变量名_changing 【视图层数据发生变动，发射changing信号，本信号只被控制层监听，模型层不用管。】（这里再着重讨论下changing信号和changed信号各自的分工，changed信号的信息变动源更多的是外部，造成模型层数据变动，从而本程序内部视图层跟踪进行相应的变动，或者有时一些复杂的逻辑交给控制层中继处理；而changing信号更多的是本程序本地信息变动为驱动源，changing的第一任务是本GUI视图层内部各个不同面板组件之间信息同步，其次才是根据情况控制层决定是否监听从而更改模型层数据。简言之，changing第一任务是视图层内部的不同，changed第一任务是外部引起的数据变动视图层跟踪相应的变化，其次才是视需要控制层监听某些信号来编写更复杂的内部程序逻辑。）</li>
<li>name_changing 和 name_changed 是只有值发生变法才发送消息，但某些情况下需要总是发送消息（可设置always_send选项）</li>
<li>name_appending name_appended 某些情况下列表引入append模式会很方便</li>
<li>name_clearing name_cleared 某些情况下需要数据清空还原默认值操作</li>
<li>传递过去的value就是当前的数据值，除了append模式只传递附加的部分。</li>
</ol>
<h3 id="_9">代码重构后感</h3>
<p>按照上面的思路，模型层建立了一些通用模型，进行了代码重构，发现MVC架构在项目早期实际上还增加了很多额外的代码量，不过后期应该是会降低代码量的。</p>
<p>然后就是后面写代码的时候不仅要注意前面提及的规则，还需要额外再加上一条：</p>
<blockquote>
<p>写的代码写完之后最好就可以放在一个地方供使用，然后其他时候就不用阅读了。</p>
</blockquote>
<p>这不仅涉及到代码的可复用性，代码的良好设计，上面提及的MVC架构在努力实现模型层视图层的分离时也在努力去追求这一点。</p>
<p>TODO： pypubsub模块需要深入地学习如何debug，如何查看阅读那些信息发送了那些信息到那个函数里面被执行了。</p>
<h2 id="mvcplus">三次思考MVC架构【PLUS】</h2>
<p>前面二次思考MVC架构的内容基本是正确的，除了changing信号具体实现细节还有一些要补充的：</p>
<ul>
<li>建立视图层变量，具体写法和建立方法类似于模型层变量的做法</li>
<li>视图层各个面板绑定好事件，内容发生变更则发送信号进行视图层相关面板数据同步工作。</li>
<li>视图层变量更多的和面板操作记录的临时变量相关，对于外部驱动发生的数据更改，之后驱动的方法我们应该优先选择面板的SetValue之类还会继续发送GUI Event的方法，如果没有这样的方法，则需要手工添加，好做到模型层初始化或者有变更则会自动触发视图层的变更。</li>
</ul>
<h2 id="_10">注意事项</h2>
<p>目前pypubsub 4.0版本已经确认如果有两个面板同时监听某个topic，那么各个面板对应的函数，参数格式应该一致。比如 </p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_topic_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">pass</span>
</pre></div>
<p>如果另外一个写为：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_topic_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">pass</span>
</pre></div>
<p>则pypubsub会抛异常，但如果两个都写作一样的，无论哪种形式，都没问题。</p>
<h3 id="_11">类变量和实例变量</h3>
<p>这个算是python里面的基础知识了，在使用你自己写的可复用面板的时候，千万要记得：</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="p">...</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="err">这里的变量每个实例都是相同的</span>
  <span class="nx">def</span> <span class="nx">__init__</span><span class="p">()...</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span>  <span class="err">这里的变量每个实例都不同</span>
</pre></div>
<p>也就是你在写一些方法和定义一些特别的本面板上的元素的时候，有些挂在类上问题不大，有些是一定要定义在初始化函数里面的，好让具体多个实例化后的面板有不同的子面板元素，这样行为才不会出错。</p>
<h2 id="_12">参考资料</h2>
<ol>
<li><a href="http://zetcode.com/wxpython">zetcode 的wxpython教程</a></li>
<li><a href="https://docs.wxpython.org/">wxpython官方参考文档</a></li>
<li>wxpython in action , Author by Harri Pasanen and Robin Dunn</li>
</ol>
            
            
            <hr/>

        </div>
        <section>
        <div class="col-md-2" style="float:right;font-size:0.9em;">
            <h4>首发于：</h4>
            <time pubdate="pubdate" datetime="2018-10-10T00:00:00+08:00">2018年 10月 10日 </time>

<h4>最近更新于：</h4>
<time datetime="2018-10-23T00:00:00+08:00">2018年 10月 23日 </time>

            <h4>分类：</h4>
            <a class="category-link" href="/categories.html#wxpython-ref">wxpython</a>
            <h4>标签：</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#wxpython-ref">wxpython
                    <span>7</span>
</a></li>
            </ul>
        </div>
        </section>
</div>
</article>
    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>


<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="http://www.cdwanze.work" title="cdwanze Home Page">cdwanze</a></li>
    </ul>
</div>
</footer>

        <script src="/theme/js/jquery.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
    <script>
        function validateForm(query) {
            return (query.length > 0);
        }
    </script>

    <script>
        function adjust_search_width() {
            var w = document.documentElement.clientWidth;
            if ((w > 755) && (w < 975)) {
                plus_width = w - 755;
                $('.navbar-form .form-control').outerWidth(210 + plus_width);
            } else if (w >= 975) {
                $('.navbar-form .form-control').outerWidth(210 + 220);
            } else if (w <= 755) {
                $('.navbar-form .form-control').css('width', '100%')
            }
        }

        $(document).ready(function () {
            adjust_search_width();
        });

        window.onresize = function () {
            adjust_search_width();
        }

    </script>


    



</body>
</html>