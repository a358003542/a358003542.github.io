<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="D4VqC4HppC"/>
    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625"/>

        <meta name="author" content="cdwanze"/>
        <meta name="copyright" content="cdwanze"/>

        <meta property="og:type" content="article"/>
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", python语言, " />

<meta property="og:title" content="python语言学习之-官方模块第三谈 "/>
<meta property="og:url" content="https://docs.cdwanze.work/articles/python-modules-three.html" />
<meta property="og:description" content="re模块 re模块提供了python对于正则表达式的支持，对于字符串操作，如果之前在介绍字符串类型的一些方法（比如split，replace等等），能够用它们解决问题就用它们，因为更快更简单。实在需要动用正则表达式理念才考虑使用re模块，而且你要克制写很多或者很复杂的（除非某些特殊情况）正则表达式的冲动，因为正则表达式的引入将会使得整个程序都更加难懂和不可捉摸。 更多内容请参见官方文档。 re模块中的元字符集 . 表示一行内的任意字符，如果如果通过re.compile指定re.DOTALL，则表示多行内的任意字符，即包括了换行符。此外还可以通过字符串模板在它的前面加上(?s)来获得同样的效果。 * 对之前的字符匹配或者多次。 + 对之前的字符匹配或者多次。 ? 对之前的字符匹配或者。 {m} 对之前的字符匹配()m次。 {m,n} 对之前的字符匹配m次到n次，其中n次可能省略，视作默认值是无穷大。 \^ 表示字符串的开始，如果加上re.MULTILINE选项，则表示行首。此外字符串模板加上(?m)可以获得同样的效果。 \$ 表示字符串的结束，同\^类似，如果加上 …" />
<meta property="og:site_name" content="cdwanze的博文" />
<meta property="og:article:author" content="cdwanze" />
<meta property="og:article:published_time" content="2017-05-10T00:00:00+08:00" />
<meta name="twitter:title" content="python语言学习之-官方模块第三谈 ">
<meta name="twitter:description" content="re模块 re模块提供了python对于正则表达式的支持，对于字符串操作，如果之前在介绍字符串类型的一些方法（比如split，replace等等），能够用它们解决问题就用它们，因为更快更简单。实在需要动用正则表达式理念才考虑使用re模块，而且你要克制写很多或者很复杂的（除非某些特殊情况）正则表达式的冲动，因为正则表达式的引入将会使得整个程序都更加难懂和不可捉摸。 更多内容请参见官方文档。 re模块中的元字符集 . 表示一行内的任意字符，如果如果通过re.compile指定re.DOTALL，则表示多行内的任意字符，即包括了换行符。此外还可以通过字符串模板在它的前面加上(?s)来获得同样的效果。 * 对之前的字符匹配或者多次。 + 对之前的字符匹配或者多次。 ? 对之前的字符匹配或者。 {m} 对之前的字符匹配()m次。 {m,n} 对之前的字符匹配m次到n次，其中n次可能省略，视作默认值是无穷大。 \^ 表示字符串的开始，如果加上re.MULTILINE选项，则表示行首。此外字符串模板加上(?m)可以获得同样的效果。 \$ 表示字符串的结束，同\^类似，如果加上 …">

    <title>
python语言学习之-官方模块第三谈  · cdwanze的博文
</title>


        <link href="https://docs.cdwanze.work/theme/css/font-awesome.css" rel="stylesheet"
              media="screen">
        <link href="https://docs.cdwanze.work/theme/css/bootstrap.min.css" rel="stylesheet"
              media="screen">

            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/pygments.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/elegant.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/custom.css" media="screen">






</head>
<body>

<nav class="navbar">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="https://www.cdwanze.work"><span
                    class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <form action="https://docs.cdwanze.work/search.html"
                  onsubmit="return validateForm(this.elements['q'].value);"
                  class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" name="q" id="tipue_search_input"
                           class="form-control" placeholder="Search..."
                           style="width:430px;">
                </div>
                <button class="btn btn-default" type="submit">搜索</button>
            </form>


            <ul class="nav navbar-nav nav-pills navbar-right">
                <li >
                    <a href="https://docs.cdwanze.work">博文首页</a></li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle"
                           data-toggle="dropdown" role="button"
                           aria-haspopup="true" aria-expanded="false">查找文章<span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a class="slowscroll" href="/categories.html">按分类</a>
                            </li>
                            <li><a class="slowscroll" href="/tags.html">按标签</a>
                            </li>
                        </ul>
                    </li>


                        <li >
                            <a href="https://docs.cdwanze.work/guan-yu-ben-wang-zhan.html">关于本网站</a>
                        </li>
                        <li >
                            <a href="https://docs.cdwanze.work/gong-gao.html">公告</a>
                        </li>
            </ul>


        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">
<article>
<div class="row">
    <header class="page-header col-md-10 col-md-offset-2">
    <h1><a href="https://docs.cdwanze.work/articles/python-modules-three.html"> python语言学习之-官方模块第三谈  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-md-2 table-of-content">
        <nav>
        <h4>目录</h4>
        <div class="toc">
<ul>
<li><a href="#re">re模块</a><ul>
<li><a href="#re_1">re模块中的元字符集</a></li>
<li><a href="#re_2">re模块中的特殊字符类</a></li>
<li><a href="#_1">转义问题</a></li>
<li><a href="#re_3">re模块的使用</a><ul>
<li><a href="#_2">匹配和查找</a></li>
<li><a href="#_3">分割操作</a></li>
<li><a href="#_4">替换操作</a></li>
<li><a href="#_5">非最长匹配</a></li>
<li><a href="#_6">非捕获组</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#abc">abc模块</a></li>
<li><a href="#argparse">argparse模块</a><ul>
<li><a href="#_7">简单添加一个参数</a></li>
<li><a href="#_8">添加参数的其他选项设置</a><ul>
<li><a href="#nargs">nargs选项设置</a></li>
</ul>
</li>
<li><a href="#_9">一个完整的例子</a></li>
<li><a href="#_10">命令行选项关联其他动作</a><ul>
<li><a href="#store95const">store_const</a></li>
<li><a href="#store95true-store95false">store_true 和 store_false</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ast">ast模块</a><ul>
<li><a href="#literal95eval">literal_eval函数</a></li>
</ul>
</li>
<li><a href="#collections">collections模块</a><ul>
<li><a href="#namedtuple">namedtuple函数</a></li>
<li><a href="#counter">Counter计数类</a></li>
<li><a href="#ordereddict">OrderedDict对象</a></li>
</ul>
</li>
<li><a href="#configparser">configparser模块</a><ul>
<li><a href="#configparser_1">新建一个configparser对象</a></li>
<li><a href="#config">读取某个config文件</a></li>
<li><a href="#configparser_2">如同字典一般操作configparser对象</a></li>
<li><a href="#write">调用write方法写入</a></li>
<li><a href="#_11">不默认更改大小写</a></li>
</ul>
</li>
<li><a href="#csv">csv模块</a><ul>
<li><a href="#csv_1">自定义csv方言</a><ul>
<li><a href="#reader">对应的Reader编写</a></li>
<li><a href="#writer">对应的Writer编写</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#tempfile">tempfile模块</a></li>
<li><a href="#mkstemp">mkstemp</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="col-md-8 article-content">

            
            
<h2 id="re">re模块</h2>
<p>re模块提供了python对于正则表达式的支持，对于字符串操作，如果之前在介绍字符串类型的一些方法（比如split，replace等等），能够用它们解决问题就用它们，因为更快更简单。实在需要动用正则表达式理念才考虑使用re模块，而且你要克制写很多或者很复杂的（除非某些特殊情况）正则表达式的冲动，因为正则表达式的引入将会使得整个程序都更加难懂和不可捉摸。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/re.html">官方文档</a>。</p>
<h3 id="re_1">re模块中的元字符集</h3>
<dl>
<dt><em>.</em></dt>
<dd>
<p>表示一行内的任意字符，如果如果通过re.compile指定<strong>re.DOTALL</strong>，则表示多行内的任意字符，即包括了换行符。此外还可以通过字符串模板在它的前面加上<strong>(?s)</strong>来获得同样的效果。</p>
</dd>
<dt><em>*</em></dt>
<dd>
<p>对之前的字符匹配或者多次。</p>
</dd>
<dt><em>+</em></dt>
<dd>
<p>对之前的字符匹配或者多次。</p>
</dd>
<dt><em>?</em></dt>
<dd>
<p>对之前的字符匹配或者。</p>
</dd>
<dt><em>{m}</em></dt>
<dd>
<p>对之前的字符匹配()m次。</p>
</dd>
<dt><em>{m,n}</em></dt>
<dd>
<p>对之前的字符匹配m次到n次，其中n次可能省略，视作默认值是无穷大。</p>
</dd>
<dt><em>\^</em></dt>
<dd>
<p>表示字符串的开始，如果加上<strong>re.MULTILINE</strong>选项，则表示行首。此外字符串模板加上<strong>(?m)</strong>可以获得同样的效果。</p>
</dd>
<dt><em>\$</em></dt>
<dd>
<p>表示字符串的结束，同\^类似，如果加上<strong>re.MULTILINE</strong>选项，则表示行尾，可以简单理解为<code>\n</code>换行符。此外字符串模板加上<strong>(?m)</strong>可以获得同样的效果。</p>
<p>\<span class="math">\(符号在re.sub函数中可以被替换为另外一个字符串，其具体效果就是原字符串尾加上了这个字符串，类似的\^被替换成某个字符串，其具体效果就是原字符串头加上了这个字符串。这里显然\^和\\)</span>在字符串中都不是真实存在的字符，而没有这个所谓的标记，所以这种替换总给人怪怪的感觉。</p>
</dd>
<dt><em>[]</em></dt>
<dd>
<p>[abc]字符组匹配一个字符，这个字符是a或者b或者c。类似的[a-z]匹配所有的小写字母，<code>[\w]</code>匹配任意的字母或数字，具体请看下面的特殊字符类。</p>
</dd>
<dt><em>|</em></dt>
<dd>
<p>相当于正则表达式内的匹配或逻辑。</p>
</dd>
<dt><em>()</em></dt>
<dd>
<p>圆括号包围的部分将会记忆起来，方便后面调用。这个后面在谈及。</p>
</dd>
</dl>
<h3 id="re_2">re模块中的特殊字符类</h3>
<div class="highlight"><pre><span></span><span class="err">\</span><span class="n">w</span>  <span class="err">任意的字母或数字</span>  <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="p">]</span>  <span class="p">(</span><span class="n">meaning</span> <span class="n">word</span><span class="p">)</span>
<span class="err">\</span><span class="n">W</span>  <span class="err">匹配任何非字母非数字</span> <span class="p">[</span><span class="o">^</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="p">]</span>
<span class="err">\</span><span class="n">d</span>   <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span>   <span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="err">数字</span>
<span class="err">\</span><span class="n">D</span>  <span class="p">[</span><span class="o">^</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="err">非数字</span>
<span class="err">\</span><span class="n">s</span>   <span class="err">匹配任何空白字符</span>   <span class="p">[</span> <span class="err">\</span><span class="n">t</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">r</span><span class="err">\</span><span class="n">f</span><span class="err">\</span><span class="n">v</span><span class="p">]</span> <span class="err">。</span>
<span class="err">\</span><span class="n">S</span>  <span class="err">匹配任何非空白字符</span>
<span class="err">匹配中文</span><span class="p">:[</span><span class="err">\</span><span class="n">u4e00</span><span class="o">-</span><span class="err">\</span><span class="n">u9fa5</span><span class="p">]</span>
<span class="err">\</span><span class="n">b</span>  <span class="err">文档说严格的定义是\</span><span class="n">w</span> <span class="err">和\</span><span class="n">W</span> <span class="err">之间的边界，反之亦然。粗略的理解可以看作是英文单词头或者尾。</span>
</pre></div>
<p>其中\^在方括号[]里面，只有在最前面，才表示排除型字符组的意思。</p>
<h3 id="_1">转义问题</h3>
<p>正则表达式的转义问题有时会比较纠结。一个简单的原则是以上谈及的有特殊作用的字符有转义问题，如果python中的字符都写成<code>r''</code>这种形式，也就是所谓的raw
string形式，这样<code>\n</code>在里面就可以直接写成<code>\n</code>，而<code>\section</code>可以简单写为<code>\\section</code>即可，也就是<code>\</code>字符需要转义一次。</p>
<p>然后字符组的方括号内[]有些字符有时是不需要转义的，这个实在不确定就转义吧，要不就用正则表达式工具测试一下。</p>
<h3 id="re_3">re模块的使用</h3>
<p>compile方法生成regular expression
object这一条线这里略过了，接下来的讨论全部基于（原始的）字符串模板。</p>
<p>字符串模板前面提及(?m)和(?s)的用法了，然后<strong>(?i)</strong>表示忽略大小写。</p>
<h4 id="_2">匹配和查找</h4>
<p>search，match方法简单地用法就是：</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="k">search</span><span class="p">(</span><span class="err">字符串模板</span><span class="p">,</span> <span class="err">待匹配字符串</span><span class="p">)</span>
<span class="n">re</span><span class="p">.</span><span class="k">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
<p>它们将会返回一个match object或者none，其中match
object在逻辑上就是真值的意思。match对字符串的匹配是必须从一开始就精确匹配，这对于正则表达式多少0有点突兀。推荐使用search方法，如果一定要限定行首，或者字符串开始可以用前面讨论的正则表达式各个符号来表达。请看下面的例子。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">'''this is test line.</span>
<span class="s1">this is the second line.</span>
<span class="s1">today is sunday.'''</span>

<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'(?m)^today'</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>

<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'所使用的正则表达式是：'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">re</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'所输入的字符串是：'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'匹配的结果是：'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'匹配的字符串index'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">())</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'return the none value'</span><span class="p">)</span>
</pre></div>
<p>前面说道圆括号的部分将会记忆起来，作为匹配的结果，默认整个正则表达式所匹配的全部是group中的第0个元素，然后从左到右，子group编号依次是1，2，3......。</p>
<div class="highlight"><pre><span></span><span class="err">所使用的正则表达式是：</span> <span class="n">re</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'(?m)^today'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">MULTILINE</span><span class="p">)</span>
<span class="err">所输入的字符串是：</span> <span class="n">this</span> <span class="k">is</span> <span class="n">test</span> <span class="n">line</span><span class="p">.</span>
<span class="n">this</span> <span class="k">is</span> <span class="n">the</span> <span class="k">second</span> <span class="n">line</span><span class="p">.</span>
<span class="n">today</span> <span class="k">is</span> <span class="n">sunday</span><span class="p">.</span>
<span class="err">匹配的结果是：</span> <span class="n">today</span>
<span class="err">匹配的字符串</span><span class="k">index</span> <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">49</span><span class="p">)</span>
</pre></div>
<p>具体这些信息是为了说明情况，实际最简单的情况可能就需要判断一下是不是真值，字符串模板是不是匹配到了即可。</p>
<h4 id="_3">分割操作</h4>
<p>re模块的split函数可以看作字符串的split方法的升级版本，对于所描述的任何正则表达式，匹配成功之后都将成为一个分隔符，从而将原输入字符串分割开来。</p>
<p>下面是我写的zwc小脚本的最核心的部分，用途是统计中英文文档的具体英文单词和中文字符的个数。其中最核心的部分就是用的re的split函数进行正则表达式分割，如果不用那个圆括号的话，那么分隔符是不会包含进去的，这里就是具体匹配的中文字和各个标点符号等等。用了圆括号，那么圆括号匹配的内容也会进去列表。这里就是具体的各个分隔符。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">zwc</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="c1">#中英文常用标点符号</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'([</span><span class="se">\u4e00</span><span class="s1">-</span><span class="se">\u9fa5</span><span class="s1">\s，。；])'</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>
    <span class="c1">#去除 空白</span>
    <span class="c1">#去除\s 中英文常用标点符号</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="ow">not</span>  <span class="n">i</span> <span class="ow">in</span>
    <span class="p">[</span><span class="s2">""</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\r</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\f</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\v</span><span class="s2">"</span><span class="p">,</span><span class="s2">"；"</span><span class="p">,</span><span class="s2">"，"</span><span class="p">,</span><span class="s2">"。"</span><span class="p">]]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">string</span><span class="o">=</span><span class="s1">'''道可道，非常道。名可名，非常名。無名天地之始，有名萬物之母。</span>
<span class="s1">    故常無欲，以觀其妙；常有欲，以觀其徼。此兩者同出而異名，</span>
<span class="s1">    同謂之玄，玄之又玄，眾妙之門。 '''</span>
    <span class="n">zwc</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</pre></div>
<p>字符分割之后后面做了一个小修正，将匹配到的空白字符和中英文标点符号等都删除了，这些是不应该统计入字数的。</p>
<p>具体这个github项目链接在这里：<a href="https://github.com/a358003542/zwc">zwc项目</a>。</p>
<h4 id="_4">替换操作</h4>
<p>基于正则表达式的替换操作非常的有用，其实前面的search方法，再加上具体匹配字符串的索引值，然后修改原字符串，然后再search这样循环操作下去，就是一个替换操作了。re模块有sub方法来专门解决这个问题。</p>
<h4 id="_5">非最长匹配</h4>
<p>本小节参考了 python cookbook 的 2.7 小节，比如说：</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">r</span><span class="s1">'"(.*)"'</span><span class="p">)</span>
</pre></div>
<p>这将匹配两个双引号之间的内容，其默认是最长匹配，也就是多个双引号组成的句子都会匹配进去，你可以如下要要求最短匹配：</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">r</span><span class="s1">'"(.*?)"'</span><span class="p">)</span>
</pre></div>
<h4 id="_6">非捕获组</h4>
<p>看下面的正则表达式， <code>(?:...)</code> 这个括号的组是非捕获组，也就是不会进入
.group 里面去。</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="k">search</span><span class="p">(</span><span class="n">r</span><span class="s1">'((?:.|\n)*)'</span><span class="p">,</span><span class="n">text2</span><span class="p">)</span>
</pre></div>
<p>然后默认 <code>.</code> 是不会匹配换行符号的，如果要引入换行符则要如上所示加上。</p>
<h2 id="abc">abc模块</h2>
<p>abc模块帮助你实现抽象基类，有点类似于java中抽象类的概念。</p>
<p>具体实现如下所示：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span> 

<span class="k">class</span> <span class="nc">Graph</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    一般图</span>
<span class="sd">    """</span>
    <span class="n">DIRECTED</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Not Implement nodes methods"</span><span class="p">)</span>
</pre></div>
<p>抽象类不可实例化，实例化将会报错。继承于它的类，如果如上定义了抽象方法，那么继承它的类必须定义好对应方法的实现，否则将会报错。</p>
<p>抽象类里面也可以定义不是抽象方法的其他实际动作的方法。</p>
<p>抽象类里面还可以定义抽象属性。</p>
<h2 id="argparse">argparse模块</h2>
<p>下面简要介绍了python3的官方文档argparse模块的用法，用于快速制作一个可以刷参数的python脚本。</p>
<p>首先看下面这个简单的情况:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
<p>这是简单的一个例子了，现在脚本还不可以接受任何参数，只可以用 <code>-h</code> 或
<code>--help</code> 来查看一些信息，如下所示。</p>
<div class="highlight"><pre><span></span><span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>桌面$ <span class="nv">python3</span> <span class="nv">hello</span>.<span class="nv">py</span> <span class="o">-</span><span class="nv">h</span>
<span class="nv">usage</span>: 
<span class="nv">this</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">example</span> <span class="nv">to</span> <span class="k">show</span> <span class="nv">argparse</span> <span class="nv">usage</span>
 [<span class="o">-</span><span class="nv">h</span>]

<span class="nv">optional</span> <span class="nv">arguments</span>:
  <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>  <span class="k">show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>
</pre></div>
<p>其首先是新建一个parser，上面ArgumentParser的usage是可选参数，就是命令行的一些描述信息。然后需要调用parser的
<code>parse_args</code> 方法，其就是具体将命令行接受的一些参数刷进去。</p>
<h3 id="_7">简单添加一个参数</h3>
<p>上面的例子太简单了，现在开始简单添加一个参数。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
<p>这样命令行的帮助信息就变成如下所示了:</p>
<div class="highlight"><pre><span></span><span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>桌面$ <span class="nv">python3</span> <span class="nv">hello</span>.<span class="nv">py</span> <span class="o">-</span><span class="nv">h</span>
<span class="nv">usage</span>: 
<span class="nv">this</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">example</span> <span class="nv">to</span> <span class="k">show</span> <span class="nv">argparse</span> <span class="nv">usage</span>

<span class="nv">optional</span> <span class="nv">arguments</span>:
  <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>       <span class="k">show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>
  <span class="o">--</span><span class="nv">config</span> <span class="nv">CONFIG</span>  <span class="nv">the</span> <span class="nv">config</span> <span class="nv">file</span> <span class="nv">path</span>
</pre></div>
<p>如果我们如下输入则有:</p>
<div class="highlight"><pre><span></span><span class="n">wanze@wanze</span><span class="o">-</span><span class="n">ubuntu64</span><span class="p">:</span><span class="err">~</span><span class="o">/</span><span class="err">桌面$</span> <span class="n">python3</span> <span class="n">hello</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span><span class="o">=</span><span class="c">'config.cfg'</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="c">'config.cfg')</span>
</pre></div>
<p>我们看到 <code>parse_args</code> 方法返回的是Namespace对象，推荐用 <code>vars</code>
函数来将其处理成为字典值，这样会更好地方便后面的使用。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">wanze</span><span class="nd">@wanze</span><span class="o">-</span><span class="n">ubuntu64</span><span class="p">:</span><span class="o">~/</span><span class="err">桌面$</span> <span class="n">python3</span> <span class="n">hello</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
<span class="n">usage</span><span class="p">:</span> 
<span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">example</span> <span class="n">to</span> <span class="n">show</span> <span class="n">argparse</span> <span class="n">usage</span>
<span class="n">python3</span> <span class="n">hello</span><span class="o">.</span><span class="n">py</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">c</span> <span class="n">CONFIG</span><span class="p">,</span> <span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span>
                        <span class="n">the</span> <span class="n">config</span> <span class="nb">file</span> <span class="n">path</span>
<span class="n">wanze</span><span class="nd">@wanze</span><span class="o">-</span><span class="n">ubuntu64</span><span class="p">:</span><span class="o">~/</span><span class="err">桌面$</span> <span class="n">python3</span> <span class="n">hello</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span><span class="o">=</span><span class="s1">'config.cfg'</span>
<span class="p">{</span><span class="s1">'config'</span><span class="p">:</span> <span class="s1">'config.cfg'</span><span class="p">}</span>
</pre></div>
<p>上面代码稍作修改，在长名字可选参数前面还可以加上短名字可选参数支持，然后我们看到
<code>parse_args</code> 方法经过 <code>vars</code>
处理之后返回的是字典值。该字典的key默认对应的是长名字可选参数。你还可以自己设置目标参数名:</p>
<h3 id="_8">添加参数的其他选项设置</h3>
<p>下面演示了如何设置目标参数在脚本中具体对应的变量名:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">dest</span><span class="o">=</span><span class="s2">"configpath"</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
<p>然后我们看到字典输入如下:</p>
<div class="highlight"><pre><span></span><span class="n">wanze</span><span class="nv">@wanze</span><span class="o">-</span><span class="nl">ubuntu64</span><span class="p">:</span><span class="o">~/</span><span class="n">桌面</span><span class="err">$</span><span class="w"> </span><span class="n">python3</span><span class="w"> </span><span class="n">hello</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="c1">--config='config.cfg'</span>
<span class="err">{</span><span class="s1">'configpath'</span><span class="err">:</span><span class="w"> </span><span class="s1">'config.cfg'</span><span class="err">}</span><span class="w"></span>
</pre></div>
<p>当然一般就默认设置成为和长名字可选参数一致，没必要这么折腾。类似的你还可以继续用
<code>add_argument</code> 方法来添加其他的可选参数，然后 <code>add_argument</code>
还有如下一些选项配置:</p>
<dl>
<dt>required=True</dt>
<dd>
<p>该参数一定要输入值，否则报错</p>
</dd>
<dt>help</dt>
<dd>
<p>描述信息，前面已经看到了。</p>
</dd>
<dt>default</dt>
<dd>
<p>该参数的默认值，默认是None，你可以选择设置成另外一个值。</p>
</dd>
<dt>type</dt>
<dd>
<p>目标参数的数据类型，默认是字符串，可以设置为int或float。注意设置格式如下，不是字符串的那种设置形式:
​    <code>parser.add_argument('--delay',type=int)</code></p>
</dd>
</dl>
<p>必填参数的添加如下所示，除了这个\"target\"名字前面没有 <code>--</code>
之外，和可选参数用法大致类似，其刷入args字典之后的key就是\"target\"这个名字。</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'target'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="ss">"必填参数"</span><span class="p">)</span>
</pre></div>
<p>不过必填参数和可选参数在某些细节上还是有点差异的，后面会提及。</p>
<h4 id="nargs">nargs选项设置</h4>
<p>nargs设置之后该参数在脚本中具体对应的变量将是一个列表。其中nargs可以设置为一个数字，比如
<code>nargs=4</code> ，则脚本对该参数将接受4个输入值，然后将其收集进一个列表里面。</p>
<p>此外还有:</p>
<dl>
<dt>nargs='*'</dt>
<dd>
<p>这通常是对可选参数进行设置，当然也可以作用于必填参数，但这让必填参数失去意义了。其将收集任意多的输入参数值，而如果多个可选参数之间这样使用星号是可以的，具体请参看官方文档。</p>
</dd>
<dt>nargs='+'</dt>
<dd>
<p>这通常作用于必填参数，其意义有点类似于正则表达式里面的'+'号，和上面的'*'号比起来其必须有一个输入值，否则将报错。</p>
</dd>
<dt>nargs='?'</dt>
<dd>
<p>这个'?'号具体使用情况挺复杂的，我不太喜欢，而且其和nargs其他的一些设置比较起来显得有点格格不入。首先其对应的变量值不是列表而是单个值！其次其改变了默认值的行为。如果该参数不输入，比如
​    <code>--foo</code>
​    这个东西完全不输入在命令行里面，那么foo默认取default的值，如果加入了
​    <code>--foo</code> 这个东西但是后面又不跟值，则foo取 <strong>const</strong>
​    选项赋的值。不太喜欢这个东西。</p>
</dd>
</dl>
<h3 id="_9">一个完整的例子</h3>
<p>下面给出一个完整的例子:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">resize the image</span>
<span class="s1">'''</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">dest</span><span class="o">=</span><span class="s2">"configpath"</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'inputimg'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the input image"</span><span class="p">,</span><span class="n">nargs</span><span class="o">=</span><span class="s1">'+'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--width'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the input image"</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>

    <span class="n">configpath</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'configpath'</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'width'</span><span class="p">]</span>
    <span class="n">inputimg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'inputimg'</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">inputimg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="s1">'inputimg'</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'resize image'</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'the input image is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputimg</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'the target width is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table>
<p>具体运行情况如下所示:</p>
<div class="highlight"><pre><span></span><span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>图片$ <span class="nv">python3</span> <span class="nv">resizeimg</span>.<span class="nv">py</span> <span class="o">--</span><span class="nv">help</span>
<span class="nv">usage</span>: 
<span class="nv">resize</span> <span class="nv">the</span> <span class="nv">image</span>

<span class="nv">positional</span> <span class="nv">arguments</span>:
  <span class="nv">inputimg</span>              <span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span>

<span class="nv">optional</span> <span class="nv">arguments</span>:
  <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>            <span class="k">show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>
  <span class="o">-</span><span class="nv">c</span> <span class="nv">CONFIGPATH</span>, <span class="o">--</span><span class="nv">config</span> <span class="nv">CONFIGPATH</span>
                        <span class="nv">the</span> <span class="nv">config</span> <span class="nv">file</span> <span class="nv">path</span>
  <span class="o">--</span><span class="nv">width</span> <span class="nv">WIDTH</span>         <span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span>

<span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>图片$ <span class="nv">python3</span> <span class="nv">resizeimg</span>.<span class="nv">py</span> <span class="o">--</span><span class="nv">width</span><span class="o">=</span><span class="mi">300</span> <span class="o">*</span>.<span class="nv">png</span>
<span class="nv">resize</span> <span class="nv">image</span>
<span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span> <span class="nv">is</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span> <span class="mi">13</span>:<span class="mi">16</span>:<span class="mi">46</span> 的屏幕截图.<span class="nv">png</span>
<span class="nv">the</span> <span class="nv">target</span> <span class="nv">width</span> <span class="nv">is</span> <span class="mi">300</span>
<span class="nv">resize</span> <span class="nv">image</span>
<span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span> <span class="nv">is</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">18</span>:<span class="mi">17</span>:<span class="mi">19</span>屏幕截图.<span class="nv">png</span>
<span class="nv">the</span> <span class="nv">target</span> <span class="nv">width</span> <span class="nv">is</span> <span class="mi">300</span>
<span class="nv">resize</span> <span class="nv">image</span>
<span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span> <span class="nv">is</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">18</span>:<span class="mi">20</span>:<span class="mi">45</span>屏幕截图.<span class="nv">png</span>
<span class="nv">the</span> <span class="nv">target</span> <span class="nv">width</span> <span class="nv">is</span> <span class="mi">300</span>
....
</pre></div>
<h3 id="_10">命令行选项关联其他动作</h3>
<p>parser的 <code>add_argument</code> 方法的 <code>action</code>
参数就是用来控制命令行选项关联的动作的，一般都不需要设置，就是默认的
<code>store</code> ，也就是存储值。类似的有 <code>store_const</code> , <code>store_true</code> 和
<code>store_false</code> 。</p>
<h4 id="store95const">store_const</h4>
<p>如果是默认的store，则通常是需要指明具体值的，如果设置action为
<code>store_const</code> 了:</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--foo'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_const'</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
<p>那么如下就会自动设置该值，这和default默认值的区别是这个选项的值要求是某个常量值。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">python3</span> <span class="n">test2</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">foo</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
<h4 id="store95true-store95false">store_true 和 store_false</h4>
<p>如果写为:</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--foo'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">)</span>
</pre></div>
<p>则其存储的就是 <code>True</code> 值:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">python3</span> <span class="n">test2</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">foo</span> 
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>
<p>这里主要是要讲定义自己的动作，就是类似 <code>--version</code>
这样的用法，是一种影响程序整个工作流的选项，官方文档推荐通过子类化
<code>argparse.Action</code> 的方法，还是有点麻烦的。然后发现 <em>click</em>
模块非常好（一个解决创建命令行脚本工具问题推荐使用的第三方模块），处理这个问题也很容易:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>

<span class="k">def</span> <span class="nf">print_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">resilient_parsing</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">'Version 1.0'</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">quick</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">param</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">param</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">'--version'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">print_version</span><span class="p">,</span>
              <span class="n">expose_value</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">is_eager</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">'--quick'</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="n">quick</span><span class="p">,</span><span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">userinput</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'input:'</span><span class="p">)</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">userinput</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">userinput</span> <span class="o">==</span> <span class="s1">'exit'</span><span class="p">:</span>
            <span class="k">break</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">hello</span><span class="p">()</span>
</pre></div>
<p>这里的ctx和param到click模块那边再细讲吧，我们看到整个过程比argparse美观多了。</p>
<h2 id="ast">ast模块</h2>
<p>更多信息请参看 <a href="https://docs.python.org/3.4/library/ast.html">官方文档</a>
。</p>
<h3 id="literal95eval">literal_eval函数</h3>
<p><code>literal_eval</code>函数是一个非常有用的函数，其可用于将某个短小的python字符串转化成python
object。如下所示:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ast</span>
<span class="k">def</span> <span class="nf">str2pyobj</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">'''str to python obj or not changed'''</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span><span class="c1">###</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">val</span>
</pre></div>
<p>支持的python object有: strings, bytes, numbers, tuples, lists, dicts,
sets, booleans, and None.</p>
<p>所以一般的字符串如 \"1\" \"3.14\" \"[1,2,3]\" 将其分别转化成为integer
float
和list是小菜一碟。当然最好建立异常捕捉，如果转化失败，则原样返回字符串即可。</p>
<h2 id="collections">collections模块</h2>
<p>更多内容请参见<a href="https://docs.python.org/3/library/collections.html">官方文档</a>。</p>
<h3 id="namedtuple">namedtuple函数</h3>
<p>collections模块里面的namedtuple函数将会产生一个有名字的数组的类（有名数组），通过这个类可以新建类似的实例。比如：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">Point3d</span><span class="o">=</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Point3d'</span><span class="p">,[</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="s1">'z'</span><span class="p">])</span>
<span class="n">p1</span><span class="o">=</span><span class="n">Point3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p1</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

<span class="n">Point3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">0</span> <span class="mi">2</span>
</pre></div>
<h3 id="counter">Counter计数类</h3>
<p>可以进行简单的输入数据统计频数计算。</p>
<h3 id="ordereddict">OrderedDict对象</h3>
<p>python中的字典对象默认各个key是没有顺序的，OrderdDict对象的概念就是在字典概念的基础上让各个key有顺序。</p>
<p>一个例子如下所示（来自官方文档）。简单的理解就是一个字典对象记住了各个key的插入顺序。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="err">{</span><span class="s1">'banana'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'pear'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'orange'</span><span class="p">:</span> <span class="mi">2</span><span class="err">}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="k">dictionary</span> <span class="n">sorted</span> <span class="k">by</span> <span class="k">key</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="k">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">'orange'</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">'pear'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="k">dictionary</span> <span class="n">sorted</span> <span class="k">by</span> <span class="n">value</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="k">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">'pear'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">'orange'</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="k">dictionary</span> <span class="n">sorted</span> <span class="k">by</span> <span class="k">length</span> <span class="k">of</span> <span class="n">the</span> <span class="k">key</span> <span class="n">string</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="k">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">'pear'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">'orange'</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
</pre></div>
<h2 id="configparser">configparser模块</h2>
<p>简单的配置文件管理就用python的内置模块configparser。python2对应的模块名字叫
ConfigParser 。</p>
<p>python3之后configparser的使用更加简单了，具体就分为如下几步:</p>
<h3 id="configparser_1">新建一个configparser对象</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">configparser</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</pre></div>
<h3 id="config">读取某个config文件</h3>
<p>调用read方法具体读取某个config文件。</p>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="s1">'test.cfg'</span><span class="p">)</span>
</pre></div>
<h3 id="configparser_2">如同字典一般操作configparser对象</h3>
<p>然后接下来就是如同字典一般操作这个configparser对象。其中 'DEFAULT'
是特殊的section，大致如下这样表达:</p>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="p">[</span><span class="s1">'DEFAULT'</span><span class="p">]</span> <span class="o">=</span> <span class="err">{</span><span class="s1">'ServerAliveInterval'</span><span class="p">:</span> <span class="s1">'45'</span><span class="p">,</span>
                     <span class="s1">'Compression'</span><span class="p">:</span> <span class="s1">'yes'</span><span class="p">,</span>
                     <span class="s1">'CompressionLevel'</span><span class="p">:</span> <span class="s1">'9'</span><span class="err">}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">'bitbucket.org'</span><span class="p">]</span> <span class="o">=</span> <span class="err">{}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">'bitbucket.org'</span><span class="p">][</span><span class="s1">'User'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'hg'</span>
<span class="n">config</span><span class="p">[</span><span class="s1">'topsecret.server.com'</span><span class="p">]</span> <span class="o">=</span> <span class="err">{}</span>
</pre></div>
<h3 id="write">调用write方法写入</h3>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="k">open</span><span class="p">(</span><span class="s1">'example.ini'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
    <span class="n">config</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
</pre></div>
<h3 id="_11">不默认更改大小写</h3>
<p>具体请参看
<a href="http://stackoverflow.com/questions/19359556/configparser-reads-capital-keys-and-make-them-lower-case">这个网页</a>
，configparser模块默认把 option name 也就是每个section的key
name改成小写，我不太喜欢这种风格，因为将configparser刷成字典值时，我们通常认为字典的key大小写是区分的，可以如下改动，然后就不自动进行小写操作了:</p>
<div class="highlight"><pre><span></span><span class="k">self</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">configparser</span><span class="p">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="k">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="n">str</span><span class="o">##</span> <span class="k">not</span> <span class="n">auto</span> <span class="n">make</span> <span class="n">it</span> <span class="n">lowercase</span>
</pre></div>
<h2 id="csv">csv模块</h2>
<p>下面主要介绍了自定义csv方言的情况，更加简单的txt文本样式，有时使用pandas会很方便，有时就是简单的使用自己定义的逗号分隔，一行行附加打印入文本即可，并不需要特别的处理。</p>
<h3 id="csv_1">自定义csv方言</h3>
<p>首先我们看到最通用的excel格式的csv方言写法：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">excel</span><span class="p">(</span><span class="n">Dialect</span><span class="p">):</span>
    <span class="sd">"""Describe the usual properties of Excel-generated CSV files."""</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">','</span>
    <span class="n">quotechar</span> <span class="o">=</span> <span class="s1">'"'</span>
    <span class="n">doublequote</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">skipinitialspace</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">lineterminator</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span>
    <span class="n">quoting</span> <span class="o">=</span> <span class="n">QUOTE_MINIMAL</span>
<span class="n">register_dialect</span><span class="p">(</span><span class="s2">"excel"</span><span class="p">,</span> <span class="n">excel</span><span class="p">)</span>
</pre></div>
<p>下面就这些字段的含义作出说明：</p>
<ul>
<li>
<p><strong>delimiter</strong>  分隔符，这个意义很明显。</p>
</li>
<li>
<p><strong>lineterminator</strong>  换行符，这个意义也很明显，目前主要就两种： <code>\r\n</code>  和 <code>\n</code> 。</p>
</li>
<li>
<p><strong>skipinitialspace</strong>  默认是False，其主要是对于如果你将空格设置为分隔符时有意义，这样后面字符开始的空格将会被忽略，其他情况设置为True或者False区别不大。</p>
<hr/>
</li>
<li>
<p><strong>quoting</strong>  设置quote规则</p>
<ul>
<li>
<p>csv.QUOTE_MINIMAL 意思是只有在需要的情况下才加上双引号，比如逗号在字符串里面，双引号在字符串里面，换行符号在字符串里面等等。</p>
</li>
<li>
<p>csv.QUOTE_ALL 意思是都加上双引号，即使是数字。</p>
</li>
<li>
<p>csv.QUOTE_NONNUMERIC 数字不加，字符串都加上双引号。（只有在这种情况下csv模块才会正确将数字解析为float类型）</p>
</li>
<li>
<p>csv.QUOTE_NONE 都不加（此时需要设置好escapechar选项）</p>
</li>
</ul>
</li>
<li>
<p><strong>quotechar</strong> 设置quote具体的字符，一般设置为双引号。</p>
</li>
<li>
<p><strong>doublequote</strong> 用来处理双引号在字符串中的情况，默认是True，字符串将会双引号之外再加上双引号，如果设置为False，会前面加上一个 <code>escapechar</code> 。</p>
</li>
</ul>
<p>自己定义csv方言就是类似的写上这样一个方言类，然后如下注册好即可：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">class</span> <span class="nc">MindMapCSV</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">Dialect</span><span class="p">):</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">','</span> <span class="c1"># 分隔符</span>
    <span class="n">quotechar</span> <span class="o">=</span> <span class="s1">'"'</span> <span class="c1"># quote符号</span>
    <span class="n">doublequote</span> <span class="o">=</span> <span class="bp">True</span> <span class="c1"># 双引号在字符中的情况</span>
    <span class="n">skipinitialspace</span> <span class="o">=</span> <span class="bp">True</span> <span class="c1"># 分隔符后空白忽略</span>
    <span class="n">lineterminator</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="c1"># 换行符</span>
    <span class="n">quoting</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span> <span class="c1"># 最小quote</span>

<span class="n">csv</span><span class="o">.</span><span class="n">register_dialect</span><span class="p">(</span><span class="s2">"MindMapCSV"</span><span class="p">,</span> <span class="n">MindMapCSV</span><span class="p">)</span>
</pre></div>
<h4 id="reader">对应的Reader编写</h4>
<p>下面贴出一个样例，具体要看你设计的csv方言来的。</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Reader</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dialect</span><span class="o">=</span><span class="s1">'sv'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">head</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getrow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">lst</span>

    <span class="k">def</span> <span class="nf">getdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">e</span>
</pre></div>
<p>其中有：</p>
<ul>
<li>getrow 取某一行的值</li>
<li>getcol 取某一列的值</li>
<li>getdata 取整个表格的数据值</li>
</ul>
<h4 id="writer">对应的Writer编写</h4>
<p>同样也要根据你的csv方言设计来的，下面只是贴出一个样例：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Writer</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dialect</span><span class="o">=</span><span class="s1">'sv'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dialect</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">setrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>
    <span class="k">def</span> <span class="nf">setcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">setdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
<p>提供的方法有：</p>
<ul>
<li>addrow 添加一行值</li>
<li>addcol 添加一列值</li>
<li>set 设置某行某列的某个值为什么</li>
<li>setdata 设置整个数据</li>
<li>write 实际写入到文件中去。</li>
</ul>
<h2 id="tempfile">tempfile模块</h2>
<p>tempfile模块用于创建临时文件或者临时文件夹，这个模块在所有系统平台上都能正常工作，有时还是很有用的。</p>
<p>比如windows系统下的临时文件夹所在：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span>
<span class="s1">'nt'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">tempfile</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
<span class="s1">'C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">a3580</span><span class="se">\\</span><span class="s1">AppData</span><span class="se">\\</span><span class="s1">Local</span><span class="se">\\</span><span class="s1">Temp'</span>
</pre></div>
<p>最核心的两个函数是 <code>mkstemp</code> 和 <code>mkdtemp</code> 。</p>
<h2 id="mkstemp">mkstemp</h2>
<p>mkstemp函数用于新建一个临时文件</p>
<div class="highlight"><pre><span></span><span class="n">fd</span><span class="p">,</span> <span class="n">fpath</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
<span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_cache_file</span><span class="p">:</span>
    <span class="n">marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">FREQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">),</span> <span class="n">temp_cache_file</span><span class="p">)</span>
</pre></div>
<p>返回的第二个参数就是目标临时文件的路径名，第一个文件参数比较特殊，是操作系统级别的文件句柄（应该是C语言那边的文件句柄吧），要转成一般使用的python文件对象如上所示，使用 <code>os.fdopen</code> 来打开。</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js','mhchem.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
            
            
            <hr/>

        </div>
        <section>
        <div class="col-md-2" style="float:right;font-size:0.9em;">
            <h4>首发于：</h4>
            <time pubdate="pubdate" datetime="2017-05-10T00:00:00+08:00">2017年 5月 10日 </time>
            <h4>分类：</h4>
            <a class="category-link" href="https://docs.cdwanze.work/categories.html#pythonyu-yan-ref">python语言</a>
        </div>
        </section>
</div>
</article>
    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>


<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="http://www.cdwanze.work" title="cdwanze Home Page">cdwanze</a></li>
    </ul>
</div>
</footer>

        <script src="https://docs.cdwanze.work/theme/js/jquery.min.js"></script>
    <script src="https://docs.cdwanze.work/theme/js/bootstrap.min.js"></script>
    <script>
        function validateForm(query) {
            return (query.length > 0);
        }
    </script>

    <script>
        function adjust_search_width() {
            var w = document.documentElement.clientWidth;
            if ((w > 755) && (w < 975)) {
                plus_width = w - 755;
                $('.navbar-form .form-control').outerWidth(210 + plus_width);
            } else if (w >= 975) {
                $('.navbar-form .form-control').outerWidth(210 + 220);
            } else if (w <= 755) {
                $('.navbar-form .form-control').css('width', '100%')
            }
        }

        $(document).ready(function () {
            adjust_search_width();
        });

        window.onresize = function () {
            adjust_search_width();
        }

    </script>


    



</body>
</html>