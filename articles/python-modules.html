<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="D4VqC4HppC"/>
    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625"/>

        <meta name="author" content="cdwanze"/>
        <meta name="copyright" content="cdwanze"/>

        <meta property="og:type" content="article"/>
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="python, python语言, " />

<meta property="og:title" content="python语言学习模块篇 "/>
<meta property="og:url" content="/articles/python-modules.html" />
<meta property="og:description" content="引入模块 import语句 import语句的一般使用方法之前已有接触，比如 import math ，然后要使用math模块里面的函数或者类等需要使用这样的带点的变量名结构：math.pi。 此外import语句还有一个常见的缩写名使用技巧，比如import numpy as np，那么后面就可以这样写了， np.array，而不是numpy.array。 from语句 from语句的使用有以下两种情况： from this import this from what import * 第一种形式是点名只导入某个变量，第二种形式是都导入进来。我想读者肯定知道这点，使用第二种导入形式的时候要小心变量名覆盖问题，这个自己心里有数即可。 reload函数 reload函数可以重新载入某个模块，reload函数的优点就是不需要重新启动应用程序，更加合理的动态重载一些模块。reload只能用于python编写的模块，在python3中，reload函数被移到imp模块里面去了，因此首先需要import imp才能使用了。比如说： from imp import reload reload(somemodule) unittest模块 …" />
<meta property="og:site_name" content="cdwanze的博文" />
<meta property="og:article:author" content="cdwanze" />
<meta property="og:article:published_time" content="2016-03-03T00:00:00+08:00" />
<meta property="" content="2019-10-02T00:00:00+08:00" />
<meta name="twitter:title" content="python语言学习模块篇 ">
<meta name="twitter:description" content="引入模块 import语句 import语句的一般使用方法之前已有接触，比如 import math ，然后要使用math模块里面的函数或者类等需要使用这样的带点的变量名结构：math.pi。 此外import语句还有一个常见的缩写名使用技巧，比如import numpy as np，那么后面就可以这样写了， np.array，而不是numpy.array。 from语句 from语句的使用有以下两种情况： from this import this from what import * 第一种形式是点名只导入某个变量，第二种形式是都导入进来。我想读者肯定知道这点，使用第二种导入形式的时候要小心变量名覆盖问题，这个自己心里有数即可。 reload函数 reload函数可以重新载入某个模块，reload函数的优点就是不需要重新启动应用程序，更加合理的动态重载一些模块。reload只能用于python编写的模块，在python3中，reload函数被移到imp模块里面去了，因此首先需要import imp才能使用了。比如说： from imp import reload reload(somemodule) unittest模块 …">

    <title>
python语言学习模块篇  · cdwanze的博文
</title>


        <link href="/theme/css/font-awesome.css" rel="stylesheet"
              media="screen">
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet"
              media="screen">

            <link rel="stylesheet" type="text/css"
                  href="/theme/css/pygments.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="/theme/css/elegant.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="/theme/css/custom.css" media="screen">






</head>
<body>

<nav class="navbar">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="/"><span
                    class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <form action="/search.html"
                  onsubmit="return validateForm(this.elements['q'].value);"
                  class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" name="q" id="tipue_search_input"
                           class="form-control" placeholder="Search..."
                           style="width:430px;">
                </div>
                <button class="btn btn-default" type="submit">搜索</button>
            </form>


            <ul class="nav navbar-nav nav-pills navbar-right">
                <li >
                    <a href="">博文首页</a></li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle"
                           data-toggle="dropdown" role="button"
                           aria-haspopup="true" aria-expanded="false">查找文章<span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a class="slowscroll" href="/categories.html">按分类</a>
                            </li>
                            <li><a class="slowscroll" href="/tags.html">按标签</a>
                            </li>
                        </ul>
                    </li>


                        <li >
                            <a href="/pdf-ebooks.html">pdf电子书籍</a>
                        </li>
                        <li >
                            <a href="/epub-ebooks.html">epub电子书籍</a>
                        </li>
                        <li >
                            <a href="/about.html">关于本网站</a>
                        </li>
            </ul>


        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">
<article>
<div class="row">
    <header class="page-header col-md-10 col-md-offset-2">
    <h1><a href="/articles/python-modules.html"> python语言学习模块篇  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-md-2 table-of-content">
        <nav>
        <h4>目录</h4>
        <div class="toc">
<ul>
<li><a href="#_1">引入模块</a><ul>
<li><a href="#import">import语句</a></li>
<li><a href="#from">from语句</a></li>
<li><a href="#reload">reload函数</a></li>
</ul>
</li>
<li><a href="#unittest">unittest模块</a></li>
<li><a href="#time">time模块</a><ul>
<li><a href="#time_1">time函数</a></li>
<li><a href="#gmtime">gmtime函数</a></li>
<li><a href="#localtime">localtime函数</a></li>
<li><a href="#ctime">ctime函数</a></li>
<li><a href="#strftime">strftime函数</a></li>
<li><a href="#sleep">sleep函数</a></li>
</ul>
</li>
<li><a href="#sys">sys模块</a><ul>
<li><a href="#sysargv">sys.argv</a></li>
<li><a href="#exit">exit函数</a></li>
<li><a href="#sysplatform">sys.platform</a></li>
<li><a href="#syspath">sys.path</a></li>
<li><a href="#_2">标准输入输出错误输出文件</a></li>
<li><a href="#sysversion">sys.version</a></li>
<li><a href="#sysmaxsize">sys.maxsize</a></li>
<li><a href="#sysstdinisatty">sys.stdin.isatty()</a></li>
</ul>
</li>
<li><a href="#subprocess">subprocess模块</a><ul>
<li><a href="#call">call函数</a></li>
<li><a href="#getoutput">getoutput函数</a></li>
<li><a href="#getstatusoutput">getstatusoutput函数</a></li>
<li><a href="#popen">Popen类</a></li>
</ul>
</li>
<li><a href="#shutil">shutil模块</a><ul>
<li><a href="#_3">复制文件</a></li>
<li><a href="#_4">复制文件夹</a></li>
<li><a href="#_5">删除整个目录</a></li>
<li><a href="#_6">移动文件夹</a></li>
<li><a href="#chown">chown函数</a></li>
<li><a href="#which">which函数</a></li>
</ul>
</li>
<li><a href="#os">os模块</a><ul>
<li><a href="#getcwd">getcwd函数</a></li>
<li><a href="#mkdir">mkdir函数</a></li>
<li><a href="#chdir">chdir函数</a></li>
<li><a href="#_7">删除文件</a></li>
<li><a href="#osrename">os.rename</a></li>
<li><a href="#osrepalce">os.repalce</a></li>
<li><a href="#_8">删除空目录</a></li>
<li><a href="#listdir">listdir命令</a></li>
<li><a href="#_9">遍历目录树</a></li>
<li><a href="#environ">environ函数</a></li>
<li><a href="#getpid">getpid函数</a></li>
<li><a href="#stat">stat函数</a><ul>
<li><a href="#st95size">st_size属性</a></li>
<li><a href="#st95mtime">st_mtime属性</a></li>
<li><a href="#st95ctime">st_ctime属性</a></li>
</ul>
</li>
<li><a href="#_10">给进程发送信号</a></li>
</ul>
</li>
<li><a href="#ospath">os.path模块</a><ul>
<li><a href="#abspath">abspath函数</a></li>
<li><a href="#dirname">dirname函数</a></li>
<li><a href="#basename">basename函数</a></li>
<li><a href="#split">split函数</a></li>
<li><a href="#splitext">splitext函数</a></li>
<li><a href="#join">join函数</a></li>
<li><a href="#expanduser">expanduser函数</a></li>
<li><a href="#exists">exists函数</a></li>
<li><a href="#isfileisdirislink">isfile和isdir还有islink</a></li>
<li><a href="#samefile">samefile函数</a></li>
<li><a href="#getmtime">getmtime函数</a></li>
<li><a href="#getctime">getctime函数</a></li>
</ul>
</li>
<li><a href="#shelve">shelve模块</a><ul>
<li><a href="#_11">存入多个对象</a></li>
<li><a href="#_12">读取这些对象</a></li>
</ul>
</li>
<li><a href="#pickle">pickle模块</a><ul>
<li><a href="#_13">将对象存入文件</a></li>
<li><a href="#_14">从文件中取出对象</a></li>
</ul>
</li>
<li><a href="#pathlib">pathlib模块</a></li>
<li><a href="#logging">logging模块</a><ul>
<li><a href="#logging_1">什么时候使用logging</a></li>
<li><a href="#_15">将日志信息输出到文件</a></li>
<li><a href="#logging_2">logging模块中级教程</a><ul>
<li><a href="#loggers">loggers</a></li>
<li><a href="#handlers">handlers</a></li>
<li><a href="#filters">filters</a></li>
<li><a href="#formatters">formatters</a></li>
</ul>
</li>
<li><a href="#_16">字典统一配置</a></li>
</ul>
</li>
<li><a href="#json">json模块</a><ul>
<li><a href="#json_1">什么是json</a></li>
<li><a href="#json_2">json存储格式语法</a></li>
<li><a href="#_17">存储字典值</a></li>
<li><a href="#_18">存储到文件的一些美化</a></li>
<li><a href="#dumpsloads">dumps和loads函数</a></li>
</ul>
</li>
<li><a href="#itertools">itertools模块</a><ul>
<li><a href="#repeat">repeat函数</a></li>
<li><a href="#starmap">starmap函数</a></li>
</ul>
</li>
<li><a href="#inspect">inspect模块</a><ul>
<li><a href="#getfile">getfile函数</a></li>
<li><a href="#getcallargs">getcallargs函数</a></li>
</ul>
</li>
<li><a href="#functools">functools模块</a><ul>
<li><a href="#partial">partial类</a></li>
</ul>
</li>
<li><a href="#datetime">datetime模块</a><ul>
<li><a href="#timedelta">timedelta对象</a></li>
<li><a href="#datetime_1">datetime对象</a><ul>
<li><a href="#nowutcnow">now和utcnow方法</a><ul>
<li><a href="#pytz">查看pytz的所有时区</a></li>
<li><a href="#now">具体给now方法指定一个时区</a></li>
<li><a href="#nowutcnow_1">now方法和utcnow方法区别</a></li>
</ul>
</li>
<li><a href="#datetime_2">datetime对象的属性</a></li>
<li><a href="#strftime_1">strftime方法</a></li>
<li><a href="#_19">支持的时间间隔运算</a></li>
</ul>
</li>
<li><a href="#struct95time-datetime">struct_time 对象转化成为 datetime 对象</a></li>
<li><a href="#datetime-time95struct">datetime 对象转化为 time_struct 对象</a></li>
</ul>
</li>
<li><a href="#re">re模块</a><ul>
<li><a href="#re_1">re模块中的元字符集</a></li>
<li><a href="#re_2">re模块中的特殊字符类</a></li>
<li><a href="#_20">转义问题</a></li>
<li><a href="#re_3">re模块的使用</a><ul>
<li><a href="#_21">匹配和查找</a></li>
<li><a href="#_22">分割操作</a></li>
<li><a href="#_23">替换操作</a></li>
<li><a href="#_24">非最长匹配</a></li>
<li><a href="#_25">非捕获组</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#abc">abc模块</a></li>
<li><a href="#argparse">argparse模块</a><ul>
<li><a href="#_26">简单添加一个参数</a></li>
<li><a href="#_27">添加参数的其他选项设置</a><ul>
<li><a href="#nargs">nargs选项设置</a></li>
</ul>
</li>
<li><a href="#_28">一个完整的例子</a></li>
<li><a href="#_29">命令行选项关联其他动作</a><ul>
<li><a href="#store95const">store_const</a></li>
<li><a href="#store95true-store95false">store_true 和 store_false</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ast">ast模块</a><ul>
<li><a href="#literal95eval">literal_eval函数</a></li>
</ul>
</li>
<li><a href="#collections">collections模块</a><ul>
<li><a href="#namedtuple">namedtuple函数</a></li>
<li><a href="#counter">Counter计数类</a></li>
<li><a href="#ordereddict">OrderedDict对象</a></li>
</ul>
</li>
<li><a href="#configparser">configparser模块</a><ul>
<li><a href="#configparser_1">新建一个configparser对象</a></li>
<li><a href="#config">读取某个config文件</a></li>
<li><a href="#configparser_2">如同字典一般操作configparser对象</a></li>
<li><a href="#write">调用write方法写入</a></li>
<li><a href="#_30">不默认更改大小写</a></li>
</ul>
</li>
<li><a href="#csv">csv模块</a><ul>
<li><a href="#csv_1">自定义csv方言</a><ul>
<li><a href="#reader">对应的Reader编写</a></li>
<li><a href="#writer">对应的Writer编写</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#tempfile">tempfile模块</a></li>
<li><a href="#mkstemp">mkstemp</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="col-md-8 article-content">

            
            
<h2 id="_1">引入模块</h2>
<h3 id="import">import语句</h3>
<p>import语句的一般使用方法之前已有接触，比如 <code>import math</code> ，然后要使用math模块里面的函数或者类等需要使用这样的带点的变量名结构：math.pi。</p>
<p>此外import语句还有一个常见的缩写名使用技巧，比如import numpy as
np，那么后面就可以这样写了， np.array，而不是numpy.array。</p>
<h3 id="from">from语句</h3>
<p>from语句的使用有以下两种情况：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">this</span> <span class="kn">import</span> <span class="n">this</span>
<span class="kn">from</span> <span class="nn">what</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
<p>第一种形式是点名只导入某个变量，第二种形式是都导入进来。我想读者肯定知道这点，使用第二种导入形式的时候要小心变量名覆盖问题，这个自己心里有数即可。</p>
<h3 id="reload">reload函数</h3>
<p>reload函数可以重新载入某个模块，reload函数的优点就是不需要重新启动应用程序，更加合理的动态重载一些模块。reload只能用于python编写的模块，在python3中，reload函数被移到imp模块里面去了，因此首先需要import
imp才能使用了。比如说：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">imp</span> <span class="kn">import</span> <span class="nb">reload</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">somemodule</span><span class="p">)</span>
</pre></div>
<h2 id="unittest">unittest模块</h2>
<p>在编程中有一个概念TDD，其和具体的编程语言无关，其全称叫做test-driven
development。也就是人们常说的测试驱动型开发。不说这么大的概念，但在python编程开发中有一块内容是你必须要了解的，那就是单元测试开发。具体python中内置模块unittest就是做这个工作的。</p>
<p>基本的使用就简单用下面这个例子来说明了：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">class</span> <span class="nc">TooBigError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TooBigError</span><span class="p">(</span><span class="s1">'too big input error'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'hello'</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FirstTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''setUp函数在每个测试单元执行前被执行，其通常用于预先配置</span>
<span class="sd">        一些后面测试单元会用到的参数'''</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''tearDown函数在每个测试单元执行之后再执行。'''</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''具体的测试单元，名字需要以test字符开始'''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">3.1416</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotAlmostEqual</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">3.1415</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_raises</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">TooBigError</span><span class="p">,</span> <span class="n">hello</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
<p>unittest模块的main函数具体实际执行各个测试单元类，这些测试单元类继承自unittest的TestCase类。在这些继承自TestCase的类中，setUp函数和tearDown函数有特殊的用途，具体见上面代码的说明。然后里面定义的函数test字符串开头的都是所谓的测试单元，其将被逐个执行。</p>
<p>TestCase有很多方法，比如assertTrue，assertFalse用于断言某个bool值是真或假，然后assertEqual用来断言某两个值是相等的(==)，类似的还有assertNotEqual用来断言两个值不相等。这里值得一提的assertAlmostEqual方法是用来断言某两个float值在多少小数位上是大致相等的，比如上面的例子，
<span class="math">\(\pi\)</span>
值具体到小数点4位是3.1416。上面这些方法后面还可以额外接受一个提示字符串参数（Msg参数），用来具体没有断言成功的时的补充信息。</p>
<p>assertRaises方法用来断言某个函数在接受某些参数之后必然返回某个异常。该方法第一个参数是期望捕捉到的异常，第二个参数是具体调用的函数，后面的参数将送给这个函数，所以就不能跟之前谈及的Msg参数了。</p>
<p>更多信息请参看该模块的官方文档。</p>
<h2 id="time">time模块</h2>
<p>time模块提供了一些和时间相关的函数，更加的底层，不过有些函数可能在某些平台并不适用。类似的模块还有datetime模块，datetime是以类的框架来解决一些时间问题的。所以如果只是需要简单的调用一下时间，那么用time模块，如果是大量和时间相关的问题，推荐使用datetime模块。</p>
<h3 id="time_1">time函数</h3>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">time</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="mf">1404348227.07554</span>
</pre></div>
<p>time函数返回一个数值，这个数值表示从1970年1月1号0时0分0秒到现在的时间过了多少秒。</p>
<h3 id="gmtime">gmtime函数</h3>
<p>这个函数可以接受一个参数，这个参数是多少秒，然后返回一个特定格式的时间数组<code>struct_time</code>。如果不接受参数，那么默认接受的秒数由time函数返回，也就是从那个特定时间到现在过了多少秒，这样这个特定格式的时间数组对应的就是当前时间。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">gmtime</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">struct_time</span><span class="p">(</span><span class="n">tm_year</span><span class="o">=</span><span class="mi">2014</span><span class="p">,</span> <span class="n">tm_mon</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">tm_mday</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tm_hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
<span class="n">tm_min</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span> <span class="n">tm_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tm_wday</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tm_yday</span><span class="o">=</span><span class="mi">184</span><span class="p">,</span> <span class="n">tm_isdst</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">gmtime</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">struct_time</span><span class="p">(</span><span class="n">tm_year</span><span class="o">=</span><span class="mi">1970</span><span class="p">,</span> <span class="n">tm_mon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tm_mday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tm_hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
<span class="n">tm_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tm_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tm_wday</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tm_yday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tm_isdst</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
<h3 id="localtime">localtime函数</h3>
<p>此外类似的还有<strong>localtime</strong>函数，和gmtime用法和返回完全一模一样，唯一的区别就是返回的是当地的时间。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-%d %H:%M:%S'</span><span class="p">,</span><span class="n">time</span><span class="p">.</span><span class="k">localtime</span><span class="p">())</span>
<span class="s1">'2014-07-03 09:19:40'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-%d %H:%M:%S'</span><span class="p">,</span><span class="n">time</span><span class="p">.</span><span class="n">gmtime</span><span class="p">())</span>
<span class="s1">'2014-07-03 01:19:49'</span>
</pre></div>
<h3 id="ctime">ctime函数</h3>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">ctime</span><span class="p">()</span>
<span class="s1">'Thu Jul  3 08:54:54 2014'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">ctime</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="s1">'Thu Jan  1 07:00:00 1970'</span>
</pre></div>
<p>和gmtime类似，不过返回的是字符串格式的时间。我们看到ctime默认设置的时间是根据localtime函数来的。</p>
<h3 id="strftime">strftime函数</h3>
<p>接受那个特定格式的时间数组<code>struct_time</code>作为参数，然后返回一定字符串格式的时间。具体例子请参看前面的例子。</p>
<p>其中最常用的格式符有：</p>
<div class="highlight"><pre><span></span><span class="c">%Y，多少年；%m，多少月；%d，多少日；</span>
<span class="c">%H，多少小时；%M，多少分；%S，多少秒。</span>
</pre></div>
<p><code>%X</code> 直接输出09:27:19这样的格式，也就是前面的多少小时多少分多少秒可以用一个%X表示即可。</p>
<p>还有一些，比如：%I表示多少小时，不过是[0-12]的形式；%y表示多少年，不过是[00-99]的格式，比如2014年就输出14；%p，本地的AM或PM文字。等等。</p>
<h3 id="sleep">sleep函数</h3>
<p>sleep函数有时需要用到，将程序休眠个几秒的意思。需要接受一个数值参数，单位是秒，可以是零点几秒。但sleep函数只是大概休眠几秒的意思，最好不去用来计时，因为它不大精确。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/time.html">官方文档</a>。</p>
<h2 id="sys">sys模块</h2>
<p>sys模块有一些功能很常用，其实在前面我们就看到过一些了。</p>
<h3 id="sysargv">sys.argv</h3>
<p>在刚开始说明python执行脚本参数传递的问题时就已经讲了sys.argv这个变量。这是一个由字符串组成的列表。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
<p>比如新建上面的一个test.py文件，然后执行：</p>
<div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">test</span><span class="p">.</span><span class="n">py</span> <span class="n">test1</span> <span class="n">test2</span>
<span class="p">[</span><span class="s1">'test.py'</span><span class="p">,</span> <span class="s1">'test1'</span><span class="p">,</span> <span class="s1">'test2'</span><span class="p">]</span>
<span class="n">test</span><span class="p">.</span><span class="n">py</span>
<span class="n">test1</span>
<span class="n">test2</span>
</pre></div>
<p>我们可以看到sys.argv[0]就是这个脚本的文件名，然后后面依次是各个参数。</p>
<h3 id="exit">exit函数</h3>
<p>这个我们在编写GUI程序的时候经常看到，在其他脚本程序中也很常用。如果不带参数的话那么直接退出程序，还可以带一个字符串参数，返回错误提示信息，或者带一个数字，这里的详细讨论略过。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">'出错了'</span><span class="p">)</span>
<span class="err">出错了</span>
<span class="n">wanze</span><span class="nd">@wanze</span><span class="o">-</span><span class="n">ubuntu</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>
<h3 id="sysplatform">sys.platform</h3>
<p>返回当前脚本执行的操作系统环境。</p>
<p>Linux 返回字符串值：linux；Windows返回win32；Mac OS X 返回darwin。</p>
<h3 id="syspath">sys.path</h3>
<p>一连串字符串列表，是python脚本模块的搜索路径，所以我们自定义的python模块，只需要在sys.path这个列表上新加一个字符串路径即可。</p>
<h3 id="_2">标准输入输出错误输出文件</h3>
<p>sys.stdin，sys.stdout，sys.stderr这三个文件对象对应的就是linux系统所谓的标准输入标准输出和错误输出文件流对象。</p>
<h3 id="sysversion">sys.version</h3>
<p>sys.version输出当前python的版本信息和编译环境的详细信息。</p>
<p>sys.version_info[0]
返回当前python主版本的标识，比如python3就返回数字3。</p>
<h3 id="sysmaxsize">sys.maxsize</h3>
<p>返回当前计算环境下整数(int)类型的最大值，32位系统是<span class="math">\(2**31-1\)</span>。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span>
<span class="mi">2147483647</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
<span class="mi">2147483647</span>
</pre></div>
<h3 id="sysstdinisatty">sys.stdin.isatty()</h3>
<p>测试输入流是不是终端。如果是终端，则返回True。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/sys.html">官方文档</a>。</p>
<h2 id="subprocess">subprocess模块</h2>
<p>我想大家都注意到了现在的计算机都是多任务的，这种多任务的实现机制就是所谓的多个进程同时运行，因为计算机只有一个CPU（现在多核的越来越普及了。）所有计算机一次只能处理一个进程，而这种多进程的实现有点类似你人脑（当然不排除某些极个别现象），你不能一边看电影一边写作业，但是可以写一会作业然后再看一会电影（当然不推荐这么做、），计算机的多进程实现机制也和这个类似，就是一会干这个进程，一会儿做那个进程。</p>
<p>计算机的一个进程里面还可以分为很多个线程，这个较为复杂，就不谈了。比如你编写的一个脚本程序，系统就会给它分配一个进程号之类的，然后cpu有时就会转过头来执行它一下（计算机各个进程之间的切换很快的，所以才会给我们一种多任务的错觉。）而你的脚本程序里面还可以再开出其他的子进程出来，
python的subprocess模块主要负责这方面的工作。</p>
<h3 id="call">call函数</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># Command with shell expansion</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">"echo"</span><span class="p">,</span> <span class="s2">"hello world"</span><span class="p">])</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">"echo"</span><span class="p">,</span> <span class="s2">"$HOME"</span><span class="p">])</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">'echo $HOME'</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">hello</span> <span class="n">world</span>
<span class="err">$</span><span class="n">HOME</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wanze</span>
</pre></div>
<p>其中使用shell=True选项后用法较简单较直观，但网上提及安全性和兼容性可能有问题，他们推荐一般不适用shell=True这个选项。</p>
<p>如果不使用shell=True这个选项的，比如这里<code>$HOME</code>这个系统变量就无法正确翻译过来，如果实在需要home路径，需要使用os.path的expanduser函数。</p>
<h3 id="getoutput">getoutput函数</h3>
<p>取出某个进程命令的输出，返回的是字符串形式。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">name</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s1">'whoami'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
<h3 id="getstatusoutput">getstatusoutput函数</h3>
<p>某个进程执行的状态。</p>
<h3 id="popen">Popen类</h3>
<p>根据Popen类创建一个进程管理实例，可以进行进程的沟通，暂停，关闭等等操作。前面的函数的实现是基于Popen类的，这是较高级的课题，这里暂时略过。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/subprocess.html">官方文档</a>。</p>
<h2 id="shutil">shutil模块</h2>
<p>相当于os模块的补充，shutil模块进一步提供了一些系统级别的文件或文件夹的复制，删除，移动等等操作。</p>
<h3 id="_3">复制文件</h3>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="p">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
<span class="n">shutil</span><span class="p">.</span><span class="k">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
<span class="n">shutil</span><span class="p">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>
<p>其中<strong>copyfile</strong>的src和dst两个参量都是完整文件路径名，第一个参量是待复制的文件，第二个参量是复制后的文件名；而<strong>copy</strong>函数的第一个参量是待复制的文件，但是第二个参量是目标文件夹路径；<strong>copy2</strong>函数和copy函数类似，不同的是它能尝试保留文件的所有元信息metadata（模块开头有说明是理论上但不尽然）。</p>
<h3 id="_4">复制文件夹</h3>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="p">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>
<p><strong>copytree</strong>函数第一个参量是待复制的文件夹路径名，第二个参量是目标文件夹路径名，其将被创建不应该存在。</p>
<h3 id="_5">删除整个目录</h3>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="p">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
<p><strong>rmtree</strong>函数用于删除整个文件夹，path就是目标文件夹的路径名。</p>
<h3 id="_6">移动文件夹</h3>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="p">.</span><span class="k">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">dst</span><span class="p">)</span>
</pre></div>
<p><strong>move</strong>函数把一个文件或者一个文件夹移动到一个文件夹内。</p>
<h3 id="chown">chown函数</h3>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="p">.</span><span class="n">chown</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="k">user</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="k">group</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>
</pre></div>
<p><strong>chown</strong>函数类似的linux系统下的chown函数，这个函数基于os.chown函数，不过接口更友好。</p>
<h3 id="which">which函数</h3>
<div class="highlight"><pre><span></span><span class="n">shutil</span><span class="p">.</span><span class="n">which</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
<p><strong>which</strong>函数类似的linux系统下的which函数。</p>
<p>更多shutil模块内容请参见<a href="https://docs.python.org/3.4/library/shutil.html">官方文档</a>。</p>
<h2 id="os">os模块</h2>
<h3 id="getcwd">getcwd函数</h3>
<p>不管你在终端运行python还是运行某个python脚本，总有一个变量存储着当前工作目录的位置。你可以通过getcwd命令来查看当前工作目录。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</pre></div>
<p>上面是通过LaTeX文件运行的python小脚本，当你以python命令来运行某个脚本的时候，你调用python命令的地方就是当前的工作目录。然后加载的其他模块的各个py文件运行时的当前工作目录和主py文件脚本的当前目录是一样的，都是你运行python命令的地方。</p>
<p>如果是终端调用python就是你终端的当前工作目录所在，你可以用pwd命令来查看。如下所示：</p>
<div class="highlight"><pre><span></span><span class="o">=&gt;</span><span class="n">pwd</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wanze</span>
<span class="o">=&gt;</span><span class="n">python3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wanze</span>
</pre></div>
<h3 id="mkdir">mkdir函数</h3>
<p>新建一个文件夹。</p>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
</pre></div>
<h3 id="chdir">chdir函数</h3>
<p>os模块里有一个chdir函数来更改当前工作目录所在地。</p>
<p>可以使用<em>.</em>和<em>..</em>语法，也可以使用简单的\"test\"调转到test文件夹。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">'/home/wanze/pymf'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">print</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wanze</span><span class="o">/</span><span class="n">pymf</span>
</pre></div>
<h3 id="_7">删除文件</h3>
<p>os.remove(path)</p>
<p>支持相对路径表达。如果路径是目录将会抛出一个OSError异常。</p>
<h3 id="osrename">os.rename</h3>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="k">rename</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>
<p>第一个参数是目标文件或目录，第二个参数是要替换成为的名字。这个命令一方面可以重命名文件，此外可以移动文件。</p>
<p>支持相对路径语法表达，rename在windows下不一定替换原文件，repalce一定替换文件。</p>
<h3 id="osrepalce">os.repalce</h3>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="k">replace</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>
<p>rename在windows下不一定替换原文件，repalce一定替换文件。</p>
<p>支持相对路径语法表达。</p>
<h3 id="_8">删除空目录</h3>
<p>os.rmdir(path)</p>
<p>支持相对路径语法表达，只能删除空目录。如果要删除整个目录，请使用shutil.rmtree(path)。</p>
<h3 id="listdir">listdir命令</h3>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">'.'</span><span class="p">)</span>
</pre></div>
<p>相当于简单的ls命令，将返回一个字符串列表，其内包含本path下所有的文件和文件夹名（包括链接文件）。</p>
<p>可以结合前面介绍的os.path模块的isfile等函数新建一个函数listdir_file，listdir_dir和listdir_link，将普通文件，目录和链接文件区分开来。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">listdir_dir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">'.'</span><span class="p">):</span>
    <span class="sd">'''os的listdir函数加强，只返回文件夹。'''</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">dir</span> <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span> <span class="p">]</span>
<span class="k">def</span> <span class="nf">listdir_file</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">'.'</span><span class="p">):</span>
    <span class="sd">'''os的listdir函数加强，只返回普通文件'''</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">file</span> <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
     <span class="ow">and</span>  <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="nb">file</span><span class="p">)]</span>
<span class="k">def</span> <span class="nf">listdir_link</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">'.'</span><span class="p">):</span>
    <span class="sd">'''os的listdir函数加强，只返回链接文件'''</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">link</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">link</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
<h3 id="_9">遍历目录树</h3>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
</pre></div>
<p>产生一个生成器对象，具体数值含义如下：（dirpath, dirnames,
filenames），其中dirpath和filenames可以合并出本目录下所有文件的具体文件名路径，而dirpath和dirnames可以合并出本目录下所有目录的具体路径名。</p>
<p>根据这个os.walk函数我写了一个<code>gen_file</code>
函数，其是一个生成器函数，会遍历目录树，并返回本目录下的文件信息。具体代码如下所示:</p>
<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">gen_file</span><span class="ss">(</span><span class="nv">startpath</span><span class="o">=</span><span class="s1">'</span><span class="s">.</span><span class="s1">'</span>,<span class="nv">filetype</span><span class="o">=</span><span class="s2">""</span><span class="ss">)</span>:
    <span class="s1">'''</span><span class="s">利用os.walk 遍历某个目录，收集其内的文件，返回</span>
    <span class="ss">(</span>文件路径列表, 本路径下的文件列表<span class="ss">)</span>
    比如:
    <span class="ss">(</span>[<span class="s1">'</span><span class="s">shortly</span><span class="s1">'</span>], [<span class="s1">'</span><span class="s">shortly.py</span><span class="s1">'</span>]<span class="ss">)</span>
<span class="ss">(</span>[<span class="s1">'</span><span class="s">shortly</span><span class="s1">'</span>, <span class="s1">'</span><span class="s">templates</span><span class="s1">'</span>], [<span class="s1">'</span><span class="s">shortly.py</span><span class="s1">'</span>]<span class="ss">)</span>
<span class="ss">(</span>[<span class="s1">'</span><span class="s">shortly</span><span class="s1">'</span>, <span class="s1">'</span><span class="s">static</span><span class="s1">'</span>], [<span class="s1">'</span><span class="s">shortly.py</span><span class="s1">'</span>]<span class="ss">)</span>

    第一个可选参数 <span class="nv">startpath</span>  默认值 <span class="s1">'</span><span class="s">.</span><span class="s1">'</span>
    第二个参数  <span class="nv">filetype</span>  正则表达式模板 默认值是<span class="s2">""</span> 其作用是只选择某些文件
    如果是空值，则所有的文件都将被选中。比如 <span class="s2">"</span><span class="s">html$|pdf$</span><span class="s2">"</span> 将只选中 <span class="nv">html</span>和<span class="nv">pdf</span>文件。
    <span class="s1">'''</span>
    <span class="k">for</span> <span class="nv">root</span>, <span class="nv">dirs</span>, <span class="nv">files</span> <span class="nv">in</span> <span class="nv">os</span>.<span class="nv">walk</span><span class="ss">(</span><span class="nv">startpath</span><span class="ss">)</span>:
        <span class="nv">filelist</span> <span class="o">=</span> []
        <span class="k">for</span> <span class="nv">f</span> <span class="nv">in</span> <span class="nv">files</span>:
            <span class="nv">fileName</span>,<span class="nv">fileExt</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">splitext</span><span class="ss">(</span><span class="nv">f</span><span class="ss">)</span>
            <span class="k">if</span> <span class="nv">filetype</span>:
                <span class="k">if</span> <span class="nv">re</span>.<span class="nv">search</span><span class="ss">(</span><span class="nv">filetype</span>,<span class="nv">fileExt</span><span class="ss">)</span>:
                    <span class="nv">filelist</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">f</span><span class="ss">)</span>
            <span class="k">else</span>:
                <span class="nv">filelist</span> <span class="o">=</span> <span class="nv">files</span>
        <span class="k">if</span> <span class="nv">filelist</span>:#空文件夹不加入
            <span class="nv">dirlist</span> <span class="o">=</span> <span class="nv">root</span>.<span class="nv">split</span><span class="ss">(</span><span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">sep</span><span class="ss">)</span>
            <span class="nv">dirlist</span> <span class="o">=</span> <span class="nv">dirlist</span>[<span class="mi">1</span>:]
            <span class="k">if</span> <span class="nv">dirlist</span>:
                <span class="nv">yield</span> <span class="ss">(</span><span class="nv">dirlist</span>, <span class="nv">filelist</span><span class="ss">)</span>
            <span class="k">else</span>:
                <span class="nv">yield</span> <span class="ss">(</span>[<span class="s1">'</span><span class="s">.</span><span class="s1">'</span>], <span class="nv">filelist</span><span class="ss">)</span>
</pre></div>
<p>这个函数可以帮助你管理本目录下（可以通过正则表达式过滤）你感兴趣的文件，都刷一边。然后继续必要的操作，比如查找等等之类的。</p>
<h3 id="environ">environ函数</h3>
<p>os.environ，返回一个字典值，这个字典值里面存储着当前shell的一些变量和值。比如系统中"HOME"所具体的路径名是：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'HOME'</span><span class="p">])</span>

<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wanze</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>
<h3 id="getpid">getpid函数</h3>
<p>os.getpid函数，返回当前运行的进程的pid。</p>
<h3 id="stat">stat函数</h3>
<p>返回文件的一些信息。比如st_size是文件的大小，单位是字节。</p>
<h4 id="st95size">st_size属性</h4>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="k">print</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'*.py'</span><span class="p">)])</span>

<span class="k">print</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'*.py'</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">&gt;</span> <span class="mi">400</span><span class="p">])</span>

<span class="p">[</span><span class="s1">'/home/wanze/桌面/test.py'</span><span class="p">,</span> <span class="s1">'/home/wanze/桌面/flatten.py'</span><span class="p">]</span>
<span class="p">[</span><span class="s1">'flatten.py'</span><span class="p">]</span>
</pre></div>
<p>下面这个例子进行了文件大小输出单位的优化:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">filesize</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>

<span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'字节'</span><span class="p">,</span><span class="s1">'KB'</span><span class="p">,</span><span class="s1">'MB'</span><span class="p">,</span><span class="s1">'GB'</span><span class="p">,</span><span class="s1">'TB'</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">filesize</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span>
        <span class="n">filesize</span> <span class="o">=</span> <span class="n">filesize</span><span class="o">/</span><span class="mi">1024</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>

<span class="k">print</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">'大小是'</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">filesize</span><span class="p">))</span> <span class="o">+</span> <span class="n">unit</span><span class="p">)</span>
</pre></div>
<p>这个python小脚本自动输出合适的单位，具体程序逻辑还是很简单的。</p>
<h4 id="st95mtime">st_mtime属性</h4>
<p>最后文件修改的时间。</p>
<h4 id="st95ctime">st_ctime属性</h4>
<p>最后文件创建的时间，在windows下是严格的最初文件创建时间，在unix下是最后文件metadata的改变时间。</p>
<h3 id="_10">给进程发送信号</h3>
<p>可以通过os模块的kill函数来给某个进程发送某个信号。</p>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="n">kill</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>
</pre></div>
<p>函数第一个参数是进程的pid，第二个参数是具体发送的信号。比如:</p>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="n">kill</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">signal</span><span class="p">.</span><span class="n">SIGSTOP</span><span class="p">)</span>
</pre></div>
<p>就是暂停某个进程，然后</p>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="n">kill</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">signal</span><span class="p">.</span><span class="n">SIGCONT</span><span class="p">)</span>
</pre></div>
<p>是继续某个进程。
然后<strong>killpg</strong>函数能够对某个进程包括其子进程发送某个信号，参考了<a href="http://kernelcheck.blogspot.com/2009/07/pausestop-process-in-python.html">这个网页</a>。</p>
<p>除此之外还有 <strong>SIGINT</strong> （正常终止进程信号）和 <strong>SIGKILL</strong>
（强制终止进程信号）
等等，更多信号请参看关于unix信号那块，比如<a href="http://en.wikipedia.org/wiki/Unix_signal">这个wiki页面</a>
。</p>
<p>更多os模块内容请参见<a href="https://docs.python.org/3.4/library/os.html">官方文档</a>。</p>
<h2 id="ospath">os.path模块</h2>
<p>前面提到sys.argv只能返回当前python脚本的文件名，而我们常常需要这个python脚本在系统中的具体位置。前面如os.getcwd等也能获得当前python脚本的所在目录，不过os.path模块的一个优点就是跨平台特性支持很好，也就是一般我们通过其他方式获得的path路径都会用这个模块的函数辅助处理一下。</p>
<p>我们来看下面的例子：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'HOME'</span><span class="p">]))</span>

<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wanze</span><span class="o">/</span><span class="err">桌面</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">wanze</span><span class="o">/</span><span class="err">桌面</span>
<span class="n">test</span><span class="o">.</span><span class="n">py</span>
<span class="n">wanze</span>
</pre></div>
<p>其中<code>__file__</code>表示当前脚本文件所在的路径。</p>
<h3 id="abspath">abspath函数</h3>
<p>abspath函数接受一个path路径值然后返回一个正规的普适的路径地址。具体效果类似于执行了:
<code>normpath(join(os.getcwd(), path))</code> 。</p>
<p>再看下面的例子演示了空字符串默认当前工作目录，然后也接受绝对路径等。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="s1">'/home/wanze'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">'test'</span><span class="p">)</span>
<span class="s1">'/home/wanze/test'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">'/test'</span><span class="p">)</span>
<span class="s1">'/test'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">'test/'</span><span class="p">)</span>
<span class="s1">'/home/wanze/test'</span>
</pre></div>
<p>我们看到如果abspath接收的是空字符串，其定位是当前脚本的工作目录，那么是引用的模块里面的<code>os.path.abspath('')</code>，具体对应的也是当前脚本的工作目录。然后os.path.abspath(\".\")返回的是当前脚本工作目录。</p>
<h3 id="dirname">dirname函数</h3>
<p>dirname函数接受一个路径值然后返回这个路径除开最后一个元素的前面的路径值。比如上面的例子，路径指向文件，那么dirname函数返回的是除开这个文件名的前面的路径；而如果接受的路径指向目录，那么返回的是除开最后一个文件夹名的前面的路径值。</p>
<h3 id="basename">basename函数</h3>
<p>如上面例子所示，basename函数接受一个路径值然后返回路径的最后一个元素，如果路径指向文件，那么返回的是文件名；如果路径指向目录，那么返回的是最后那个目录的文件夹名。比如下面实现了从绝对路径提取出文件名的功能。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">os.path</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">string</span> <span class="o">=</span> <span class="s1">'/home/wanze/test.txt'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fileName</span><span class="p">,</span><span class="n">fileExtension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fileName</span>
<span class="s1">'test'</span>
</pre></div>
<h3 id="split">split函数</h3>
<p>将路径path字符串分割，可以视作dirname和basename的组合。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">split</span><span class="ss">(</span><span class="s1">'</span><span class="s">/usr/local/bin/test.txt</span><span class="s1">'</span><span class="ss">)</span>
<span class="ss">(</span><span class="s1">'</span><span class="s">/usr/local/bin</span><span class="s1">'</span>, <span class="s1">'</span><span class="s">test.txt</span><span class="s1">'</span><span class="ss">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="k">dirname</span><span class="ss">(</span><span class="s1">'</span><span class="s">/usr/local/bin/test.txt</span><span class="s1">'</span><span class="ss">)</span>
<span class="s1">'</span><span class="s">/usr/local/bin</span><span class="s1">'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="k">basename</span><span class="ss">(</span><span class="s1">'</span><span class="s">/usr/local/bin/test.txt</span><span class="s1">'</span><span class="ss">)</span>
<span class="s1">'</span><span class="s">test.txt</span><span class="s1">'</span>
</pre></div>
<h3 id="splitext">splitext函数</h3>
<p>将某个路径path的后缀分开，这里主要是针对文件名为输入的时候，那么第一个为该文件的名字，输出数组的第二个值是该文件的后缀。这个函数在提取文件名后缀和前面的名字的时候很有用，方便组合出新的文件名。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="s1">'/path/to/somefile.ext'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fileName</span>
<span class="s1">'/path/to/somefile'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fileExtension</span>
<span class="s1">'.ext'</span>
</pre></div>
<h3 id="join">join函数</h3>
<p>用于连接多个路径值合并成一个新的路径值，同样相对于简单的字符串拼接，用这个函数处理路径组合具有操作系统普适性和灵活性。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~'</span><span class="p">),</span><span class="s1">'test'</span><span class="p">,</span><span class="s1">'lib'</span><span class="p">)</span>
<span class="s1">'/home/wanze/test/lib'</span>
</pre></div>
<p>上面join函数多个参数生成的新path在windows下又是不同的输出的。</p>
<h3 id="expanduser">expanduser函数</h3>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~'</span><span class="p">)</span>
<span class="s1">'/home/wanze'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~/pymf'</span><span class="p">)</span>
<span class="s1">'/home/wanze/pymf'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~'</span><span class="p">),</span><span class="s1">'pymf'</span><span class="p">,</span><span class="s1">'mymodule'</span><span class="p">)</span>
<span class="s1">'/home/wanze/pymf/mymodule'</span>
</pre></div>
<p><code>~</code>这个符号可以在这里使用，从而展开为以/home/wanze为基础的绝对路径，兼容大部分系统（在windows下也可以使用。）</p>
<p>同时我们看到join函数可以接受很多不定量的参数，然后将他们组合成为一个新的路径，而且不用你费心是<code>/</code>还是<code>\</code>，你不需要写这些了，用join函数自然料理好一切。</p>
<h3 id="exists">exists函数</h3>
<p>os.path.exists(path)：测试路径或文件等是否存在。如果存在返回True，否则返回False。</p>
<h3 id="isfileisdirislink">isfile和isdir还有islink</h3>
<p>os.path.isfile(path)：接受一个字符串路径变量，如果是文件那么返回True，否则返回False（也就是文件不存在或者不是文件是文件夹等情况都会返回False）。</p>
<p>类似的有isdir和islink函数。</p>
<h3 id="samefile">samefile函数</h3>
<p>os.path.samefile(path1,path2)：如果两个文件或路径相同则返回True\
，否则返回False。</p>
<h3 id="getmtime">getmtime函数</h3>
<p>os.path.getmtime(path)</p>
<p>返回文件的最后修改时间，返回值是多少多少秒，可用time模块的ctime或localtime函数将其转换成time.struct_time
对象，然后使用strftime来进行更好的格式输出。</p>
<h3 id="getctime">getctime函数</h3>
<p>类似getmtime，返回文件的最后创建时间。在unix系统中是指最后文件的元信息更改的时间。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/os.path.html">官方文档</a>。</p>
<p>现在让我们进入模块基础知识的学习吧，建立编写自己的模块，这样不断积累自己的知识，不断变得更强。</p>
<p>实际上之前我们已经接触过很多python自身的标准模块或者其他作者写的第三方模块，而import和from语句就是加载模块用的。</p>
<p>from语句和import语句内部作用机制很类似，只是在变量名的处理方式上有点差异（from会把变量名复制过来）。这里重点就import的工作方式说明如下：</p>
<ol>
<li>
<p>首先需要找到模块文件。</p>
</li>
<li>
<p>然后将模块文件编译成位码（需要时，根据文件的时间戳。），你会看到新多出来一个<code>__pycache__</code>文件夹。</p>
</li>
<li>
<p>执行编译出来的位码，创建该py文件定义的对象。</p>
</li>
</ol>
<p>这三个步骤是第一次import的时候会执行的，第二次import的时候会跳过去，而直接引用内存中已加载的对象。</p>
<h2 id="shelve">shelve模块</h2>
<p>shelve模块是基于pickle模块的，也就是只有pickle模块支持的对象它才支持。
之前提及pickle模块只能针对一个对象，如果你有多个对象要处理，可以考虑使用shelve模块，而shelve模块就好像是自动将这些对象用字典的形式包装起来了。除此之外shelve模块的使用更加简便了。</p>
<h3 id="_11">存入多个对象</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shelve</span>
<span class="kn">from</span> <span class="nn">Hero</span> <span class="kn">import</span> <span class="n">Garen</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">garen1</span><span class="o">=</span><span class="n">Garen</span><span class="p">()</span>
    <span class="n">garen2</span><span class="o">=</span><span class="n">Garen</span><span class="p">(</span><span class="s1">'red'</span><span class="p">)</span>
    <span class="n">garen3</span><span class="o">=</span><span class="n">Garen</span><span class="p">(</span><span class="s1">'yellow'</span><span class="p">)</span>
    <span class="n">db</span><span class="o">=</span><span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'test.db'</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">'garen1'</span><span class="p">,</span><span class="n">garen1</span><span class="p">),(</span><span class="s1">'garen2'</span><span class="p">,</span><span class="n">garen2</span><span class="p">),(</span><span class="s1">'garen3'</span><span class="p">,</span><span class="n">garen3</span><span class="p">)]:</span>
        <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">item</span>
    <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>我们看到整个过程的代码变得非常的简洁了，然后一个个对象是以字典的形式存入进去的。</p>
<h3 id="_12">读取这些对象</h3>
<p>读取这些对象的代码也很简洁，就是用shelve模块的open函数打开数据库文件，open函数会自动返回一个字典对象，这个字典对象里面的数据就对应着之前存入的键值和对象。</p>
<p>同时通过这个例子我发现，如果自己定义的类，将他们提取出来放入另外一个文件，那么shelve模块读取文件时候是不需要再引入之前的定义。这一点值得我们注意，因为shelve模块内部也采用的是pickle的机制，所以可以猜测之前pickle的那个例子类的定义写在写入文件代码的里面，所以不能载入数据库；而如果将这些类的定义放入一个文件，然后这些类以模块或说模块载入的形式引入，那么读取这些对象就可以以一种更优雅的形式实现。如下所示：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shelve</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">db</span><span class="o">=</span><span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'test.db'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>我们看到就作为简单的程序或者原型程序的数据库，shelve模块已经很好用而且够用了。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/shelve.html">官方文档</a>。</p>
<h2 id="pickle">pickle模块</h2>
<p>pickle模块可以将某复杂的对象永久存入文件中，以后再导入这个文件，这样自动将这个复杂的对象导入进来了。</p>
<h3 id="_13">将对象存入文件</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">=</span><span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">test001</span><span class="o">=</span><span class="n">Test</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">test001</span><span class="p">)</span>
    <span class="n">testfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">'data.pkl'</span><span class="p">,</span><span class="s1">'wb'</span><span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">test001</span><span class="p">,</span><span class="n">testfile</span><span class="p">)</span>
    <span class="n">testfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<h3 id="_14">从文件中取出对象</h3>
<p>值得一提的是从文件中取出对象，原来的类的定义还是必须存在，也就是声明一次在内存中的，否则会出错。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">=</span><span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">testfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">'data.pkl'</span><span class="p">,</span><span class="s1">'rb'</span><span class="p">)</span>
    <span class="n">test001</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">testfile</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">test001</span><span class="p">)</span>
    <span class="n">testfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>pickle模块的基本使用就是用dump函数将某个对象存入某个文件中，然后这个文件以后可以用load函数来加载，然后之前的那个对象会自动返回出来。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/pickle.html">官方文档</a>。</p>
<h2 id="pathlib">pathlib模块</h2>
<p>自python3.4以后起，python3就内置了pathlib模块了。之前的python版本，需要通过pip安装pathlib，后面的使用也差不了太多了。下面的讨论主要参考了python3.4的pathlib模块的官方文档，以其为准。</p>
<p>这个模块主要让我们对系统的路径更加灵活的操作，python取代bash进行系统运维的时候，有大量的对文件名，路径等的操作，pathlib将大大简化我们在这一块的工作量。首先来看一个例子：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~'</span><span class="p">))</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>

<span class="k">print</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.pdf"</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()])</span>
<span class="k">print</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p2</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()])</span>
</pre></div>
<p>这里Path是可以接受相对路径语法的，所以\".\"和\"..\"都是可用的。然后Path对象有方法glob和iterdir方法，其中glob就是类似linux的glob命令；然后iterdir将遍历当前目录。遍历之后返回了一个可迭代对象（读者可以看一下，是一个生成器对象），展开之后仍然是一个Path对象。然后Path对象有
<code>is_file</code> 方法和 <code>is_dir</code> 方法来判断该Path对象是不是文件夹或者文件路径。</p>
<p>Path对象有很多便捷的方法，很是好用，比如： <strong>iterdir</strong> ， <strong>exists</strong> ，
<strong>is_file</strong> ， <strong>is_dir</strong> ， <strong>parents</strong> ， <strong>cwd</strong>
等等。更多信息请参看官方文档。</p>
<p>marshal模块可以将python的一些变量以二进制的形式读写入文件中，比如jieba分词的词典缓存就是这么做的。</p>
<p>官方文档推荐如果确实有类似的简单存储需求，推荐是使用pickle或者shelve模块，不管怎么说，这个模块简单的使用我们了解下吧。</p>
<p>其支持的对象类型有：</p>
<blockquote>
<p>The following types are supported: booleans, integers, floating point numbers, complex numbers, strings, bytes, bytearrays, tuples, lists, sets, frozensets, dictionaries</p>
</blockquote>
<p>简单的使用如下：</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">FREQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_cache_file</span><span class="p">:</span>
    <span class="n">marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">FREQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">),</span> <span class="n">temp_cache_file</span><span class="p">)</span>
</pre></div>
<p>load方法加载目标文件对象，返回值是你之前送入的对象。</p>
<p>dump方法是把你想要送进去的对象，送入到某个文件中去。</p>
<h2 id="logging">logging模块</h2>
<p>在软件开发中，两个东西最易被初学者忽视，但实际上却是最有用的工具:
一个是单元测试；一个是日志输出管理。python的官方内置模块logging可以帮助你更好地管理自己的日志汇报系统。一个好的日志汇报系统不仅能够帮助程序员调试debug，用户向专业人员汇报发生错误时候的信息，还可以帮助人们理解程序具体是如何运行的和运行到了那里，在干些什么，这些都是非常有用的。</p>
<h3 id="logging_1">什么时候使用logging</h3>
<p>有的时候一些简单的函数调试就可以使用print函数来进行一些输出信息，这在编程早期还是有用的。而后续不管是调试还是编程都推荐使用单元测试的方法。而在大型软件项目中，print函数则是更应该少出现，只有那些程序员希望用户看到的信息才能使用print函数（当然某些经过io重定向的print函数不在这里的讨论范围之内）。</p>
<p>程序员有时想要看看某个大型软件内部具体是如何运作的，丑陋的做法是print，然后注释掉。这样也不是不可以，只是最好程序员做的一切工作都能保存起来拿到台面上，毕竟这都是劳动。logging模块的第一个用途就出来了:
我们可以使用 <code>logging.info()</code>
这个函数，来输出某些信息，这些信息只有在你调低了logging等级之后（默认的是
<strong>WARNING</strong> ），才会显示出来。低于 <strong>WARNING</strong> 等级的还有一个函数
<code>logging.debug()</code>
。info函数的信息通常是程序员用来确认程序是按照预期运行的，debug函数的信息通常是出现某个bug了，程序员希望有助于他debug的输出信息。</p>
<p><code>logging.warn()</code>
函数用来发出警告信息，并且程序员应该修改程序来避免这个信息出现；
<code>logging.warning</code>
函数用来发出警告信息，这种情况程序员表示在我的预料之中，是用户不应该这样做，程序不需要修改，但信息应该被记录。</p>
<p>然后特别重大的错误或异常捕捉，这个使用python的 <code>try... except...</code>
语句，或者raise抛出异常，这自不必多说。只是有某些情况，程序员不愿抛出这个异常，而是希望压抑这个错误，则可以使用logging模块的
<code>error()</code> 函数或者 <code>exception()</code> 函数或者 <code>critical()</code> 函数。</p>
<p>具体这些函数的严重等级是:</p>
<p>最简单的一个使用例子如下所示:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'info'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'warning'</span><span class="p">)</span>
</pre></div>
<p>这里的basicConfig函数对整个日志系统进行一些配置。比如这里设置日志报告等级
<code>level=logging.DEBUG</code> ，这样我们将会看到 <strong>DEBUG</strong> 以及 <strong>DEBUG</strong>
以上等级的日志信息；然后如果设置为 <code>logging.INFO</code> ，则就只看到 <strong>INFO</strong>
和 <strong>INFO</strong> 以上等级的信息了。</p>
<h3 id="_15">将日志信息输出到文件</h3>
<p>更专业的做法是将日志输出到文件中去，即使是自己调试，对于大型软件项目来说，日志信息是很多的，将其保存到文件，然后用编辑器或者shell工具或者其他工具查看会更便捷一些。要将这些日志信息都输出到某个文件中很简单，在
<strong>basicConfig</strong> 设置 <code>filename</code> 参数即可:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">'test.log'</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'info'</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'warning'</span><span class="p">)</span>
</pre></div>
<p>默认的 <strong>filemode</strong> 是 \"a\"
，也就是日志信息一直累积在那里。你可以多运行几次这个小py脚本，来看看具体的效果。
<strong>filemode</strong> 也可以设置为 \"w\" ，则只保存最后那次运行的日志信息。</p>
<h3 id="logging_2">logging模块中级教程</h3>
<p>logging模块的中级使用需要了解如下几个词汇：loggers, handlers, filters,
and formatters。</p>
<h4 id="loggers">loggers</h4>
<p><strong>记录器</strong>
之前我们运行logging.info，就是调用的默认的记录器，然后一般我们会针对每个python的模块文件创建一个记录器。</p>
<div class="highlight"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</pre></div>
<p>这个 <code>__name__</code>
只是一种简便的命名方法，如果你勤快或者某种情况下有需要的话完全可以自己手工给记录器取个名字。</p>
<p>然后这个 <code>getLogger</code>
函数如果你后面指定的名字之前已经定义了（这通常是指在其他第三方模块下定义了），那么你通过这个
<code>getLogger</code>
然后指定目标名字就会得到对应的该记录器。这通常对于DIY某个第三方模块的日志记录器有用。</p>
<p>记录器可以挂载或者卸载某个处理器对象或过滤器对象：</p>
<ul>
<li>
<p>logger.addHandler()</p>
</li>
<li>
<p>logger.removeHandler()</p>
</li>
<li>
<p>logger.addFilter()</p>
</li>
<li>
<p>logger.removeFilter()</p>
</li>
</ul>
<p>记录器通过 <code>setLevel()</code>
方法来设置最小记录级别，这个和后面的Handler级别是协作关系。</p>
<p>记录器的propagate参数这里值得详细说下，记录器的名字自己定义也好，还是用
<code>__name__</code>
这样python自带的模块结构语法也好，其有个上层和下层的关系，比如说
<code>main.test</code> 这个记录器是属于 <code>main</code> 这个记录器的。而这里讨论的
<code>propagate</code> 参数，默认是True，也就是发送给 <code>main.test</code>
记录器的信息也会传递给其上层 <code>main</code>
记录器上去。如果设置为False则不会往上传递了。</p>
<h4 id="handlers">handlers</h4>
<p><strong>处理器</strong>负责分发日志信息到目标地去。这里主要介绍这几个Handler类：</p>
<dl>
<dt>StreamHandler</dt>
<dd>
<p>将信息以流的形式输出，这通常指输出到终端</p>
</dd>
<dt>FileHandler</dt>
<dd>
<p>将信息写入到某个文件中去</p>
</dd>
<dt>RotatingFileHandler</dt>
<dd>
<p>将信息写入某个文件，如果文件大小超过某个值，则另外新建一个文件继续写。</p>
</dd>
<dt>TimeRotatingFileHandler</dt>
<dd>
<p>将信息写入某个文件，每隔一段时间，比如说一天，就会自动再新建一个文件再往里面写。</p>
</dd>
</dl>
<p>处理器对象也有 <code>setLevel</code> 方法，这个前面也提及了，和记录器的 <code>setLevel</code>
是协作关系，更详细的描述是，信息先记录器处理并分发给对应的处理器对象，然后再处理器处理再分发到目的地。</p>
<p>处理器可以挂载 <strong>格式器</strong> 对象和 <strong>过滤器</strong> 对象。</p>
<ul>
<li>
<p>handler.setFormatter()</p>
</li>
<li>
<p>handler.addFilter()</p>
</li>
<li>
<p>handler.removeFilter()</p>
</li>
</ul>
<h4 id="filters">filters</h4>
<p><strong>过滤器</strong></p>
<h4 id="formatters">formatters</h4>
<p><strong>格式器</strong>，具体信息的格式定义。</p>
<p>这里的format涉及到的一些参数设置如下所示:</p>
<div class="highlight"><pre><span></span><span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">levelname</span><span class="p">)</span><span class="n">s</span> <span class="err">类似</span><span class="s1">'DEBUG'</span><span class="err">这样的</span><span class="n">logging</span> <span class="k">level</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="n">s</span> <span class="err">具体输出的信息</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">asctime</span><span class="p">)</span><span class="n">s</span> <span class="err">具体时间，默认是</span><span class="s1">'2003-07-08 16:49:45,896'</span><span class="err">，你可以通过</span> <span class="o">**</span><span class="n">datefmt</span><span class="o">**</span> <span class="err">选项来进一步设置格式，格式设置和</span><span class="n">strftime命令类似</span><span class="err">。</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="n">s</span> <span class="err">文件名，更简洁的表达是模块名。</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="n">s</span> <span class="err">模块名</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">funcName</span><span class="p">)</span><span class="n">s</span> <span class="err">函数名</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">lineno</span><span class="p">)</span><span class="n">d</span> <span class="err">具体</span><span class="n">logging代码在第几行</span>

<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="n">s</span> <span class="n">logger的名字</span><span class="err">，默认是</span><span class="s1">'root'</span><span class="err">。</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">process</span><span class="p">)</span><span class="n">d</span> <span class="err">进程号</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">processName</span><span class="p">)</span><span class="n">s</span> <span class="err">进程名</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span><span class="n">d</span> <span class="err">线程号</span>
<span class="o">-</span>   <span class="o">%</span><span class="p">(</span><span class="n">threadName</span><span class="p">)</span><span class="n">s</span> <span class="err">线程名</span>
</pre></div>
<h3 id="_16">字典统一配置</h3>
<p>django的setting.py就会有这样的配置，具体含义还是很明显的，就是定义处理器，格式器，记录器等。</p>
<div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="err">{</span>
    <span class="s1">'version'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'disable_existing_loggers'</span><span class="p">:</span> <span class="k">False</span><span class="p">,</span>
    <span class="s1">'formatters'</span><span class="p">:</span> <span class="err">{</span>
        <span class="s1">'simple'</span><span class="p">:</span> <span class="err">{</span>
            <span class="s1">'format'</span><span class="p">:</span> <span class="ss">"%(asctime)s %(name)s [%(levelname)s] %(thread)d %(module)s %(funcName)s %(lineno)s: %(message)s"</span>
        <span class="err">}</span>
    <span class="err">}</span><span class="p">,</span>
    <span class="s1">'handlers'</span><span class="p">:</span> <span class="err">{</span>
        <span class="s1">'log_file'</span><span class="p">:</span> <span class="err">{</span>
            <span class="s1">'class'</span><span class="p">:</span> <span class="s1">'sdsom.common.log.DedupeRotatingAndTimedRotatingFileHandler'</span><span class="p">,</span>
            <span class="s1">'filename'</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'log_path'</span><span class="p">),</span>
            <span class="s1">'when'</span><span class="p">:</span> <span class="s1">'midnight'</span><span class="p">,</span>
            <span class="s1">'maxBytes'</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'log_max_bytes'</span><span class="p">)),</span>
            <span class="s1">'interval'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">'backupDay'</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'log_backup_days'</span><span class="p">)),</span>
            <span class="s1">'dedupetime'</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'log_dedupe_time'</span><span class="p">)),</span>
            <span class="s1">'formatter'</span><span class="p">:</span> <span class="s1">'simple'</span>
        <span class="err">}</span><span class="p">,</span>
    <span class="err">}</span><span class="p">,</span>
    <span class="s1">'loggers'</span><span class="p">:</span> <span class="err">{</span>
        <span class="s1">'django.request'</span><span class="p">:</span> <span class="err">{</span>
            <span class="s1">'handlers'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'log_file'</span><span class="p">],</span>
            <span class="s1">'level'</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'web'</span><span class="p">,</span> <span class="s1">'log_level'</span><span class="p">),</span>
            <span class="s1">'propagate'</span><span class="p">:</span> <span class="k">True</span><span class="p">,</span>
        <span class="err">}</span><span class="p">,</span>
    <span class="err">}</span>
<span class="err">}</span>
</pre></div>
<h2 id="json">json模块</h2>
<h3 id="json_1">什么是json</h3>
<p>json全称是JavaScript Object Notation，也就是JavaScript对象表示法。json是一种基于文本的，人类易读的数据存储交互格式。json文件保存使用后缀 <code>.json</code> 。虽然json是从javascript语言衍生出来，不过其作为数据存储和交互是独立于语言的。json和xml作为数据存储和交互方案相比有更易读和读写速度更快的特点。</p>
<h3 id="json_2">json存储格式语法</h3>
<p>json存储格式的语法很简单，首先是最基本的数字开始，其支持两种数字类型，整数型和浮点型，其对应于python的int和float；字符串在双引号里面，其对应于python的字符串概念；布尔值true和false，其对应于python的True和False，然后还有一个null对应于python的None；json数据用<code>[]</code>表示，里面的元素用逗号分隔，其对应的正是python的列表概念；然后json的object对象用<code>{}</code> 包围，其内是key:value这样的形式，其正对应于python的字典概念。</p>
<p>python语言已经内置了json模块，所以要读写json文件只需要简单 <code>import json</code>即可。</p>
<p>首先让我们小试牛刀，把 <code>[1,2,3,4,5]</code> 这组数存( <strong>dump</strong>)进test.json文件里面去。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'test.json'</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
</pre></div>
<p>json不支持元组(tuple)和字节(bytes)类型，bytes类型一般不会去惊扰它，如果有tuple元组你需要存储，那么将其转换成列表即可。</p>
<p>简单的读取是使用的json的 <code>load</code> 函数，如下所示：</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'test.json'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lst2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
<p>这样lst2就被赋值  <code>[1,2,3,4,5]</code> 了，方便后面的运算。</p>
<h3 id="_17">存储字典值</h3>
<p>上面的例子稍作修改即可以存储字典值了：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">dict01</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'a'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">'b'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">'c'</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'test.json'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict01</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'test.json'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">dict02</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">dict02</span><span class="p">)</span>
</pre></div>
<h3 id="_18">存储到文件的一些美化</h3>
<p>上面的dump函数那句读者可以考虑加入 <code>indent</code> 选项：</p>
<div class="highlight"><pre><span></span><span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict01</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
<p>这样我们的test.json文件里面的数据会进行一些缩进，会更好看一些了。</p>
<p>此外 <code>sort_keys</code>选项有时会很有用，默认是False，如果设置为True，则输出的文件的key是排序了的 。</p>
<p>此外 <code>ensure_ascii</code> 选项默认是True，中文字符保存会变为 <code>\uabcd</code> 之类的东西，如果设置为False，则能显示正常的中文字符。</p>
<h3 id="dumpsloads">dumps和loads函数</h3>
<p>dumps和loads函数是非文件接口版，简单了解下即可。</p>
<h2 id="itertools">itertools模块</h2>
<h3 id="repeat">repeat函数</h3>
<p>其定义函数如下：</p>
<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">repeat</span><span class="ss">(</span><span class="nv">object</span>, <span class="nv">times</span><span class="o">=</span><span class="nv">None</span><span class="ss">)</span>:
    # <span class="nv">repeat</span><span class="ss">(</span><span class="mi">10</span>, <span class="mi">3</span><span class="ss">)</span> <span class="o">--&gt;</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="nv">times</span> <span class="nv">is</span> <span class="nv">None</span>:
        <span class="k">while</span> <span class="nv">True</span>:
            <span class="nv">yield</span> <span class="nv">object</span>
    <span class="k">else</span>:
        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="nv">times</span><span class="ss">)</span>:
            <span class="nv">yield</span> <span class="nv">object</span>
</pre></div>
<p>也就是返回一个可迭代对象，这么封装最大的一个用处是用于填充map函数或者zip函数的某个常数值。因为你填写repeat(5)之后将一个返回一个可迭代对象，不停的返回数字5而不需要你考虑长度问题。</p>
<h3 id="starmap">starmap函数</h3>
<p>starmap函数具体定义如下所示：</p>
<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">starmap</span><span class="ss">(</span><span class="nv">function</span>, <span class="nv">iterable</span><span class="ss">)</span>:
    # <span class="nv">starmap</span><span class="ss">(</span><span class="nv">pow</span>, [<span class="ss">(</span><span class="mi">2</span>,<span class="mi">5</span><span class="ss">)</span>, <span class="ss">(</span><span class="mi">3</span>,<span class="mi">2</span><span class="ss">)</span>, <span class="ss">(</span><span class="mi">10</span>,<span class="mi">3</span><span class="ss">)</span>]<span class="ss">)</span> <span class="o">--&gt;</span> <span class="mi">32</span> <span class="mi">9</span> <span class="mi">1000</span>
    <span class="k">for</span> <span class="nv">args</span> <span class="nv">in</span> <span class="nv">iterable</span>:
        <span class="nv">yield</span> <span class="nv">function</span><span class="ss">(</span><span class="o">*</span><span class="nv">args</span><span class="ss">)</span>
</pre></div>
<p>其接受一个可迭代对象，然后逐个将可迭代对象中的元素解包之后送入函数当参数（最后当然函数也执行了）。</p>
<h2 id="inspect">inspect模块</h2>
<p>更多信息请参看 <a href="https://docs.python.org/3.4/library/inspect.html">官方文档](</a> 。</p>
<h3 id="getfile">getfile函数</h3>
<p>传入python
object，返回定义该object具体是在那个文件中的。可以如下获取该文件的系统绝对路径地址:</p>
<div class="highlight"><pre><span></span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">inspect</span><span class="p">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
</pre></div>
<p>值得一提的是，如果该模块被安装进入系统了，那么实际该文件的地址应该是类似这样的形式:</p>
<div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">4</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">infome</span><span class="o">-</span><span class="mi">15</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">30</span><span class="o">-</span><span class="n">py3</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="n">egg</span><span class="o">/</span><span class="n">infome</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="n">youdao</span><span class="p">.</span><span class="n">py</span>
</pre></div>
<p>。</p>
<h3 id="getcallargs">getcallargs函数</h3>
<p>如下所示:</p>
<div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">.</span><span class="n">getcallargs</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</pre></div>
<p>相当于模拟执行了func函数，然后返回如果执行func函数时其接受的参数字典值（包括必填参数和可选参数）。</p>
<h2 id="functools">functools模块</h2>
<h3 id="partial">partial类</h3>
<p>functools模块定义了一个partial类，其输入参数如下所示:</p>
<div class="highlight"><pre><span></span>    <span class="n">functools</span><span class="p">.</span><span class="k">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">)</span>
</pre></div>
<p>其将返回一个partial对象，其有 <code>__call__</code>
方法，也就是其可以类似函数进行调用。然后其有 <strong>func</strong>
属性，作为未来函数的调用； <strong>args</strong> 属性，作为未来函数的参数；
<strong>keywords</strong> 属性，作为未来函数的可选参数。
简单来说就是partial对原函数对象func进行了封装（所以其特别适合做装饰器），
<code>newfun=partial(func,args,keywords)</code>
，使得调用这个newfun对象就好像调用原func一样，只是加上了额外的参数，其中args非可选参数是类似列表append形式，而keywords可选参数或说关键字参数是类似字典update形式。</p>
<p>下面是一个简单的演示例子:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>

<span class="k">def</span> <span class="nf">fun1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'called fun1 with'</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show_details</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">is_partial</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_partial</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">show_details</span><span class="p">(</span><span class="s1">'fun1'</span><span class="p">,</span><span class="n">fun1</span><span class="p">)</span>

<span class="n">fun1</span><span class="p">(</span><span class="s1">'fun1 a'</span><span class="p">)</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fun1</span><span class="p">,</span><span class="s1">'p1 a'</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">'p1'</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>

<span class="n">p1</span><span class="p">()</span>
</pre></div>
<p>其输出如下:</p>
<div class="highlight"><pre><span></span>    <span class="n">fun1</span>
    <span class="o">&lt;</span><span class="k">function</span> <span class="n">fun1</span> <span class="k">at</span> <span class="mi">0</span><span class="n">xb705880c</span><span class="o">&gt;</span>
    <span class="n">fun1</span>
    <span class="k">called</span> <span class="n">fun1</span> <span class="k">with</span> <span class="n">fun1</span> <span class="n">a</span> <span class="mi">2</span>
    <span class="n">p1</span>
    <span class="n">functools</span><span class="p">.</span><span class="k">partial</span><span class="p">(</span><span class="o">&lt;</span><span class="k">function</span> <span class="n">fun1</span> <span class="k">at</span> <span class="mi">0</span><span class="n">xb705880c</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">'p1 a'</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="k">function</span> <span class="n">fun1</span> <span class="k">at</span> <span class="mi">0</span><span class="n">xb705880c</span><span class="o">&gt;</span>
    <span class="p">(</span><span class="s1">'p1 a'</span><span class="p">,)</span>
    <span class="err">{</span><span class="s1">'b'</span><span class="p">:</span> <span class="mi">99</span><span class="err">}</span>
    <span class="k">called</span> <span class="n">fun1</span> <span class="k">with</span> <span class="n">p1</span> <span class="n">a</span> <span class="mi">99</span>
</pre></div>
<p>这里的逻辑是首先正常执行fun1，然后将fun用partial封装成p1，新增参数字符串'p1
a'和b=4，后面我们可以看到这个p1的参数都加进去了。然后执行这个p1我们看到了参数的变化。</p>
<h2 id="datetime">datetime模块</h2>
<p>简单的日期时间操作用time模块里面的一些函数即可，datetime模块是用类的方式来处理的，适合大量处理日期时间的任务。然后值得一提的是mongodb的python接口
<em>pymongo</em> 里面（连接mongodb的python第三方模块），日期时间的输入输出都是
datetime 对象的，这很是方便。</p>
<p>下面简要介绍之，更多内容请参看 <a href="https://docs.python.org/3.4/library/datetime.html">官方文档</a> 。</p>
<h3 id="timedelta">timedelta对象</h3>
<p>通过timedelta函数返回一个timedelta对象，也就是一个表示时间间隔的对象。函数参数情况如下所示:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="n">datetime</span>.<span class="n">timedelta</span>([<span class="n">days</span>[, <span class="n">seconds</span>[, <span class="n">microseconds</span>[, <span class="n">milliseconds</span>[, <span class="n">minutes</span>[, <span class="n">hours</span>[, <span class="n">weeks</span>]]]]]]])
</pre></div>
<p>其没有必填参数，简单控制的话第一个整数就是多少天的间隔的意思:</p>
<div class="highlight"><pre><span></span><span class="n">datetime</span><span class="p">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
<p>两个时间间隔对象可以彼此之间相加或相减，返回的仍是一个时间间隔对象。而更方便的是一个datetime对象如果减去一个时间间隔对象，那么返回的对应减去之后的datetime对象，然后两个datetime对象如果相减返回的是一个时间间隔对象。这很是方便。</p>
<h3 id="datetime_1">datetime对象</h3>
<p>通过datetime函数可以创建一个datetime对象:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="n">datetime</span>.<span class="n">datetime</span>(<span class="n">year</span>, <span class="n">month</span>, <span class="n">day</span>[, <span class="n">hour</span>[, <span class="n">minute</span>[, <span class="n">second</span>[, <span class="n">microsecond</span>[, <span class="n">tzinfo</span>]]]]])
</pre></div>
<p>其中year，month和day是必填参数。下面是一个简单的例子:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">db_t</span> <span class="o">=</span> <span class="err">{</span>
<span class="p">...</span>  <span class="ss">"date"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1777</span><span class="p">,</span><span class="mi">07</span><span class="p">,</span><span class="mi">07</span><span class="p">)</span>
<span class="p">...</span> <span class="err">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">db_t</span>
<span class="err">{</span><span class="s1">'date'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1777</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="err">}</span>
</pre></div>
<p>其通过pymongo存入mongodb之后是这样的形式:</p>
<div class="highlight"><pre><span></span><span class="n">ISODate</span><span class="p">(</span><span class="ss">"1777-07-07T00:00:00.000Z"</span><span class="p">)</span>
</pre></div>
<h4 id="nowutcnow">now和utcnow方法</h4>
<p>datetime对象有 <code>now</code> 和 <code>utcnow</code>
这两个<em>类方法</em>（classmethod）来返回当前日期时间的datetime对象。utcnow不可以接受参数，now方法可以接受一个tz指定时区的参数，我们可以通过
<em>pytz</em> 模块（一个处理时区推荐的第三方模块）来具体指明某个时区。</p>
<h5 id="pytz">查看pytz的所有时区</h5>
<p>参看
<a href="http://stackoverflow.com/questions/13866926/python-pytz-list-of-timezones">这个网页</a>
。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">pytz</span><span class="p">.</span><span class="n">all_timezones</span>
<span class="p">[</span><span class="s1">'Africa/Abidjan'</span><span class="p">,</span> <span class="s1">'Africa/Accra'</span><span class="p">,</span> <span class="s1">'Africa/Addis_Ababa'</span><span class="p">,</span> <span class="s1">'Africa/Algiers'</span><span class="p">,</span> <span class="p">......</span>
</pre></div>
<h5 id="now">具体给now方法指定一个时区</h5>
<p>参看
<a href="http://stackoverflow.com/questions/2331592/datetime-datetime-utcnow-why-no-tzinfo">这个网页</a>
。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytz</span>
<span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s2">"Asia/Hong_Kong"</span><span class="p">))</span>
</pre></div>
<h5 id="nowutcnow_1">now方法和utcnow方法区别</h5>
<p>我们看下面这个例子:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="p">.</span><span class="n">timezone</span><span class="p">(</span><span class="ss">"UTC"</span><span class="p">)),</span><span class="n">datetime</span><span class="p">.</span><span class="n">utcnow</span><span class="p">()</span>
<span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">266863</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=&lt;</span><span class="n">UTC</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">266888</span><span class="p">))</span>
</pre></div>
<p>如果我们给now方法指定默认的时区是\"UTC\"，那么我们看到其返回的datetime对象和utcnow返回的datetime对象基本上没什么区别，后面的微秒（
<span class="math">\(10^{-6}\)</span>
秒）有点区别完全可以理解。然后我们再看now方法如果不加任何参数会如何:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">now</span>
<span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">144018</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">utcnow</span>
<span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">319108</span><span class="p">)</span>
</pre></div>
<p>这里now显示的时间和本地的时间是一致的，说明now默认的时区是本地的时区参数。谈到这里大家应该就明白了，如果是后台数据库有日期时间输入需求，为了保持时间戳的一致性，推荐都使用utcnow方法来生成时间戳，也就是实际上都以UTC格林威治时区为准。如果到前端需要显示给用户具体的日期时间了，如果要引用前端数据库的日期时间，才需要引入时区的考虑进行必要的转换。然后如果前端需要用python生成实时的时间，那么就用now方法再引入pytz的时区控制。</p>
<h4 id="datetime_2">datetime对象的属性</h4>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">year</span>
<span class="mi">2015</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span>
<span class="mi">11</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">day</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">hour</span>
<span class="mi">18</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">minute</span>
<span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">second</span>
<span class="mi">57</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">tzinfo</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span>
<span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">919613</span><span class="p">)</span>
</pre></div>
<p>具体含义如下所示:</p>
<dl>
<dt>year</dt>
<dd>
<p>年</p>
</dd>
<dt>month</dt>
<dd>
<p>月</p>
</dd>
<dt>day</dt>
<dd>
<p>日</p>
</dd>
<dt>hour</dt>
<dd>
<p>时</p>
</dd>
<dt>minute</dt>
<dd>
<p>分</p>
</dd>
<dt>second</dt>
<dd>
<p>秒</p>
</dd>
<dt>microsecond</dt>
<dd>
<p>微秒</p>
</dd>
</dl>
<h4 id="strftime_1">strftime方法</h4>
<p>datetime对象可以如下调用 <code>strftime</code> 方法或者 <code>__format__</code>
方法来得到一个好看的你想要的日期时间字符串格式:</p>
<div class="highlight"><pre><span></span>    <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%T'</span><span class="p">)</span>
    <span class="s1">'18:52:39'</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">__format__</span><span class="p">(</span><span class="s1">'</span><span class="si">%F</span><span class="s1">'</span><span class="p">)</span>
    <span class="s1">'2015-11-03'</span>
</pre></div>
<p>这里的格式符号python官方文档有所述及，而更实际上是和linux系统下的 <code>date</code>
命令的格式符一致的，读者可以用 <code>date --help</code>
来看一下，就可以看到如下信息:</p>
<div class="highlight"><pre><span></span>    <span class="o">%%</span>      <span class="err">一个文字的</span> <span class="o">%</span>
    <span class="nf">%a</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">的星期名缩写</span><span class="p">(</span><span class="err">例如：</span> <span class="err">日，代表星期日</span><span class="p">)</span>
    <span class="o">%</span><span class="n">A</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">的星期名全称</span> <span class="p">(</span><span class="err">如：星期日</span><span class="p">)</span>
    <span class="nf">%b</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">的月名缩写</span> <span class="p">(</span><span class="err">如：一，代表一月</span><span class="p">)</span>
    <span class="o">%</span><span class="n">B</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">的月名全称</span> <span class="p">(</span><span class="err">如：一月</span><span class="p">)</span>
    <span class="nf">%c</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">的日期和时间</span> <span class="p">(</span><span class="err">如：</span><span class="mi">2005</span><span class="err">年</span><span class="mi">3</span><span class="err">月</span><span class="mi">3</span><span class="err">日</span> <span class="err">星期四</span> <span class="mi">23</span><span class="o">:</span><span class="mo">05</span><span class="o">:</span><span class="mi">25</span><span class="p">)</span>
    <span class="o">%</span><span class="n">C</span>      <span class="err">世纪；比如</span> <span class="o">%</span><span class="n">Y</span><span class="err">，通常为省略当前年份的后两位数字</span><span class="p">(</span><span class="err">例如：</span><span class="mi">20</span><span class="p">)</span>
    <span class="nf">%d</span>      <span class="err">按月计的日期</span><span class="p">(</span><span class="err">例如：</span><span class="mo">01</span><span class="p">)</span>
    <span class="o">%</span><span class="n">D</span>      <span class="err">按月计的日期；等于</span><span class="nf">%m</span><span class="o">/</span><span class="nf">%d</span><span class="o">/</span><span class="nf">%y</span>
    <span class="nf">%e</span>      <span class="err">按月计的日期，添加空格，等于</span><span class="nf">%_d</span>
    <span class="o">%</span><span class="n">F</span>      <span class="err">完整日期格式，等价于</span> <span class="o">%</span><span class="n">Y</span><span class="o">-</span><span class="nf">%m</span><span class="o">-</span><span class="nf">%d</span>
    <span class="nf">%g</span>      <span class="n">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="err">格式年份的最后两位</span> <span class="p">(</span><span class="err">参见</span><span class="o">%</span><span class="n">G</span><span class="p">)</span>
    <span class="o">%</span><span class="n">G</span>      <span class="n">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="err">格式年份</span> <span class="p">(</span><span class="err">参见</span><span class="o">%</span><span class="n">V</span><span class="p">)</span><span class="err">，一般只和</span> <span class="o">%</span><span class="n">V</span> <span class="err">结合使用</span>
    <span class="nf">%h</span>      <span class="err">等于</span><span class="nf">%b</span>
    <span class="o">%</span><span class="n">H</span>      <span class="err">小时</span><span class="p">(</span><span class="mo">00</span><span class="o">-</span><span class="mi">23</span><span class="p">)</span>
    <span class="o">%</span><span class="n">I</span>      <span class="err">小时</span><span class="p">(</span><span class="mo">00</span><span class="o">-</span><span class="mi">12</span><span class="p">)</span>
    <span class="nf">%j</span>      <span class="err">按年计的日期</span><span class="p">(</span><span class="mo">001</span><span class="o">-</span><span class="mi">366</span><span class="p">)</span>
    <span class="nf">%k</span>   <span class="n">hour</span><span class="p">,</span> <span class="n">space</span> <span class="n">padded</span> <span class="p">(</span> <span class="mf">0..23</span><span class="p">);</span> <span class="n">same</span> <span class="n">as</span> <span class="nf">%_</span><span class="n">H</span>
    <span class="nf">%l</span>   <span class="n">hour</span><span class="p">,</span> <span class="n">space</span> <span class="n">padded</span> <span class="p">(</span> <span class="mf">1..12</span><span class="p">);</span> <span class="n">same</span> <span class="n">as</span> <span class="nf">%_</span><span class="n">I</span>
    <span class="nf">%m</span>   <span class="n">month</span> <span class="p">(</span><span class="mf">01..12</span><span class="p">)</span>
    <span class="o">%</span><span class="n">M</span>   <span class="n">minute</span> <span class="p">(</span><span class="mf">00..59</span><span class="p">)</span>
    <span class="nf">%n</span>      <span class="err">换行</span>
    <span class="o">%</span><span class="n">N</span>      <span class="err">纳秒</span><span class="p">(</span><span class="mo">000000000</span><span class="o">-</span><span class="mi">999999999</span><span class="p">)</span>
    <span class="nf">%p</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">下的</span><span class="s">"上午"</span><span class="err">或者</span><span class="s">"下午"</span><span class="err">，未知时输出为空</span>
    <span class="o">%</span><span class="n">P</span>      <span class="err">与</span><span class="nf">%p</span> <span class="err">类似，但是输出小写字母</span>
    <span class="nf">%r</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">下的</span> <span class="mi">12</span> <span class="err">小时时钟时间</span> <span class="p">(</span><span class="err">如：</span><span class="mi">11</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mo">04</span> <span class="err">下午</span><span class="p">)</span>
    <span class="o">%</span><span class="n">R</span>      <span class="mi">24</span> <span class="err">小时时间的时和分，等价于</span> <span class="o">%</span><span class="nl">H</span><span class="p">:</span><span class="o">%</span><span class="n">M</span>
    <span class="nf">%s</span>      <span class="err">自</span><span class="n">UTC</span> <span class="err">时间</span> <span class="mi">1970</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">01</span> <span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span> <span class="err">以来所经过的秒数</span>
    <span class="o">%</span><span class="n">S</span>      <span class="err">秒</span><span class="p">(</span><span class="mo">00</span><span class="o">-</span><span class="mi">60</span><span class="p">)</span>
    <span class="nf">%t</span>      <span class="err">输出制表符</span> <span class="n">Tab</span>
    <span class="o">%</span><span class="n">T</span>      <span class="err">时间，等于</span><span class="o">%</span><span class="nl">H</span><span class="p">:</span><span class="o">%</span><span class="nl">M</span><span class="p">:</span><span class="o">%</span><span class="n">S</span>
    <span class="nf">%u</span>      <span class="err">星期，</span><span class="mi">1</span> <span class="err">代表星期一</span>
    <span class="o">%</span><span class="n">U</span>      <span class="err">一年中的第几周，以周日为每星期第一天</span><span class="p">(</span><span class="mo">00</span><span class="o">-</span><span class="mi">53</span><span class="p">)</span>
    <span class="o">%</span><span class="n">V</span>      <span class="n">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="err">格式规范下的一年中第几周，以周一为每星期第一天</span><span class="p">(</span><span class="mo">01</span><span class="o">-</span><span class="mi">53</span><span class="p">)</span>
    <span class="nf">%w</span>      <span class="err">一星期中的第几日</span><span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span><span class="err">，</span><span class="mi">0</span> <span class="err">代表周一</span>
    <span class="o">%</span><span class="n">W</span>      <span class="err">一年中的第几周，以周一为每星期第一天</span><span class="p">(</span><span class="mo">00</span><span class="o">-</span><span class="mi">53</span><span class="p">)</span>
    <span class="nf">%x</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">下的日期描述</span> <span class="p">(</span><span class="err">如：</span><span class="mi">12</span><span class="o">/</span><span class="mi">31</span><span class="o">/</span><span class="mi">99</span><span class="p">)</span>
    <span class="o">%</span><span class="n">X</span>      <span class="err">当前</span><span class="n">locale</span> <span class="err">下的时间描述</span> <span class="p">(</span><span class="err">如：</span><span class="mi">23</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">48</span><span class="p">)</span>
    <span class="nf">%y</span>      <span class="err">年份最后两位数位</span> <span class="p">(</span><span class="mo">00</span><span class="o">-</span><span class="mi">99</span><span class="p">)</span>
    <span class="o">%</span><span class="n">Y</span>      <span class="err">年份</span>
    <span class="nf">%z</span> <span class="o">+</span><span class="n">hhmm</span>                <span class="err">数字时区</span><span class="p">(</span><span class="err">例如，</span><span class="o">-</span><span class="mo">0400</span><span class="p">)</span>
    <span class="o">%:</span><span class="n">z</span> <span class="o">+</span><span class="nl">hh</span><span class="p">:</span><span class="n">mm</span>              <span class="err">数字时区</span><span class="p">(</span><span class="err">例如，</span><span class="o">-</span><span class="mo">04</span><span class="o">:</span><span class="mo">00</span><span class="p">)</span>
    <span class="o">%::</span><span class="n">z</span> <span class="o">+</span><span class="nl">hh</span><span class="p">:</span><span class="nl">mm</span><span class="p">:</span><span class="n">ss</span>  <span class="err">数字时区</span><span class="p">(</span><span class="err">例如，</span><span class="o">-</span><span class="mo">04</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="p">)</span>
    <span class="o">%:::</span><span class="n">z</span>                   <span class="err">数字时区带有必要的精度</span> <span class="p">(</span><span class="err">例如，</span><span class="o">-</span><span class="mo">04</span><span class="err">，</span><span class="o">+</span><span class="mo">05</span><span class="o">:</span><span class="mi">30</span><span class="p">)</span>
    <span class="o">%</span><span class="n">Z</span>                      <span class="err">按字母表排序的时区缩写</span> <span class="p">(</span><span class="err">例如，</span><span class="n">EDT</span><span class="p">)</span>
</pre></div>
<p>其中的 <code>%F</code> 和 <code>%T</code> 在python官方文档中并无说明，可见其内部API是和这个
<code>date</code> 命令一致的。</p>
<h4 id="_19">支持的时间间隔运算</h4>
<p>前面提到了一个datetime对象减去一个timedelta对象返回一个datetime对象，然后一个datetime对象减去一个datetime对象返回一个时间间隔对象。比如此时之前一年的时间可以这样表达
<code>datetime.datetime.utcnow() - datetime.timedelta(365)</code>
。然后此时和爱因斯坦的生日时间间隔可以这样表达:</p>
<div class="highlight"><pre><span></span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1879</span><span class="p">,</span><span class="mi">03</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
<p>然后我们可以利用这个时间间隔来进行一些操作和判断。</p>
<div class="highlight"><pre><span></span>    <span class="o">&gt;&gt;&gt;</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1879</span><span class="p">,</span><span class="mi">03</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">delta</span>
    <span class="n">datetime</span><span class="p">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">49792</span><span class="p">,</span> <span class="mi">35970</span><span class="p">,</span> <span class="mi">903285</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="p">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">120</span><span class="o">*</span><span class="mi">365</span><span class="p">)</span>
    <span class="k">True</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">delta</span><span class="p">.</span><span class="n">days</span> <span class="o">//</span> <span class="mi">365</span>
    <span class="mi">136</span>
</pre></div>
<h3 id="struct95time-datetime">struct_time 对象转化成为 datetime 对象</h3>
<p>参看
<a href="http://stackoverflow.com/questions/1697815/how-do-you-convert-a-python-time-struct-time-object-into-a-datetime-object">这个网页</a></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
</pre></div>
<p>mktime函数接受time模块的 <code>struct_time</code> object，其可以来自time模块的
<code>gmtime</code> 、<code>localtime</code> 、 <code>strptime</code>
这些函数，mktime函数将返回一个时间戳，然后用datetime模块的
<code>fromtimestamp</code> 函数可以接受这个时间戳。</p>
<p>总的过程即:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">mktime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">mktime</span><span class="p">(</span><span class="n">struct</span><span class="p">))</span>
</pre></div>
<h3 id="datetime-time95struct">datetime 对象转化为 time_struct 对象</h3>
<p>参考了 <a href="http://stackoverflow.com/questions/8022161/python-converting-from-datetime-datetime-to-time-time">这个网页</a></p>
<div class="highlight"><pre><span></span>    <span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">t</span>
    <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">37496</span><span class="p">)</span>

    <span class="o">&gt;&gt;&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">timetuple</span><span class="p">())</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">1</span><span class="n">E6</span>
    <span class="mi">1320517575</span><span class="p">.</span><span class="mi">037496</span>
</pre></div>
<h2 id="re">re模块</h2>
<p>re模块提供了python对于正则表达式的支持，对于字符串操作，如果之前在介绍字符串类型的一些方法（比如split，replace等等），能够用它们解决问题就用它们，因为更快更简单。实在需要动用正则表达式理念才考虑使用re模块，而且你要克制写很多或者很复杂的（除非某些特殊情况）正则表达式的冲动，因为正则表达式的引入将会使得整个程序都更加难懂和不可捉摸。</p>
<p>更多内容请参见<a href="https://docs.python.org/3/library/re.html">官方文档</a>。</p>
<h3 id="re_1">re模块中的元字符集</h3>
<dl>
<dt><em>.</em></dt>
<dd>
<p>表示一行内的任意字符，如果如果通过re.compile指定<strong>re.DOTALL</strong>，则表示多行内的任意字符，即包括了换行符。此外还可以通过字符串模板在它的前面加上<strong>(?s)</strong>来获得同样的效果。</p>
</dd>
<dt><em>*</em></dt>
<dd>
<p>对之前的字符匹配或者多次。</p>
</dd>
<dt><em>+</em></dt>
<dd>
<p>对之前的字符匹配或者多次。</p>
</dd>
<dt><em>?</em></dt>
<dd>
<p>对之前的字符匹配或者。</p>
</dd>
<dt><em>{m}</em></dt>
<dd>
<p>对之前的字符匹配()m次。</p>
</dd>
<dt><em>{m,n}</em></dt>
<dd>
<p>对之前的字符匹配m次到n次，其中n次可能省略，视作默认值是无穷大。</p>
</dd>
<dt><em>\^</em></dt>
<dd>
<p>表示字符串的开始，如果加上<strong>re.MULTILINE</strong>选项，则表示行首。此外字符串模板加上<strong>(?m)</strong>可以获得同样的效果。</p>
</dd>
<dt><em>\$</em></dt>
<dd>
<p>表示字符串的结束，同\^类似，如果加上<strong>re.MULTILINE</strong>选项，则表示行尾，可以简单理解为<code>\n</code>换行符。此外字符串模板加上<strong>(?m)</strong>可以获得同样的效果。</p>
<p>\<span class="math">\(符号在re.sub函数中可以被替换为另外一个字符串，其具体效果就是原字符串尾加上了这个字符串，类似的\^被替换成某个字符串，其具体效果就是原字符串头加上了这个字符串。这里显然\^和\\)</span>在字符串中都不是真实存在的字符，而没有这个所谓的标记，所以这种替换总给人怪怪的感觉。</p>
</dd>
<dt><em>[]</em></dt>
<dd>
<p>[abc]字符组匹配一个字符，这个字符是a或者b或者c。类似的[a-z]匹配所有的小写字母，<code>[\w]</code>匹配任意的字母或数字，具体请看下面的特殊字符类。</p>
</dd>
<dt><em>|</em></dt>
<dd>
<p>相当于正则表达式内的匹配或逻辑。</p>
</dd>
<dt><em>()</em></dt>
<dd>
<p>圆括号包围的部分将会记忆起来，方便后面调用。这个后面在谈及。</p>
</dd>
</dl>
<h3 id="re_2">re模块中的特殊字符类</h3>
<div class="highlight"><pre><span></span><span class="err">\</span><span class="n">w</span>  <span class="err">任意的字母或数字</span>  <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="p">]</span>  <span class="p">(</span><span class="n">meaning</span> <span class="n">word</span><span class="p">)</span>
<span class="err">\</span><span class="n">W</span>  <span class="err">匹配任何非字母非数字</span> <span class="p">[</span><span class="o">^</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="p">]</span>
<span class="err">\</span><span class="n">d</span>   <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span>   <span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="err">数字</span>
<span class="err">\</span><span class="n">D</span>  <span class="p">[</span><span class="o">^</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="err">非数字</span>
<span class="err">\</span><span class="n">s</span>   <span class="err">匹配任何空白字符</span>   <span class="p">[</span> <span class="err">\</span><span class="n">t</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">r</span><span class="err">\</span><span class="n">f</span><span class="err">\</span><span class="n">v</span><span class="p">]</span> <span class="err">。</span>
<span class="err">\</span><span class="n">S</span>  <span class="err">匹配任何非空白字符</span>
<span class="err">匹配中文</span><span class="p">:[</span><span class="err">\</span><span class="n">u4e00</span><span class="o">-</span><span class="err">\</span><span class="n">u9fa5</span><span class="p">]</span>
<span class="err">\</span><span class="n">b</span>  <span class="err">文档说严格的定义是\</span><span class="n">w</span> <span class="err">和\</span><span class="n">W</span> <span class="err">之间的边界，反之亦然。粗略的理解可以看作是英文单词头或者尾。</span>
</pre></div>
<p>其中\^在方括号[]里面，只有在最前面，才表示排除型字符组的意思。</p>
<h3 id="_20">转义问题</h3>
<p>正则表达式的转义问题有时会比较纠结。一个简单的原则是以上谈及的有特殊作用的字符有转义问题，如果python中的字符都写成<code>r''</code>这种形式，也就是所谓的raw
string形式，这样<code>\n</code>在里面就可以直接写成<code>\n</code>，而<code>\section</code>可以简单写为<code>\\section</code>即可，也就是<code>\</code>字符需要转义一次。</p>
<p>然后字符组的方括号内[]有些字符有时是不需要转义的，这个实在不确定就转义吧，要不就用正则表达式工具测试一下。</p>
<h3 id="re_3">re模块的使用</h3>
<p>compile方法生成regular expression
object这一条线这里略过了，接下来的讨论全部基于（原始的）字符串模板。</p>
<p>字符串模板前面提及(?m)和(?s)的用法了，然后<strong>(?i)</strong>表示忽略大小写。</p>
<h4 id="_21">匹配和查找</h4>
<p>search，match方法简单地用法就是：</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="k">search</span><span class="p">(</span><span class="err">字符串模板</span><span class="p">,</span> <span class="err">待匹配字符串</span><span class="p">)</span>
<span class="n">re</span><span class="p">.</span><span class="k">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
<p>它们将会返回一个match object或者none，其中match
object在逻辑上就是真值的意思。match对字符串的匹配是必须从一开始就精确匹配，这对于正则表达式多少0有点突兀。推荐使用search方法，如果一定要限定行首，或者字符串开始可以用前面讨论的正则表达式各个符号来表达。请看下面的例子。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">'''this is test line.</span>
<span class="s1">this is the second line.</span>
<span class="s1">today is sunday.'''</span>

<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'(?m)^today'</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>

<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'所使用的正则表达式是：'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">re</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'所输入的字符串是：'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'匹配的结果是：'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'匹配的字符串index'</span><span class="p">,</span><span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">())</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'return the none value'</span><span class="p">)</span>
</pre></div>
<p>前面说道圆括号的部分将会记忆起来，作为匹配的结果，默认整个正则表达式所匹配的全部是group中的第0个元素，然后从左到右，子group编号依次是1，2，3......。</p>
<div class="highlight"><pre><span></span><span class="err">所使用的正则表达式是：</span> <span class="n">re</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'(?m)^today'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">MULTILINE</span><span class="p">)</span>
<span class="err">所输入的字符串是：</span> <span class="n">this</span> <span class="k">is</span> <span class="n">test</span> <span class="n">line</span><span class="p">.</span>
<span class="n">this</span> <span class="k">is</span> <span class="n">the</span> <span class="k">second</span> <span class="n">line</span><span class="p">.</span>
<span class="n">today</span> <span class="k">is</span> <span class="n">sunday</span><span class="p">.</span>
<span class="err">匹配的结果是：</span> <span class="n">today</span>
<span class="err">匹配的字符串</span><span class="k">index</span> <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">49</span><span class="p">)</span>
</pre></div>
<p>具体这些信息是为了说明情况，实际最简单的情况可能就需要判断一下是不是真值，字符串模板是不是匹配到了即可。</p>
<h4 id="_22">分割操作</h4>
<p>re模块的split函数可以看作字符串的split方法的升级版本，对于所描述的任何正则表达式，匹配成功之后都将成为一个分隔符，从而将原输入字符串分割开来。</p>
<p>下面是我写的zwc小脚本的最核心的部分，用途是统计中英文文档的具体英文单词和中文字符的个数。其中最核心的部分就是用的re的split函数进行正则表达式分割，如果不用那个圆括号的话，那么分隔符是不会包含进去的，这里就是具体匹配的中文字和各个标点符号等等。用了圆括号，那么圆括号匹配的内容也会进去列表。这里就是具体的各个分隔符。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">zwc</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="c1">#中英文常用标点符号</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'([</span><span class="se">\u4e00</span><span class="s1">-</span><span class="se">\u9fa5</span><span class="s1">\s，。；])'</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>
    <span class="c1">#去除 空白</span>
    <span class="c1">#去除\s 中英文常用标点符号</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="ow">not</span>  <span class="n">i</span> <span class="ow">in</span>
    <span class="p">[</span><span class="s2">""</span><span class="p">,</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\r</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\f</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\v</span><span class="s2">"</span><span class="p">,</span><span class="s2">"；"</span><span class="p">,</span><span class="s2">"，"</span><span class="p">,</span><span class="s2">"。"</span><span class="p">]]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">string</span><span class="o">=</span><span class="s1">'''道可道，非常道。名可名，非常名。無名天地之始，有名萬物之母。</span>
<span class="s1">    故常無欲，以觀其妙；常有欲，以觀其徼。此兩者同出而異名，</span>
<span class="s1">    同謂之玄，玄之又玄，眾妙之門。 '''</span>
    <span class="n">zwc</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</pre></div>
<p>字符分割之后后面做了一个小修正，将匹配到的空白字符和中英文标点符号等都删除了，这些是不应该统计入字数的。</p>
<p>具体这个github项目链接在这里：<a href="https://github.com/a358003542/zwc">zwc项目</a>。</p>
<h4 id="_23">替换操作</h4>
<p>基于正则表达式的替换操作非常的有用，其实前面的search方法，再加上具体匹配字符串的索引值，然后修改原字符串，然后再search这样循环操作下去，就是一个替换操作了。re模块有sub方法来专门解决这个问题。</p>
<h4 id="_24">非最长匹配</h4>
<p>本小节参考了 python cookbook 的 2.7 小节，比如说：</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">r</span><span class="s1">'"(.*)"'</span><span class="p">)</span>
</pre></div>
<p>这将匹配两个双引号之间的内容，其默认是最长匹配，也就是多个双引号组成的句子都会匹配进去，你可以如下要要求最短匹配：</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">r</span><span class="s1">'"(.*?)"'</span><span class="p">)</span>
</pre></div>
<h4 id="_25">非捕获组</h4>
<p>看下面的正则表达式， <code>(?:...)</code> 这个括号的组是非捕获组，也就是不会进入
.group 里面去。</p>
<div class="highlight"><pre><span></span><span class="n">re</span><span class="p">.</span><span class="k">search</span><span class="p">(</span><span class="n">r</span><span class="s1">'((?:.|\n)*)'</span><span class="p">,</span><span class="n">text2</span><span class="p">)</span>
</pre></div>
<p>然后默认 <code>.</code> 是不会匹配换行符号的，如果要引入换行符则要如上所示加上。</p>
<h2 id="abc">abc模块</h2>
<p>abc模块帮助你实现抽象基类，有点类似于java中抽象类的概念。</p>
<p>具体实现如下所示：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span> 

<span class="k">class</span> <span class="nc">Graph</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    一般图</span>
<span class="sd">    """</span>
    <span class="n">DIRECTED</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return:</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Not Implement nodes methods"</span><span class="p">)</span>
</pre></div>
<p>抽象类不可实例化，实例化将会报错。继承于它的类，如果如上定义了抽象方法，那么继承它的类必须定义好对应方法的实现，否则将会报错。</p>
<p>抽象类里面也可以定义不是抽象方法的其他实际动作的方法。</p>
<p>抽象类里面还可以定义抽象属性。</p>
<h2 id="argparse">argparse模块</h2>
<p>下面简要介绍了python3的官方文档argparse模块的用法，用于快速制作一个可以刷参数的python脚本。</p>
<p>首先看下面这个简单的情况:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
<p>这是简单的一个例子了，现在脚本还不可以接受任何参数，只可以用 <code>-h</code> 或
<code>--help</code> 来查看一些信息，如下所示。</p>
<div class="highlight"><pre><span></span><span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>桌面$ <span class="nv">python3</span> <span class="nv">hello</span>.<span class="nv">py</span> <span class="o">-</span><span class="nv">h</span>
<span class="nv">usage</span>: 
<span class="nv">this</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">example</span> <span class="nv">to</span> <span class="k">show</span> <span class="nv">argparse</span> <span class="nv">usage</span>
 [<span class="o">-</span><span class="nv">h</span>]

<span class="nv">optional</span> <span class="nv">arguments</span>:
  <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>  <span class="k">show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>
</pre></div>
<p>其首先是新建一个parser，上面ArgumentParser的usage是可选参数，就是命令行的一些描述信息。然后需要调用parser的
<code>parse_args</code> 方法，其就是具体将命令行接受的一些参数刷进去。</p>
<h3 id="_26">简单添加一个参数</h3>
<p>上面的例子太简单了，现在开始简单添加一个参数。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
<p>这样命令行的帮助信息就变成如下所示了:</p>
<div class="highlight"><pre><span></span><span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>桌面$ <span class="nv">python3</span> <span class="nv">hello</span>.<span class="nv">py</span> <span class="o">-</span><span class="nv">h</span>
<span class="nv">usage</span>: 
<span class="nv">this</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">example</span> <span class="nv">to</span> <span class="k">show</span> <span class="nv">argparse</span> <span class="nv">usage</span>

<span class="nv">optional</span> <span class="nv">arguments</span>:
  <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>       <span class="k">show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>
  <span class="o">--</span><span class="nv">config</span> <span class="nv">CONFIG</span>  <span class="nv">the</span> <span class="nv">config</span> <span class="nv">file</span> <span class="nv">path</span>
</pre></div>
<p>如果我们如下输入则有:</p>
<div class="highlight"><pre><span></span><span class="n">wanze@wanze</span><span class="o">-</span><span class="n">ubuntu64</span><span class="p">:</span><span class="err">~</span><span class="o">/</span><span class="err">桌面$</span> <span class="n">python3</span> <span class="n">hello</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span><span class="o">=</span><span class="c">'config.cfg'</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="c">'config.cfg')</span>
</pre></div>
<p>我们看到 <code>parse_args</code> 方法返回的是Namespace对象，推荐用 <code>vars</code>
函数来将其处理成为字典值，这样会更好地方便后面的使用。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">wanze</span><span class="nd">@wanze</span><span class="o">-</span><span class="n">ubuntu64</span><span class="p">:</span><span class="o">~/</span><span class="err">桌面$</span> <span class="n">python3</span> <span class="n">hello</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
<span class="n">usage</span><span class="p">:</span> 
<span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">example</span> <span class="n">to</span> <span class="n">show</span> <span class="n">argparse</span> <span class="n">usage</span>
<span class="n">python3</span> <span class="n">hello</span><span class="o">.</span><span class="n">py</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">c</span> <span class="n">CONFIG</span><span class="p">,</span> <span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span>
                        <span class="n">the</span> <span class="n">config</span> <span class="nb">file</span> <span class="n">path</span>
<span class="n">wanze</span><span class="nd">@wanze</span><span class="o">-</span><span class="n">ubuntu64</span><span class="p">:</span><span class="o">~/</span><span class="err">桌面$</span> <span class="n">python3</span> <span class="n">hello</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span><span class="o">=</span><span class="s1">'config.cfg'</span>
<span class="p">{</span><span class="s1">'config'</span><span class="p">:</span> <span class="s1">'config.cfg'</span><span class="p">}</span>
</pre></div>
<p>上面代码稍作修改，在长名字可选参数前面还可以加上短名字可选参数支持，然后我们看到
<code>parse_args</code> 方法经过 <code>vars</code>
处理之后返回的是字典值。该字典的key默认对应的是长名字可选参数。你还可以自己设置目标参数名:</p>
<h3 id="_27">添加参数的其他选项设置</h3>
<p>下面演示了如何设置目标参数在脚本中具体对应的变量名:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">this is a example to show argparse usage</span>
<span class="s1">'''</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">dest</span><span class="o">=</span><span class="s2">"configpath"</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
<p>然后我们看到字典输入如下:</p>
<div class="highlight"><pre><span></span><span class="n">wanze</span><span class="nv">@wanze</span><span class="o">-</span><span class="nl">ubuntu64</span><span class="p">:</span><span class="o">~/</span><span class="n">桌面</span><span class="err">$</span><span class="w"> </span><span class="n">python3</span><span class="w"> </span><span class="n">hello</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="c1">--config='config.cfg'</span>
<span class="err">{</span><span class="s1">'configpath'</span><span class="err">:</span><span class="w"> </span><span class="s1">'config.cfg'</span><span class="err">}</span><span class="w"></span>
</pre></div>
<p>当然一般就默认设置成为和长名字可选参数一致，没必要这么折腾。类似的你还可以继续用
<code>add_argument</code> 方法来添加其他的可选参数，然后 <code>add_argument</code>
还有如下一些选项配置:</p>
<dl>
<dt>required=True</dt>
<dd>
<p>该参数一定要输入值，否则报错</p>
</dd>
<dt>help</dt>
<dd>
<p>描述信息，前面已经看到了。</p>
</dd>
<dt>default</dt>
<dd>
<p>该参数的默认值，默认是None，你可以选择设置成另外一个值。</p>
</dd>
<dt>type</dt>
<dd>
<p>目标参数的数据类型，默认是字符串，可以设置为int或float。注意设置格式如下，不是字符串的那种设置形式:
​    <code>parser.add_argument('--delay',type=int)</code></p>
</dd>
</dl>
<p>必填参数的添加如下所示，除了这个\"target\"名字前面没有 <code>--</code>
之外，和可选参数用法大致类似，其刷入args字典之后的key就是\"target\"这个名字。</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'target'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="ss">"必填参数"</span><span class="p">)</span>
</pre></div>
<p>不过必填参数和可选参数在某些细节上还是有点差异的，后面会提及。</p>
<h4 id="nargs">nargs选项设置</h4>
<p>nargs设置之后该参数在脚本中具体对应的变量将是一个列表。其中nargs可以设置为一个数字，比如
<code>nargs=4</code> ，则脚本对该参数将接受4个输入值，然后将其收集进一个列表里面。</p>
<p>此外还有:</p>
<dl>
<dt>nargs='*'</dt>
<dd>
<p>这通常是对可选参数进行设置，当然也可以作用于必填参数，但这让必填参数失去意义了。其将收集任意多的输入参数值，而如果多个可选参数之间这样使用星号是可以的，具体请参看官方文档。</p>
</dd>
<dt>nargs='+'</dt>
<dd>
<p>这通常作用于必填参数，其意义有点类似于正则表达式里面的'+'号，和上面的'*'号比起来其必须有一个输入值，否则将报错。</p>
</dd>
<dt>nargs='?'</dt>
<dd>
<p>这个'?'号具体使用情况挺复杂的，我不太喜欢，而且其和nargs其他的一些设置比较起来显得有点格格不入。首先其对应的变量值不是列表而是单个值！其次其改变了默认值的行为。如果该参数不输入，比如
​    <code>--foo</code>
​    这个东西完全不输入在命令行里面，那么foo默认取default的值，如果加入了
​    <code>--foo</code> 这个东西但是后面又不跟值，则foo取 <strong>const</strong>
​    选项赋的值。不太喜欢这个东西。</p>
</dd>
</dl>
<h3 id="_28">一个完整的例子</h3>
<p>下面给出一个完整的例子:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">usage</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">resize the image</span>
<span class="s1">'''</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-c'</span><span class="p">,</span><span class="s1">'--config'</span><span class="p">,</span><span class="n">dest</span><span class="o">=</span><span class="s2">"configpath"</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the config file path"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'inputimg'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the input image"</span><span class="p">,</span><span class="n">nargs</span><span class="o">=</span><span class="s1">'+'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--width'</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">"the input image"</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>

    <span class="n">configpath</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'configpath'</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'width'</span><span class="p">]</span>
    <span class="n">inputimg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">'inputimg'</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">inputimg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="s1">'inputimg'</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'resize image'</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'the input image is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputimg</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'the target width is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table>
<p>具体运行情况如下所示:</p>
<div class="highlight"><pre><span></span><span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>图片$ <span class="nv">python3</span> <span class="nv">resizeimg</span>.<span class="nv">py</span> <span class="o">--</span><span class="nv">help</span>
<span class="nv">usage</span>: 
<span class="nv">resize</span> <span class="nv">the</span> <span class="nv">image</span>

<span class="nv">positional</span> <span class="nv">arguments</span>:
  <span class="nv">inputimg</span>              <span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span>

<span class="nv">optional</span> <span class="nv">arguments</span>:
  <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>            <span class="k">show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>
  <span class="o">-</span><span class="nv">c</span> <span class="nv">CONFIGPATH</span>, <span class="o">--</span><span class="nv">config</span> <span class="nv">CONFIGPATH</span>
                        <span class="nv">the</span> <span class="nv">config</span> <span class="nv">file</span> <span class="nv">path</span>
  <span class="o">--</span><span class="nv">width</span> <span class="nv">WIDTH</span>         <span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span>

<span class="nv">wanze</span>@<span class="nv">wanze</span><span class="o">-</span><span class="nv">ubuntu64</span>:<span class="o">~/</span>图片$ <span class="nv">python3</span> <span class="nv">resizeimg</span>.<span class="nv">py</span> <span class="o">--</span><span class="nv">width</span><span class="o">=</span><span class="mi">300</span> <span class="o">*</span>.<span class="nv">png</span>
<span class="nv">resize</span> <span class="nv">image</span>
<span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span> <span class="nv">is</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span> <span class="mi">13</span>:<span class="mi">16</span>:<span class="mi">46</span> 的屏幕截图.<span class="nv">png</span>
<span class="nv">the</span> <span class="nv">target</span> <span class="nv">width</span> <span class="nv">is</span> <span class="mi">300</span>
<span class="nv">resize</span> <span class="nv">image</span>
<span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span> <span class="nv">is</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">18</span>:<span class="mi">17</span>:<span class="mi">19</span>屏幕截图.<span class="nv">png</span>
<span class="nv">the</span> <span class="nv">target</span> <span class="nv">width</span> <span class="nv">is</span> <span class="mi">300</span>
<span class="nv">resize</span> <span class="nv">image</span>
<span class="nv">the</span> <span class="nv">input</span> <span class="nv">image</span> <span class="nv">is</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">18</span>:<span class="mi">20</span>:<span class="mi">45</span>屏幕截图.<span class="nv">png</span>
<span class="nv">the</span> <span class="nv">target</span> <span class="nv">width</span> <span class="nv">is</span> <span class="mi">300</span>
....
</pre></div>
<h3 id="_29">命令行选项关联其他动作</h3>
<p>parser的 <code>add_argument</code> 方法的 <code>action</code>
参数就是用来控制命令行选项关联的动作的，一般都不需要设置，就是默认的
<code>store</code> ，也就是存储值。类似的有 <code>store_const</code> , <code>store_true</code> 和
<code>store_false</code> 。</p>
<h4 id="store95const">store_const</h4>
<p>如果是默认的store，则通常是需要指明具体值的，如果设置action为
<code>store_const</code> 了:</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--foo'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_const'</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
<p>那么如下就会自动设置该值，这和default默认值的区别是这个选项的值要求是某个常量值。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">python3</span> <span class="n">test2</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">foo</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
<h4 id="store95true-store95false">store_true 和 store_false</h4>
<p>如果写为:</p>
<div class="highlight"><pre><span></span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--foo'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">)</span>
</pre></div>
<p>则其存储的就是 <code>True</code> 值:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">python3</span> <span class="n">test2</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">foo</span> 
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>
<p>这里主要是要讲定义自己的动作，就是类似 <code>--version</code>
这样的用法，是一种影响程序整个工作流的选项，官方文档推荐通过子类化
<code>argparse.Action</code> 的方法，还是有点麻烦的。然后发现 <em>click</em>
模块非常好（一个解决创建命令行脚本工具问题推荐使用的第三方模块），处理这个问题也很容易:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>

<span class="k">def</span> <span class="nf">print_version</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">resilient_parsing</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">'Version 1.0'</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">quick</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">param</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">param</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">'--version'</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">print_version</span><span class="p">,</span>
              <span class="n">expose_value</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">is_eager</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">'--quick'</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="n">quick</span><span class="p">,</span><span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">userinput</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'input:'</span><span class="p">)</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">userinput</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">userinput</span> <span class="o">==</span> <span class="s1">'exit'</span><span class="p">:</span>
            <span class="k">break</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">hello</span><span class="p">()</span>
</pre></div>
<p>这里的ctx和param到click模块那边再细讲吧，我们看到整个过程比argparse美观多了。</p>
<h2 id="ast">ast模块</h2>
<p>更多信息请参看 <a href="https://docs.python.org/3.4/library/ast.html">官方文档</a> 。</p>
<h3 id="literal95eval">literal_eval函数</h3>
<p><code>literal_eval</code>函数是一个非常有用的函数，其可用于将某个短小的python字符串转化成python
object。如下所示:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ast</span>
<span class="k">def</span> <span class="nf">str2pyobj</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">'''str to python obj or not changed'''</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span><span class="c1">###</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">val</span>
</pre></div>
<p>支持的python object有: strings, bytes, numbers, tuples, lists, dicts,
sets, booleans, and None.</p>
<p>所以一般的字符串如 \"1\" \"3.14\" \"[1,2,3]\" 将其分别转化成为integer
float
和list是小菜一碟。当然最好建立异常捕捉，如果转化失败，则原样返回字符串即可。</p>
<h2 id="collections">collections模块</h2>
<p>更多内容请参见<a href="https://docs.python.org/3/library/collections.html">官方文档</a>。</p>
<h3 id="namedtuple">namedtuple函数</h3>
<p>collections模块里面的namedtuple函数将会产生一个有名字的数组的类（有名数组），通过这个类可以新建类似的实例。比如：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">Point3d</span><span class="o">=</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Point3d'</span><span class="p">,[</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">,</span><span class="s1">'z'</span><span class="p">])</span>
<span class="n">p1</span><span class="o">=</span><span class="n">Point3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p1</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

<span class="n">Point3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">0</span> <span class="mi">2</span>
</pre></div>
<h3 id="counter">Counter计数类</h3>
<p>可以进行简单的输入数据统计频数计算。</p>
<h3 id="ordereddict">OrderedDict对象</h3>
<p>python中的字典对象默认各个key是没有顺序的，OrderdDict对象的概念就是在字典概念的基础上让各个key有顺序。</p>
<p>一个例子如下所示（来自官方文档）。简单的理解就是一个字典对象记住了各个key的插入顺序。</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="err">{</span><span class="s1">'banana'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'apple'</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'pear'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'orange'</span><span class="p">:</span> <span class="mi">2</span><span class="err">}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="k">dictionary</span> <span class="n">sorted</span> <span class="k">by</span> <span class="k">key</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="k">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">'orange'</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">'pear'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="k">dictionary</span> <span class="n">sorted</span> <span class="k">by</span> <span class="n">value</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="k">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">'pear'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">'orange'</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="o">#</span> <span class="k">dictionary</span> <span class="n">sorted</span> <span class="k">by</span> <span class="k">length</span> <span class="k">of</span> <span class="n">the</span> <span class="k">key</span> <span class="n">string</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="k">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">'pear'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">'apple'</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">'orange'</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">'banana'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
</pre></div>
<h2 id="configparser">configparser模块</h2>
<p>简单的配置文件管理就用python的内置模块configparser。python2对应的模块名字叫 ConfigParser 。</p>
<p>python3之后configparser的使用更加简单了，具体就分为如下几步:</p>
<h3 id="configparser_1">新建一个configparser对象</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">configparser</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</pre></div>
<h3 id="config">读取某个config文件</h3>
<p>调用read方法具体读取某个config文件。</p>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="s1">'test.cfg'</span><span class="p">)</span>
</pre></div>
<h3 id="configparser_2">如同字典一般操作configparser对象</h3>
<p>然后接下来就是如同字典一般操作这个configparser对象。其中 'DEFAULT'
是特殊的section，大致如下这样表达:</p>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="p">[</span><span class="s1">'DEFAULT'</span><span class="p">]</span> <span class="o">=</span> <span class="err">{</span><span class="s1">'ServerAliveInterval'</span><span class="p">:</span> <span class="s1">'45'</span><span class="p">,</span>
                     <span class="s1">'Compression'</span><span class="p">:</span> <span class="s1">'yes'</span><span class="p">,</span>
                     <span class="s1">'CompressionLevel'</span><span class="p">:</span> <span class="s1">'9'</span><span class="err">}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">'bitbucket.org'</span><span class="p">]</span> <span class="o">=</span> <span class="err">{}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">'bitbucket.org'</span><span class="p">][</span><span class="s1">'User'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'hg'</span>
<span class="n">config</span><span class="p">[</span><span class="s1">'topsecret.server.com'</span><span class="p">]</span> <span class="o">=</span> <span class="err">{}</span>
</pre></div>
<h3 id="write">调用write方法写入</h3>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="k">open</span><span class="p">(</span><span class="s1">'example.ini'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
    <span class="n">config</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>
</pre></div>
<h3 id="_30">不默认更改大小写</h3>
<p>具体请参看 <a href="http://stackoverflow.com/questions/19359556/configparser-reads-capital-keys-and-make-them-lower-case">这个网页</a> ，configparser模块默认把 option name 也就是每个section的key
name改成小写，我不太喜欢这种风格，因为将configparser刷成字典值时，我们通常认为字典的key大小写是区分的，可以如下改动，然后就不自动进行小写操作了:</p>
<div class="highlight"><pre><span></span><span class="k">self</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">configparser</span><span class="p">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="k">self</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="n">str</span><span class="o">##</span> <span class="k">not</span> <span class="n">auto</span> <span class="n">make</span> <span class="n">it</span> <span class="n">lowercase</span>
</pre></div>
<h2 id="csv">csv模块</h2>
<p>下面主要介绍了自定义csv方言的情况，更加简单的txt文本样式，有时使用pandas会很方便，有时就是简单的使用自己定义的逗号分隔，一行行附加打印入文本即可，并不需要特别的处理。</p>
<h3 id="csv_1">自定义csv方言</h3>
<p>首先我们看到最通用的excel格式的csv方言写法：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">excel</span><span class="p">(</span><span class="n">Dialect</span><span class="p">):</span>
    <span class="sd">"""Describe the usual properties of Excel-generated CSV files."""</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">','</span>
    <span class="n">quotechar</span> <span class="o">=</span> <span class="s1">'"'</span>
    <span class="n">doublequote</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">skipinitialspace</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">lineterminator</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span>
    <span class="n">quoting</span> <span class="o">=</span> <span class="n">QUOTE_MINIMAL</span>
<span class="n">register_dialect</span><span class="p">(</span><span class="s2">"excel"</span><span class="p">,</span> <span class="n">excel</span><span class="p">)</span>
</pre></div>
<p>下面就这些字段的含义作出说明：</p>
<ul>
<li>
<p><strong>delimiter</strong>  分隔符，这个意义很明显。</p>
</li>
<li>
<p><strong>lineterminator</strong>  换行符，这个意义也很明显，目前主要就两种： <code>\r\n</code>  和 <code>\n</code> 。</p>
</li>
<li>
<p><strong>skipinitialspace</strong>  默认是False，其主要是对于如果你将空格设置为分隔符时有意义，这样后面字符开始的空格将会被忽略，其他情况设置为True或者False区别不大。</p>
<hr/>
</li>
<li>
<p><strong>quoting</strong>  设置quote规则</p>
<ul>
<li>
<p>csv.QUOTE_MINIMAL 意思是只有在需要的情况下才加上双引号，比如逗号在字符串里面，双引号在字符串里面，换行符号在字符串里面等等。</p>
</li>
<li>
<p>csv.QUOTE_ALL 意思是都加上双引号，即使是数字。</p>
</li>
<li>
<p>csv.QUOTE_NONNUMERIC 数字不加，字符串都加上双引号。（只有在这种情况下csv模块才会正确将数字解析为float类型）</p>
</li>
<li>
<p>csv.QUOTE_NONE 都不加（此时需要设置好escapechar选项）</p>
</li>
</ul>
</li>
<li>
<p><strong>quotechar</strong> 设置quote具体的字符，一般设置为双引号。</p>
</li>
<li>
<p><strong>doublequote</strong> 用来处理双引号在字符串中的情况，默认是True，字符串将会双引号之外再加上双引号，如果设置为False，会前面加上一个 <code>escapechar</code> 。</p>
</li>
</ul>
<p>自己定义csv方言就是类似的写上这样一个方言类，然后如下注册好即可：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">class</span> <span class="nc">MindMapCSV</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">Dialect</span><span class="p">):</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">','</span> <span class="c1"># 分隔符</span>
    <span class="n">quotechar</span> <span class="o">=</span> <span class="s1">'"'</span> <span class="c1"># quote符号</span>
    <span class="n">doublequote</span> <span class="o">=</span> <span class="bp">True</span> <span class="c1"># 双引号在字符中的情况</span>
    <span class="n">skipinitialspace</span> <span class="o">=</span> <span class="bp">True</span> <span class="c1"># 分隔符后空白忽略</span>
    <span class="n">lineterminator</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="c1"># 换行符</span>
    <span class="n">quoting</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span> <span class="c1"># 最小quote</span>

<span class="n">csv</span><span class="o">.</span><span class="n">register_dialect</span><span class="p">(</span><span class="s2">"MindMapCSV"</span><span class="p">,</span> <span class="n">MindMapCSV</span><span class="p">)</span>
</pre></div>
<h4 id="reader">对应的Reader编写</h4>
<p>下面贴出一个样例，具体要看你设计的csv方言来的。</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Reader</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dialect</span><span class="o">=</span><span class="s1">'sv'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">head</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getrow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">lst</span>

    <span class="k">def</span> <span class="nf">getdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">e</span>
</pre></div>
<p>其中有：</p>
<ul>
<li>getrow 取某一行的值</li>
<li>getcol 取某一列的值</li>
<li>getdata 取整个表格的数据值</li>
</ul>
<h4 id="writer">对应的Writer编写</h4>
<p>同样也要根据你的csv方言设计来的，下面只是贴出一个样例：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Writer</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dialect</span><span class="o">=</span><span class="s1">'sv'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dialect</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">setrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>
    <span class="k">def</span> <span class="nf">setcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">setdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
<p>提供的方法有：</p>
<ul>
<li>addrow 添加一行值</li>
<li>addcol 添加一列值</li>
<li>set 设置某行某列的某个值为什么</li>
<li>setdata 设置整个数据</li>
<li>write 实际写入到文件中去。</li>
</ul>
<h2 id="tempfile">tempfile模块</h2>
<p>tempfile模块用于创建临时文件或者临时文件夹，这个模块在所有系统平台上都能正常工作，有时还是很有用的。</p>
<p>比如windows系统下的临时文件夹所在：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span>
<span class="s1">'nt'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">tempfile</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
<span class="s1">'C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">a3580</span><span class="se">\\</span><span class="s1">AppData</span><span class="se">\\</span><span class="s1">Local</span><span class="se">\\</span><span class="s1">Temp'</span>
</pre></div>
<p>最核心的两个函数是 <code>mkstemp</code> 和 <code>mkdtemp</code> 。</p>
<h2 id="mkstemp">mkstemp</h2>
<p>mkstemp函数用于新建一个临时文件</p>
<div class="highlight"><pre><span></span><span class="n">fd</span><span class="p">,</span> <span class="n">fpath</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
<span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_cache_file</span><span class="p">:</span>
    <span class="n">marshal</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">FREQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">),</span> <span class="n">temp_cache_file</span><span class="p">)</span>
</pre></div>
<p>返回的第二个参数就是目标临时文件的路径名，第一个文件参数比较特殊，是操作系统级别的文件句柄（应该是C语言那边的文件句柄吧），要转成一般使用的python文件对象如上所示，使用 <code>os.fdopen</code> 来打开。</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js','mhchem.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
            
            
            <hr/>

        </div>
        <section>
        <div class="col-md-2" style="float:right;font-size:0.9em;">
            <h4>首发于：</h4>
            <time pubdate="pubdate" datetime="2016-03-03T00:00:00+08:00">2016年 3月 3日 </time>

<h4>最近更新于：</h4>
<time datetime="2019-10-02T00:00:00+08:00">2019年 10月 2日 </time>

            <h4>分类：</h4>
            <a class="category-link" href="/categories.html#pythonyu-yan-ref">python语言</a>
            <h4>标签：</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#python-ref">python
                    <span>14</span>
</a></li>
            </ul>
        </div>
        </section>
</div>
</article>
    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>


<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="http://docs.cdwanze.work" title="cdwanze Home Page">cdwanze</a></li>
    </ul>
</div>
</footer>

        <script src="/theme/js/jquery.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
    <script>
        function validateForm(query) {
            return (query.length > 0);
        }
    </script>

    <script>
        function adjust_search_width() {
            var w = document.documentElement.clientWidth;
            if ((w > 755) && (w < 975)) {
                plus_width = w - 755;
                $('.navbar-form .form-control').outerWidth(210 + plus_width);
            } else if (w >= 975) {
                $('.navbar-form .form-control').outerWidth(210 + 220);
            } else if (w <= 755) {
                $('.navbar-form .form-control').css('width', '100%')
            }
        }

        function adjust_markdown_css(){
            $(table).addClass('table');
            $(table).addClass('table-striped');
        }

        $(document).ready(function () {
            adjust_search_width();
            adjust_markdown_css();
        });

        window.onresize = function () {
            adjust_search_width();
        }

    </script>


    



</body>
</html>