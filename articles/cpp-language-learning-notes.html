<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625"/>

        <meta name="author" content="wanze"/>
        <meta name="copyright" content="wanze"/>

        <meta name="description"
              content="前言 本教程参考 这个github样例项目 阅读更方便。 本文假定读者已经学会C语言了，如果没有请先学习C语言，这不冲突的。读者可以参看笔者写的 C语言学习笔记一文 。 CPP语言开发环境 CPP语言开发环境还是推荐使用visual studio。 hello world #include &lt;iostream&gt; int main(void) { using namespace std; cout &lt;&lt; &#34;hello world!&#34;; cout &lt;&lt; endl; return 0; } 头文件的扩展名 cpp新的风格头文件是没有扩展名的，比如 iostream 就是 iostream ，并没有.h或者.hpp之类的，这样可以使用 namespace std 。旧的风格大体类似于C语言带上 .h 后缀。 命名空间 这个算是和C语言很大的一个不同点了，命名空间这个概念对于熟悉编程的人来说并不是一个默认的概念了，大体类似于python的模块名，一些其他编程语言也有类似的概念。比如 …
"/>

        <meta property="og:type" content="article"/>
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", c_and_cpp, " />

<meta property="og:title" content="CPP语言学习笔记 "/>
<meta property="og:url" content="https://a358003542.github.io/articles/cpp-language-learning-notes.html" />
<meta property="og:description" content="前言 本教程参考 这个github样例项目 阅读更方便。 本文假定读者已经学会C语言了，如果没有请先学习C语言，这不冲突的。读者可以参看笔者写的 C语言学习笔记一文 。 CPP语言开发环境 CPP语言开发环境还是推荐使用visual studio。 hello world #include &lt;iostream&gt; int main(void) { using namespace std; cout &lt;&lt; &#34;hello world!&#34;; cout &lt;&lt; endl; return 0; } 头文件的扩展名 cpp新的风格头文件是没有扩展名的，比如 iostream 就是 iostream ，并没有.h或者.hpp之类的，这样可以使用 namespace std 。旧的风格大体类似于C语言带上 .h 后缀。 命名空间 这个算是和C语言很大的一个不同点了，命名空间这个概念对于熟悉编程的人来说并不是一个默认的概念了，大体类似于python的模块名，一些其他编程语言也有类似的概念。比如 …" />
<meta property="og:site_name" content="万泽的博客" />
<meta property="og:article:author" content="wanze" />
<meta property="og:article:published_time" content="2020-08-31T08:46:51.707426+08:00" />
<meta name="twitter:title" content="CPP语言学习笔记 ">
<meta name="twitter:description" content="前言 本教程参考 这个github样例项目 阅读更方便。 本文假定读者已经学会C语言了，如果没有请先学习C语言，这不冲突的。读者可以参看笔者写的 C语言学习笔记一文 。 CPP语言开发环境 CPP语言开发环境还是推荐使用visual studio。 hello world #include &lt;iostream&gt; int main(void) { using namespace std; cout &lt;&lt; &#34;hello world!&#34;; cout &lt;&lt; endl; return 0; } 头文件的扩展名 cpp新的风格头文件是没有扩展名的，比如 iostream 就是 iostream ，并没有.h或者.hpp之类的，这样可以使用 namespace std 。旧的风格大体类似于C语言带上 .h 后缀。 命名空间 这个算是和C语言很大的一个不同点了，命名空间这个概念对于熟悉编程的人来说并不是一个默认的概念了，大体类似于python的模块名，一些其他编程语言也有类似的概念。比如 …">


    <title>CPP语言学习笔记  · 万泽的博客
</title>

        <link href="https://a358003542.github.io/theme/css/font-awesome.css" rel="stylesheet"
              media="screen">
        <link href="https://a358003542.github.io/theme/css/bootstrap.min.css" rel="stylesheet"
              media="screen">

        <link rel="stylesheet" type="text/css"
                  href="https://a358003542.github.io/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css"
                  href="https://a358003542.github.io/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css"
                  href="https://a358003542.github.io/theme/css/base.css" media="screen">




</head>
<body>

<nav class="navbar">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="https://a358003542.github.io/"><span
                    class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <form action="https://a358003542.github.io/search.html"
                  onsubmit="return validateForm(this.elements['q'].value);"
                  class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" name="q" id="tipue_search_input"
                           class="form-control" placeholder="Search..."
                           style="width:430px;">
                </div>
                <button class="btn btn-default" type="submit">搜索</button>
            </form>


            <ul class="nav navbar-nav nav-pills navbar-right">
                <li >
                    <a  href="/archives.html">所有文章</a></li>

                <li ><a href="/categories.html">文章分类</a></li>
                <li ><a href="/tags.html">文章标签</a></li>


                        <li >
                            <a href="https://a358003542.github.io/about.html">关于本网站</a>
                        </li>
            </ul>


        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">
<article>
<div class="row">
    <header class="page-header col-md-10 col-md-offset-2">
    <h1><a href="https://a358003542.github.io/articles/cpp-language-learning-notes.html"> CPP语言学习笔记  </a></h1>
    </header>
</div>

<div class="row">
    <div class="col-md-2 table-of-content">
        <nav>
        <h4>目录</h4>
        <div class="toc">
<ul>
<li><a href="#_1">前言</a></li>
<li><a href="#cpp">CPP语言开发环境</a></li>
<li><a href="#hello-world">hello world</a><ul>
<li><a href="#_2">头文件的扩展名</a></li>
<li><a href="#_3">命名空间</a></li>
<li><a href="#cout">cout对象</a></li>
<li><a href="#_4">声明变量</a></li>
<li><a href="#_5">定义函数</a></li>
</ul>
</li>
<li><a href="#_6">数据类型</a></li>
<li><a href="#_7">程序逻辑</a></li>
<li><a href="#_8">函数</a><ul>
<li><a href="#_9">数组作为函数的参数</a></li>
<li><a href="#c">C风格字符串作为函数的参数</a></li>
<li><a href="#_10">结构体作为函数的参数</a></li>
<li><a href="#_11">函数作为函数的参数</a></li>
</ul>
</li>
<li><a href="#_12">函数补充</a><ul>
<li><a href="#_13">内联函数</a></li>
<li><a href="#_14">引用变量</a></li>
<li><a href="#_15">默认参数</a></li>
<li><a href="#_16">函数重载</a></li>
<li><a href="#_17">函数模板</a></li>
</ul>
</li>
<li><a href="#_18">内存模型和名称空间</a><ul>
<li><a href="#_19">内存模型</a></li>
<li><a href="#_20">名称空间</a></li>
</ul>
</li>
<li><a href="#_21">类</a><ul>
<li><a href="#_22">类作用域</a></li>
<li><a href="#_23">构造函数</a></li>
<li><a href="#_24">析构函数</a></li>
<li><a href="#this">this指针</a></li>
<li><a href="#const">const成员函数</a></li>
<li><a href="#_25">类内定义的数组长度是常量的情况</a></li>
<li><a href="#_26">运算符重载</a></li>
<li><a href="#_27">友元函数</a></li>
<li><a href="#_28">类的类型转换</a><ul>
<li><a href="#_29">将其他类型数据转成本类</a></li>
<li><a href="#_30">将本类转成其他类型数据</a></li>
</ul>
</li>
<li><a href="#_31">类和动态内存分配</a><ul>
<li><a href="#_32">成员初始化列表</a></li>
<li><a href="#null">NULL空指针</a></li>
</ul>
</li>
<li><a href="#_33">类继承</a></li>
</ul>
</li>
<li><a href="#_34">附录</a><ul>
<li><a href="#cin">cin详解</a></li>
<li><a href="#cout_1">cout详解</a></li>
</ul>
</li>
<li><a href="#_35">参考资料</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="col-md-8 article-content">

            
<h2 id="_1">前言</h2>
<p>本教程参考 <a href="https://github.com/a358003542/cpp_practice">这个github样例项目</a> 阅读更方便。</p>
<p>本文假定读者已经学会C语言了，如果没有请先学习C语言，这不冲突的。读者可以参看笔者写的 <a href="https://a358003542.github.io/articles/c-language-learning-notes.html">C语言学习笔记一文</a> 。</p>
<h2 id="cpp">CPP语言开发环境</h2>
<p>CPP语言开发环境还是推荐使用visual studio。</p>
<h2 id="hello-world">hello world</h2>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"hello world!"</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h3 id="_2">头文件的扩展名</h3>
<p>cpp新的风格头文件是没有扩展名的，比如 <code>iostream</code> 就是 iostream ，并没有.h或者.hpp之类的，这样可以使用 <code>namespace std</code> 。旧的风格大体类似于C语言带上 <code>.h</code> 后缀。</p>
<h3 id="_3">命名空间</h3>
<p>这个算是和C语言很大的一个不同点了，命名空间这个概念对于熟悉编程的人来说并不是一个默认的概念了，大体类似于python的模块名，一些其他编程语言也有类似的概念。比如：</p>
<div class="highlight"><pre><span></span><span class="n">Microflot</span><span class="o">::</span><span class="n">hello</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>
<span class="n">GooGloo</span><span class="o">::</span><span class="n">hello</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>
</pre></div>
<p>上面一个是调用的命名空间Microflot里面的hello函数，另一个是调用的GooGloo命令空间的hello函数。之前的hello world程序 <code>using namespace std;</code> 的话就是如下写的：</p>
<div class="highlight"><pre><span></span>#include &lt;iostream&gt;

int main(void) {
    //using namespace std;
    std::cout &lt;&lt; "hello world!";
    std::cout &lt;&lt; std::endl;

    return 0;
}
</pre></div>
<p>这个有点类似于python里面的 <code>from what import *</code> 将里面的函数名等都给导进来了，所以就可以直接使用cin，cout了。此外还有一种推荐的做法是：</p>
<div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
<p>这大体类似于python里面的 <code>from what import cout</code> ，只是具体导入了某个函数名之类的。</p>
<h3 id="cout">cout对象</h3>
<p>cout是一个对象，其内部有方法知道如何打印字符串。</p>
<div class="highlight"><pre><span></span>cout &lt;&lt; "string";
</pre></div>
<p>上面代码的过程就是cout对象调用插入运算符 <code>&lt;&lt;</code> ，从而执行某个操作将字符串插入到输出流中。</p>
<p>std::endl是一个特殊的C++符号 【换行符？】，将其插入输出流将导致屏幕光标换行。</p>
<div class="highlight"><pre><span></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">;</span>
</pre></div>
<p>是的， cout可以直接打印int数值。</p>
<h3 id="_4">声明变量</h3>
<p>cpp这点和c语言最大的区别是cpp是推荐在首次使用变量之前声明它而不是集中在文件开头。</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the x value: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">x</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the y value: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"x + y = "</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>cin 和cout相比较之前C语言哪一套实在方便多了，然后我们看到cout可以进行简单的字符串拼接操作。</p>
<h3 id="_5">定义函数</h3>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the x value: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">x</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the y value: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"x + y = "</span> <span class="o">&lt;&lt;</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
<p>就cpp和c语言的函数定义和函数原型声明这块来说区别不是太大。熟悉C语言的这块简单温习下就好。</p>
<h2 id="_6">数据类型</h2>
<p>整型有：short，int，long 和 long long 。一般没有有说服力的理由就应使用int。</p>
<p>char类型：char类型一般用于存储一个字节大小的字符，但也用于存储比short更小的整型。</p>
<p>bool类型：true or false</p>
<p>符号常量修饰符：const</p>
<p>浮点数类型：float、double、long double。</p>
<p>1．编写一个小程序，要求用户使用一个整数指出自己的身高（单位为英寸），然后将身高转换为英尺和英寸【这里的意思是取整部分为英尺余下部分继续为英寸】。该程序使用下划线字符来指示输入位置。另外，使用一个const符号常量来表示转换因子。</p>
<p>inch2foot.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">CONVERSION</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">height_inch</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input your height value in inch: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">height_inch</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">height_inch</span> <span class="o">%</span> <span class="n">CONVERSION</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"your height value is "</span> <span class="o">&lt;&lt;</span> <span class="n">height_inch</span> <span class="o">/</span> <span class="n">CONVERSION</span>
            <span class="o">&lt;&lt;</span> <span class="s">" foots."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"your height value is "</span> <span class="o">&lt;&lt;</span> <span class="n">height_inch</span> <span class="o">/</span> <span class="n">CONVERSION</span>
            <span class="o">&lt;&lt;</span> <span class="s">" foots and "</span> <span class="o">&lt;&lt;</span> <span class="n">height_inch</span> <span class="o">%</span> <span class="n">CONVERSION</span> <span class="o">&lt;&lt;</span> <span class="s">"inchs."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> <code>%</code> 是取模运算，整数之间的除法是取商运算。</p>
<p>3．编写一个程序，要求用户以度、分、秒的方式输入一个纬度，然后以度为单位显示该纬度。1度为60分，1分等于60秒，请以符号常量的方式表示这些值。对于每个输入值，应使用一个独立的变量存储它。下面是该程序运行时的情况：</p>
<p><img alt="img" src="https://a358003542.github.io/images/programming/cpp_xiti_1.png"/></p>
<p>to_degress.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">CONVERSION</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">degrees</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">minutes</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">seconds</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">result</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter a latitude in degrees, minutes, and seconds:"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"First, enter the degrees: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">degrees</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Next, enter the minutes of arc: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">minutes</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Finally, enter the seconds of arc: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">seconds</span><span class="p">;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">degrees</span> <span class="o">+</span> <span class="n">minutes</span> <span class="o">/</span> <span class="n">CONVERSION</span> <span class="o">+</span> <span class="n">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="n">CONVERSION</span> <span class="o">*</span> <span class="n">CONVERSION</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">degrees</span> <span class="o">&lt;&lt;</span> <span class="s">" degrees, "</span>  <span class="o">&lt;&lt;</span> <span class="n">minutes</span> <span class="o">&lt;&lt;</span> <span class="s">" minutes, "</span> <span class="o">&lt;&lt;</span> <span class="n">seconds</span> <span class="o">&lt;&lt;</span> <span class="s">" seconds = "</span> <span class="o">&lt;&lt;</span>
            <span class="n">result</span>
            <span class="o">&lt;&lt;</span> <span class="s">" degrees."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了const定义常数项的用法。</p>
<p>5．编写一个程序，要求用户输入全球当前的人口和美国当前的人口（或其他国家的人口）。将这些信息存储在long long变量中，并让程序显示美国（或其他国家）的人口占全球人口的百分比。该程序的输出应与下面类似：</p>
<p><img alt="img" src="https://a358003542.github.io/images/programming/cpp_xiti_2.png"/></p>
<p>usa_population.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">long</span> <span class="kt">long</span> <span class="n">word_population</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">usa_population</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">population_ratio</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the world's population: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">word_population</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the population of the US: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">usa_population</span><span class="p">;</span>

    <span class="n">population_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">usa_population</span> <span class="o">/</span> <span class="n">word_population</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"The population of the US is "</span> <span class="o">&lt;&lt;</span> <span class="n">population_ratio</span> <span class="o">&lt;&lt;</span> <span class="s">"% of the world population."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了如何进行强制类型转换。</p>
<p>7．编写一个程序，要求用户按欧洲风格输入汽车的耗油量（每100公里消耗的汽油量（升）），然后将其转换为美国风格的耗油量—每加仑多少英里。注意，除了使用不同的单位计量外，美国方法（距离/燃料）与欧洲方法（燃料/距离）相反。100公里等于62.14英里，1加仑等于3.875升。因此，19mpg大约合12.4l/100km，27mpg大约合8.71/100km。</p>
<p>to_usa_mpg.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">eu_fuel</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">usa_mpg</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">KILOMETER_CONVERT_MILES</span> <span class="o">=</span> <span class="mf">0.6214</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">GALLON_CONVERT_LITERS</span> <span class="o">=</span> <span class="mf">3.875</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input how many your car use fuel[unit liter] on running 100 kilometers: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">eu_fuel</span><span class="p">;</span>

    <span class="n">usa_mpg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">KILOMETER_CONVERT_MILES</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">eu_fuel</span> <span class="o">/</span> <span class="n">GALLON_CONVERT_LITERS</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"The mpg your car in usa standard is : "</span> <span class="o">&lt;&lt;</span> <span class="n">usa_mpg</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
<hr/>
<p>long totals[500] = {0};  //初始化一个500个元素的数组，索引为0的元素设值为0，其他元素自动设值为0。</p>
<p>你也可以如下：</p>
<p>long totals[500] = {} ; // 这样所有元素都自动设值为0。</p>
<p>字符串类型，C严格意义上来说并没有所谓的字符串类型，C语言风格的字符串这里略过讨论了，C++添加了string类，你需要包含头文件string，然后就可以如下使用string类了。</p>
<div class="highlight"><pre><span></span>string str1;
str1 = "abc";
</pre></div>
<p>熟悉C语言风格字符串使用的一下就看出一个巨大的区别了，那就是这里可以直接初始化字符串变量，不需要操作数组长度之类的东西了，非常好的改进！</p>
<p>然后C语言风格的字符串不可以将一个字符串的值赋值给另一个字符串，但是string类可以如下做：</p>
<div class="highlight"><pre><span></span>string str1;
string str2 = "abc";
str1 = str2;
cout &lt;&lt; str1 + str2;
</pre></div>
<p>你还可以用加法来进行字符串拼接，终于，类似python的那些基本字符串操作在C语言那边还要让人头疼好久这里终于顺畅一些了。</p>
<div class="highlight"><pre><span></span>cout &lt;&lt; str1.size(); // 返回3
</pre></div>
<p>请求行输入因为历史原因 cin.getline(charstr, max_size) 更接近于我们在C语言中熟知的那种概念，而友元函数 getline(cin, string) 反而更接近C++风格，因为cin是C++里面的概念，所以人们会预期cin的类方法会对接string接口，但这只是历史要兼容的原因罢了，并没什么特别的理由要弄得这样反常规。</p>
<p>C++里面的结构就基本的东西来说和C语言里面的讨论是没有太大区别的，C++里面的结构体当然也可以将string类作为成员对象。特别要强调的是C语言里面字符串数组实际上并没有所谓的字符串这个基本内存存储单元，因为字符串不定长，所以字符串数组实际下面存放的是指针，但是结构数组不同，C语言的结构体是如此基本，它就可以看做一个基本的内存存储单元，所以结构数组下面就是一个一个结构体而不是指向结构体的指针。因此结构体数组的引用语句是 <code>struct_array[0].name</code> 。</p>
<p>C++里面的Union和enum枚举和C语言里面的讨论也没有太大区别。</p>
<p>C++里面的指针还有相关内存管理malloc之类的等等和C语言里面的讨论也没有太大区别，不过需要注意的是C++编程一定程度上弱化了指针的概念，很多地方C++编程不一定要使用指针的，然后内存管理也不推荐使用malloc函数而是推荐使用new和delete运算符。</p>
<p>对于C++的基本类型和结构可以如下使用new来声明一个内存块，然后用给定的指针名来指向它，引用它和使用它。</p>
<div class="highlight"><pre><span></span>typeName * pointer_name = new typeName;

int * pn = new int;
*pn = 1;
cout &lt;&lt; *pn;
</pre></div>
<p>这个东西只能通过该指针来使用，参考资料1说这个东西更确切来说应该叫做数据对象，变量也是数据对象。不管怎么说，就是指内存里的那个东西。</p>
<p>delete运算符只能用于那些也就是上面讨论的new出来的指针。具体如下所示：</p>
<div class="highlight"><pre><span></span>int * pn = new int;
delete pn;
</pre></div>
<p>使用new来创建数组和结构和其他又有所不同，以数组为例，常规声明数组叫做静态联编（static binding），即在编译阶段已经为该数组申请分配好内存了；而通过new来创建的数组只在后面运行阶段才可能创建，也就是运行阶段如果没使用这个数组也不会创建，这称为动态联编（dynamic binding）。这种数组叫做动态数组。</p>
<p>下面例子演示了其为何叫做动态数组，我们可以运行时用户指定该数组大小，然后运行时给定值：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the array length: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">x</span><span class="p">;</span>

    <span class="kt">int</span><span class="o">*</span> <span class="n">parray</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">parray</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">parray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">delete</span><span class="p">[]</span> <span class="n">parray</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注意new出来的动态数组 delete 运算符语句加上了 [] 。</strong></p>
<p>具体指针的使用C语言里面的东西了，这里可以回顾提醒一下， <code>arr[1]</code> 和 <code>*(arr+1)</code> 是一个意思， <code>arr[0]</code> 和 <code>*arr</code> 是一个意思。</p>
<p>关于指针和数组这块东西很多的，但因为都是C语言里面的知识点，我这里就略过讨论了，如果读者自觉在这块还有所欠缺，请在C语言教材对应的部分补习之。</p>
<p>也可以使用new一个动态的字符串，或者说动态字符数组，但这完全没有必要。因为string类内部也就是这样做的，你没必要去重复造轮子了，直接使用string类就是了。</p>
<p>使用new出来的结构参照前面的讨论，类似的叫做动态结构。这里的动态结构倒不是说结构的定义动态，结构体的定义还是要做的。</p>
<p>C语言里面就存储类型有自动存储和静态存储，简单来说自动存储变量的存活是程序自动管理的，而静态存储变量在整个程序运行期都是存活的。这一块C++和C语言是一致的，不同的是C++因为上面讨论的new运算符而提出了一个新的存储类型，叫做动态存储。具体new和delete运算符管理的内存池和静态变量和自动变量的内存池是分开的，其叫做自由存储空间或堆。如果new出来的动态存储变量没有delete，这叫做内存泄漏，内存泄露一般只是本程序那些内存没法用了，然后严重点本程序运行的内存被耗尽了，因为没有内存程序崩溃了。参考资料说这种严重的泄漏甚至导致操作系统或其他应用程序崩溃。</p>
<p>类似string类，C++用vector类来实现动态数组，类似上面的string类的讨论，如果你要自己利用new和delete来实现某种动态数组的效果，那么不要重复造轮子了，请用vector类，vector类内部就是这样做的。下面将上面动态数组的例子写成vector版本：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the array length: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">x</span><span class="p">;</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>vector类还有很多其他用法，但在这里不是重点。我们看到vector初始化不需要指定长度参数了，其通过push_back方法来新增元素。</p>
<p>vector类因为是动态数组，所以效率有点低，C++又实现了一个新的类array类，其内部存储和原来的数组存储风格一致，所以效率等价，然后因为是类，所有多了一些便捷的操作方法。这些方法后面有时间再慢慢了解。</p>
<hr/>
<p>编写一个C++程序，如下述输出示例所示的那样请求并显示信息：</p>
<p><img alt="img" src="https://a358003542.github.io/images/programming/cpp_xiti_c4_1.png"/></p>
<p>注意，该程序应该接受的名字包含多个单词。另外，程序将向下调整成绩，即向下调一个字母。</p>
<p>xiti_c4_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="n">string</span> <span class="n">first_name</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">last_name</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">grade</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"What is your first name? "</span><span class="p">;</span>
    <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">first_name</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"What is your last name? "</span><span class="p">;</span>

    <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">last_name</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"What letter grade do you deserve? "</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">grade</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"What is your age? "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">age</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Name: "</span> <span class="o">&lt;&lt;</span> <span class="n">last_name</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">first_name</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Grade: "</span><span class="p">;</span> 
    <span class="n">cout</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">grade</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Age: "</span> <span class="o">&lt;&lt;</span> <span class="n">age</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 一般字符可以直接cout，但如果类型已经是int型了，那么希望输出对应的字符则需要使用<code>cout.get</code>。</p>
<p>编写一个程序，它要求用户首先输入其名，然后输入其姓；然后程序使用一个逗号和空格将姓和名组合起来，并存储和显示组合结果。请使用char数组和头文件cstring中的函数。下面是该程序运行时的情形：</p>
<p><img alt="img" src="https://a358003542.github.io/images/programming/cpp_xiti_c4_2.png"/></p>
<p>xiti_c4_3.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">first_name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">last_name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>


    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"What is your first name? "</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"What is your last name? "</span><span class="p">;</span>

    <span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">last_name</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>

    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">);</span>
    <span class="n">strcat_s</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">", "</span><span class="p">);</span>
    <span class="n">strcat_s</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">first_name</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Here's the information in a single string: "</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要了解下C风格的字符数组用法。</p>
<p>结构CandyBar包含3个成员。第一个成员存储了糖块的品牌；第二个成员存储糖块的重量（可以有小数）；第三个成员存储了糖块的卡路里含量（整数）。请编写一个程序，声明这个结构，创建一个名为snack的CandyBar变量，并将其成员分别初始化为“Mocha Munch”、2.3和350。初始化应在声明snack时进行。最后，程序显示snack变量的内容。</p>
<p>xiti_c4_5.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">CandyBar</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">weight</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">calories</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CandyBar</span> <span class="n">snack</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"Mocha Munch"</span><span class="p">,</span>
        <span class="mf">2.3</span><span class="p">,</span>
        <span class="mi">350</span>
    <span class="p">};</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CandyBar "</span> <span class="o">&lt;&lt;</span> <span class="n">snack</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">" weight: "</span> <span class="o">&lt;&lt;</span> <span class="n">snack</span><span class="p">.</span><span class="n">weight</span> <span class="o">&lt;&lt;</span>
        <span class="s">" and calories: "</span> <span class="o">&lt;&lt;</span> <span class="n">snack</span><span class="p">.</span><span class="n">calories</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了结构体的用法。</p>
<p>结构CandyBar包含3个成员，如上面讨论的。请编写一个程序，创建一个包含3个元素的CandyBar数组【使用new来动态分配数组，而不是声明一个包含3个元素的CandyBar数组】，并将它们初始化为所选择的值，然后显示每个结构的内容。</p>
<p>xiti_c4_6.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">CandyBar</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">weight</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">calories</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">CandyBar</span><span class="o">*</span> <span class="n">psnack</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CandyBar</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

    <span class="n">psnack</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">name</span> <span class="o">=</span> <span class="s">"aaa"</span><span class="p">;</span>
    <span class="n">psnack</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">weight</span> <span class="o">=</span> <span class="mf">2.3</span><span class="p">;</span>
    <span class="n">psnack</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">calories</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

    <span class="n">psnack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"bbb"</span><span class="p">,</span>
        <span class="mf">2.5</span><span class="p">,</span>
        <span class="mi">6</span>
    <span class="p">};</span>

    <span class="n">psnack</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"ccc"</span><span class="p">,</span>
        <span class="mf">2.6</span><span class="p">,</span>
        <span class="mi">7</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CandyBar "</span> <span class="o">&lt;&lt;</span> <span class="n">psnack</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">" weight: "</span> <span class="o">&lt;&lt;</span> <span class="n">psnack</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">weight</span> <span class="o">&lt;&lt;</span>
            <span class="s">" and calories: "</span> <span class="o">&lt;&lt;</span> <span class="n">psnack</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">calories</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">delete</span><span class="p">[]</span> <span class="n">psnack</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了如何new一个结构体。</p>
<p>William Wingate从事比萨饼分析服务。对于每个披萨饼，他都需要记录下列信息：</p>
<p>披萨饼公司的名称，可以有多个单词组成。
披萨饼的直径。
披萨饼的重量。
请设计一个能够存储这些信息的结构【请使用new来为结构分配内存，请使用vector来实现动态数组】，并编写一个使用这种结构变量的程序。程序将请求用户输入上述信息，然后显示这些信息。请使用cin（或它的方法）和cout。</p>
<p>xiti_c4_7.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>


<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Pizza</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">diameter</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">weight</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the array length: "</span><span class="p">;</span>
    <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">x</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Pizza</span> <span class="o">*&gt;</span> <span class="n">vec</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Pizza</span><span class="o">*</span> <span class="n">ppizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pizza</span><span class="p">;</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input your pizza name: "</span><span class="p">;</span>

        <span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">ppizza</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input your pizza diameter: "</span><span class="p">;</span>
        <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">ppizza</span><span class="o">-&gt;</span><span class="n">diameter</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input your pizza weight: "</span><span class="p">;</span>
        <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">ppizza</span><span class="o">-&gt;</span><span class="n">weight</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"-----------------"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ppizza</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CandyBar "</span> <span class="o">&lt;&lt;</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">" weight: "</span> <span class="o">&lt;&lt;</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">diameter</span> <span class="o">&lt;&lt;</span>
            <span class="s">" and calories: "</span> <span class="o">&lt;&lt;</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">weight</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了vector的用法。</p>
<h2 id="_7">程序逻辑</h2>
<p>这块C++和C语言内容基本上没什么区别，所以大多略过了，然后主要做一些习题也算是对前面学到的东西的再应用。</p>
<p>C++的for语句多了一个新的下面这种形式，这个要了解下：</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">x</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}){</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>这个熟悉python语言等高级语言的知道这是迭代遍历循环操作，然后后面可以是数组或者vector或者array。</p>
<p>关于cin的用法请看下面的演示例子，主要是这个补充知识点：cin.get获取字符之后返回的仍是cin对象，其如果在bool取值环境，如果读取成功则返回true，如果读取失败则返回fasle。读取失败也包括常规的EOF结尾情况。</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter characters:</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span> <span class="c1">//Ctrl+Z </span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ch</span><span class="p">;</span>
        <span class="o">++</span><span class="n">count</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>1．编写一个要求用户输入两个整数的程序。该程序将计算并输出这两个整数之间（包括这两个整数）所有整数的和。这里假设先输入较小的整数。例如，如果用户输入的是2和9，则程序将指出2～9之间所有整数的和为44。</p>
<p>xiti_c5_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">start_int</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">end_int</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the start integer: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">start_int</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the end integer: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">end_int</span><span class="p">;</span>


    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">start_int</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">end_int</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"the integer in range "</span> <span class="o">&lt;&lt;</span> <span class="n">start_int</span> <span class="o">&lt;&lt;</span> <span class="s">" - "</span> <span class="o">&lt;&lt;</span> <span class="n">end_int</span> <span class="o">&lt;&lt;</span> <span class="s">" summation is "</span> <span class="o">&lt;&lt;</span> <span class="n">sum</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了如何写for语句。</p>
<p>3．编写一个要求用户输入数字的程序。每次输入后，程序都将报告到目前为止，所有输入的累计和。当用户输入0时，程序结束。</p>
<p>xiti_c5_3.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>


    <span class="kt">int</span> <span class="n">temp</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">do</span> <span class="p">{</span>    
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input a number, input 0 quit : "</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">temp</span><span class="p">;</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">temp</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"your input number summation is "</span> <span class="o">&lt;&lt;</span> <span class="n">sum</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例演示了do-while语句。</p>
<p>5．假设要销售《C++ For Fools》一书。请编写一个程序，输入全年中每个月的销售量（图书数量，而不是销售额）。程序通过循环，使用初始化为月份字符串的char *数组（或string对象数组）逐月进行提示，并将输入的数据储存在一个int数组中。然后，程序计算数组中各元素的总数，并报告这一年的销售情况。</p>
<p>xiti_c5_5.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">string</span> <span class="n">months</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"jan"</span><span class="p">,</span><span class="s">"feb"</span><span class="p">,</span><span class="s">"march"</span><span class="p">,</span><span class="s">"april"</span><span class="p">,</span><span class="s">"may"</span><span class="p">,</span><span class="s">"june"</span><span class="p">,</span><span class="s">"july"</span><span class="p">,</span><span class="s">"august"</span><span class="p">,</span><span class="s">"september"</span><span class="p">,</span><span class="s">"october"</span><span class="p">,</span><span class="s">"november"</span><span class="p">,</span><span class="s">"december"</span> <span class="p">};</span>
    <span class="kt">int</span> <span class="n">sales</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">string</span> <span class="nl">month</span> <span class="p">:</span> <span class="n">months</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input the sale of amount in "</span> <span class="o">&lt;&lt;</span> <span class="n">month</span> <span class="o">&lt;&lt;</span> <span class="s">" : "</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">sales</span><span class="p">[</span><span class="n">count</span><span class="p">];</span>

        <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">sales</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"this year's sale amount is: "</span> <span class="o">&lt;&lt;</span> <span class="n">sum</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了如何使用新式的for语句。</p>
<p>6．完成编程练习5，但这一次使用一个二维数组来存储输入—3年中每个月的销售量。程序将报告每年销售量以及三年的总销售量。</p>
<p>xiti_c5_6.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main19</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">sum_all</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">string</span> <span class="n">months</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"jan"</span><span class="p">,</span><span class="s">"feb"</span><span class="p">,</span><span class="s">"march"</span><span class="p">,</span><span class="s">"april"</span><span class="p">,</span><span class="s">"may"</span><span class="p">,</span><span class="s">"june"</span><span class="p">,</span><span class="s">"july"</span><span class="p">,</span><span class="s">"august"</span><span class="p">,</span><span class="s">"september"</span><span class="p">,</span><span class="s">"october"</span><span class="p">,</span><span class="s">"november"</span><span class="p">,</span><span class="s">"december"</span> <span class="p">};</span>
    <span class="kt">int</span> <span class="n">sales</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">sum_year</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">string</span> <span class="nl">month</span> <span class="p">:</span> <span class="n">months</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input year "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">" the sale of amount in "</span> <span class="o">&lt;&lt;</span> <span class="n">month</span> <span class="o">&lt;&lt;</span> <span class="s">" : "</span><span class="p">;</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">count</span><span class="p">];</span>

            <span class="n">sum_year</span> <span class="o">+=</span> <span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">count</span><span class="p">];</span>

            <span class="n">count</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"this year "</span><span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">"all sale amount is: "</span> <span class="o">&lt;&lt;</span> <span class="n">sum_year</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="n">sum_all</span> <span class="o">+=</span> <span class="n">sum_year</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"the three year all sale amount is: "</span><span class="o">&lt;&lt;</span> <span class="n">sum_all</span>  <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 本例主要演示了二维数组的用法。</p>
<p>10．编写一个使用嵌套循环的程序，要求用户输入一个值，指出要显示多少行。然后，程序将显示相应行数的星号，其中第一行包括一个星号，第二行包括两个星号，依此类推。每一行包含的字符数等于用户指定的行数，在星号不够的情况下，在星号前面加上句点。该程序的运行情况如下：</p>
<p><img alt="img" src="https://a358003542.github.io/images/programming/xiti_c5_10.png"/></p>
<p>xiti_c5_10.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main20</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">rows</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter number of rows: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">rows</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//here we can not use the if statement.</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"."</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"*"</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> 需要注意本例不能使用if语句，所以才有上面的写法。</p>
<p>下面这个例子中 cin &gt;&gt; fish[i] 返回cin对象，其bool值含义是如果获取输入成功则返回true，如果获取输入失败则返回false。</p>
<p>cinfish.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="k">const</span> <span class="kt">int</span> <span class="n">Max</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>


    <span class="kt">double</span> <span class="n">fish</span><span class="p">[</span><span class="n">Max</span><span class="p">];</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"fish #1: "</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">Max</span> <span class="o">&amp;&amp;</span> <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">fish</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">Max</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"fish #"</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">fish</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"No fish</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average weight is "</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">/</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>cinfish2.cpp</p>
<p>下面例子类似上面也是一个和用户交互请求输入数字的例子，不同的是上一个如果用户输入有误则退出，而这一个如果用户输入有误程序会继续请求用户输入。所以上一个例子是演示的不定数目的输入情况，而这一个演示的是如何处理用户输入有误时候的情况。为了和上面的例子进行比较我尽可能让这两个例子基本结构变动不大。</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="k">const</span> <span class="kt">int</span> <span class="n">Max</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">fish</span><span class="p">[</span><span class="n">Max</span><span class="p">];</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"fish #1: "</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">Max</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">fish</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span> <span class="c1">//failed for input</span>
            <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//clear the wrong input line</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">Max</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"fish #"</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">Max</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"fish #"</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">fish</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"No fish</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average weight is "</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">/</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>注解：</strong> <code>cin.clear()</code> 是让cin在遇到错误输入之后可以继续开始接受输入。后面的while语句是清空缓存区那一行错误输入。</p>
<p>下面这个例子演示了如何写入文件：</p>
<p>outfile.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">automobile</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">year</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">a_price</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">d_price</span><span class="p">;</span>

    <span class="n">ofstream</span> <span class="n">outFile</span><span class="p">;</span>
    <span class="n">outFile</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">"carinfo.txt"</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the make and modle of automobile: "</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">automobile</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the model year: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">year</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the original asking price: "</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">a_price</span><span class="p">;</span>

    <span class="n">d_price</span> <span class="o">=</span> <span class="mf">0.913</span> <span class="o">*</span> <span class="n">a_price</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">fixed</span><span class="p">;</span> <span class="c1">// </span>
    <span class="n">cout</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">//</span>
    <span class="n">cout</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios_base</span><span class="o">::</span><span class="n">showpoint</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Make and modle: "</span> <span class="o">&lt;&lt;</span> <span class="n">automobile</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Year: "</span> <span class="o">&lt;&lt;</span> <span class="n">year</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Was asking $"</span> <span class="o">&lt;&lt;</span> <span class="n">a_price</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Now asking $"</span> <span class="o">&lt;&lt;</span> <span class="n">d_price</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>


    <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="n">fixed</span><span class="p">;</span>
    <span class="n">outFile</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">outFile</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios_base</span><span class="o">::</span><span class="n">showpoint</span><span class="p">);</span>
    <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">"Make and modle: "</span> <span class="o">&lt;&lt;</span> <span class="n">automobile</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">"Year: "</span> <span class="o">&lt;&lt;</span> <span class="n">year</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">"Was asking $"</span> <span class="o">&lt;&lt;</span> <span class="n">a_price</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">"Now asking $"</span> <span class="o">&lt;&lt;</span> <span class="n">d_price</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">outFile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>具体在新建一个ofstream对象之后，通过open方法将输出流和目标文件联系起来，然后剩下来的动作和使用cout没有区别，最后记得把文件输出流调用close方法关闭。</p>
<div class="highlight"><pre><span></span>ofstream outFile;
outFile.open("carinfo.txt");

....

outFile.close();
</pre></div>
<ul>
<li>precision方法  控制输出流浮点数的精度</li>
<li><code>setf(ios_base::showpoint)</code> 显示浮点数小数点后面的零</li>
</ul>
<p>1．编写一个程序，读取键盘输入，直到遇到@符号为止，并回显输入（数字除外），同时将大写字符转换为小写，将小写字符转换为大写（别忘了cctype函数系列）。</p>
<p>xiti_c6_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cctype&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main26</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">'@'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">isupper</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">cout</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">tolower</span><span class="p">(</span><span class="n">ch</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">islower</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">cout</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">toupper</span><span class="p">(</span><span class="n">ch</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">cout</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>3．编写一个菜单驱动程序的雏形。该程序显示一个提供4个选项的菜单——每个选项用一个字母标记。如果用户使用有效选项之外的字母进行响应，程序将提示用户输入一个有效的字母，直到用户这样做为止。然后，该程序使用一条switch语句，根据用户的选择执行一个简单操作。该程序的运行情况如下：</p>
<p><img alt="img" src="https://a358003542.github.io/images/2020/xiti_c6_3.png"/></p>
<p>xiti_c6_3.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">help</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">help</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"c) carnivore              p) pianist</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span>
        <span class="s">"t) tree                   g) game</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please enter one of the following choices:</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="n">help</span><span class="p">();</span>

    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>

    <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">ch</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

    <span class="kt">bool</span> <span class="n">quit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">quit</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">'c'</span><span class="o">:</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A maple is a carnivore"</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'p'</span><span class="o">:</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A maple is a pianist"</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'t'</span><span class="o">:</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A maple is a tree"</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'g'</span><span class="o">:</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"A maple is a game"</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please enter a c, p, t, or g: "</span><span class="p">;</span>
            <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">ch</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>
            <span class="n">quit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

        <span class="p">}</span>
    <span class="p">}</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>5．在Neutronia王国，货币单位是tvarp，收入所得税的计算方式如下：</p>
<p>5000 tvarps：不收税</p>
<p>5001～15000 tvarps：10%</p>
<p>15001～35000 tvarps：15%</p>
<p>35000 tvarps以上：20%</p>
<p>例如，收入为38000 tvarps时，所得税为5000 0.00 + 10000 0.10 + 20000 0.15 + 3000 0.20，即4600 tvarps。请编写一个程序，使用循环来要求用户输入收入，并报告所得税。当用户输入负数或非数字时，循环将结束。</p>
<p>xiti_c6_5.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">calc_tax</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">calc_tax</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">tax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">35000</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tax</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">);</span>
        <span class="n">x</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">15000</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tax</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">);</span>
        <span class="n">x</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">5000</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tax</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mf">0.10</span><span class="p">);</span>
        <span class="n">x</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">tax</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">tvarps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tvarps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"your income tax is "</span> <span class="o">&lt;&lt;</span> <span class="n">calc_tax</span><span class="p">(</span><span class="n">tvarps</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">" tvarps.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input how many tvarps of your income: "</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">tvarps</span><span class="p">);</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>8．编写一个程序，它打开一个文件文件，逐个字符地读取该文件，直到到达文件末尾，然后指出该文件中包含多少个字符。</p>
<p>xiti_c6_8.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="n">string</span> <span class="n">filename</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input the filename you want to open: "</span><span class="p">;</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">filename</span><span class="p">;</span>

    <span class="n">ifstream</span> <span class="n">inFile</span><span class="p">;</span>

    <span class="n">inFile</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
    <span class="c1">// check the file is open</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">inFile</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Could not open the file "</span> <span class="o">&lt;&lt;</span> <span class="n">filename</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">inFile</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"This file contains "</span> <span class="o">&lt;&lt;</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="s">" characters.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="n">inFile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2 id="_8">函数</h2>
<p>我估计这块应该C++和C语言差异也不会太大，主要做一些习题练习下。</p>
<h3 id="_9">数组作为函数的参数</h3>
<p>数组作为函数的参数实际传递的是该数组的首地址，但C++还需要知道这个数组内元素的类型，所以你在函数原型声明的时候应该类似这样进行声明： <code>int sum_arr(int * arr, int n)</code> ，或者 <code>int sum_arr(int arr[], int n)</code> ，这两种写法在函数原型声明上是没有区别的，告诉C++编译器该数组内的元素类型就完成任务了。如果函数不应该修改数组里面的内容，那么应该在声明前面加上 <code>const</code> 关键字。</p>
<p>可以通过下面这个例子来加深对数组作为函数的参数的理解：</p>
<p>arrfun.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">Max</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">fill_array</span><span class="p">(</span><span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">limit</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">show_array</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">revalue</span><span class="p">(</span><span class="kt">double</span> <span class="n">r</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">double</span> <span class="nf">sum_array</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span> <span class="n">ar_begin</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span><span class="o">*</span> <span class="n">ar_end</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">properties</span><span class="p">[</span><span class="n">Max</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fill_array</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">Max</span><span class="p">);</span>

    <span class="n">show_array</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter revaluation factor: "</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">factor</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">factor</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bad input; Please enter a number: "</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">revalue</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
        <span class="n">show_array</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

        <span class="kt">double</span> <span class="n">total</span><span class="p">;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">sum_array</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">properties</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"array total sum = "</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="s">" .</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">double</span> <span class="nf">sum_array</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span> <span class="n">ar_begin</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span><span class="o">*</span> <span class="n">ar_end</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">double</span><span class="o">*</span> <span class="n">pt</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">pt</span> <span class="o">=</span> <span class="n">ar_begin</span><span class="p">;</span> <span class="n">pt</span> <span class="o">!=</span> <span class="n">ar_end</span><span class="p">;</span> <span class="n">pt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="o">*</span><span class="n">pt</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">total</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">fill_array</span><span class="p">(</span><span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">limit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">temp</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter value #"</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">temp</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cin</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bad input; input process terminated.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="n">ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="nf">show_array</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Property #"</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">": $"</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">revalue</span><span class="p">(</span><span class="kt">double</span> <span class="n">r</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">r</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>这个例子演示了基本的数组作为函数参数的使用方法，演示了const的使用，还演示了第二种数组作为函数参数的写法，具体请看sum_array函数，其接受的是数组的首地址和末地址，你可以通过 <code>sum_array(properties, properties + size);</code> 这种写法来传入数组的长度，或者随意计算数组前面几个元素的和都是可以的。</p>
<h3 id="c">C风格字符串作为函数的参数</h3>
<p>本质上C风格字符串属于字符数组，只是里面有个<code>\0</code>来标记字符串的结尾。具体使用参考上面的数组的讨论。</p>
<h3 id="_10">结构体作为函数的参数</h3>
<p>结构体其实更加简单，其使用基本上可以看作某种额外的基本数据类型，你可以传值，也可以传指针，只是如果结构体比较大的话，还是推荐传指针。</p>
<p>关于C++新增的类的概念，比如string类，array类等，这些作为函数的参数大体可以参考结构体的使用，也就是可以看作某种额外的基本数据类型。关于类的使用后面会有更详细的讨论了。</p>
<h3 id="_11">函数作为函数的参数</h3>
<p>函数名就是函数的地址，你可以直接将函数名作为参数传递进去，不过麻烦在这个函数指针的类型声明上：</p>
<div class="highlight"><pre><span></span>void estimate(int repeat, double(*pf)(int));
</pre></div>
<p>声明的这个pf就是指针那个目标函数的指针，只是因为声明的时候要带上指向函数的类型声明，有的时候语句会很长。</p>
<p>可以利用typedef进行简化：</p>
<div class="highlight"><pre><span></span>typedef double(*test_func_type)(int);
</pre></div>
<p>具体请看下面的样例来加深理解：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">typedef</span> <span class="nf">double</span><span class="p">(</span><span class="o">*</span><span class="n">test_func_type</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">estimate</span><span class="p">(</span><span class="kt">int</span> <span class="p">,</span> <span class="n">test_func_type</span><span class="p">);</span>
<span class="kt">double</span> <span class="nf">test_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">);</span>


<span class="kt">double</span> <span class="nf">test_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">3.14</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">" * 3.14 = "</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">estimate</span><span class="p">(</span><span class="kt">int</span> <span class="n">repeat</span><span class="p">,</span> <span class="n">test_func_type</span> <span class="n">pf</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">repeat</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="o">*</span><span class="n">pf</span><span class="p">)(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">estimate</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">test_func</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>1．编写一个程序，不断要求用户输入两个数，直到其中的一个为0。对于每两个数，程序将使用一个函数来计算它们的调和平均数，并将结果返回给main( )，而后者将报告结果。调和平均数指的是倒数平均值的倒数，计算公式如下：</p>
<p>调和平均数=2.0 * x * y / (x + y)</p>
<p>xiti_c7_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cctype&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">double</span> <span class="nf">calc_harmonic_mean</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>

<span class="kt">double</span> <span class="nf">calc_harmonic_mean</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">result</span><span class="p">;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">f1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">f2</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">result</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input two number:"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">f1</span> <span class="o">&gt;&gt;</span> <span class="n">f2</span><span class="p">))</span> <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">input_line_right</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">isblank</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
                    <span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
                    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bad input!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
                    <span class="n">input_line_right</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">input_line_right</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">f1</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">f2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">calc_harmonic_mean</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">);</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">f1</span> <span class="o">&lt;&lt;</span> <span class="s">" and "</span> <span class="o">&lt;&lt;</span> <span class="n">f2</span> <span class="o">&lt;&lt;</span> <span class="s">" harmonic mean is: "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bad input!"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>3．下面是一个结构声明：</p>
<div class="highlight"><pre><span></span>struct box{
    char maker[40];
    float height;
    float width;
    float length;
    float volume;
};
</pre></div>
<p>a．编写一个函数，按值传递box结构，并显示每个成员的值。</p>
<p>b．编写一个函数，传递box结构的地址，并将volume成员设置为其他三维长度的乘积。</p>
<p>c．编写一个使用这两个函数的简单程序。</p>
<p>xiti_c7_3.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">box</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">maker</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">height</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">length</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">volume</span><span class="p">;</span>
<span class="p">}</span><span class="n">Box</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">show_box</span><span class="p">(</span><span class="n">Box</span> <span class="n">box1</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">calc_box_volume</span><span class="p">(</span><span class="n">Box</span><span class="o">*</span> <span class="n">pbox</span><span class="p">);</span>



<span class="kt">void</span> <span class="nf">show_box</span><span class="p">(</span><span class="n">Box</span> <span class="n">box1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> 
        <span class="s">"box: "</span> <span class="o">&lt;&lt;</span> <span class="n">box1</span><span class="p">.</span><span class="n">maker</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span>
        <span class="s">"height: "</span> <span class="o">&lt;&lt;</span> <span class="n">box1</span><span class="p">.</span><span class="n">height</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span>
        <span class="s">"width: "</span> <span class="o">&lt;&lt;</span> <span class="n">box1</span><span class="p">.</span><span class="n">width</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span>
        <span class="s">"length: "</span> <span class="o">&lt;&lt;</span> <span class="n">box1</span><span class="p">.</span><span class="n">length</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span>
        <span class="s">"volume: "</span> <span class="o">&lt;&lt;</span> <span class="n">box1</span><span class="p">.</span><span class="n">volume</span>
        <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">calc_box_volume</span><span class="p">(</span><span class="n">Box</span><span class="o">*</span> <span class="n">pbox</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pbox</span><span class="o">-&gt;</span><span class="n">volume</span> <span class="o">=</span> <span class="n">pbox</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">*</span> <span class="n">pbox</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">*</span> <span class="n">pbox</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//int main33() {</span>

    <span class="n">Box</span> <span class="n">box1</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"box1"</span><span class="p">,</span>
        <span class="mf">2.5</span><span class="p">,</span>
        <span class="mf">3.6</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">,</span>
        <span class="mi">0</span>
    <span class="p">};</span>

    <span class="n">show_box</span><span class="p">(</span><span class="n">box1</span><span class="p">);</span>

    <span class="n">calc_box_volume</span><span class="p">(</span><span class="o">&amp;</span><span class="n">box1</span><span class="p">);</span>

    <span class="n">show_box</span><span class="p">(</span><span class="n">box1</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>5．定义一个递归函数，接受一个整数参数，并返回该参数的阶乘。前面讲过，3的阶乘写作3!，等于<code>3*2!</code>，依此类推；而0!被定义为1。通用的计算公式是，如果n大于零，则<code>n!=n*（n−1）!</code>。在程序中对该函数进行测试，程序使用循环让用户输入不同的值，程序将报告这些值的阶乘。</p>
<p>xiti_c7_5.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">factorial</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>


<span class="kt">int</span> <span class="nf">factorial</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">factorial</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//int main34() {</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input one integer number:"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">))</span> <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">input_line_right</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">isblank</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="p">{</span>
                    <span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
                    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bad input!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
                    <span class="n">input_line_right</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">input_line_right</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" factorial is: "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bad input!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>9．这个练习让您编写处理数组和结构的函数。下面是程序的框架，请提供其中描述的函数，以完成该程序。</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">SLEN</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">student</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">fullname</span><span class="p">[</span><span class="n">SLEN</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">hobby</span><span class="p">[</span><span class="n">SLEN</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">ooplevel</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// getinfo has two arguments: a pointer to the first argument of</span>
<span class="c1">// an array of student structures and an int representing the</span>
<span class="c1">// number of elements of the array. the function solicits and</span>
<span class="c1">// stores data about students. It terminates input upon filling </span>
<span class="c1">// the array or upon encountering a blank line for the student </span>
<span class="c1">// name. the function returns the actual number of array elements </span>
<span class="c1">// filled.</span>
<span class="kt">int</span> <span class="nf">getinfo</span><span class="p">(</span><span class="n">student</span> <span class="n">pa</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="c1">// display1 takes a student structure as an argument</span>
<span class="c1">// and display its contents.</span>
<span class="kt">void</span> <span class="nf">display1</span><span class="p">(</span><span class="n">student</span> <span class="n">st</span><span class="p">);</span>

<span class="c1">// display2 takes the address of students structure as an </span>
<span class="c1">// argument and display the structure's cntents.</span>
<span class="kt">void</span> <span class="nf">display2</span><span class="p">(</span><span class="k">const</span> <span class="n">student</span><span class="o">*</span> <span class="n">ps</span><span class="p">);</span>

<span class="c1">// display3 takes the address of the first element of an array</span>
<span class="c1">// of student structures and the number of array elements as </span>
<span class="c1">// arguments and displays the contents of the structures</span>
<span class="kt">void</span> <span class="nf">display3</span><span class="p">(</span><span class="k">const</span> <span class="n">student</span> <span class="n">pa</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//int main35() {</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter class size: "</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">class_size</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">class_size</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="n">student</span><span class="o">*</span> <span class="n">ptr_stu</span> <span class="o">=</span> <span class="k">new</span> <span class="n">student</span><span class="p">[</span><span class="n">class_size</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">entered</span> <span class="o">=</span> <span class="n">getinfo</span><span class="p">(</span><span class="n">ptr_stu</span><span class="p">,</span> <span class="n">class_size</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">entered</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">display1</span><span class="p">(</span><span class="n">ptr_stu</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">display2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptr_stu</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">display3</span><span class="p">(</span><span class="n">ptr_stu</span><span class="p">,</span> <span class="n">entered</span><span class="p">);</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">ptr_stu</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Done</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c7_9.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">SLEN</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">student</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">fullname</span><span class="p">[</span><span class="n">SLEN</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">hobby</span><span class="p">[</span><span class="n">SLEN</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">ooplevel</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">getinfo</span><span class="p">(</span><span class="n">student</span> <span class="n">pa</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">display1</span><span class="p">(</span><span class="n">student</span> <span class="n">st</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">display2</span><span class="p">(</span><span class="k">const</span> <span class="n">student</span><span class="o">*</span> <span class="n">ps</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">display3</span><span class="p">(</span><span class="k">const</span> <span class="n">student</span> <span class="n">pa</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">getinfo</span><span class="p">(</span><span class="n">student</span> <span class="n">pa</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">entered</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input student fullname: "</span><span class="p">;</span>
        <span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fullname</span><span class="p">,</span> <span class="n">SLEN</span><span class="p">);</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input student hobby: "</span><span class="p">;</span>
        <span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">hobby</span><span class="p">,</span> <span class="n">SLEN</span><span class="p">);</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input student ooplevel: "</span><span class="p">;</span>
        <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">pa</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ooplevel</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

        <span class="n">entered</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">entered</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">display1</span><span class="p">(</span><span class="n">student</span> <span class="n">st</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span><span class="s">"student "</span> <span class="o">&lt;&lt;</span> <span class="n">st</span><span class="p">.</span><span class="n">fullname</span> <span class="o">&lt;&lt;</span>
        <span class="s">" hobby: "</span> <span class="o">&lt;&lt;</span> <span class="n">st</span><span class="p">.</span><span class="n">hobby</span> <span class="o">&lt;&lt;</span>
        <span class="s">" ooplevel: "</span> <span class="o">&lt;&lt;</span> <span class="n">st</span><span class="p">.</span><span class="n">ooplevel</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">display2</span><span class="p">(</span><span class="k">const</span> <span class="n">student</span><span class="o">*</span> <span class="n">ps</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span><span class="s">"student "</span> <span class="o">&lt;&lt;</span> <span class="n">ps</span><span class="o">-&gt;</span><span class="n">fullname</span> <span class="o">&lt;&lt;</span>
        <span class="s">" hobby: "</span> <span class="o">&lt;&lt;</span> <span class="n">ps</span><span class="o">-&gt;</span><span class="n">hobby</span> <span class="o">&lt;&lt;</span>
        <span class="s">" ooplevel: "</span> <span class="o">&lt;&lt;</span> <span class="n">ps</span><span class="o">-&gt;</span><span class="n">ooplevel</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">display3</span><span class="p">(</span><span class="k">const</span> <span class="n">student</span> <span class="n">pa</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">display1</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//int main35() {</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter class size: "</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">class_size</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">class_size</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="n">student</span><span class="o">*</span> <span class="n">ptr_stu</span> <span class="o">=</span> <span class="k">new</span> <span class="n">student</span><span class="p">[</span><span class="n">class_size</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">entered</span> <span class="o">=</span> <span class="n">getinfo</span><span class="p">(</span><span class="n">ptr_stu</span><span class="p">,</span> <span class="n">class_size</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">entered</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">display1</span><span class="p">(</span><span class="n">ptr_stu</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">display2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptr_stu</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">display3</span><span class="p">(</span><span class="n">ptr_stu</span><span class="p">,</span> <span class="n">entered</span><span class="p">);</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">ptr_stu</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Done</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>10．设计一个名为calculate( )的函数，它接受两个double值和一个指向函数的指针，而被指向的函数接受两个double参数，并返回一个double值。calculate( )函数的类型也是double，并返回被指向的函数使用calculate( )的两个double参数计算得到的值。例如，假设add( )函数的定义如下：</p>
<div class="highlight"><pre><span></span>double add(double x, double y){
    return x + y;
}
</pre></div>
<p>则下述代码中的函数调用将导致calculate( )把2.5和10.4传递给add( )函数，并返回add( )的返回值（12.9）：</p>
<div class="highlight"><pre><span></span>double q = calculate(2.5, 10.4, add)
</pre></div>
<p>请编写一个程序，它调用上述两个函数和至少另一个与add( )类似的函数。该程序使用循环来让用户成对地输入数字。对于每对数字，程序都使用calculate( )来调用add( )和至少一个其他的函数。如果读者爱冒险，可以尝试创建一个指针数组，其中的指针指向add( )样式的函数，并编写一个循环，使用这些指针连续让calculate( )调用这些函数。提示：下面是声明这种指针数组的方式，其中包含三个指针：</p>
<div class="highlight"><pre><span></span>double (*pf[3])(double, double);
</pre></div>
<p>可以采用数组初始化语法，并将函数名作为地址来初始化这样的数组。</p>
<p>xiti_c7_10.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">typedef</span> <span class="nf">double</span> <span class="p">(</span><span class="o">*</span><span class="n">func_call</span><span class="p">)(</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>

<span class="kt">double</span> <span class="nf">addition</span><span class="p">(</span><span class="kt">double</span> <span class="p">,</span> <span class="kt">double</span> <span class="p">);</span>
<span class="kt">double</span> <span class="nf">subtraction</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>
<span class="kt">double</span> <span class="nf">multiplication</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>

<span class="kt">double</span> <span class="nf">calculate</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">,</span> <span class="n">func_call</span> <span class="n">func</span><span class="p">);</span>

<span class="kt">double</span> <span class="nf">calculate</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">,</span> <span class="n">func_call</span> <span class="n">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="nf">addition</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"running addition...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="nf">subtraction</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"running subtraction...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="nf">multiplication</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"running multiplication...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="p">(</span><span class="o">*</span><span class="n">pf</span><span class="p">[</span><span class="mi">3</span><span class="p">])(</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">);</span>

    <span class="n">pf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">addition</span><span class="p">;</span>
    <span class="n">pf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtraction</span><span class="p">;</span>
    <span class="n">pf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplication</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">i</span> <span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">})</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">q</span> <span class="o">=</span> <span class="n">calculate</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">10.4</span><span class="p">,</span> <span class="n">pf</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"result: "</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2 id="_12">函数补充</h2>
<p>接下来的内容多是C++特有的内容了。</p>
<h3 id="_13">内联函数</h3>
<p>内联函数和普通函数的区别就是在函数定义或声明的时候加上关键字 <code>inline</code> ，具体实现上的区别就是普通函数编译出来的代码函数有一个跳转执行的过程，而内联函数的代码与调用该函数的代码是内联在一起的，并没有这个跳转动作。</p>
<p>可以把内联函数比作C语言中的宏定义的函数，比如C++的：</p>
<div class="highlight"><pre><span></span><span class="kr">inline</span> <span class="kt">double</span> <span class="nf">square</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">){</span><span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">};</span>
</pre></div>
<p>可以比作C语言的：</p>
<div class="highlight"><pre><span></span><span class="cp">#define SQUARE(X) ((X)*(X)) </span>
</pre></div>
<h3 id="_14">引用变量</h3>
<p>引用变量就程序员编程的角度出发可以将其看作某个函数的别名，比如：</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="o">&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
</pre></div>
<p>这样上面变量名a和b指向的都是同一块内存空间。</p>
<ol>
<li>引用变量是对某个变量的引用，所以初始化就必须赋值。</li>
<li>引用变量作为函数的参数，在该函数里面使用引用变量等于直接使用传递过来的那个变量。也就是任何操作都等于直接对原数据进行操作。</li>
<li>引用变量从实现上可以看作取了赋值变量的地址，然后使用的时候默认自动进行解引用 <code>*</code> 操作。但这个了解下即可，C++很多地方都在弱化指针这个概念，C++程序员也没必要继续C程序的老一套思维，什么都往指针上靠。对于数组是只能使用指针，对于结构体或类，是能够用引用变量这个概念就用引用变量，没必要使用指针，毕竟指针不是很安全。</li>
</ol>
<p>引用变量在函数参数上最经典的一个例子就是swap函数：</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">temp</span><span class="p">;</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>具体使用也只需要简单传递变量名即可：</p>
<div class="highlight"><pre><span></span>    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
</pre></div>
<p>引用变量用于结构体和类大体逻辑可以参考上面的讨论，值得一提的是返回结构体和类采用相关的返回引用变量的形式将是高效的，不像传统返回值还需要额外的拷贝动作。</p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">free_throws</span><span class="p">{</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">made</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">free_throws</span> <span class="o">&amp;</span> <span class="n">accumulate</span><span class="p">(</span><span class="n">free_throws</span> <span class="o">&amp;</span> <span class="n">target</span><span class="p">,</span> <span class="k">const</span> <span class="n">free_throws</span> <span class="o">&amp;</span> <span class="n">source</span><span class="p">){</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="n">target</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h3 id="_15">默认参数</h3>
<p>方法就是在函数原型声明的时候如下给定默认参数，具体函数定义实现那里不用变。</p>
<div class="highlight"><pre><span></span>int harpo(int n, int m=4, int j = 5);
</pre></div>
<h3 id="_16">函数重载</h3>
<p>函数重载或函数多态具体来说就是几个函数拥有相同的函数名，不同的参数数目或类型，C++编译器会匹配合适的对应的那个函数。在匹配过程中不会考虑 <code>const</code> 关键字。这种匹配是基于函数的原型声明，不会考虑具体形参的名字。这种匹配不会考虑具体函数的返回类型。</p>
<h3 id="_17">函数模板</h3>
<p>C++的函数模板运行你以一种泛型的概念来编写函数：</p>
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">AnyType</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">AnyType</span> <span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">AnyType</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">){</span>
    <span class="n">AnyType</span> <span class="n">temp</span><span class="p">;</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>模板函数同样也存在重载。这里情况会稍微有点复杂，以C++98标准来说，具体化类型版本是优先于模板版本的：</p>
<div class="highlight"><pre><span></span>template &lt;&gt; void swap(job &amp;, job &amp;);

template &lt;typename T&gt;
void swap(T &amp;, T &amp;);
</pre></div>
<p>但这块里面东西还有很多，暂时略过了，有时间可以了解下，感觉这个东西就和运算符优先级问题一样，实在不行加个括号，这里也是实在不行改个函数名就是了。</p>
<p>1．编写通常接受一个参数（字符串的地址），并打印该字符串的函数。然而，如果提供了第二个参数（int类型），且该参数不为0，则该函数打印字符串的次数将为该函数被调用的次数（注意，字符串的打印次数不等于第二个参数的值，而等于函数被调用的次数）。是的，这是一个非常可笑的函数，但它让您能够使用本章介绍的一些技术。在一个简单的程序中使用该函数，以演示该函数是如何工作的。</p>
<p>xiti_c8_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">print_string</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">print_string</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span> <span class="p">);</span>


<span class="kt">void</span> <span class="nf">print_string</span><span class="p">(</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">print_string</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//int main37() {</span>

    <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"abc"</span><span class="p">;</span>

    <span class="n">print_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>2．CandyBar结构包含3个成员。第一个成员存储candy bar的品牌名称；第二个成员存储candy bar的重量（可能有小数）；第三个成员存储candy bar的热量（整数）。请编写一个程序，它使用一个这样的函数，即将CandyBar的引用、char指针、double和int作为参数，并用最后3个值设置相应的结构成员。最后3个参数的默认值分别为“Millennium Munch”、2.85和350。另外，该程序还包含一个以CandyBar的引用为参数，并显示结构内容的函数。请尽可能使用const。</p>
<p>xiti_c8_2.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">SLEN</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">CandyBar</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="n">SLEN</span><span class="p">];</span>
    <span class="kt">double</span> <span class="n">weight</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">calories</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">CandyBar</span><span class="o">&amp;</span> <span class="n">init_CandyBar</span><span class="p">(</span><span class="n">CandyBar</span><span class="o">&amp;</span> <span class="n">candybar</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">name</span><span class="o">=</span><span class="s">"Millennium Munch"</span><span class="p">,</span> <span class="kt">double</span> <span class="n">weight</span><span class="o">=</span><span class="mf">2.85</span><span class="p">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">=</span><span class="mi">350</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">print_CandyBar</span><span class="p">(</span><span class="k">const</span> <span class="n">CandyBar</span><span class="o">&amp;</span> <span class="n">candybar</span><span class="p">);</span>


<span class="n">CandyBar</span><span class="o">&amp;</span> <span class="n">init_CandyBar</span><span class="p">(</span><span class="n">CandyBar</span><span class="o">&amp;</span> <span class="n">candybar</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">double</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">candybar</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">SLEN</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="n">candybar</span><span class="p">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="p">;</span>
    <span class="n">candybar</span><span class="p">.</span><span class="n">calories</span> <span class="o">=</span> <span class="n">calories</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">candybar</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">print_CandyBar</span><span class="p">(</span><span class="k">const</span> <span class="n">CandyBar</span><span class="o">&amp;</span> <span class="n">candybar</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"candybar name: "</span> <span class="o">&lt;&lt;</span> <span class="n">candybar</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span>
        <span class="s">" weight: "</span> <span class="o">&lt;&lt;</span> <span class="n">candybar</span><span class="p">.</span><span class="n">weight</span> <span class="o">&lt;&lt;</span> <span class="s">" calories: "</span> <span class="o">&lt;&lt;</span> <span class="n">candybar</span><span class="p">.</span><span class="n">calories</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//int main38() {</span>

    <span class="n">CandyBar</span> <span class="n">candybar</span><span class="p">;</span>

    <span class="n">init_CandyBar</span><span class="p">(</span><span class="n">candybar</span><span class="p">);</span>

    <span class="n">print_CandyBar</span><span class="p">(</span><span class="n">candybar</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>因为是指明要用char指针，所以才这样实现，如果用string的话会简单很多。</p>
<p>5．编写模板函数max5( )，它将一个包含5个T类型元素的数组作为参数，并返回数组中最大的元素（由于长度固定，因此可以在循环中使用硬编码，而不必通过参数来传递）。在一个程序中使用该函数，将T替换为一个包含5个int值的数组和一个包含5个dowble值的数组，以测试该函数。</p>
<p>xiti_c8_5.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">T</span> <span class="n">max5</span><span class="p">(</span><span class="n">T</span> <span class="n">arr</span><span class="p">[]);</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">T</span> <span class="n">max5</span><span class="p">(</span><span class="n">T</span> <span class="n">arr</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">T</span> <span class="n">max</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">max</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">arr1</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">45</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span> <span class="p">};</span>
    <span class="kt">int</span> <span class="n">max1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="n">max5</span><span class="p">(</span><span class="n">arr1</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">max1</span> <span class="o">==</span> <span class="mi">54</span><span class="p">);</span>


    <span class="kt">double</span> <span class="n">arr2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">5.58</span><span class="p">,</span><span class="mf">6.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.14</span><span class="p">,</span><span class="mf">1.25</span> <span class="p">};</span>
    <span class="kt">double</span> <span class="n">max2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">max2</span> <span class="o">=</span> <span class="n">max5</span><span class="p">(</span><span class="n">arr2</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">max2</span> <span class="o">==</span> <span class="mf">6.5</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>这题还是很简单的，就是基本的模板函数用法，我们继续看下面这题。</p>
<p>6．编写模板函数maxn( )，它将由一个T类型元素组成的数组和一个表示数组元素数目的整数作为参数，并返回数组中最大的元素。在程序对它进行测试，该程序使用一个包含6个int元素的数组和一个包含4个double元素的数组来调用该函数。程序还包含一个具体化，它将char指针数组和数组中的指针数量作为参数，并返回最长的字符串的地址。如果有多个这样的字符串，则返回其中第一个字符串的地址。使用由5个字符串指针组成的数组来测试该具体化。</p>
<p>xiti_c8_6.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">T</span> <span class="n">maxn</span><span class="p">(</span><span class="n">T</span> <span class="n">arr</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="kt">char</span><span class="o">*</span> <span class="n">maxn</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">arr</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">T</span> <span class="n">maxn</span><span class="p">(</span><span class="n">T</span> <span class="n">arr</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">T</span> <span class="n">max</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">max</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;&gt;</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">maxn</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">max</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">max</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">max</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//int main40() {</span>

    <span class="kt">int</span> <span class="n">arr1</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span> <span class="p">};</span>
    <span class="kt">int</span> <span class="n">max1</span><span class="p">;</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="n">maxn</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">max1</span> <span class="o">==</span> <span class="mi">54</span><span class="p">);</span>


    <span class="kt">double</span> <span class="n">arr2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">5.58</span><span class="p">,</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">3.14</span><span class="p">,</span><span class="mf">1.25</span> <span class="p">};</span>
    <span class="kt">double</span> <span class="n">max2</span><span class="p">;</span>
    <span class="n">max2</span> <span class="o">=</span> <span class="n">maxn</span><span class="p">(</span><span class="n">arr2</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">max2</span> <span class="o">==</span> <span class="mf">6.5</span><span class="p">);</span>

    <span class="kt">char</span> <span class="n">s1</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"abc"</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">s2</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"abc def"</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">s3</span><span class="p">[]</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">s4</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"hello world."</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">s5</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"a"</span><span class="p">;</span>

    <span class="kt">char</span><span class="o">*</span> <span class="n">arr3</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">s3</span><span class="p">,</span><span class="n">s4</span><span class="p">,</span><span class="n">s5</span> <span class="p">};</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">max3</span><span class="p">;</span>
    <span class="n">max3</span> <span class="o">=</span> <span class="n">maxn</span><span class="p">(</span><span class="n">arr3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">max3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>函数模板的显示具体化具体函数部分编写和常规函数相比就是多了 <code>template &lt;&gt;</code> 这个东西，然后注意原型声明上有这样的顺序：</p>
<ol>
<li>一般常规函数</li>
<li>模板函数</li>
<li>模板函数具体化</li>
</ol>
<p>然后具体重载顺序C++98给定的顺序是一般常规函数最优先，模板函数具体化优先于模板函数。</p>
<h2 id="_18">内存模型和名称空间</h2>
<p>头文件常包含的内容：</p>
<ul>
<li>函数原型</li>
<li>使用<code>#define</code> 或const定义的符号常量</li>
<li>结构声明</li>
<li>类声明</li>
<li>模板声明</li>
<li>内联函数</li>
</ul>
<p>关于多文件编译相关知识在之前的C语言学习中已经讨论过了，这块并没有什么区别。</p>
<h3 id="_19">内存模型</h3>
<p>所谓内存模型实际上就是在讨论C++语言的变量内存生存期问题。变量的作用域和生存期是两个问题，要正常访问一个变量首先当然这个变量应该是存在的，也就是这个变量是在生存期的，其次就是这个变量是可访问的，也就是当前变量代码所在是处于该变量的作用域的。</p>
<p>C++和C语言在变量的作用域问题上其实和其他大多数编程语言差别都不大，只是你有时可能会遇到一些奇怪的术语，但程序员都懂的，可以简单把C++或C语言理解为花括号分区块的块作用域语言。</p>
<p>C++和C语言和其他高级编程语言可能多了一个变量内存生存期问题。其他高级编程语言变量生存期可能都是由程序自动管理的，这个在C++或C语言里面对应的叫做自动存储变量。继而C语言引入了 <code>static</code>  关键字和静态存储变量这个概念，简单来说静态存储变量在整个程序运行期都是存活的【再一次强调变量存活和可访问是两回事，你在一个文件里面声明的全局静态变量在其他文件是不可以访问的，继而C语言提出了文件作用域的概念，但个人觉得没必要再增加一个额外的作用域的概念，这个情况只是因为静态变量要正常访问还需要编译器链接的时候做一些额外的动作，具体就是其他文件使用extern声明。原则上其他文件使用某个文件上定义的变量，不管是静态变量还是自动变量都应该使用extern关键字声明一下变量，只是说静态变量的情况是一定要声明，否则用不了，而自动变量的情况是你不声明就可以直接用，声明了反而会报错。】。</p>
<p>C++再继而又提出了一个内存存储类型，这个之前在介绍 <code>new</code> 关键字的时候讨论过，叫做动态存储。具体就是new和delete运算符管理的内存池和静态变量和自动变量的内存池是分开的，其叫做自由存储空间或堆。</p>
<p>此外C++还提出了一种线程存储类型，具体是 <code>thread_local</code> 关键字引入进来，这个本文应该会较少讨论。</p>
<p>关于这块如果C语言相关知识和前面关于new关键字的讨论部分真的学懂了的话，那么本小节内容大概了解下即可。</p>
<h3 id="_20">名称空间</h3>
<p>C++的名称空间这个概念并不难理解，其相当于给名称空间内的变量的名字加上了某个名称前缀。</p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">Jack</span><span class="p">{</span>
    <span class="kt">void</span> <span class="n">fetch</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="n">Jill</span><span class="p">{</span>
    <span class="kt">void</span> <span class="n">fetch</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
<p>具体使用就是 <code>Jill::fetch()</code> 这种格式。</p>
<p>如果你使用了 <code>using Jill::fetch;</code> ，则后面可以直接使用 <code>fetch</code> 来代替 <code>Jill:fetch</code> 。这个用专业术语叫做using声明。</p>
<p><code>using namespace Jill</code> 这种写法我们早就看到过了，就是把Jill名称空间下的变量名都引入进来。这个用专业术语叫做using编译。</p>
<p>using声明是不能导入相同的名字，而使用using编译，则情况有些例外。具体要看你使用using编译在那里，比如下面这种情况：</p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">Jill</span><span class="p">{</span>
    <span class="kt">void</span> <span class="n">fetch</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="n">fetch</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">Jill</span><span class="p">;</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p>using编译这时引入叫做引入了局部名称空间，说的再直白点就是这里引入的Jill名称空间里面的变量都在main函数里面，是main函数里面的局部变量。你在main函数里面说我要使用fetch则就是对应的 <code>Jill::fetch</code> ，但全部变量或者说全部名称空间的那个fetch还是可以访问的，具体要采用这样的形式： <code>::fetch</code> 。</p>
<p>一般是推荐使用using声明，using编译只是为了方便。名称空间只是方便大型项目的管理工作的，一般小项目小程序用using编译是没什么问题的。</p>
<p>命名空间可以如下嵌套：</p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">abc</span><span class="p">{</span>
    <span class="k">namespace</span> <span class="n">def</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>上面<code>int i</code> 的引用完整表达是： <code>abc::def::i</code>  。</p>
<p>未命名的命名空间：</p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">ice</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>未命名的命名空间有点像外面的全局变量一样可以<code>::ice</code> 来引用，但区别在于其不能使用using语句，也就是这里面的变量只是本文件可见的。</p>
<p>命令空间的样例程序请参看 test_namesp.cpp 和 namesp.h 和namesp.cpp这三个文件。</p>
<p>1．下面是一个头文件：</p>
<div class="highlight"><pre><span></span><span class="c1">//golf.h</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">Len</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">golf</span><span class="p">{</span>
    <span class="kt">char</span> <span class="n">fullname</span><span class="p">[</span><span class="n">Len</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">handicap</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// non-interactive version:</span>
<span class="c1">// function sets golf structure to provided name, handicap </span>
<span class="c1">// using values passed as arguments to the function</span>
<span class="kt">void</span> <span class="nf">setgolf</span><span class="p">(</span><span class="n">golf</span> <span class="o">&amp;</span> <span class="n">g</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hc</span><span class="p">);</span>

<span class="c1">// interactive version:</span>
<span class="c1">// function solicits name and handicap from user</span>
<span class="c1">// and sets the members of g to the values entered</span>
<span class="c1">// returns 1 if name is entered, 0 if name is empty string</span>
<span class="kt">int</span> <span class="nf">setgolf</span><span class="p">(</span><span class="n">golf</span> <span class="o">&amp;</span> <span class="n">g</span><span class="p">);</span>

<span class="c1">// function resets handicap to new value</span>
<span class="kt">void</span> <span class="nf">handicap</span><span class="p">(</span><span class="n">golf</span> <span class="o">&amp;</span> <span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hc</span><span class="p">);</span>

<span class="c1">// function displays contents of golf structure</span>
<span class="kt">void</span> <span class="nf">showgolf</span><span class="p">(</span><span class="k">const</span> <span class="n">golf</span> <span class="o">&amp;</span> <span class="n">g</span><span class="p">);</span>
</pre></div>
<p>注意到setgolf( )被重载，可以这样使用其第一个版本：</p>
<div class="highlight"><pre><span></span>golf ann;
setgolf(ann, "Ann Birdfree", 24);
</pre></div>
<p>上述函数调用提供了存储在ann结构中的信息。可以这样使用其第二个版本：</p>
<div class="highlight"><pre><span></span>golf ann;
setgolf(ann);
</pre></div>
<p>上述函数将提示用户输入姓名和等级，并将它们存储在andy结构中。这个函数可以（但是不一定必须）在内部使用第一个版本。</p>
<p>根据这个头文件，创建一个多文件程序。其中的一个文件名为golf.cpp，它提供了与头文件中的原型匹配的函数定义；另一个文件应包含main( )，并演示原型化函数的所有特性。例如，包含一个让用户输入的循环，并使用输入的数据来填充一个由golf结构组成的数组，数组被填满或用户将高尔夫选手的姓名设置为空字符串时，循环将结束。main( )函数只使用头文件中原型化的函数来访问golf结构。</p>
<p>golf.h大体类似上面定义的。</p>
<p>golf.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"golf.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">setgolf</span><span class="p">(</span><span class="n">golf</span><span class="o">&amp;</span> <span class="n">g</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hc</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="n">g</span><span class="p">.</span><span class="n">handicap</span> <span class="o">=</span> <span class="n">hc</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">setgolf</span><span class="p">(</span><span class="n">golf</span><span class="o">&amp;</span> <span class="n">g</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input name: "</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span> <span class="n">Len</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">fullname</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input handicap: "</span><span class="p">;</span>
    <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">g</span><span class="p">.</span><span class="n">handicap</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handicap</span><span class="p">(</span><span class="n">golf</span><span class="o">&amp;</span> <span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hc</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">g</span><span class="p">.</span><span class="n">handicap</span> <span class="o">=</span> <span class="n">hc</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">showgolf</span><span class="p">(</span><span class="k">const</span> <span class="n">golf</span><span class="o">&amp;</span> <span class="n">g</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">fullname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">fullname</span> <span class="o">&lt;&lt;</span> <span class="s">"'s handicap is: "</span> <span class="o">&lt;&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">handicap</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c9_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"golf.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ARR_MAX</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">golf</span> <span class="n">golf_arr</span><span class="p">[</span><span class="n">ARR_MAX</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARR_MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">setgolf</span><span class="p">(</span><span class="n">golf_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"bob sam"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">setgolf</span><span class="p">(</span><span class="n">golf_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="n">showgolf</span><span class="p">(</span><span class="n">golf_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test handicap function....</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">showgolf</span><span class="p">(</span><span class="n">golf_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">handicap</span><span class="p">(</span><span class="n">golf_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">18</span><span class="p">);</span>
    <span class="n">showgolf</span><span class="p">(</span><span class="n">golf_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本习题主要是要求读者掌握多文件C++的编写过程。</p>
<p>4．请基于下面这个名称空间编写一个由3个文件组成的程序：</p>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">SALES</span><span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">QUARTERS</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Sales</span><span class="p">{</span>
        <span class="kt">double</span> <span class="n">sales</span><span class="p">[</span><span class="n">QUARTERS</span><span class="p">];</span>
        <span class="kt">double</span> <span class="n">average</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">max</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">min</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="c1">// copies the lesser of 4 or n items from the array ar</span>
    <span class="c1">// to the sales member of s and computes and stores the </span>
    <span class="c1">// average, maximum, and minimum values of the entered items;</span>
    <span class="c1">// remaining elements of sales, if any, set to 0;</span>
    <span class="kt">void</span> <span class="nf">setSales</span><span class="p">(</span><span class="n">Sale</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
    <span class="c1">// gathers sales for 4 quarters interactively, stores them </span>
    <span class="c1">// in the sales member of s and computes and stores the</span>
    <span class="c1">// average, maximum, and minimum values.</span>
    <span class="kt">void</span> <span class="nf">setSales</span><span class="p">(</span><span class="n">Sale</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
    <span class="c1">// display all information in structure s</span>
    <span class="kt">void</span> <span class="nf">showSales</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>第一个文件是一个头文件，其中包含名称空间；第二个文件是一个源代码文件，它对这个名称空间进行扩展，以提供这三个函数的定义；第三个文件声明两个Sales对象，并使用setSales( )的交互式版本为一个结构提供值，然后使用setSales( )的非交互式版本为另一个结构提供值。另外它还使用showSales( )来显示这两个结构的内容。</p>
<p>sales.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"sales.h"</span><span class="cp"></span>


<span class="k">namespace</span> <span class="n">SALES</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">calcSales</span><span class="p">(</span><span class="n">Sales</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">max</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kt">double</span> <span class="n">min</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kt">double</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">average</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">min</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">max</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="p">}</span>

            <span class="n">sum</span> <span class="o">+=</span> <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">average</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>

        <span class="n">s</span><span class="p">.</span><span class="n">average</span> <span class="o">=</span> <span class="n">average</span><span class="p">;</span>
        <span class="n">s</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">max</span><span class="p">;</span>
        <span class="n">s</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">min</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kt">void</span> <span class="n">setSales</span><span class="p">(</span><span class="n">Sales</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">ar</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>


        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">n</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">calcSales</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">setSales</span><span class="p">(</span><span class="n">Sales</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input QUARTERS "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>  <span class="o">&lt;&lt;</span> <span class="s">" sales: "</span><span class="p">;</span>
            <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">get</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">calcSales</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">showSales</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"QUARTERS "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">" sales: "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">sales</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average: "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">average</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"maximum: "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">max</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"minimum: "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">min</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c9_4.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"sales.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="kt">double</span> <span class="n">ar</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">1.0</span><span class="p">,</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">5.6</span> <span class="p">};</span>

    <span class="k">using</span> <span class="n">SALES</span><span class="o">::</span><span class="n">Sales</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">SALES</span><span class="o">::</span><span class="n">setSales</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">SALES</span><span class="o">::</span><span class="n">showSales</span><span class="p">;</span>

    <span class="n">Sales</span> <span class="n">s</span><span class="p">;</span>

    <span class="n">setSales</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

    <span class="n">showSales</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>

    <span class="n">Sales</span> <span class="n">s2</span><span class="p">;</span>
    <span class="n">setSales</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>

    <span class="n">showSales</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本习题主要要求读者掌握名称空间的用法。</p>
<h2 id="_21">类</h2>
<p>下面进入C++语言区别C语言引入的最大特性，那就是类和相关面向对象编程的概念。本文假定读者已经熟悉一门高级编程语言比如python了，所以就面向对象编程相关概念不会做过多的讨论，预先假定读者已经对这一块很熟悉了。下面我们来看C++类是如何声明的：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Stock</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">company</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">shares</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">share_val</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">set_tot</span><span class="p">(){</span><span class="n">total_val</span> <span class="o">=</span> <span class="n">shares</span> <span class="o">*</span> <span class="n">share_val</span><span class="p">;}</span>

<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">acquire</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">co</span><span class="p">,</span> <span class="kt">long</span> <span class="n">n</span><span class="p">,</span> <span class="kt">double</span> <span class="n">pr</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>上面出现的一个新的概念就是 <code>private</code> 和 <code>public</code> 这两个区块定义了该类的私有变量和公有变量，私有变量是不可以直接访问的变量【这里所谓的变量也包括函数名】，而公有变量是该类可以直接访问的变量。在其他高级编程语言中也会出现类似的概念，只是一些语言不是强制要求，只是作为编程规范提及。这里需要提醒读者的是私有变量不光是出于安全方面的考虑，很多时候一些数据仅仅出于类和软件系统架构上的设计，出于便捷易用性也会考虑隐藏某些数据而只提供必要的接口给外界使用。</p>
<p>由于类的变量属性默认就是private，所以实际编程可以考虑不写这个private，只在公有变量部分声明public即可。</p>
<p>类方法的具体实现就是编写函数，只不过其函数名字要写成这样的形式：</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">Stock</span><span class="o">::</span><span class="n">acquire</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">co</span><span class="p">,</span> <span class="kt">long</span> <span class="n">n</span><span class="p">,</span> <span class="kt">double</span> <span class="n">pr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// your function</span>
<span class="p">}</span>
</pre></div>
<h3 id="_22">类作用域</h3>
<p>类里面定义的变量具体在C++里面作用域又新增一个概念，叫做类作用域，因为类的声明本身包含一个花括号区块，这个倒不是出人意料之外。你可以把类作用域看作另外一个花括号区块来理解其中的变量作用域关系，然后需要特别强调的是类作用域之内的变量是可以直接调用——这里强调的是类的成员函数里面是可以直接使用类里面的各个变量，因为C++的类的成员函数具体定义是在外面的分开的，所以这里强调下。</p>
<h3 id="_23">构造函数</h3>
<p>创建Stock对象在面向对象编程有专门的说法叫做创建Stock实例，如下所示：</p>
<div class="highlight"><pre><span></span><span class="n">Stock</span> <span class="n">sally</span><span class="p">;</span>
<span class="n">sally</span><span class="p">.</span><span class="n">hello</span><span class="p">();</span>
</pre></div>
<p>上面语句就是创建了一个Stock实例Sally，然后调用了sally内的hello方法。</p>
<p>读者从C语言学到这里可能觉得 <code>Stock sally</code> 有点类似于声明了一个结构体，没什么好奇怪的，但如果已经熟悉了面向对象编程的，听到这里说 <code>Stock sally</code> 这一句就创建了一个Stock实例内心就会生出一些困惑的。他会想因为类有时很复杂，实例化需要通过一个实例化初始函数来完成一些工作，他会想是不是有 <code>Stock()</code> 这个东西，他想的没有错。</p>
<p>C++在面向对象编程这块概念上和其他高级语言其实差别不大，C++的所有类的实例化同样要经过一个实例化函数，只是C++这边专业术语叫做构造函数，C++的类实例化都要调用这个构造函数的，如果你没有定义，那么将调用默认的构造函数。</p>
<p>比如上面的 <code>Stock sally</code> 其属于隐式调用默认构造函数，其等于 <code>Stock sally = Stock()</code> 。构造函数的定义如下：</p>
<div class="highlight"><pre><span></span><span class="n">Stock</span><span class="o">::</span><span class="n">Stock</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">co</span><span class="p">,</span> <span class="kt">long</span> <span class="n">n</span><span class="p">,</span> <span class="kt">double</span> <span class="n">pr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<p>此外C++还有一种隐式调用构造函数的形式：</p>
<div class="highlight"><pre><span></span>Stock sally(...)
</pre></div>
<p>其等于：</p>
<div class="highlight"><pre><span></span>Stock sally = Stock(...)
</pre></div>
<h3 id="_24">析构函数</h3>
<p>析构函数简单来说就是该对象即将过期时最后要调用的成员函数，其功能可以类比python类的 <code>__del__</code> 方法。析构函数的写法如下：</p>
<div class="highlight"><pre><span></span><span class="n">Stock</span><span class="o">::~</span><span class="n">Stock</span><span class="p">()</span>
<span class="p">{</span>
<span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<p>构造函数和析构函数同样如下在头文件中声明下：</p>
<div class="highlight"><pre><span></span>class Stock
{
 ....
 public:
    Stock();
    ~Stock();
    ...
}
</pre></div>
<h3 id="this">this指针</h3>
<p>C++这个this指针的概念可以类比python的<code>self</code> ，而且这个this参数在C++的类方法里面还是作为默认参数传递进去的，也就是直接用就是了，其代表的就是对本实例的一个<strong>指针</strong>。注意this是一个指针，其调用内部成员要使用 <code>this-&gt;a</code> 这样的语法。</p>
<p>关于返回 <code>*this</code> 有点让人困惑，请参看 <a href="https://stackoverflow.com/questions/2750316/this-vs-this-in-c">这个网页</a> ，其和方法或说成员函数的返回声明类型有关，如果是声明的 <code>Stock &amp;</code> 则 <code>*this</code> 是对本实例的引用，一个<strong>引用变量</strong> ；否则返回的是本对象的一个复制。</p>
<h3 id="const">const成员函数</h3>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Stack</span><span class="p">{</span>
    <span class="p">...</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">double</span> <span class="n">total</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>前面提到this指针，本实例作为参数是隐含传递进去了，如果希望该成员函数不修改调用对象也就是本实例的数据，则可以用上面的写法，成员函数后面跟一个const，具体术语叫做const成员函数，这样该const成员函数是不会修改本实例的数据的。</p>
<h3 id="_25">类内定义的数组长度是常量的情况</h3>
<p>如下类里面定义一个数组，其长度是一个常量，下面的写法是<strong>错误的</strong> 【参考资料1提到类里面定义常量都要使用enum或者static const形式我是存有疑问的，因为个人实践一般const设置的常量只要不是数组情况也是可以正常使用的。】。</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Stack</span><span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">MAX</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">costs</span><span class="p">[</span><span class="n">MAX</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
<p>这是因为类的声明还只是描述类的形式，还并没有实际进行实例化创建动作。而后面要进行这种创建动作的要找这个MAX的值却发现找不到了。你可以使用enum枚举，因为枚举只是一个符号名称，代码编译时已经自动替换为某个数值了。</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Stack</span><span class="p">{</span>
    <span class="k">enum</span> <span class="p">{</span><span class="n">MAX</span> <span class="o">=</span> <span class="mi">3</span><span class="p">};</span>
    <span class="kt">double</span> <span class="n">costs</span><span class="p">[</span><span class="n">MAX</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
<p>或者创建一个静态常量：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Stack</span><span class="p">{</span>
    <span class="n">staic</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MAX</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">costs</span><span class="p">[</span><span class="n">MAX</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
<p>下面请参考 test_stack.cpp 这个例子来详细理解前面的内容。</p>
<p>2．下面是一个非常简单的类定义：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">LIMIT</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">lname</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">fname</span><span class="p">[</span><span class="n">LIMIT</span><span class="p">];</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Person</span><span class="p">()</span> <span class="p">{</span> <span class="n">lname</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span> <span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span> <span class="p">};</span>
    <span class="n">Person</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">ln</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fn</span> <span class="o">=</span> <span class="s">"Heyyou"</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">Show</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> <span class="c1">// firstname lastname format</span>
    <span class="kt">void</span> <span class="nf">FormalShow</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> <span class="c1">// lastname firstname format</span>
<span class="p">};</span>
</pre></div>
<p>它使用了一个string对象和一个字符数组，让您能够比较它们的用法。请提供未定义的方法的代码，以完成这个类的实现。再编写一个使用这个类的程序，它使用了三种可能的构造函数调用（没有参数、一个参数和两个参数）以及两种显示方法。下面是一个使用这些构造函数和方法的例子：</p>
<div class="highlight"><pre><span></span><span class="n">Person</span> <span class="n">one</span><span class="p">;</span>
<span class="n">Person</span> <span class="nf">two</span><span class="p">(</span><span class="s">"Smythecraft"</span><span class="p">);</span>
<span class="n">Person</span> <span class="nf">three</span><span class="p">(</span><span class="s">"Dimwiddy"</span><span class="p">,</span> <span class="s">"Sam"</span><span class="p">);</span>
<span class="n">one</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="n">one</span><span class="p">.</span><span class="n">FormalShow</span><span class="p">();</span>
<span class="c1">//etc for two and three person</span>
</pre></div>
<p>上面 <code>Person() { lname = ""; fname[0] = '\0'; };</code> 这种在声明时就写上成员函数的定义的函数会自动成为内联函数。你也可以如下按照传统inline方法来写：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">{</span>
    <span class="p">...</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Person</span><span class="p">();</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="n">Person</span><span class="o">::</span><span class="n">Person</span><span class="p">(){</span>
    <span class="n">lname</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>像C++这种额外的写法，那些不重要的语法糖性质的东西我不会在介绍语言特性的正文中引入，必要时提到即可。</p>
<p>本例子主要检验了读者对本章节前面关于类的编写的一些基本知识和应用。</p>
<p>person.h</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">"person.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>



<span class="n">Person</span><span class="o">::</span><span class="n">Person</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">ln</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fn</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">fname</span><span class="p">,</span> <span class="n">fn</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">lname</span> <span class="o">=</span> <span class="n">ln</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Person</span><span class="o">::</span><span class="n">Show</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">fname</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">lname</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Person</span><span class="o">::</span><span class="n">FormalShow</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">lname</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">fname</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c10_2.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"person.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="n">Person</span> <span class="n">one</span><span class="p">;</span>
    <span class="n">Person</span> <span class="n">two</span><span class="p">(</span><span class="s">"Smythecraft"</span><span class="p">);</span>
    <span class="n">Person</span> <span class="n">three</span><span class="p">(</span><span class="s">"Dimwiddy"</span><span class="p">,</span> <span class="s">"Sam"</span><span class="p">);</span>

    <span class="n">one</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">one</span><span class="p">.</span><span class="n">FormalShow</span><span class="p">();</span>

    <span class="n">two</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">two</span><span class="p">.</span><span class="n">FormalShow</span><span class="p">();</span>

    <span class="n">three</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">three</span><span class="p">.</span><span class="n">FormalShow</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>3．重做前面<code>xiti_c9_1</code> 编程，但要用正确的golf类声明替换那里的代码。用带合适参数的构造函数替换 <code>setgolf（golf &amp;, const char *, int）</code>，以提供初始值。保留 <code>setgolf( )</code> 的交互版本，但要用构造函数来实现它（例如，setgolf( )的代码应该获得数据，将数据传递给构造函数来创建一个临时对象，并将其赋给调用对象，即 <code>*this</code> ）。</p>
<p>在golf.h那里新增Golf类的声明：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Golf</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Len</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">fullname</span><span class="p">[</span><span class="n">Len</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">handicap</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Golf</span><span class="p">();</span>
    <span class="n">Golf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hc</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">showgolf</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">set_handicap</span><span class="p">(</span><span class="kt">int</span> <span class="n">hc</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>在Golf.cpp那里新增Golf类的定义：</p>
<div class="highlight"><pre><span></span><span class="n">Golf</span><span class="o">::</span><span class="n">Golf</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input name: "</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">fullname</span><span class="p">,</span> <span class="n">Len</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">fullname</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"please input handicap: "</span><span class="p">;</span>
        <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">handicap</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">Golf</span><span class="o">::</span><span class="n">Golf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hc</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">fullname</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">handicap</span> <span class="o">=</span> <span class="n">hc</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Golf</span><span class="o">::</span><span class="n">showgolf</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">fullname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">fullname</span> <span class="o">&lt;&lt;</span> <span class="s">"'s handicap is: "</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">handicap</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Golf</span><span class="o">::</span><span class="n">set_handicap</span><span class="p">(</span><span class="kt">int</span> <span class="n">hc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">handicap</span> <span class="o">=</span> <span class="n">hc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c10_3.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"golf.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Golf</span> <span class="n">golf1</span> <span class="o">=</span> <span class="n">Golf</span><span class="p">(</span><span class="s">"bob sam"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">golf1</span><span class="p">.</span><span class="n">showgolf</span><span class="p">();</span>

    <span class="n">Golf</span> <span class="n">golf2</span> <span class="o">=</span> <span class="n">Golf</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"test handicap function....</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">golf2</span><span class="p">.</span><span class="n">showgolf</span><span class="p">();</span>
    <span class="n">golf2</span><span class="p">.</span><span class="n">set_handicap</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
    <span class="n">golf2</span><span class="p">.</span><span class="n">showgolf</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本例也算是对结构体和类之间转换的一种思考，结构内的访问属性默认是public，而类里面的变量默认访问属性是private。C++程序员该使用类就会使用类，而结构体只是某种纯粹的数据表达。</p>
<p>6．下面是一个类的声明：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Move</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Move</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// set x,y to a,b</span>
    <span class="kt">void</span> <span class="nf">showmove</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> <span class="c1">//show current x,y values</span>
    <span class="n">Move</span> <span class="nf">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Move</span> <span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span> 
    <span class="c1">// this function adds x of m to x of invoking object to get new x,</span>
    <span class="c1">// add y of m to y of invoking object to get new y, create a new</span>
    <span class="c1">// move object initialized to new x,y values and returns it.</span>
    <span class="kt">void</span> <span class="nf">reset</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//reset x,y to a,b</span>
<span class="p">};</span>
</pre></div>
<p>请编写该类的成员函数定义和具体测试该类的程序。</p>
<p>move.cpp内容如下：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">"move.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="n">Move</span><span class="o">::</span><span class="n">Move</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Move</span><span class="o">::</span><span class="n">showmove</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"&lt;Move x="</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">" y="</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">"&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Move</span> <span class="n">Move</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Move</span><span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">new_x</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">+</span> <span class="n">m</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">new_y</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">+</span> <span class="n">m</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="k">return</span> <span class="nf">Move</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Move</span><span class="o">::</span><span class="n">reset</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c10_6.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"move.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//int main48() {</span>

    <span class="n">Move</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">Move</span><span class="p">();</span>
    <span class="n">m1</span><span class="p">.</span><span class="n">showmove</span><span class="p">();</span>

    <span class="n">Move</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">Move</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">Move</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">Move</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">);</span>
    <span class="n">Move</span> <span class="n">m4</span> <span class="o">=</span> <span class="n">m3</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">m2</span><span class="p">);</span>
    <span class="n">m4</span><span class="p">.</span><span class="n">showmove</span><span class="p">();</span>

    <span class="n">m4</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="mf">9.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">m4</span><span class="p">.</span><span class="n">showmove</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>8．可以将简单列表描述成下面这样：</p>
<ul>
<li>可存储0或多个某种类型的列表；</li>
<li>可创建空列表；</li>
<li>可在列表中添加数据项；</li>
<li>可确定列表是否为空；</li>
<li>可确定列表是否为满；</li>
<li>可访问列表中的每一个数据项，并对它执行某种操作。</li>
</ul>
<p>可以看到，这个列表确实很简单，例如，它不允许插入或删除数据项。</p>
<p>请设计一个List类来表示这种抽象类型。您应提供头文件list.h和实现文件list.cpp，前者包含类定义，后者包含类方法的实现。您还应创建一个简短的程序来使用这个类。</p>
<p>该列表的规范很简单，这主要旨在简化这个编程练习。可以选择使用数组或链表来实现该列表，但公有接口不应依赖于所做的选择。也就是说，公有接口不应有数组索引、节点指针等。应使用通用概念来表达创建列表、在列表中添加数据项等操作。对于访问数据项以及执行操作，通常应使用将函数指针作为参数的函数来处理：</p>
<div class="highlight"><pre><span></span>void visit(Item (*pf)(Item &amp;));
</pre></div>
<p>其中，pf指向一个将Item引用作为参数的函数（不是成员函数），Item是列表中数据项的类型。visit( )函数将该函数用于列表中的每个数据项。</p>
<p>list.h 内容如下：</p>
<div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#ifndef LIST_H_</span>
<span class="cp">#define LIST_H_</span>

<span class="cp">#define ItemType double</span>
<span class="k">typedef</span> <span class="nf">ItemType</span><span class="p">(</span><span class="o">*</span><span class="n">func_type</span><span class="p">)(</span><span class="n">ItemType</span><span class="o">&amp;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">List</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">enum</span> <span class="p">{</span> <span class="n">MAX</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="n">ItemType</span> <span class="n">items</span><span class="p">[</span><span class="n">MAX</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">num</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">List</span><span class="p">();</span> <span class="c1">// default empty list</span>
    <span class="kt">bool</span> <span class="nf">is_full</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="nf">is_empty</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">show_list</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">append</span><span class="p">(</span><span class="n">ItemType</span> <span class="n">item</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">visit</span><span class="p">(</span><span class="n">func_type</span> <span class="n">pf</span><span class="p">);</span>
<span class="p">};</span>


<span class="cp">#endif </span><span class="c1">// !LIST_H_</span>
</pre></div>
<p>list.cpp </p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">"list.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="n">List</span><span class="o">::</span><span class="n">List</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">List</span><span class="o">::</span><span class="n">is_full</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">==</span> <span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">List</span><span class="o">::</span><span class="n">is_empty</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">List</span><span class="o">::</span><span class="n">show_list</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"["</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"]</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">List</span><span class="o">::</span><span class="n">append</span><span class="p">(</span><span class="n">ItemType</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_full</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">items</span><span class="p">[</span><span class="n">num</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"list is full."</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">List</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">func_type</span> <span class="n">pf</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">pf</span><span class="p">)(</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c10_8.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"list.h"</span><span class="cp"></span>


<span class="n">ItemType</span> <span class="nf">multiply2</span><span class="p">(</span><span class="n">ItemType</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">item</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">List</span> <span class="n">list1</span> <span class="o">=</span> <span class="n">List</span><span class="p">();</span>

    <span class="n">list1</span><span class="p">.</span><span class="n">show_list</span><span class="p">();</span>

    <span class="n">list1</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">list1</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

    <span class="n">list1</span><span class="p">.</span><span class="n">show_list</span><span class="p">();</span>

    <span class="n">list1</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="n">multiply2</span><span class="p">);</span>

    <span class="n">list1</span><span class="p">.</span><span class="n">show_list</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本例只要求实现一个简单的列表，其中函数作为参数部分也算是一个温习。</p>
<h3 id="_26">运算符重载</h3>
<p>类相应的运算符重载在python那边是在类里面重新定义 <code>__add__</code> 之类的方法，而在C++这边是重新定义 <code>operator+</code> 之类的这样的成员函数，然后就重载了对应的运算符操作。具体这块细节后面有时间再慢慢熟悉，本文也是接触到什么运算符就提到相关知识点，不会面面俱到的，在这块学习上是没必要要求面面俱到的。</p>
<p>请看下面的例子：</p>
<p>mytime.h</p>
<div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#ifndef MYTIME_H_</span>
<span class="cp">#define MYTIME_H_</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">MyTime</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">hours</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">minutes</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">MyTime</span><span class="p">();</span>
    <span class="n">MyTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">AddMin</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">AddHr</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">Reset</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">MyTime</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">MyTime</span> <span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">MyTime</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">MyTime</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">mult</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="k">friend</span> <span class="n">MyTime</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">m</span><span class="p">,</span> <span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span> <span class="o">*</span> <span class="n">m</span><span class="p">;</span> <span class="p">};</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">Show</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="c1">// !MYTIME_H_</span>
</pre></div>
<p>mytime.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">"mytime.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="n">MyTime</span><span class="o">::</span><span class="n">MyTime</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">hours</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">MyTime</span><span class="o">::</span><span class="n">MyTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hours</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">MyTime</span><span class="o">::</span><span class="n">AddMin</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">minutes</span> <span class="o">+=</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">hours</span> <span class="o">+=</span> <span class="n">minutes</span> <span class="o">/</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">minutes</span> <span class="o">%=</span> <span class="mi">60</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">MyTime</span><span class="o">::</span><span class="n">AddHr</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hours</span> <span class="o">+=</span> <span class="n">h</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">MyTime</span><span class="o">::</span><span class="n">Reset</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hours</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">MyTime</span> <span class="n">MyTime</span><span class="o">::</span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">MyTime</span> <span class="n">sum</span><span class="p">;</span>
    <span class="n">sum</span><span class="p">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">minutes</span><span class="p">;</span>
    <span class="n">sum</span><span class="p">.</span><span class="n">hours</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">hours</span> <span class="o">+</span> <span class="n">sum</span><span class="p">.</span><span class="n">minutes</span> <span class="o">/</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">sum</span><span class="p">.</span><span class="n">minutes</span> <span class="o">%=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">MyTime</span> <span class="n">MyTime</span><span class="o">::</span><span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">MyTime</span> <span class="n">diff</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tot1</span><span class="p">,</span> <span class="n">tot2</span><span class="p">;</span>
    <span class="n">tot1</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">minutes</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">t</span><span class="p">.</span><span class="n">hours</span><span class="p">;</span>
    <span class="n">tot2</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">hours</span><span class="p">;</span>
    <span class="n">diff</span><span class="p">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot2</span> <span class="o">-</span> <span class="n">tot1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">diff</span><span class="p">.</span><span class="n">hours</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot2</span> <span class="o">-</span> <span class="n">tot1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">diff</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">MyTime</span> <span class="n">MyTime</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">mult</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">MyTime</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">minutes</span> <span class="o">*</span> <span class="n">mult</span><span class="p">;</span>

    <span class="n">result</span><span class="p">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">total</span> <span class="o">%</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">result</span><span class="p">.</span><span class="n">hours</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="mi">60</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">hours</span> <span class="o">&lt;&lt;</span> <span class="s">" hours, "</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">minutes</span> <span class="o">&lt;&lt;</span> <span class="s">" minutes"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">MyTime</span><span class="o">::</span><span class="n">Show</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">hours</span> <span class="o">&lt;&lt;</span> <span class="s">" hours, "</span> <span class="o">&lt;&lt;</span> <span class="n">minutes</span> <span class="o">&lt;&lt;</span> <span class="s">" minutes"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>test_mytime.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"mytime.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//int main50(){</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">MyTime</span> <span class="n">planning</span><span class="p">;</span>
    <span class="n">MyTime</span> <span class="n">coding</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">35</span><span class="p">);</span>
    <span class="n">MyTime</span> <span class="n">fixing</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">55</span><span class="p">);</span>
    <span class="n">MyTime</span> <span class="n">total</span><span class="p">;</span>
    <span class="n">MyTime</span> <span class="n">diff</span><span class="p">;</span>
    <span class="n">MyTime</span> <span class="n">adjusted</span><span class="p">;</span>
    <span class="n">MyTime</span> <span class="n">adjusted2</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"planning time = "</span><span class="p">;</span>
    <span class="n">planning</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"coding time = "</span><span class="p">;</span>
    <span class="n">coding</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"fixing time = "</span><span class="p">;</span>
    <span class="n">fixing</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">total</span> <span class="o">=</span> <span class="n">coding</span> <span class="o">+</span> <span class="n">fixing</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"coding + fixing = "</span><span class="p">;</span>
    <span class="n">total</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="n">coding</span> <span class="o">-</span> <span class="n">fixing</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"coding - fixing = "</span><span class="p">;</span>
    <span class="n">diff</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">adjusted</span> <span class="o">=</span> <span class="n">coding</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"coding * 1.5 = "</span><span class="p">;</span>
    <span class="n">adjusted</span><span class="p">.</span><span class="n">Show</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">adjusted2</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">coding</span> <span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"1.5 * coding = "</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">adjusted2</span> <span class="o">&lt;&lt;</span>  <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>这个例子演示了重载目标MyTime类的加法减法和乘法，然后具体时间刻度计算了解下即可。倒是这里面代码中的这一行：</p>
<div class="highlight"><pre><span></span><span class="n">MyTime</span> <span class="n">sum</span><span class="p">;</span>
<span class="n">sum</span><span class="p">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">+</span> <span class="n">t</span><span class="p">.</span><span class="n">minutes</span><span class="p">;</span>
</pre></div>
<p>让我困惑，然后我认识到之前对于 <code>private</code> 个人理解是有所偏差的。如果是类的成员函数，调用自身私有变量，在同一个类的作用域中，可以直接调用这是可以理解的。而这里是另外新建了一个MyTime对象可以直接调用私有变量这是我没有想到的。如果是其他类的对象，当然是不能直接调用私有变量的，否则这个私有变量设定就没有意义了，这里显然是本类的对象，在本类的成员函数定义里面，是可以直接调用私有变量的。</p>
<h3 id="_27">友元函数</h3>
<p>在上面的例子中，对象乘以1.5这样的操作直接重载 <code>operator*</code> 即可，但是如果是 <code>1.5 * coding</code> 这样的形式，这个时候需要重载一般意义上的乘法，但如果只是一般重载乘法传过来的该类对象的私有变量是不可以直接访问的，而这个时候就需要使用友元函数，具体声明形式如下：</p>
<div class="highlight"><pre><span></span><span class="k">friend</span> <span class="n">MyTime</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">m</span><span class="p">,</span> <span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">);</span>
</pre></div>
<p>其实际上并不是类的成员函数，但也是写在类的声明里面的，前面要加上 <code>friend</code> 关键字，然后其对于MyTime也就是本类的访问权限和成员函数是一样的。上面完整的形式是：</p>
<div class="highlight"><pre><span></span><span class="k">friend</span> <span class="n">MyTime</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">m</span><span class="p">,</span> <span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">t</span> <span class="o">*</span> <span class="n">m</span><span class="p">;</span> <span class="p">};</span>
</pre></div>
<p>也就是一个内联函数，再利用原有的 <code>operator*</code> 即可。</p>
<p>同样类似的下面还重载了 <code>&lt;&lt;</code> 运算符，好让该对象支持cout直接输出：</p>
<div class="highlight"><pre><span></span><span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">);</span>
</pre></div>
<p>具体实现：</p>
<div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">MyTime</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">hours</span> <span class="o">&lt;&lt;</span> <span class="s">" hours, "</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">minutes</span> <span class="o">&lt;&lt;</span> <span class="s">" minutes"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>注意返回了原<code>ostream</code> 对象，为的是支持 <code>cout &lt;&lt; a &lt;&lt; b</code> 这样的形式。</p>
<p>下面继续下一个例子，模拟物理上的矢量运算：</p>
<p>vector.h</p>
<div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#ifndef VECTOR_H_</span>
<span class="cp">#define VECTOR_H_</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">VECTOR</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">Vector</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="k">enum</span> <span class="n">Mode</span><span class="p">{</span><span class="n">RECT</span><span class="p">,</span> <span class="n">POL</span><span class="p">};</span>
        <span class="c1">// RECT rectangular mode POL polar mode</span>

    <span class="k">private</span><span class="o">:</span>
        <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">mag</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">ang</span><span class="p">;</span> <span class="c1">// unit is radian</span>
        <span class="n">Mode</span> <span class="n">mode</span><span class="p">;</span>
        <span class="kt">void</span> <span class="nf">set_mag</span><span class="p">();</span>
        <span class="kt">void</span> <span class="nf">set_ang</span><span class="p">();</span>
        <span class="kt">void</span> <span class="nf">set_x</span><span class="p">();</span>
        <span class="kt">void</span> <span class="nf">set_y</span><span class="p">();</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="n">Vector</span><span class="p">();</span>
        <span class="n">Vector</span><span class="p">(</span><span class="kt">double</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">n2</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">form</span> <span class="o">=</span> <span class="n">RECT</span><span class="p">);</span>
        <span class="kt">void</span> <span class="nf">reset</span><span class="p">(</span><span class="kt">double</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">n2</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">form</span> <span class="o">=</span> <span class="n">RECT</span><span class="p">);</span>
        <span class="o">~</span><span class="n">Vector</span><span class="p">();</span>
        <span class="kt">double</span> <span class="nf">xval</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="p">};</span>
        <span class="kt">double</span> <span class="nf">yval</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">y</span><span class="p">;</span> <span class="p">};</span>
        <span class="kt">double</span> <span class="nf">magval</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">mag</span><span class="p">;</span> <span class="p">};</span>
        <span class="kt">double</span> <span class="nf">angval</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ang</span><span class="p">;</span> <span class="p">};</span>
        <span class="kt">void</span> <span class="nf">polar_mode</span><span class="p">();</span>
        <span class="kt">void</span> <span class="nf">rect_mode</span><span class="p">();</span>

        <span class="c1">//operator overloading</span>
        <span class="n">Vector</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
        <span class="n">Vector</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
        <span class="n">Vector</span> <span class="k">operator</span><span class="o">-</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
        <span class="n">Vector</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">)</span><span class="k">const</span><span class="p">;</span>

        <span class="c1">//friends</span>
        <span class="k">friend</span> <span class="n">Vector</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">);</span>
        <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="c1">// !VECTOR_H_</span>
</pre></div>
<p>vector.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"vector.h"</span><span class="cp"></span>


<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">atan</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">atan2</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>


<span class="k">namespace</span> <span class="n">VECTOR</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">Rad_to_deg</span> <span class="o">=</span> <span class="mi">45</span><span class="o">/</span><span class="n">atan</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kt">void</span> <span class="n">Vector</span><span class="o">::</span><span class="n">set_mag</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Vector</span><span class="o">::</span><span class="n">set_ang</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Vector</span><span class="o">::</span><span class="n">set_x</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Vector</span><span class="o">::</span><span class="n">set_y</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Vector</span><span class="o">::</span><span class="n">Vector</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">ang</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">RECT</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Vector</span><span class="o">::</span><span class="n">Vector</span><span class="p">(</span><span class="kt">double</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">n2</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">form</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">form</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">RECT</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">n1</span><span class="p">;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">n2</span><span class="p">;</span>
            <span class="n">set_mag</span><span class="p">();</span>
            <span class="n">set_ang</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">form</span> <span class="o">==</span> <span class="n">POL</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">n1</span><span class="p">;</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">n2</span> <span class="o">/</span> <span class="n">Rad_to_deg</span><span class="p">;</span> <span class="c1">// input n2 is degree</span>
            <span class="n">set_x</span><span class="p">();</span>
            <span class="n">set_y</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Incorrect 3rd argument to Vector() -- "</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"vector set to 0</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">ang</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">RECT</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">Vector</span><span class="o">::</span><span class="n">reset</span><span class="p">(</span><span class="kt">double</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">n2</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">form</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">form</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">RECT</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">n1</span><span class="p">;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">n2</span><span class="p">;</span>
            <span class="n">set_mag</span><span class="p">();</span>
            <span class="n">set_ang</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">form</span> <span class="o">==</span> <span class="n">POL</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">n1</span><span class="p">;</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">n2</span> <span class="o">/</span> <span class="n">Rad_to_deg</span><span class="p">;</span>
            <span class="n">set_x</span><span class="p">();</span>
            <span class="n">set_y</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Incorrect 3rd argument to Vector() -- "</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"vector set to 0</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">ang</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">RECT</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">Vector</span><span class="o">::~</span><span class="n">Vector</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>


    <span class="kt">void</span> <span class="n">Vector</span><span class="o">::</span><span class="n">polar_mode</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">POL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Vector</span><span class="o">::</span><span class="n">rect_mode</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">RECT</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Vector</span> <span class="n">Vector</span><span class="o">::</span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Vector</span> <span class="n">Vector</span><span class="o">::</span><span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Vector</span> <span class="n">Vector</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">*</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Vector</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Vector</span> <span class="n">Vector</span><span class="o">::</span><span class="k">operator</span><span class="o">-</span><span class="p">()</span> <span class="k">const</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">Vector</span><span class="o">::</span><span class="n">RECT</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"(x,y) = ("</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">Vector</span><span class="o">::</span><span class="n">POL</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"(m,a) = ("</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">mag</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">ang</span> <span class="o">*</span> <span class="n">Rad_to_deg</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"Vector object mode is invalid."</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
<p>test_vector.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"vector.h"</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//int main51(){</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">VECTOR</span><span class="o">::</span><span class="n">Vector</span><span class="p">;</span>

    <span class="n">Vector</span> <span class="n">v1</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">v2</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">Vector</span> <span class="n">v3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

    <span class="n">Vector</span> <span class="n">v4</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">v5</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">v6</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">v7</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">v8</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v1 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">v4</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v4 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v4</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">v4</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v4 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v4</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">v5</span> <span class="o">=</span> <span class="o">-</span><span class="n">v4</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v5 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v5</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">v6</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="n">VECTOR</span><span class="o">::</span><span class="n">Vector</span><span class="o">::</span><span class="n">POL</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v6 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v6</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">v6</span><span class="p">.</span><span class="n">rect_mode</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v6 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v6</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">v7</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">v5</span> <span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v7 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v7</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">v8</span> <span class="o">=</span> <span class="n">v7</span> <span class="o">-</span> <span class="n">v6</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"v8 = "</span> <span class="o">&lt;&lt;</span> <span class="n">v8</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<ol>
<li>弧度的换算是根据  <span class="math">\(atan(1) = \frac{\pi}{4}\)</span> ，从而得到常见的换算公式1弧度等于 <span class="math">\(\frac{180}{\pi}\)</span> 。</li>
<li>ang默认单位是radian</li>
<li>构造函数和reset方法都好理解，然后坐标为极坐标是第二个参数输入角度单位是度。</li>
<li>对于加减乘运算的重载，其写法很优雅地利用了构造函数，从而根据构造函数默认的xy坐标很方便进行一些运算并自动计算得到极坐标的相关数据。</li>
<li>cout的输出方法并不是很难理解，倒是这个 <code>if (v.mode == Vector::RECT) {</code> 不可以直接使用RECT值得引起我们的注意，这是一个友元函数，其和该类的成员函数具有相同的访问权限，但只是访问权限，这里是作用域问题。这是因为： <strong>友元函数不在类作用域中</strong>。之所以没有加上 VECTOR是因为该友元函数在namespace VECTOR里面，但是不可以直接使用 RECT。</li>
</ol>
<p>参考资料1的随机漫步那个例子就不列出来，这不是这里讨论的重点。</p>
<h3 id="_28">类的类型转换</h3>
<h4 id="_29">将其他类型数据转成本类</h4>
<p>将其他类型数据转成本类利用的就是本类的构造函数。其中有隐式转换和显示转换两种。个人不太喜欢类的类型的隐式转换，不太推荐编程的时候使用太多这种类型隐式转换，会让你的程序晦涩难懂并可能失控。具体隐式转换是如下面写法：</p>
<div class="highlight"><pre><span></span><span class="n">Stonewt</span> <span class="n">myCat</span><span class="p">;</span>
<span class="n">myCat</span> <span class="o">=</span> <span class="mf">19.6</span><span class="p">;</span>
</pre></div>
<p>C++会试着查找Stonewt类的构造函数，然后发现构造函数有：</p>
<div class="highlight"><pre><span></span><span class="n">Stonewt</span><span class="p">(</span><span class="kt">double</span> <span class="n">lbs</span><span class="p">);</span>
</pre></div>
<p>这个特征参数匹配，就会试着调用 <code>Stonewt(19.6)</code> 来进行隐式类型转换。个人不太喜欢这种写法，而实际上C++也不推荐这种写法，并引入了 <code>explicit</code> 关键词：</p>
<div class="highlight"><pre><span></span><span class="k">explicit</span> <span class="nf">Stonewt</span><span class="p">(</span><span class="kt">double</span> <span class="n">lbs</span><span class="p">);</span>
</pre></div>
<p>这个构造函数引入explicit关键词之后就不能用于隐式类型转换了，如果需要类型转换，则必须采用如下明确的形式：</p>
<div class="highlight"><pre><span></span><span class="n">Stonewt</span> <span class="n">myCat</span><span class="p">;</span>
<span class="n">myCat</span> <span class="o">=</span> <span class="n">Stonewt</span><span class="p">(</span><span class="mf">19.6</span><span class="p">);</span>
</pre></div>
<p>这种写法也更明确易懂。</p>
<h4 id="_30">将本类转成其他类型数据</h4>
<p>下面只讲明确的显示类型转换情况，具体就是本类需要编写类似<code>operator int()</code> 这样的成员函数。</p>
<p>比如：</p>
<div class="highlight"><pre><span></span><span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span> <span class="kt">int</span><span class="p">()</span><span class="k">const</span><span class="p">{</span>
    <span class="k">return</span> <span class="kt">int</span><span class="p">(</span><span class="n">pounds</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>然后实际使用就是这种 <code>(int) what</code>  形式即返回目标类型数据。再一次，一般转换函数推荐加上 <code>explicit</code> 关键词：</p>
<div class="highlight"><pre><span></span>class Stonewt{
    explicit operator int () const;
}
</pre></div>
<p>这样禁用掉隐式转换，推荐写代码时都写成显示转换的形式，这样代码也更明确易懂一些。</p>
<p>1．请参考下面的randwalk.cpp 代码，对其进行修改，使之将一系列连续的随机漫步者位置写入到文件中。对于每个位置，用步号进行标示。另外，让该程序将初始条件（目标距离和步长）以及结果小结写入到该文件中。该文件的内容与下面类似：</p>
<p><img alt="img" src="https://a358003542.github.io/images/2020/xiti_c11_1.png"/></p>
<p>randwalk.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt; // rand srand </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt; //time</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"vector.h"</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">VECTOR</span><span class="o">::</span><span class="n">Vector</span><span class="p">;</span>

    <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span> <span class="c1">// time(0) the current time, srand reset random seed.</span>
    <span class="kt">double</span> <span class="n">direction</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">step</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">result</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">target</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">dstep</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter target distance (q to quit): "</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter step length: "</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">dstep</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">magval</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">360</span><span class="p">;</span> <span class="c1">//generate 0-359 random number</span>
            <span class="n">step</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="n">dstep</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">Vector</span><span class="o">::</span><span class="n">POL</span><span class="p">);</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">step</span><span class="p">;</span>
            <span class="n">steps</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"After "</span> <span class="o">&lt;&lt;</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="s">" steps, the subject has the following location:</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">result</span><span class="p">.</span><span class="n">polar_mode</span><span class="p">();</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" or</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Average outward distance per step = "</span>
            <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="p">.</span><span class="n">magval</span><span class="p">()</span> <span class="o">/</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">result</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter target distance (q to quit): "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bye!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c11_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt; // rand srand </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt; //time</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"vector.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">VECTOR</span><span class="o">::</span><span class="n">Vector</span><span class="p">;</span>

    <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span> <span class="c1">// time(0) the current time, srand reset random seed.</span>
    <span class="kt">double</span> <span class="n">direction</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">step</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">result</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">target</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">dstep</span><span class="p">;</span>
    <span class="n">ofstream</span> <span class="n">outFile</span><span class="p">;</span>
    <span class="n">outFile</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">"randwalk.txt"</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter target distance (q to quit): "</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter step length: "</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">dstep</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">"Target Distance: "</span> <span class="o">&lt;&lt;</span> <span class="n">target</span> <span class="o">&lt;&lt;</span> <span class="s">", Step Size: "</span> <span class="o">&lt;&lt;</span> <span class="n">dstep</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">magval</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">360</span><span class="p">;</span> <span class="c1">//generate 0-359 random number</span>
            <span class="n">step</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="n">dstep</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">Vector</span><span class="o">::</span><span class="n">POL</span><span class="p">);</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">step</span><span class="p">;</span>
            <span class="n">steps</span><span class="o">++</span><span class="p">;</span>

            <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"After "</span> <span class="o">&lt;&lt;</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="s">" steps, the subject has the following location:</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">"After "</span> <span class="o">&lt;&lt;</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="s">" steps, the subject has the following location:</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="n">result</span><span class="p">.</span><span class="n">polar_mode</span><span class="p">();</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" or</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">" or</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Average outward distance per step = "</span>
            <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="p">.</span><span class="n">magval</span><span class="p">()</span> <span class="o">/</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">outFile</span> <span class="o">&lt;&lt;</span> <span class="s">"Average outward distance per step = "</span>
            <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="p">.</span><span class="n">magval</span><span class="p">()</span> <span class="o">/</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">result</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter target distance (q to quit): "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bye!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="n">outFile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>这个习题重温了下ofstream文件输出流的用法，其他没啥好说的，算是对Vector类的另外一个测试使用例子。</p>
<p>5．Stonewt类如下所示，现在需要重新编写它，使它有一个状态成员，由该成员控制对象应转换为英石格式、整数磅格式还是浮点磅格式。重载&lt;&lt;运算符，使用它来替换show_stn( )和show_lbs( )方法。重载加法、减法和乘法运算符，以便可以对Stonewt值进行加、减、乘运算。编写一个使用所有类方法和友元的小程序，来测试这个类。</p>
<p>6．重载全部6个关系运算符。运算符对pounds成员进行比较，并返回一个bool值。编写一个程序，它声明一个包含6个Stonewt对象的数组，并在数组声明中初始化前3个对象。然后使用循环来读取用于设置剩余3个数组元素的值。接着报告最小的元素、最大的元素以及大于或等于11英石的元素的数量（最简单的方法是创建一个Stonewt对象，并将其初始化为11英石，然后将其同其他对象进行比较）。</p>
<p>stonewt.h</p>
<div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#ifndef STONEWT_H_</span>
<span class="cp">#define STONEWT_H_</span>

<span class="k">class</span> <span class="nc">Stonewt</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">Lbs_per_stn</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">stone</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">pds_left</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">pounds</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Stonewt</span><span class="p">(</span><span class="kt">double</span> <span class="n">lbs</span><span class="p">);</span> <span class="c1">// input pounds</span>
    <span class="n">Stonewt</span><span class="p">(</span><span class="kt">int</span> <span class="n">stn</span><span class="p">,</span> <span class="kt">double</span> <span class="n">lbs</span><span class="p">);</span> <span class="c1">// input how many stone and how many pounds lefted</span>
    <span class="n">Stonewt</span><span class="p">();</span>
    <span class="o">~</span><span class="n">Stonewt</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">show_lbs</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> <span class="c1">// show in pound format</span>
    <span class="kt">void</span> <span class="nf">show_stn</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> <span class="c1">// show in stone format</span>

    <span class="c1">//conversion function</span>
    <span class="k">operator</span> <span class="nf">int</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="k">operator</span> <span class="nf">double</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="c1">// !STONEWT_H_</span>
</pre></div>
<p>stonewt.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"stonewt.h"</span><span class="cp"></span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>


<span class="n">Stonewt</span><span class="o">::</span><span class="n">Stonewt</span><span class="p">(</span><span class="kt">double</span> <span class="n">lbs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stone</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">lbs</span><span class="p">)</span> <span class="o">/</span> <span class="n">Lbs_per_stn</span><span class="p">;</span>
    <span class="n">pds_left</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">lbs</span><span class="p">)</span> <span class="o">%</span> <span class="n">Lbs_per_stn</span> <span class="o">+</span> <span class="n">lbs</span> <span class="o">-</span> <span class="kt">int</span><span class="p">(</span><span class="n">lbs</span><span class="p">);</span>
    <span class="n">pounds</span> <span class="o">=</span> <span class="n">lbs</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stonewt</span><span class="o">::</span><span class="n">Stonewt</span><span class="p">(</span><span class="kt">int</span> <span class="n">stn</span><span class="p">,</span> <span class="kt">double</span> <span class="n">lbs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stone</span> <span class="o">=</span> <span class="n">stn</span><span class="p">;</span>
    <span class="n">pds_left</span> <span class="o">=</span> <span class="n">lbs</span><span class="p">;</span>
    <span class="n">pounds</span> <span class="o">=</span> <span class="n">stn</span> <span class="o">*</span> <span class="n">Lbs_per_stn</span> <span class="o">+</span> <span class="n">lbs</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stonewt</span><span class="o">::</span><span class="n">Stonewt</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">stone</span> <span class="o">=</span> <span class="n">pds_left</span> <span class="o">=</span> <span class="n">pounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stonewt</span><span class="o">::~</span><span class="n">Stonewt</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">show_stn</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">stone</span> <span class="o">&lt;&lt;</span> <span class="s">" stone, "</span> <span class="o">&lt;&lt;</span> <span class="n">pds_left</span> <span class="o">&lt;&lt;</span> <span class="s">" pounds</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">show_lbs</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pounds</span> <span class="o">&lt;&lt;</span> <span class="s">" pounds</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span> <span class="kt">int</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span> <span class="kt">double</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">pounds</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>上面利用了cmath的round函数来达到四舍五入的效果，int取整的话只是截断。然后用英石表达的话该类会存储pds_left作为剩余的那一点pound，第二个构造函数 <code>Stonewt::Stonewt(int stn, double lbs)</code> 输入的就是多少英石然后还剩下多少磅的格式。</p>
<p>stonewt.h</p>
<div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#ifndef STONEWT_H_</span>
<span class="cp">#define STONEWT_H_</span>

<span class="k">class</span> <span class="nc">Stonewt</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">enum</span> <span class="n">Mode</span> <span class="p">{</span> <span class="n">STONE</span><span class="p">,</span> <span class="n">POUND</span><span class="p">,</span> <span class="n">INT_POUND</span><span class="p">};</span>

<span class="k">private</span><span class="o">:</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">Lbs_per_stn</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">stone</span><span class="p">;</span>
    <span class="n">Mode</span> <span class="n">state</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">pds_left</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">pounds</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Stonewt</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">mode</span><span class="o">=</span><span class="n">POUND</span><span class="p">);</span> <span class="c1">// mode pound</span>
    <span class="n">Stonewt</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">double</span> <span class="n">lbs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">STONE</span><span class="p">);</span> <span class="c1">// mode stone or int_pound</span>
    <span class="n">Stonewt</span><span class="p">();</span>
    <span class="o">~</span><span class="n">Stonewt</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">stone_mode</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">pound_mode</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">int_pound_mode</span><span class="p">();</span>

    <span class="c1">//conversion function</span>
    <span class="k">explicit</span> <span class="k">operator</span> <span class="nf">int</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="k">explicit</span> <span class="k">operator</span> <span class="nf">double</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

    <span class="c1">//operator overloading</span>
    <span class="n">Stonewt</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">Stonewt</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">Stonewt</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">)</span><span class="k">const</span><span class="p">;</span>

    <span class="kt">void</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">);</span>

    <span class="c1">// operator compare</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

    <span class="c1">//friends</span>
    <span class="k">friend</span> <span class="n">Stonewt</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>
<span class="p">};</span>



<span class="cp">#endif </span><span class="c1">// !STONEWT_H_</span>
</pre></div>
<p>stonewt.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"stonewt.h"</span><span class="cp"></span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>


<span class="n">Stonewt</span><span class="o">::</span><span class="n">Stonewt</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"error: POUND mode only, init it with default empty constructor."</span><span class="p">;</span>
        <span class="n">stone</span> <span class="o">=</span> <span class="n">pds_left</span> <span class="o">=</span> <span class="n">pounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">POUND</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">stone</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">Lbs_per_stn</span><span class="p">;</span>
        <span class="n">pds_left</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="n">Lbs_per_stn</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="kt">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">;</span> 
        <span class="n">pounds</span> <span class="o">=</span> <span class="n">d</span> <span class="p">;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">Stonewt</span><span class="o">::</span><span class="n">Stonewt</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">double</span> <span class="n">lbs</span><span class="p">,</span> <span class="n">Mode</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stone</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">Lbs_per_stn</span><span class="p">;</span>
        <span class="n">pds_left</span> <span class="o">=</span> <span class="n">s</span> <span class="o">%</span> <span class="n">Lbs_per_stn</span><span class="p">;</span>
        <span class="n">pounds</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stone</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">pds_left</span> <span class="o">=</span> <span class="n">lbs</span><span class="p">;</span>
        <span class="n">pounds</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">Lbs_per_stn</span> <span class="o">+</span> <span class="n">lbs</span><span class="p">;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"error: INT_POUND or STONE mode only, init it with default empty constructor."</span><span class="p">;</span>
        <span class="n">stone</span> <span class="o">=</span> <span class="n">pds_left</span> <span class="o">=</span> <span class="n">pounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">POUND</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="n">Stonewt</span><span class="o">::</span><span class="n">Stonewt</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">stone</span> <span class="o">=</span> <span class="n">pds_left</span> <span class="o">=</span> <span class="n">pounds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">POUND</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stonewt</span><span class="o">::~</span><span class="n">Stonewt</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">stone_mode</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">STONE</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">pound_mode</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">POUND</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">int_pound_mode</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">INT_POUND</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span> <span class="kt">int</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">stone</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="o">||</span> <span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span> <span class="kt">double</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">double</span><span class="p">(</span><span class="n">stone</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span> <span class="o">||</span> <span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stone</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">stone</span><span class="p">;</span>
    <span class="n">pds_left</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">pds_left</span><span class="p">;</span>
    <span class="n">pounds</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">state</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stonewt</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Stonewt</span><span class="p">(</span><span class="n">pounds</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Stonewt</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Stonewt</span><span class="p">(</span><span class="n">pounds</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Stonewt</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Stonewt</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">pounds</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Stonewt</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">pounds</span> <span class="o">&lt;&lt;</span> <span class="s">" pounds</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">round</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">pounds</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">" pounds</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">stone</span> <span class="o">&lt;&lt;</span> <span class="s">" stone, "</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">pds_left</span> <span class="o">&lt;&lt;</span> <span class="s">" pounds</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"Stonewt object mode is invalid."</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>   
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">&gt;=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span> <span class="o">==</span> <span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">Stonewt</span><span class="o">::</span><span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stonewt</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">STONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">INT_POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">round</span><span class="p">(</span><span class="n">pounds</span><span class="p">)</span> <span class="o">!=</span> <span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">POUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pounds</span> <span class="o">!=</span> <span class="n">b</span><span class="p">.</span><span class="n">pounds</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"invalid mode!"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>xiti_c11_5.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"stonewt.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="n">Stonewt</span> <span class="n">stonewt_array</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="mi">9</span><span class="p">,</span><span class="mf">2.8</span><span class="p">,</span><span class="n">Stonewt</span><span class="o">::</span><span class="n">STONE</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Stonewt</span><span class="o">::</span><span class="n">STONE</span><span class="p">},</span>
        <span class="p">{</span><span class="mf">6.3</span><span class="p">},</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input object weight in pounds: "</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">pounds</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">pounds</span><span class="p">;</span>
        <span class="n">stonewt_array</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stonewt</span><span class="p">(</span><span class="n">pounds</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Stonewt</span> <span class="o">*</span><span class="n">max</span> <span class="o">=</span> <span class="n">stonewt_array</span><span class="p">;</span>
    <span class="n">Stonewt</span> <span class="o">*</span><span class="n">min</span> <span class="o">=</span> <span class="n">stonewt_array</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">stonewt_array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"----------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">stonewt_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">min</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">min</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stonewt_array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">stonewt_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">*</span><span class="n">max</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">max</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stonewt_array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">stonewt_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">Stonewt</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Stonewt</span><span class="o">::</span><span class="n">STONE</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">count</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"equal 11 stone elements number is: "</span> <span class="o">&lt;&lt;</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"max = "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">max</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"min = "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">min</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"max - min = "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">max</span> <span class="o">-</span> <span class="o">*</span><span class="n">min</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"2 * max = "</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="o">*</span><span class="n">max</span><span class="p">;</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本例子新的知识点倒没有，但里面东西还是挺多的，基本上是对本章节大部分内容的一个整理和总结，需要读者细细阅读体会。</p>
<p>7．复数有两个部分组成：实数部分和虚数部分。复数的一种书写方式是：（3.0，4.0），其中，3.0是实数部分，4.0是虚数部分。假设a = (A, Bi)，c = (C, Di)，则下面是一些复数运算。</p>
<ul>
<li>加法：<code>a + c = (A+C, (B+D)i)</code>。</li>
<li>减法：<code>a – c = (A−C, (B−D)i)</code>。</li>
<li>乘法：<code>a * c = (A*C−B*D, (A*D + B*C)i)</code>。</li>
<li>乘法: <code>x*c = (x * C, x *Di)</code>，其中x为实数。</li>
</ul>
<p>请定义一个复数类，以便下面的程序可以使用它来获得正确的结果。</p>
<p>xiti_c11_7.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"complex0.h"</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//int main54() {</span>

    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
    <span class="n">complex</span> <span class="n">a</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">);</span>
    <span class="n">complex</span> <span class="n">c</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter a complex number (q to quit): </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"c is "</span> <span class="o">&lt;&lt;</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"complex conjugate is "</span> <span class="o">&lt;&lt;</span> <span class="o">~</span><span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"a is "</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"a + c is "</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"a - c is "</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">-</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"a * c is "</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"2 * c is "</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter a complex number (q to quit): </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Done!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>注意，必须重载运算符&lt;&lt;和&gt;&gt;。标准C++使用头文件complex提供了比这个示例更广泛的复数支持，因此应将自定义的头文件命名为complex0.h，以免发生冲突。应尽可能使用const。</p>
<p>下面是该程序的运行情况。</p>
<p><img alt="img" src="https://a358003542.github.io/images/2020/xiti_c11_7.png"/></p>
<p>请注意，经过重载后，cin &gt;&gt;c将提示用户输入实数和虚数部分。</p>
<p>complex0.h</p>
<div class="highlight"><pre><span></span><span class="cp">#pragma once</span>


<span class="cp">#ifndef COMPLEX0_H_</span>
<span class="cp">#define COMPLEX0_H_</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>


<span class="k">class</span> <span class="nc">complex</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">double</span> <span class="n">real</span><span class="p">;</span> <span class="c1">//real</span>
    <span class="kt">double</span> <span class="n">img</span><span class="p">;</span> <span class="c1">// img</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">complex</span><span class="p">();</span>
    <span class="n">complex</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">);</span>
    <span class="o">~</span><span class="n">complex</span><span class="p">();</span>

    <span class="c1">//operator overloading</span>
    <span class="n">complex</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">complex</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="n">complex</span> <span class="k">operator</span><span class="o">-</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
    <span class="n">complex</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">)</span><span class="k">const</span><span class="p">;</span>
    <span class="n">complex</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">complex</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span><span class="k">const</span><span class="p">;</span>
    <span class="n">complex</span> <span class="k">operator</span><span class="o">~</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>

    <span class="c1">//friends</span>
    <span class="k">friend</span> <span class="n">complex</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">);</span>
<span class="p">};</span>


<span class="cp">#endif </span><span class="c1">// </span>
</pre></div>
<p>complex0.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">"complex0.h"</span><span class="cp"></span>


<span class="n">complex</span><span class="o">::</span><span class="n">complex</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">real</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">complex</span><span class="o">::</span><span class="n">complex</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">real</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">complex</span><span class="o">::~</span><span class="n">complex</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="n">complex</span> <span class="n">complex</span><span class="o">::</span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">complex</span><span class="p">(</span><span class="n">real</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="n">img</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">img</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">complex</span> <span class="n">complex</span><span class="o">::</span><span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">complex</span><span class="p">(</span><span class="n">real</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="n">img</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">img</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">complex</span> <span class="n">complex</span><span class="o">::</span><span class="k">operator</span><span class="o">-</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">complex</span><span class="p">(</span><span class="o">-</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="n">img</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">complex</span> <span class="n">complex</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">complex</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">complex</span><span class="p">((</span><span class="n">real</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">real</span> <span class="o">-</span> <span class="n">img</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">img</span><span class="p">),</span> <span class="p">(</span><span class="n">real</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">img</span> <span class="o">+</span> <span class="n">img</span> <span class="o">*</span> <span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">complex</span> <span class="n">complex</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">)</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">complex</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">real</span><span class="p">,</span> <span class="n">n</span> <span class="o">*</span> <span class="n">img</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">complex</span> <span class="n">complex</span><span class="o">::</span><span class="k">operator</span><span class="o">~</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">complex</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="n">img</span><span class="p">);</span>
<span class="p">}</span>


<span class="n">complex</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">real</span> <span class="o">&lt;&lt;</span> <span class="s">","</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">img</span> <span class="o">&lt;&lt;</span> <span class="s">"i)"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">istream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">complex</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">a</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">b</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"real: "</span><span class="p">;</span>
    <span class="n">os</span> <span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">real</span><span class="p">;</span>
    <span class="n">os</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"imaginary: "</span><span class="p">;</span>
    <span class="n">os</span> <span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">img</span><span class="p">;</span>
    <span class="n">os</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h3 id="_31">类和动态内存分配</h3>
<p>本小节主要分析讨论了官方内置的string类是如何实现不定长度字符串功能支持的，前面在介绍动态内存分配new和delete的时候提到过其内部就是利用的new和delete来实现了内部字符数组长度的可定制，但具体到实现层面，里面还有很多细节和问题需要讨论。</p>
<p>首先看一下参考资料1列出的StringBad这个带有一些bug的实现版本，该版本写法很直观，我想没有学习本小节的内容的读者一开始应该都会写出这样的最初实现版本：</p>
<p>stringbad.h</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#ifndef STRINGBAD_H_</span>
<span class="cp">#define STRINGBAD_H_</span>

<span class="k">class</span> <span class="nc">StringBad</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">str</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">StringBad</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">s</span><span class="p">);</span>
    <span class="n">StringBad</span><span class="p">();</span>
    <span class="o">~</span><span class="n">StringBad</span><span class="p">();</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">StringBad</span> <span class="o">&amp;</span> <span class="n">st</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#endif</span>
</pre></div>
<p>stringbad.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"stringbad.h"</span><span class="cp"></span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>


<span class="n">StringBad</span><span class="o">::</span><span class="n">StringBad</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">s</span><span class="p">){</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">std</span><span class="o">::</span><span class="n">strcpy</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">StringBad</span><span class="o">::</span><span class="n">StringBad</span><span class="p">(){</span>
    <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">StringBad</span><span class="o">::~</span><span class="n">StringBad</span><span class="p">(){</span>
    <span class="k">delete</span> <span class="p">[]</span> <span class="n">str</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">StringBad</span> <span class="o">&amp;</span> <span class="n">st</span><span class="p">){</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">st</span><span class="p">.</span><span class="n">str</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">os</span>
<span class="p">}</span>
</pre></div>
<p>StringBad类里面只保留了字符数组的指针，具体字符数组是存储在动态数组里面的。上面的实现有以下两大缺陷，一是没有正确应对复制构造函数的情况；二是没有正确应对赋值运算符的情况。</p>
<p>首先我们来分析第一个情况，参考资料callme2为什么会出现bug。因为callme2函数采用的是将类对象按值传递的形式，那么将调用该类的复制构造函数来完成这个动作，具体到这里可以理解为默认执行了 <code>StringBad sb = StringBad(headline2)</code> 。</p>
<p>因为上面的类实现并没有定义这个复制构造函数，那么将调用类的默认复制构造函数，具体就是非静态私有成员的值赋值，大概执行类似下面的语句：</p>
<div class="highlight"><pre><span></span><span class="n">StringBad</span> <span class="n">sb</span><span class="p">;</span>
<span class="n">sb</span><span class="p">.</span><span class="n">str</span> <span class="o">=</span> <span class="n">headline</span><span class="p">.</span><span class="n">str</span><span class="p">;</span>
<span class="n">sb</span><span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="n">headline</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
</pre></div>
<p>除了函数的按值传递情况外，下面的语句也是明确的在调用复制构造函数：</p>
<div class="highlight"><pre><span></span><span class="n">StringBad</span> <span class="nf">ditto</span><span class="p">(</span><span class="n">motto</span><span class="p">);</span>
<span class="n">StringBad</span> <span class="n">metto</span> <span class="o">=</span> <span class="n">motto</span><span class="p">;</span>
<span class="n">StringBad</span> <span class="n">also</span> <span class="o">=</span> <span class="n">StringBad</span><span class="p">(</span><span class="n">motto</span><span class="p">);</span>
<span class="n">StringBad</span> <span class="o">*</span> <span class="n">pstringBad</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBad</span><span class="p">(</span><span class="n">motto</span><span class="p">);</span>
</pre></div>
<p>这其中 <code>StringBad metto = motto;</code> 可能在具体实现上会有点差异，如果写成下面这种形式：</p>
<div class="highlight"><pre><span></span>StringBad metto;
metto = motto;
</pre></div>
<p>那么肯定上一句是调用默认的构造函数，第二句是调用的赋值运算符。但如果写成一句：<code>StringBad metto = motto;</code> 则有的可能就是只调用了复制构造函数，有的可能是先用复制构造函数创建一个临时对象，然后又再调用了赋值运算符。</p>
<p>继续到具体这个例子的讨论上，callme2按值传递内部形参sb，出了函数就将调用sb的析构函数，又因为sb的str指针就是headline2的str指针，所以sb的析构函数将会把该字符数组在动态内存里面的内容删除掉，从而造成了后面显示headline2的bug。</p>
<p>定义一个显式的复制构造函数可以解决这个问题【这种深究类里面成员的指针拷贝问题的叫做深度复制】：</p>
<div class="highlight"><pre><span></span><span class="n">StringBad</span><span class="o">::</span><span class="n">StringBad</span><span class="p">(</span><span class="k">const</span> <span class="n">StringBad</span> <span class="o">&amp;</span> <span class="n">st</span><span class="p">){</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
    <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">std</span><span class="o">::</span><span class="n">strcpy</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>上面例子的第二个bug是没有正确应对赋值运算符的情况，也就是这种情况：</p>
<div class="highlight"><pre><span></span>StringBad metto;
metto = motto;
</pre></div>
<p>同样类也有默认的 <code>operator=</code> 成员函数，其行为和复制构造函数类似，也是对类的非静态成员逐个复制。要解决这个问题，重载赋值运算符<code>=</code> 即可：</p>
<div class="highlight"><pre><span></span><span class="n">StringBad</span> <span class="o">&amp;</span> <span class="n">StringBad</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">StringBad</span> <span class="o">&amp;</span> <span class="n">st</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">){</span>
        <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">delete</span> <span class="p">[]</span> <span class="n">str</span><span class="p">;</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">str</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
    <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">std</span><span class="o">::</span><span class="n">strcpy</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">str</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>上面的代码可能读者会对 <code>this == &amp;st</code> 有点困惑，这里一定要记住引用变量从定义的时候就绑定了某个变量，后面提到它实际上就是提到那个变量，后面不要去谈论引用变量的地址或者引用变量存储的值之类的概念，比如上面的st，你问st的值是多少，它的值就是引用的StringBad那个对象，<code>&amp;st</code>  ，st的取址是多少，st的地址就是StringBad那个对象的取地址操作。</p>
<p>还有其他一下便捷的方法和运算符重载好让该类更好用，但在这里不是讨论的重点了，除了上面的赋值运算符还需要支持 <code>metto = "abc"</code> 这种形式，具体就是重载赋值运算符：</p>
<div class="highlight"><pre><span></span><span class="n">StringBad</span> <span class="o">&amp;</span> <span class="n">StringBad</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">s</span><span class="p">){</span>
    <span class="k">delete</span> <span class="p">[]</span> <span class="n">str</span><span class="p">;</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">std</span><span class="o">::</span><span class="n">strcpy</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>下面是参考资料1的一个例子，队列模拟，请读者详细阅读理解之，后面我会跟上一些觉得需要说明的知识点。关于队列的知识点这里预先假设读者已经知道了。</p>
<p>queue.h</p>
<div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#ifndef QUEUE_H_</span>
<span class="cp">#define QUEUE_H_</span>

<span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">long</span> <span class="n">arrive</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">processtime</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Customer</span><span class="p">()</span> <span class="p">{</span> <span class="n">arrive</span> <span class="o">=</span> <span class="n">processtime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">};</span>
    <span class="kt">void</span> <span class="nf">set</span><span class="p">(</span><span class="kt">long</span> <span class="n">when</span><span class="p">);</span>
    <span class="kt">long</span> <span class="nf">when</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">arrive</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">int</span> <span class="nf">ptime</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">processtime</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">Customer</span> <span class="n">Item</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Queue</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="p">{</span>
        <span class="n">Item</span> <span class="n">item</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">Node</span><span class="o">*</span> <span class="n">next</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">enum</span> <span class="p">{</span><span class="n">Q_SIZE</span><span class="o">=</span><span class="mi">10</span><span class="p">};</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">front</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">rear</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">items</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">qsize</span><span class="p">;</span>
    <span class="n">Queue</span><span class="p">(</span><span class="k">const</span> <span class="n">Queue</span> <span class="o">&amp;</span> <span class="n">q</span><span class="p">)</span><span class="o">:</span><span class="n">qsize</span><span class="p">(</span><span class="mi">0</span><span class="p">){}</span>
    <span class="n">Queue</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Queue</span><span class="o">&amp;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Queue</span><span class="p">(</span><span class="kt">int</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">Q_SIZE</span><span class="p">);</span>
    <span class="o">~</span><span class="n">Queue</span><span class="p">();</span>
    <span class="kt">bool</span> <span class="nf">isempty</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="nf">isfull</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
    <span class="kt">int</span> <span class="nf">queuecount</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="nf">enqueue</span><span class="p">(</span><span class="k">const</span> <span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="nf">dequeue</span><span class="p">(</span><span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span>
<span class="p">};</span>


<span class="cp">#endif </span><span class="c1">// !QUEUE_H_</span>
</pre></div>
<h4 id="_32">成员初始化列表</h4>
<p>这里有一行代码会比较费解：</p>
<div class="highlight"><pre><span></span><span class="n">Queue</span><span class="p">(</span><span class="k">const</span> <span class="n">Queue</span> <span class="o">&amp;</span> <span class="n">q</span><span class="p">)</span><span class="o">:</span><span class="n">qsize</span><span class="p">(</span><span class="mi">0</span><span class="p">){}</span>
</pre></div>
<p>这个写法只能用于类的构造函数，即在类的构造函数后面可以跟上冒号，然后后面跟上一些该类成员初始化时候的默认值。具体叫做成员初始化列表，构造函数待默认参数是可以直接写上的，为什么还要加上这种形式。这种形式写法里面的成员的初始值是类里面成员刚刚初始化的时候就可以进行复制的，比如说上面的qsize前面已经加上了<code>const</code> 关键词，也是可以通过这种方式来进行该常量的初始化动作的。就上面这个例子而言将qsize初始化0似乎不是那么重要，可以选择直接声明的时候赋值为0吗。但如下面的形式就是无可取代的写法了：</p>
<div class="highlight"><pre><span></span><span class="n">Classy</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="n">Classy</span><span class="o">::</span><span class="n">Classy</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">mem1</span><span class="p">(</span><span class="n">n</span><span class="p">){</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
<p>上面还演示了成员初始化列表只在具体定义中写上，声明的时候可以不写。</p>
<p>queue.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"queue.h"</span><span class="cp"></span>

<span class="n">Queue</span><span class="o">::</span><span class="n">Queue</span><span class="p">(</span><span class="kt">int</span> <span class="n">qs</span><span class="p">)</span> <span class="o">:</span><span class="n">qsize</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">front</span> <span class="o">=</span> <span class="n">rear</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Queue</span><span class="o">::~</span><span class="n">Queue</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">temp</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">front</span> <span class="o">!=</span><span class="nb">NULL</span><span class="p">){</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">front</span><span class="p">;</span>
        <span class="n">front</span> <span class="o">=</span> <span class="n">front</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">temp</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Queue</span><span class="o">::</span><span class="n">isempty</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">items</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Queue</span><span class="o">::</span><span class="n">isfull</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">items</span> <span class="o">==</span> <span class="n">qsize</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">Queue</span><span class="o">::</span><span class="n">queuecount</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">items</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Queue</span><span class="o">::</span><span class="n">enqueue</span><span class="p">(</span><span class="k">const</span> <span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isfull</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">add</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">;</span>
    <span class="n">add</span><span class="o">-&gt;</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
    <span class="n">add</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">items</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">front</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">front</span> <span class="o">=</span> <span class="n">add</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">rear</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">add</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">rear</span> <span class="o">=</span> <span class="n">add</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Queue</span><span class="o">::</span><span class="n">dequeue</span><span class="p">(</span><span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">front</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">front</span><span class="o">-&gt;</span><span class="n">item</span><span class="p">;</span>
    <span class="n">items</span><span class="o">--</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">front</span><span class="p">;</span>
    <span class="n">front</span> <span class="o">=</span> <span class="n">front</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">temp</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">items</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rear</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Customer</span><span class="o">::</span><span class="n">set</span><span class="p">(</span><span class="kt">long</span> <span class="n">when</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">processtime</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> 
    <span class="n">arrive</span> <span class="o">=</span> <span class="n">when</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h4 id="null">NULL空指针</h4>
<p>你可以声明一个指针，然后让这个指针为空。通常是用NULL或者0赋值给这个指针变量：</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span> <span class="n">ptr</span><span class="p">;</span>
<span class="n">ptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</pre></div>
<p>当然推荐使用C++11新引入的关键字 <code>nullptr</code> ：</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span> <span class="n">ptr</span><span class="p">;</span>
<span class="n">ptr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</pre></div>
<p>在本例子中该Queue类里面的每个Node节点都是new出来的，除了dequeue动作将最前面的Node挤出，需要delete该节点外，整个类的析构函数也需要对Queue类里面的所有节点进行全部delete动作。</p>
<p>上面实现中enqueue和dequeue这两个成员函数需要细细看下，其中dequeue接受的参数是为了记录好挤出的那个Node的数据值。除此之外dequeue动作和析构函数的动作还是很接近的。enqueue里面这一句 <code>rear-&gt;next = add;</code> 是为了队列倒数第二个元素能够指向倒数第一个元素。</p>
<p>bank.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"queue.h"</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_PER_HR</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
<span class="kt">bool</span> <span class="nf">newcustomer</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">);</span>

<span class="kt">bool</span> <span class="nf">newcustomer</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">RAND_MAX</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">ios_base</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">srand</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Case Study: Bank of Heather Automatic Teller</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter maximum size of queue: "</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">qs</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">qs</span><span class="p">;</span>
    <span class="n">Queue</span> <span class="n">line</span><span class="p">(</span><span class="n">qs</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the number of simulation hours: "</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">hours</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">hours</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">cyclelimit</span> <span class="o">=</span> <span class="n">MIN_PER_HR</span> <span class="o">*</span> <span class="n">hours</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the average number of customers per hour: "</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">perhour</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">perhour</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">min_per_cust</span><span class="p">;</span>
    <span class="n">min_per_cust</span> <span class="o">=</span> <span class="n">MIN_PER_HR</span> <span class="o">/</span> <span class="n">perhour</span><span class="p">;</span>

    <span class="n">Item</span> <span class="n">temp</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">turnaways</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">customers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">served</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">sum_line</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">wait_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">line_wait</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">cycle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cycle</span> <span class="o">&lt;</span> <span class="n">cyclelimit</span><span class="p">;</span> <span class="n">cycle</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">newcustomer</span><span class="p">(</span><span class="n">min_per_cust</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">isfull</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">turnaways</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="n">customers</span><span class="o">++</span><span class="p">;</span>
                <span class="n">temp</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">cycle</span><span class="p">);</span>
                <span class="n">line</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">wait_time</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">line</span><span class="p">.</span><span class="n">isempty</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">line</span><span class="p">.</span><span class="n">dequeue</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
            <span class="n">wait_time</span> <span class="o">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">ptime</span><span class="p">();</span>
            <span class="n">line_wait</span> <span class="o">+=</span> <span class="n">cycle</span> <span class="o">-</span> <span class="n">temp</span><span class="p">.</span><span class="n">when</span><span class="p">();</span>
            <span class="n">served</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">wait_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">wait_time</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">sum_line</span> <span class="o">+=</span> <span class="n">line</span><span class="p">.</span><span class="n">queuecount</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">customers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"customers accepted: "</span> <span class="o">&lt;&lt;</span> <span class="n">customers</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"customers served: "</span> <span class="o">&lt;&lt;</span> <span class="n">served</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"          turnaways: "</span> <span class="o">&lt;&lt;</span> <span class="n">turnaways</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average queue size: "</span><span class="p">;</span>
        <span class="n">cout</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="n">cout</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios_base</span><span class="o">::</span><span class="n">fixed</span><span class="p">,</span> <span class="n">ios_base</span><span class="o">::</span><span class="n">floatfield</span><span class="p">);</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">sum_line</span> <span class="o">/</span> <span class="n">cyclelimit</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average wait time: "</span>
            <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">line_wait</span> <span class="o">/</span> <span class="n">served</span> <span class="o">&lt;&lt;</span> <span class="s">"minutes</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"No customers!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Done!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>这个例子最重要的是跟上作者如何试着用编程来模拟现实世界问题的思路，具体编程上的细节问题前面都已经说过了。下面我会多说一点。</p>
<p>这里的cycle下面的循环语句相当于这个世界的心跳，每分钟会执行下面的动作。第一个是来看是否有新顾客，如果有新顾客会如何；第二个if和第三个if是看最前面的那个顾客业务处理完了没，通过<code>wait_time</code> 来衡量，其小于0就认为该顾客业务处理完了。</p>
<p>首先来看新顾客的模拟，<code>(std::rand() * x / RAND_MAX &lt; 1)</code>  代码的这里会比较难懂一点，我们知道 rand会生成从0到最大整数的随机整数，所以 <code>std::rand() * x / RAND_MAX</code> 会生成0到x之间的随机整数，而x的含义是每个顾客平均几分钟。我们假设一条时间线，那么在这条时间线上平均x分钟画一条刻度，该刻度意思就是来了一个新顾客。因为随机数0到x概率分布均匀，所以可以认为上面运算公式得到bool为真的概率为1/x 。或者说该概率公式运行x个必然会得到一个刻度，而这和最开始定义的该时间线每x分钟画一个刻度表示来一个新用户是一致的，简单来说这个随机数函数返回true意思是一个新顾客来了。</p>
<p>新顾客来了会记录自身到达的时间，然后分配给一个1-3的业务处理时间属性。然后我们继续往下看，队列开始挤出最开头的那个顾客，意思是那个顾客开始处理自己的业务了，获取该顾客的业务处理时间，后面是一些统计信息处理。下一分钟会判断该顾客业务处理完了没有，没完则等待时间减去一，完了也就是等待时间wait_time&lt;=0了那么继续处理下一个顾客。【这个模拟顾客业务处理时间和心跳时间还可以细一点，不过这不是重点。】在后面是一些统计数据的计算，都很简单。</p>
<p>1．对于下面的类声明：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Cow</span><span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">hobby</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">weight</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Cow</span><span class="p">();</span>
    <span class="n">Cow</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">nm</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">ho</span><span class="p">,</span> <span class="kt">double</span> <span class="n">wt</span><span class="p">);</span>
    <span class="n">Cow</span><span class="p">(</span><span class="k">const</span> <span class="n">Cow</span> <span class="o">&amp;</span> <span class="n">c</span><span class="p">);</span>
    <span class="o">~</span><span class="n">Cow</span><span class="p">();</span>
    <span class="n">Cow</span> <span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Cow</span> <span class="o">&amp;</span> <span class="n">c</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">ShowCow</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>给这个类提供实现，并编写一个使用所有成员函数的小程序。</p>
<p>xiti_c12_1.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Cow</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">hobby</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">weight</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Cow</span><span class="p">();</span>
    <span class="n">Cow</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">nm</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ho</span><span class="p">,</span> <span class="kt">double</span> <span class="n">wt</span><span class="p">);</span>
    <span class="n">Cow</span><span class="p">(</span><span class="k">const</span> <span class="n">Cow</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">);</span>
    <span class="o">~</span><span class="n">Cow</span><span class="p">();</span>
    <span class="n">Cow</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Cow</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">ShowCow</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Cow</span><span class="o">::</span><span class="n">Cow</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">hobby</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">hobby</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Cow</span><span class="o">::</span><span class="n">Cow</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">nm</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ho</span><span class="p">,</span> <span class="kt">double</span> <span class="n">wt</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nm</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">ho</span><span class="p">);</span>
    <span class="n">hobby</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">hobby</span><span class="p">,</span> <span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ho</span><span class="p">);</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">wt</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Cow</span><span class="o">::</span><span class="n">Cow</span><span class="p">(</span><span class="k">const</span> <span class="n">Cow</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">hobby</span><span class="p">);</span>
    <span class="n">hobby</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">hobby</span><span class="p">,</span> <span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">.</span><span class="n">hobby</span><span class="p">);</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Cow</span><span class="o">::~</span><span class="n">Cow</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">hobby</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Cow</span><span class="o">&amp;</span> <span class="n">Cow</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Cow</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>

    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">hobby</span><span class="p">);</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">hobby</span><span class="p">;</span>
    <span class="n">hobby</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">strcpy_s</span><span class="p">(</span><span class="n">hobby</span><span class="p">,</span> <span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">.</span><span class="n">hobby</span><span class="p">);</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Cow</span><span class="o">::</span><span class="n">ShowCow</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Cow "</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">" hobby is"</span> <span class="o">&lt;&lt;</span> <span class="n">hobby</span> <span class="o">&lt;&lt;</span> <span class="s">" and it's weight is "</span> <span class="o">&lt;&lt;</span> <span class="n">weight</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">Cow</span> <span class="n">cow1</span><span class="p">;</span>
    <span class="n">Cow</span> <span class="n">cow2</span> <span class="o">=</span> <span class="n">Cow</span><span class="p">(</span><span class="s">"sucy"</span><span class="p">,</span> <span class="s">"reading"</span><span class="p">,</span> <span class="mf">18.9</span><span class="p">);</span>

    <span class="n">cow1</span><span class="p">.</span><span class="n">ShowCow</span><span class="p">();</span>
    <span class="n">cow2</span><span class="p">.</span><span class="n">ShowCow</span><span class="p">();</span>

    <span class="n">cow1</span> <span class="o">=</span> <span class="n">cow2</span><span class="p">;</span>
    <span class="n">cow1</span><span class="p">.</span><span class="n">ShowCow</span><span class="p">();</span>
    <span class="n">cow2</span><span class="p">.</span><span class="n">ShowCow</span><span class="p">();</span>

    <span class="n">Cow</span> <span class="n">cow3</span> <span class="o">=</span> <span class="n">cow2</span><span class="p">;</span>
    <span class="n">cow1</span><span class="p">.</span><span class="n">ShowCow</span><span class="p">();</span>
    <span class="n">cow2</span><span class="p">.</span><span class="n">ShowCow</span><span class="p">();</span>
    <span class="n">cow3</span><span class="p">.</span><span class="n">ShowCow</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本例也在告诉我们这样一个事实，那就是类里面如果有某个成员是指针变量，那么通常是要通过动态内存分配来重新实现复制构造函数和赋值运算符和析构函数的。 赋值运算和复制构造函数的区别在于赋值运算该类对象已经初始化了，也就是已经分配动态内存了，再次赋值需要将原来分配的内存里面的值释放掉。</p>
<p>4．请参看下面的Stack类的头文件：</p>
<div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">Item</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Stack</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">enum</span> <span class="p">{</span> <span class="n">MAX</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="n">Item</span> <span class="o">*</span> <span class="n">pitems</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">top</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Stack</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">MAX</span><span class="p">);</span>
    <span class="n">Stack</span><span class="p">(</span><span class="k">const</span> <span class="n">Stack</span><span class="o">&amp;</span> <span class="n">st</span><span class="p">);</span>
    <span class="o">~</span><span class="n">Stack</span><span class="p">();</span>

    <span class="kt">bool</span> <span class="nf">isempty</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="nf">isfull</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="nf">push</span><span class="p">(</span><span class="k">const</span> <span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="nf">pop</span><span class="p">(</span><span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span>
    <span class="n">Stack</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stack</span><span class="o">&amp;</span> <span class="n">st</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>正如私有成员表明的，这个类使用动态分配的数组来保存栈项。请重新编写方法，以适应这种新的表示法，并编写一个程序来演示所有的方法，包括复制构造函数和赋值运算符。</p>
<p>xiti_c12_4.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cctype&gt;</span><span class="cp"></span>

<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">Item</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Stack2</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">enum</span> <span class="p">{</span> <span class="n">MAX</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="n">Item</span> <span class="o">*</span> <span class="n">pitems</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">top</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Stack2</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">MAX</span><span class="p">);</span>
    <span class="n">Stack2</span><span class="p">(</span><span class="k">const</span> <span class="n">Stack2</span><span class="o">&amp;</span> <span class="n">st</span><span class="p">);</span>
    <span class="o">~</span><span class="n">Stack2</span><span class="p">();</span>

    <span class="kt">bool</span> <span class="nf">isempty</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="nf">isfull</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="nf">push</span><span class="p">(</span><span class="k">const</span> <span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="nf">pop</span><span class="p">(</span><span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">);</span>
    <span class="n">Stack2</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stack2</span><span class="o">&amp;</span> <span class="n">st</span><span class="p">);</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Stack2</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
<span class="p">};</span>


<span class="n">Stack2</span><span class="o">::</span><span class="n">Stack2</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">pitems</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Stack2</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"Stack2 size: "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> 
        <span class="o">&lt;&lt;</span> <span class="s">"Stack2 top: "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">top</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">top</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"Stack values "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">pitems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stack2</span><span class="o">::</span><span class="n">Stack2</span><span class="p">(</span><span class="k">const</span> <span class="n">Stack2</span><span class="o">&amp;</span> <span class="n">st</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">;</span>

    <span class="n">pitems</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pitems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">pitems</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">Stack2</span><span class="o">&amp;</span> <span class="n">Stack2</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Stack2</span><span class="o">&amp;</span> <span class="n">st</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">)</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">;</span>

    <span class="k">delete</span><span class="p">[]</span> <span class="n">pitems</span><span class="p">;</span>
    <span class="n">pitems</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pitems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">pitems</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Stack2</span><span class="o">::~</span><span class="n">Stack2</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">pitems</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Stack2</span><span class="o">::</span><span class="n">isempty</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">top</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Stack2</span><span class="o">::</span><span class="n">isfull</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">top</span> <span class="o">==</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Stack2</span><span class="o">::</span><span class="n">push</span><span class="p">(</span><span class="k">const</span> <span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">top</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pitems</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Stack2</span><span class="o">::</span><span class="n">pop</span><span class="p">(</span><span class="n">Item</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">top</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">pitems</span><span class="p">[</span><span class="o">--</span><span class="n">top</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

    <span class="n">Stack2</span> <span class="nf">st1</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">Stack2</span> <span class="n">st2</span><span class="p">;</span>
    <span class="n">Item</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="n">st1</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"st1-----------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">st1</span><span class="p">;</span>

    <span class="n">st2</span> <span class="o">=</span> <span class="n">st1</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"st2------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">st2</span><span class="p">;</span>

    <span class="n">st2</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
    <span class="n">st2</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">st2</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"st2-------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">st2</span><span class="p">;</span>

    <span class="n">Stack2</span> <span class="n">st3</span> <span class="o">=</span> <span class="n">st2</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"st3-------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">st3</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本例子是在之前Stack类的基础上继续讨论的，唯一的改动就是之前的items是一个固定长度的数组，现在变成动态内存分配的了。</p>
<p>这里top是堆栈的顶端索引，当top等于0表示该堆栈没有元素，当top=1表示该堆栈有1个元素，但你要取值是取index=0的值。然后top++的含义是返回top之后再执行自增操作；而++top的含义是先自增再返回top的值。</p>
<p>5．Heather银行进行的研究表明，ATM客户不希望排队时间不超过1分钟。使用本小节上面提到的对于队列的模拟，找出要使平均等候时间为1分钟，每小时到达的客户数应为多少（试验时间不短于100小时）？</p>
<p>xiti_c12_5.cpp</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"queue.h"</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_PER_HR</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">bool</span> <span class="nf">newcustomer</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">);</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">ios_base</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">srand</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Case Study: Bank of Heather Automatic Teller</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter maximum size of queue: "</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">qs</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">qs</span><span class="p">;</span>
    <span class="n">Queue</span> <span class="n">line</span><span class="p">(</span><span class="n">qs</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter the number of simulation hours: "</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">hours</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">hours</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">cyclelimit</span> <span class="o">=</span> <span class="n">MIN_PER_HR</span> <span class="o">*</span> <span class="n">hours</span><span class="p">;</span>

    <span class="c1">//cout &lt;&lt; "Enter the average number of customers per hour: ";</span>
    <span class="c1">//double perhour;</span>
    <span class="c1">//cin &gt;&gt; perhour;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">double</span> <span class="n">perhour</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">perhour</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">perhour</span><span class="o">=</span><span class="n">perhour</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">min_per_cust</span><span class="p">;</span>
        <span class="n">min_per_cust</span> <span class="o">=</span> <span class="n">MIN_PER_HR</span> <span class="o">/</span> <span class="n">perhour</span><span class="p">;</span>

        <span class="n">Item</span> <span class="n">temp</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">turnaways</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">customers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">served</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">sum_line</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">wait_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">line_wait</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">cycle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cycle</span> <span class="o">&lt;</span> <span class="n">cyclelimit</span><span class="p">;</span> <span class="n">cycle</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">newcustomer</span><span class="p">(</span><span class="n">min_per_cust</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">isfull</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">turnaways</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="n">customers</span><span class="o">++</span><span class="p">;</span>
                    <span class="n">temp</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">cycle</span><span class="p">);</span>
                    <span class="n">line</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">wait_time</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">line</span><span class="p">.</span><span class="n">isempty</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">line</span><span class="p">.</span><span class="n">dequeue</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">ptime</span><span class="p">();</span>
                <span class="n">line_wait</span> <span class="o">+=</span> <span class="n">cycle</span> <span class="o">-</span> <span class="n">temp</span><span class="p">.</span><span class="n">when</span><span class="p">();</span>
                <span class="n">served</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">wait_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">wait_time</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">sum_line</span> <span class="o">+=</span> <span class="n">line</span><span class="p">.</span><span class="n">queuecount</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">customers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"customers accepted: "</span> <span class="o">&lt;&lt;</span> <span class="n">customers</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"customers served: "</span> <span class="o">&lt;&lt;</span> <span class="n">served</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"          turnaways: "</span> <span class="o">&lt;&lt;</span> <span class="n">turnaways</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average queue size: "</span><span class="p">;</span>
            <span class="n">cout</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="n">cout</span><span class="p">.</span><span class="n">setf</span><span class="p">(</span><span class="n">ios_base</span><span class="o">::</span><span class="n">fixed</span><span class="p">,</span> <span class="n">ios_base</span><span class="o">::</span><span class="n">floatfield</span><span class="p">);</span>

            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">sum_line</span> <span class="o">/</span> <span class="n">cyclelimit</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average wait time: "</span>
                <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">line_wait</span> <span class="o">/</span> <span class="n">served</span> <span class="o">&lt;&lt;</span> <span class="s">"minutes</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"No customers!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">line_wait</span> <span class="o">/</span> <span class="n">served</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"average wait time is larger than 1 minutes</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"the largest perhour parameter is: "</span> <span class="o">&lt;&lt;</span> <span class="n">perhour</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Done!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>本习题在之前讨论的基础上稍作修改，主要还是对前面讨论的ATM排队问题理解透彻即可。</p>
<h3 id="_33">类继承</h3>
<p>下面通过下面这个例子来学习类的继承相关知识点吧。</p>
<p>test_inherit.cpp</p>
<div class="highlight"><pre><span></span>
</pre></div>
<h2 id="_34">附录</h2>
<h3 id="cin">cin详解</h3>
<ul>
<li><code>cin &gt;&gt;</code> 遇到Enter Space Tab 即结束，适合char，无空格的string和单个值的int float之类的输入。需要注意的是经过个人实践换行符还是在缓冲区的，为了把这个缓冲区消掉获得更好的输入体验，一般采用这种表达方式：<code>(cin &gt;&gt; what).get()</code> ，这是因为 <code>cin &gt;&gt; what</code> 会返回cin对象，然后继续调用下面的 get 方法来消掉最后的换行符。</li>
<li><code>cin.get</code>  和 <code>cin.getline</code>  都可以用于字符数组的行输入，不同的是 get方法不会丢弃缓冲区的换行结束符，此外cin.get还有一个重载变体，<code>cin.get(char &amp;ch)</code> ，用于读取第一个字符，假设缓冲区下一个字符是换行符，然后在遇到 <code>cin.get()</code>  则将把那个换行符读取下来。</li>
<li>getline函数 ，和cin.getline的区别就是 <code>getline(cin, string)</code> getline会读入到C++的string类，而不是C风格的字符数组。</li>
</ul>
<h3 id="cout_1">cout详解</h3>
<ul>
<li><code>cout &lt;&lt;</code> 一般使用</li>
<li><code>cout.put(char &amp;ch)</code>  输出一个字符，如果输入的整型也会正常显示该字符。</li>
</ul>
<h2 id="_35">参考资料</h2>
<ol>
<li>C++ Primer Plus 第六版中文版</li>
</ol>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '/MathJax-2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js','mhchem.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

            <section>
<div class="panel-group" id="accordion2">
    <div class="panel panel-default">
        <div class="panel-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="https://a358003542.github.io/articles/cpp-language-learning-notes.html#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="panel-collapse collapse">
            <div class="panel-body">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'cdwanzes-blog';
        var disqus_identifier = 'https://a358003542.github.io/articles/cpp-language-learning-notes.html';
    var disqus_url = 'https://a358003542.github.io/articles/cpp-language-learning-notes.html';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>

        </div>
        <section>
        <div class="col-md-2" style="float:right;font-size:0.9em;">
            <h4>首发于：</h4>
            <time pubdate="pubdate" datetime="2020-08-31T08:46:51.707426+08:00">2020年 8月 31日 </time>

            <h4>分类：</h4>
            <a class="category-link" href="https://a358003542.github.io/categories.html#c_and_cpp-ref">c_and_cpp</a>

        </div>
        </section>
</div>
</article>
    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>
<button id="gotop" type="button" class="btn btn-default">
    <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
</button>

<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="https://github.com/a358003542" title="wanze Home Page">wanze</a></li>
    </ul>
</div>
</footer>

        <script src="https://a358003542.github.io/theme/js/jquery.min.js"></script>
    <script src="https://a358003542.github.io/theme/js/bootstrap.min.js"></script>

    <script src="https://a358003542.github.io/theme/js/moment.min.js"></script>

    <script src="https://a358003542.github.io/theme/js/base.js"></script>

            <script type="text/javascript">
var disqus_shortname = 'cdwanzes-blog';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>




</body>
</html>