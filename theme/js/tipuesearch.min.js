(function($){$.fn.tipuesearch=function(options){var set=$.extend({show:7,newWindow:false,showURL:true,showTitleCount:true,minimumLength:3,descriptiveWords:25,highlightTerms:true,highlightEveryTerm:false,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",queryParamName:"q",resultsDivID:"#tipue_search_content",maxindex:3,listtype:"normal",wholewordsonly:true,allterms:false,showDuration:false,debug:false},options);set.input=this[0].id;return this.each(function(){var tipuesearch_in={pages:[]};$.ajaxSetup({async:false});var tipuesearch_t_c=0;if(set.mode=="live"){for(var i=0;i<tipuesearch_pages.length;i++){$.get(tipuesearch_pages[i]).done(function(html){var cont=$(set.liveContent,html).text();cont=cont.replace(/\s+/g," ");var desc=$(set.liveDescription,html).text();desc=desc.replace(/\s+/g," ");var t_1=html.toLowerCase().indexOf("<title>");var t_2=html.toLowerCase().indexOf("</title>",t_1+7);if(t_1!=-1&&t_2!=-1){var tit=html.slice(t_1+7,t_2)}else{var tit=tipuesearch_string_1}tipuesearch_in.pages.push({title:tit,text:desc,tags:cont,url:tipuesearch_pages[i]})})}}if(set.mode=="json"){$.getJSON(set.contentLocation).done(function(json){tipuesearch_in=$.extend({},json)})}if(set.mode=="static"){tipuesearch_in=$.extend({},tipuesearch)}var tipue_search_w="";if(set.newWindow){tipue_search_w=' target="_blank"'}function getURLP(name){return decodeURIComponent((new RegExp("[?|&]"+name+"="+"([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}if(getURLP(set.queryParamName)){$("#"+set.input).val(getURLP(set.queryParamName));getTipueSearch(0,true)}$(this).keyup(function(event){if(event.keyCode=="13"){getTipueSearch(0,true)}});function getTipueSearch(start,replace){$(set.resultsDivID).hide();$(set.resultsDivID).html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>');$(set.resultsDivID).show();var out="";var results="";var show_replace=false;var show_stop=false;var c=0;found=[];var d=$("#"+set.input).val().toLowerCase();var re=/[^\s"]+|"([^"]*)"/gi;d_w=[];do{var match=re.exec(d);if(match!=null){d_w.push(match[1]?$.trim(match[1]):$.trim(match[0]))}}while(match!=null);d="";for(var i=d_w.length-1;i>=0;i--){var a_w=true;for(var f=0;f<tipuesearch_stop_words.length;f++){d_w[i]=$.trim(d_w[i]);if(d_w[i]==tipuesearch_stop_words[f]){a_w=false;show_stop=true}}if(a_w){d=d+" "+d_w[i]}else{d_w[i].remove}}if(d.length>=set.minimumLength){if(replace){var d_r=d;for(var i=0;i<d_w.length;i++){for(var f=0;f<tipuesearch_replace.words.length;f++){if(d_w[i]==tipuesearch_replace.words[f].word){d_w[i]=d_w[i].replace(d_w[i],tipuesearch_replace.words[f].replace_with);show_replace=true}}}}for(var i=0;i<tipuesearch_in.pages.length;i++){var score=0;var s_t=tipuesearch_in.pages[i].text;allfound=true;for(var f=0;f<d_w.length;f++){thisscore=0;var term=RegExp.escape(d_w[f]);var regex_pre="(?:^|\\s|'|\\\"|\\(|\\)|\\[|\\]|\\{|\\<|#|\\^|\\$|_|-|\\.|\\,|\\+|`|\\||\\@|\\$|\\%|“|\\¿|\\¡)";var regex_post="(?:$|\\s|'|\\\"|\\(|\\)|\\[|\\]|\\{|\\<|#|\\^|\\$|_|-|\\.|\\,|\\+|`|\\||\\@|\\$|\\%|”|\\?|\\!)";if(set.wholewordsonly){if(term.substring(0,2)=="\\*"){regex_pre=""}if(term.substring(term.length-2)=="\\*"){regex_post=""}}var pat=new RegExp(regex_pre+term.replace(/\\\*/g,"").replace(/\\\?/g,".")+regex_post,"gi");if(tipuesearch_in.pages[i].title.search(pat)!=-1){var m_c=tipuesearch_in.pages[i].title.match(pat).length;thisscore+=20*m_c}if(tipuesearch_in.pages[i].text.search(pat)!=-1){var m_c=tipuesearch_in.pages[i].text.match(pat).length;thisscore+=20*m_c}if(tipuesearch_in.pages[i].tags.search(pat)!=-1){var m_c=tipuesearch_in.pages[i].tags.match(pat).length;thisscore+=10*m_c}if(tipuesearch_in.pages[i].url.search(pat)!=-1){thisscore+=20}if(thisscore!=0){for(var e=0;e<tipuesearch_weight.weight.length;e++){if(tipuesearch_in.pages[i].url==tipuesearch_weight.weight[e].url){thisscore+=tipuesearch_weight.weight[e].score}}}if(thisscore&&term.match("^-")){pat=new RegExp(term.substring(1),"i");if(tipuesearch_in.pages[i].title.search(pat)!=-1||tipuesearch_in.pages[i].text.search(pat)!=-1||tipuesearch_in.pages[i].tags.search(pat)!=-1){thisscore=0}}if(thisscore&&set.highlightTerms){if(set.highlightEveryTerm){var patr=new RegExp("("+regex_pre+term.replace(/\\\*/g,"").replace(/\\\?/g,".")+regex_post+")","gi")}else{var patr=new RegExp("("+regex_pre+term.replace(/\*/g,"").replace(/\\\?/g,".")+regex_post+")","i")}s_t=s_t.replace(/&amp;/gi,"&");s_t=s_t.replace(/&nbsp;/gi,"\b");s_t=s_t.replace(patr,'<span class="h01">$1</span>');s_t=s_t.replace(eval("//g"),"");s_t=s_t.replace(eval("/\b/g"),"&nbsp;");tipuesearch_in.pages[i].title=tipuesearch_in.pages[i].title.replace(/&amp;/gi,"&");tipuesearch_in.pages[i].title=tipuesearch_in.pages[i].title.replace(/&nbsp;/gi,"\b");tipuesearch_in.pages[i].title=tipuesearch_in.pages[i].title.replace(patr,'<span class="h01">$1</span>');tipuesearch_in.pages[i].title=tipuesearch_in.pages[i].title.replace(eval("//g"),"");tipuesearch_in.pages[i].title=tipuesearch_in.pages[i].title.replace(eval("/\b/g"),"&nbsp;")}if(set.allterms&&thisscore==0&&allfound){score=0;break}score+=thisscore}if(score!=0){found.push({score:score,title:tipuesearch_in.pages[i].title,desc:s_t,url:tipuesearch_in.pages[i].url});c++}}if(c!=0){if(set.showTitleCount&&tipuesearch_t_c==0){var title=document.title;document.title="("+c+") "+title;tipuesearch_t_c++}if(show_replace==1){out+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+d+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+d_r+"</a></div>"}if(c==1){out+='<div id="tipue_search_results_count">'+tipuesearch_string_4+"</div>"}else{c_c=c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");var totalpages=Math.ceil(c/set.show);out+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+" - "+totalpages+" "+tipuesearch_string_16+"</div>"}found.sort(function(a,b){return b.score-a.score});var l_o=0;for(var i=0;i<found.length;i++){if(l_o>=start&&l_o<set.show+start){listnum=set.listtype=="numeric"?"<strong>"+(l_o+1)+".</strong>&nbsp;":"";out+='<div class="tipue_search_content_title"><a href="'+found[i].url+location.search+'"'+tipue_search_w+">"+listnum+found[i].title+"</a></div>";if(set.debug){out+='<div class="tipue_search_content_debug">'+tipuesearch_string_17+" "+found[i].score+"</div>"}if(set.showURL){var s_u=found[i].url.toLowerCase();if(s_u.indexOf("http://")==0){s_u=s_u.slice(7)}out+='<div class="tipue_search_content_url"><a href="'+found[i].url+location.search+'"'+tipue_search_w+">"+s_u+"</a></div>"}if(found[i].desc){var t=found[i].desc;firstterm=t.indexOf('<span class="h01"');if(firstterm>30){t="..."+t.substring(firstterm-30)}var t_d="";var t_w=t.split(" ");if(t_w.length<set.descriptiveWords){t_d=t}else{for(var f=0;f<set.descriptiveWords;f++){t_d+=t_w[f]+" "}}t_d=$.trim(t_d);if(t_d.charAt(t_d.length-1)!="."){t_d+=" ..."}out+='<div class="tipue_search_content_text">'+t_d+"</div>"}}l_o++}if(c>set.show){var pages=Math.ceil(c/set.show);if(pages>1){var page=start/set.show;out+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">';if(start>0){out+='<li><a href="#" class="tipue_search_foot_box" id="0_'+replace+'">'+tipuesearch_string_14+"</a></li>";out+='<li><a href="#" class="tipue_search_foot_box" id="'+(start-set.show)+"_"+replace+'">'+tipuesearch_string_6+"</a></li>"}lowerLimit=page-Math.floor(set.maxindex/2);upperLimit=page+Math.floor(set.maxindex/2);if(lowerLimit<0){upperLimit-=lowerLimit;lowerLimit=0}if(upperLimit>pages){lowerLimit-=upperLimit-pages;upperLimit=pages}if(lowerLimit<0){lowerLimit=0}for(var i=lowerLimit;i<upperLimit;i++){if(i==page){out+='<li class="current">'+(i+1)+"</li> "}else{out+='<li><a href="#" class="tipue_search_foot_box" id="'+i*set.show+"_"+replace+'">'+(i+1)+"</a></li>"}}if(page+1!=pages){out+='<li><a href="#" class="tipue_search_foot_box" id="'+(start+set.show)+"_"+replace+'">'+tipuesearch_string_7+"</a></li>";out+='<li><a href="#" class="tipue_search_foot_box" id="'+Math.floor((pages-1)*set.show)+'">'+tipuesearch_string_15+"</a></li>"}out+="</ul></div>"}}}else{out+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}}else{if(show_stop){out+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>"}else{out+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>";if(set.minimumLength==1){out+='<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>"}else{out+='<div id="tipue_search_warning">'+tipuesearch_string_12+" "+set.minimumLength+" "+tipuesearch_string_13+"</div>"}}}if(set.showDuration){var endTime=(new Date).getTime();var duration=(endTime-startTime)/1e3;out+='<p class="tipue_search_duration">'+tipuesearch_string_18.replace("$1",+duration.toFixed(3))+"</p>"}$(set.resultsDivID).hide();$(set.resultsDivID).html(out);$(set.resultsDivID).slideDown(200);$("#tipue_search_replaced").click(function(){getTipueSearch(0,false)});$(".tipue_search_foot_box").click(function(){var id_v=$(this).attr("id");var id_a=id_v.split("_");getTipueSearch(parseInt(id_a[0]),id_a[1])})}})}})(jQuery);if(!RegExp.escape){RegExp.escape=function(s){return String(s).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}}function getUrlParam(key){var value=new RegExp(key+"=([^&]*)","i").exec(window.location.search);return value&&unescape(value[1])||""}var tipue_per_page=getUrlParam("per_page");if(tipue_per_page!=""){tipue_per_page=parseInt(tipue_per_page);$("#tipue_per_page").val(tipue_per_page)}var tipue_match_type=getUrlParam("matchtype")==1;if(tipue_match_type){$("#all").prop("checked",true)}else{$("#any").prop("checked",true)}$(document).ready(function(){function deselect(e){$(".tipue_search_pop").slideFadeToggle(function(){e.removeClass("selected")})}$("#help").on("click",function(){if($(this).hasClass("selected")){deselect($(this))}else{$(this).addClass("selected");$(".tipue_search_pop").slideFadeToggle()}return false});$(".close").on("click",function(){deselect($("#help"));return false});$.fn.slideFadeToggle=function(easing,callback){return this.animate({opacity:"toggle",height:"toggle"},"fast",easing,callback)}});