{# 模板路径：macros/category_macros.html #}
{# 
  分类面板渲染宏
  参数说明：
  - categories: 全局分类数据（原categories变量）
  - filter_type: 要筛选的内容类型（如'articles'/'books'，对应文章/书籍）
  - page_label: 页面展示的类型名称（如'文章'/'书籍'，用于标题/文案）
  - accordion_id: 面板唯一ID（避免多页面JS冲突）
#}
{% macro render_category_panel(categories, filter_type, page_label, accordion_id) %}
  <div class="accordion" id="{{ accordion_id }}">
    {% for category, articles in categories %}
      {# 核心过滤逻辑：仅保留指定类型的内容 #}
      {% set filtered_articles = articles|selectattr('source_folder', 'equalto', filter_type)|list %}
      {# 仅渲染有内容的分类，避免空面板 #}
      {% if filtered_articles|count > 0 %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="{{ category.slug }}-{{ filter_type }}-ref">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#{{ category.slug }}-{{ filter_type }}" aria-expanded="true" 
              aria-controls="{{ category.slug }}-{{ filter_type }}">
              {{ category }}<span class="ms-2 badge bg-info">{{ filtered_articles|count }}</span>
          </button>
        </h2>

        <div id="{{ category.slug }}-{{ filter_type }}" class="accordion-collapse collapse" 
            aria-labelledby="{{ category.slug }}-{{ filter_type }}-ref"
            data-bs-parent="#{{ accordion_id }}">
          <div class="accordion-body">
            <ul class="list-articles-category">
              {% for article in filtered_articles %}
              <li>
                <time pubdate="pubdate" datetime="{{ article.date.isoformat() }}">
                  {{ article.locale_date }}
                </time>
                <a href="{{ SITEURL }}/{{ article.url }}">
                  {{ article.title }} 
                  {%if article.subtitle %} 
                    <small> {{ article.subtitle }} </small> 
                  {% endif %}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endif %}
    {% endfor %}
  </div>
{% endmacro %}