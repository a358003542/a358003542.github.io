<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="D4VqC4HppC"/>
    <meta name="msvalidate.01" content="55CB117A61A6F8286173763FB18D9625"/>

        <meta name="author" content="cdwanze"/>
        <meta name="copyright" content="cdwanze"/>

            <meta property="og:type" content="article"/>
        <meta name="twitter:card" content="summary">

        <meta property="og:title" content="cdwanze的博文"/>
        <meta name="twitter:title" content="cdwanze的博文">
    <meta property="og:url" content="https://docs.cdwanze.work"/>
    <meta property="og:site_name" content="cdwanze的博文"/>
    <meta property="og:article:author" content="cdwanze"/>
    <title>
cdwanze的博文 - python好伙伴 category</title>


        <link href="https://docs.cdwanze.work/theme/css/font-awesome.css" rel="stylesheet"
              media="screen">
        <link href="https://docs.cdwanze.work/theme/css/bootstrap.min.css" rel="stylesheet"
              media="screen">

            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/pygments.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/elegant.css" media="screen">
            <link rel="stylesheet" type="text/css"
                  href="https://docs.cdwanze.work/theme/css/custom.css" media="screen">






</head>
<body>

<nav class="navbar">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="https://docs.cdwanze.work/"><span
                    class=site-name>网站首页</span></a>
        </div>


        <div class="navbar-collapse collapse">
            <form action="https://docs.cdwanze.work/search.html"
                  onsubmit="return validateForm(this.elements['q'].value);"
                  class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" name="q" id="tipue_search_input"
                           class="form-control" placeholder="Search..."
                           style="width:430px;">
                </div>
                <button class="btn btn-default" type="submit">搜索</button>
            </form>


            <ul class="nav navbar-nav nav-pills navbar-right">
                <li >
                    <a href="https://docs.cdwanze.work">博文首页</a></li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle"
                           data-toggle="dropdown" role="button"
                           aria-haspopup="true" aria-expanded="false">查找文章<span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a class="slowscroll" href="/categories.html">按分类</a>
                            </li>
                            <li><a class="slowscroll" href="/tags.html">按标签</a>
                            </li>
                        </ul>
                    </li>


                        <li >
                            <a href="https://docs.cdwanze.work/epub-ebooks.html">epub电子书籍</a>
                        </li>
                        <li >
                            <a href="https://docs.cdwanze.work/about.html">关于本网站</a>
                        </li>
            </ul>


        </div>
    </div>
</nav>


<div class="container-fluid">
    <div class="col-md-1 col-md-1-left"></div>
    <div class="col-md-10">


    <style>
        article {
            border: 1px solid #aaa;
        }

        section {
            padding: 1em;
        }

        article > p {
            padding-left: 0.5em;
            padding-right: 0.5em;
        }

        #gotop {
            position: fixed;
            right: 12%;
            float: right;
            top: 50%;
        }

        @media screen and (max-width: 600px) {
            #gotop {
                display: none;
            }
        }
    </style>

    <button id="gotop" type="button" class="btn btn-default">
        <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
    </button>



    <div class="row">

        <div class="row">
         </div>

             <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <header>
                        <h1 id="recent-posts">最近博文
                            <a id="allposts" href="https://docs.cdwanze.work/archives.html">所有博文</a>
                        </h1>
                    </header>


                    <div class="recent-posts">

                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/diskcache-module.html">diskcache模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2019-11-22T00:00:00+08:00">2019年 11月 22日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">简介</h2>
<p>diskcache很好用，而且速度还挺快的。项目Github地址在 <a href="https://github.com/grantjenks/python-diskcache/">这里</a> 。虽然项目星数不是特别多，但从个人使用体验来说，基本上满足了个人的需求了。比如速度快，和python各个数据类型对接方便，更复杂的数据类型没有试过，也没必要，就一般的python数据类型来说，比如列表，字典，字符串之类的，基本上是无缝对接。然后一般缓存需要的过期时间功能它也是有的，所以基本上是一个不错的模块了。</p>
<p>具体使用很方便和简单，建议简单看下官方文档即可。</p>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/lxml-module.html">lxml模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2019-11-05T00:00:00+08:00">2019年 11月 5日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">简介</h2>
<p>lxml模块最先接触是在爬虫那块，因为Beautifulsoup很好用，所有lxml模块基本上也就处于一个被调用阶段，并没有深入了解。但随着你对爬虫框架的研究深入，你就会发现xpath语句才是正确的从xml或html中抽取信息的标准流程化语言，而即使是功能还算强大的css selector选择器，其实也不过是xpath语句的精简版。这样lxml模块开始受到我的重视了，因为lxml对xpath语句有着很好的支持。</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="n">html_e</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">'//title'</span><span class="p">)</span>
</pre></div>
<p>此外lxml还可以很方便的去构建一个xml或者lxml文本：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="n">child_1</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">'child_1'</span><span class="p">)</span>
<span class="n">child_1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">)</span>
<span class="n">child_1</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'this is a text'</span>
<span class="n">child_2</span> <span class="o">=</span> <span class="n">etree …</span></pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/loguru-module.html">loguru模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2019-06-10T00:00:00+08:00">2019年 6月 10日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">前言</h2>
<p>keep it simple , keep it stupid . loguru模块大概是符合这一精神的，其让你把精力从一些日志的调配的琐碎事情上抽离出来，好让你有更多的精力去解决核心问题。基本上使用过之后，就好像使用了python的新特性 <code>f-string</code> 一样，you just can not stop to use it. 你会忍不住想要使用它。</p>
<p>就最简单的使用：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>
</pre></div>
<p>接触过logging的马上就知道这个logger是个什么东西了，然后就想通常那样 <code>logger.info('what')</code> 之类的去打日志即可。默认的logger的日志格式就已经非常好了。</p>
<p>通常这个就已经够用了，实际上容器化了的应用或者某些应用场景，是要求你的日志都打印在默认终端上的，还有某些专门管理日志的工具，也要求你的应用就打印在默认终端。</p>
<p>某些情况下你可能需要将日志同时打印到文件中：</p>
<div class="highlight"><pre><span></span><span class="err">logger.add('&lt;filename&gt;.log')</span>
</pre></div>
<p>此外还支持这样带时间戳的文件名：</p>
<div class="highlight"><pre><span></span><span class="err">logger.add('file_{time …</span></pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/matplotlib-module.html">matplotlib模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2019-04-06T00:00:00+08:00">2019年 4月 6日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">前言</h2>
<p>之前数据绘图一文简单介绍了下如何在jupyter notebook 下绘制简单的直线图、饼图等等，本文主要是作为matplotlib模块绘图的综合性简要介绍。</p>
<p>经常看到一些简单的例子，比如如何画出散点图或者等等，从简单的直白的到复杂的一大堆参数调配的都有，让人迷惑。matplotlib模块还可以和PyQt或者wxpython等后端结合起来等等高级功能，但我现在最急切的就是想要理解matplotlib模块到底做了一些什么事情，那些是必要的常规操作，那些是对外的数据接口。</p>
<p>比如下面的调配中文字体支持的，是matplotlib模块的外围操作，应该绘图前就要调配好的：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_matplotlib_support_chinese</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="s1">'SimHei'</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    设置matplotlib支持中文</span>
<span class="sd">    :param font:</span>
<span class="sd">    :return:</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>

    <span class="n">rcParams</span><span class="p">[</span><span class="s1">'font.family'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'sans-serif'</span>
    <span class="n">rcParams</span><span class="p">[</span><span class="s1">'font.sans-serif'</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>  <span class="c1"># 插入中文字体</span>
    <span class="n">rcParams</span><span class="p">[</span><span class="s1">'axes.unicode_minus'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 用来正常显示负号</span>
</pre></div>
<p>然后我们对之前pandas的绘图接口操作发现，除了传递必要的x，y数值进去外，还需要传一个 ax …</p>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/logbook-module.html">logbook模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2018-08-27T00:00:00+08:00">2018年 8月 27日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">前言</h2>
<p>logbook似乎是个不错的模块可以改进我们的日志功能，可以看做系统logging模块的第三方升级版，但还是有很多地方不同的。</p>
<p>一开始我接触的最大的不同就是logbook官方文档并不推荐将某个handler注册在某个logger的那种做法，logbook的handler可以注册在整个线程或者整个进程上。或者我们看到官方文档的第一个例子是这种写法：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logbook</span> <span class="kn">import</span> <span class="n">warn</span><span class="p">,</span> <span class="n">StreamHandler</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">push_application</span><span class="p">()</span>
<span class="n">warn</span><span class="p">(</span><span class="s1">'This is a warning'</span><span class="p">)</span>
</pre></div>
<p>或者写作：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logbook</span> <span class="kn">import</span> <span class="n">warn</span><span class="p">,</span> <span class="n">StreamHandler</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">log_handler</span> <span class="o">=</span> <span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="k">with</span> <span class="n">log_handler</span><span class="o">.</span><span class="n">applicationbound</span><span class="p">():</span>
    <span class="n">warn</span><span class="p">(</span><span class="s1">'This is too cool for stdlib'</span><span class="p">)</span>
</pre></div>
<p>这是单个注册在整个程序上的，此外还有 <code>threadbound</code> 是注册在整个线程上的。一般桌面GUI程序推荐注册在整个程序上 …</p>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/python-dateutilmo-kuai.html">python-dateutil模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2018-06-14T00:00:00+08:00">2018年 6月 14日
                                        </time>
                                    </div>
                                </section>
                                <p>一般能够使用python的内置模块datetime解决的问题或者简单写几个辅助函数就能解决的问题是没必要上 python-dateutil 模块的，但有的时候某些问题，上python-dateutil模块会非常的方便，然后我发现好多有名的模块都默认安装这个模块了。</p>
<h2 id="relativedelta">relativedelta</h2>
<p>某些问题，用datetime的replace将某个值设为0或者什么值，或者用timedelta来减去什么值，大部分都能解决，但有的时候，比如跨月份涉及到要考虑天数不等或者其他等等问题，用relativedelta还是很方便的。</p>
<p>总的说来涉及到datetime的某个跨度的计算问题，还是推荐使用 relativedelta函数。</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<span class="n">sdt</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">months</span><span class="p">)</span>
</pre></div>


<h2 id="rrule">rrule</h2>
<p>虽然没有lrule，但根据上面的relativedelta配置的起始时间，然后指定结束时间，通过rrule函数来生成一个时间区间，有时是很方便的。</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dateutil.rrule</span> <span class="kn">import</span> <span class="n">rrule</span><span class="p">,</span> <span class="n">MONTHLY</span>
<span class="nb">list</span><span class="p">(</span><span class="n">rrule</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">MONTHLY</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">sdt</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="n">now …</span></pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/shi-yong-cythonlai-jia-su-python.html">使用cython来加速python
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2018-06-14T00:00:00+08:00">2018年 6月 14日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">找到性能瓶颈所在</h2>
<p>首先需要确认脚本或者某个函数具体到底是哪里出现了性能瓶颈：</p>
<div class="highlight"><pre><span></span><span class="err">python -m cProfile test.py</span>
</pre></div>
<p>或者使用jupyter notebook 的timeit 功能，或者自己写 time计时。</p>
<p>目前我知道的循环结构提速很明显，然后指定静态类型会提速。</p>
<p>一般的python代码cython都是支持的，但一般我们是重点去开发那个限速的目标函数，而不会到处优化的。</p>
<p>参考资料1的例子，没有加速，N设置为3000，用时 53.301s，加速之后，用时4.186s。然后没有加速的那个exp运算了很多很多次，大概花了一两秒的样子，所以我们看到原始python代码在循环操作上开销很大。某些关键计算如果循环次数太多，那么就要考虑上c扩展优化了。</p>
<p>在做性能测试的时候有一类耗时较多的操作是不用考虑c代码优化的，这类耗时多的操作就是IO等待型操作，有的是等待数据库IO操作，有的是等待文件读写IO操作，有的是等待网络IO请求等等。这些请求很多都和socket套接字请求相关。</p>
<h2 id="pyx">pyx文件</h2>
<p>关于pyx文件的更多请查看cython的官方手册。</p>
<p>下面重点讲一下 python模块包的管理方案，推荐是利用 setuptools 来，</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages …</span></pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/fire-module.html">fire模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2018-02-22T15:25:00+08:00">2018年 2月 22日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">前言</h2>
<p>初次接触 <a href="https://github.com/google/python-fire">fire模块</a> 就不自觉的和 <a href="https://github.com/pallets/click">click模块</a> 进行对比，老实说我一开始还真不太相信这是google团队的作品，google团队的产品会这么简洁，不过毕竟后面写着 ： <code>This is not an official Google product.</code></p>
<p>首先说下fire模块的优点，这个初步了解一下优点是很明显的： 可以让你少写点代码。作为一个程序员最大的愿望是什么： 少写点代码就能把事办成了。当然继续往下说，fire模块可以让你的代码更简洁，现在真的一个python脚本就是一个命令行工具了，一句废话都没有了，包括函数类里面的文档定义都是有用的。就作为一般最简单的命令行需求，我是推荐fire模块的。</p>
<p>但是fire模块目前github上 commit很少，版本号也才 0.1.2，可能模块还有很多不稳定或者bug都是可能的，如果读者在项目需求上只是一两个python脚本需要做成命令行工具，我还是推荐click模块。如果读者有大量的python脚本转成命令行工具的需求，这在目前数据处理工作越来越多的大环境（实际上我怀疑这也是他们开发fire模块的初衷），那么使用fire模块无疑是能省点力气的，毕竟当初人们觉得click模块方便那也是只是相对于写一个命令行工具而言，现在情况确实有所不同了。</p>
<div class="highlight"><pre><span></span>pip install fire
</pre></div>
<p>官方文档已经说的很详细了，本身使用是很简单的，下面我随便说说吧。</p>
<h2 id="_2">第一个例子 …</h2>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/pipenv-module.html">pipenv模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2018-02-14T11:45:00+08:00">2018年 2月 14日
                                        </time>
                                    </div>
                                </section>
                                
<p>pipenv模块刚开始听说觉得virtualenv够用了，就没太在意。后来一试发现真的可以，很方便的，在设计理念上和nodejs那边的包管理有点接近了，很不错。</p>
<p>刚进入一个文件夹，然后运行：</p>
<div class="highlight"><pre><span></span>pipenv install
</pre></div>
<p>当然运行前你需要：</p>
<div class="highlight"><pre><span></span><span class="err">pip install pipenv</span>
</pre></div>
<p>其会创建 <code>Pipfile</code> 和 <code>Pipfile.lock</code> 这两个文件。如果读者有点熟悉nodejs那边的包管理机制，就对这两个文件的作用不需要做过多的说明了。</p>
<p>那么怎么激活进入虚拟环境呢：</p>
<div class="highlight"><pre><span></span><span class="err">pipenv shell</span>
</pre></div>
<p>或者你直接调用虚拟环境下运行某个命令：</p>
<div class="highlight"><pre><span></span><span class="err">pipenv run you_awesom_command</span>
</pre></div>
<p>读者打开 <code>Pipfile</code> 文件会发现这一行</p>
<div class="highlight"><pre><span></span><span class="err">url = "https://pypi.douban.com/simple"</span>
</pre></div>
<p>以前还要在系统的另外的地方去配置，现在直接在这里修改就可以了。</p>
<p>然后安装模块就是：</p>
<div class="highlight"><pre><span></span><span class="err">pipenv install requests</span>
</pre></div>
<p>或者remove模块：</p>
<div class="highlight"><pre><span></span><span class="err">pipenv uninstall requests</span>
</pre></div>
<p>值得注意的pipenv模块很好地解析的各个包包的依赖关系，这就是他比原 …</p>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/pillow-module.html">pillow模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2018-02-06T12:04:00+08:00">2018年 2月 6日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">简介</h2>
<p>pillow模块的前身是PIL模块，其有更好的github和pypi支持，所以简单的安装就可以通过pip命令安装之即可。不过pillow模块对于某些特殊格式的图片处理支持可能依赖于系统的一些额外的图形处理模块，比如libjpeg，libtiff等。可能你的系统已经安装了，也可能没有，根据具体情况来，这里就不一一讨论了。</p>
<p>安装官方文档的叙述（also reference <a href="http://askubuntu.com/questions/427358/install-pillow-for-python-3">this</a> ），下面这些可能需要装上。</p>
<div class="highlight"><pre><span></span>sudo apt-get install python3-dev python3-setuptools
sudo apt-get install libtiff4-dev libjpeg8-dev zlib1g-dev <span class="se">\</span>
    libfreetype6-dev liblcms2-dev libwebp-dev tcl8.5-dev tk8.5-dev
</pre></div>
<h3 id="_2">测试安装情况</h3>
<p>可以如下找个图片简单测试一下安装情况:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"test.jpg"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">size …</span></pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/jinja2-template.html">jinja2模板
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2017-10-12T00:00:00+08:00">2017年 10月 12日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">前言</h2>
<p>jinja2模板在flask和pelican中都有使用，而且就是在django框架中，模版语法也大体类似，所以jinja2模板还是很值得一学的。</p>
<h2 id="_2">注释</h2>
<p>这里面的内容是模板文件的注释内容。</p>
<div class="highlight"><pre><span></span><span class="err">{# ... #}</span>
</pre></div>
<h2 id="_3">变量</h2>
<p>如下所示，里面包含某个变量，jinja2渲染模板的时候会解析这些变量。</p>
<div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="err">...</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
<p>然后 <code>object.a</code> 这样的dot法引用，或者 <code>object['a']</code> 这样的写法，甚至是调用实例的某个方法 <code>object.func()</code> 都是支持的。</p>
<h2 id="filters">过滤器filters</h2>
<p>变量可以进一步加上某个过滤器来进行进一步的处理。过滤器是有点类似于linux系统的管道作业风格，多个过滤器可以叠加，如： <code>{{ var | striptags | title }}</code> 。</p>
<p>jinja2中内置的过滤器有：</p>
<ul>
<li><code>safe</code> 渲染值不转义</li>
<li><code>capitalize</code> 值首字母大写 其他字母小写</li>
<li><code>lower</code> 字母都小写</li>
<li><code>upper</code> 字母都大写</li>
<li><code>title</code> 值每个单词首字母大写</li>
<li><code>trim</code>值首尾空格去除</li>
<li><code>striptags</code> 渲染之前把所有HTML标签去掉</li>
</ul>
<p>关于safe过滤器请参看下面讨论的特殊符号的问题。</p>
<h2 id="_4">列表排序</h2>
<p>参考了 …</p>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/beautifulsoup-module.html">beautifulsoup模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2017-10-11T07:04:00+08:00">2017年 10月 11日
                                        </time>
                                    </div>
                                </section>
                                
<h1 id="_1">简介</h1>
<p>BeautifulSoup模块在python网页分析这一块是很有名的一个模块，其确实让网页分析任务变得轻松而easy了。本文将对bs4模块进行简单的介绍，更多细节请参看 <a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/">官方文档</a> 。</p>
<h2 id="_2">安装</h2>
<p>安装就简单用pip命令安装之:</p>
<div class="highlight"><pre><span></span><span class="err">sudo pip install beautifulsoup</span>
</pre></div>
<h2 id="_3">第一个例子</h2>
<p>然后在使用上因为python2和python3的urllib相关改动很大，加上urllib在使用上不是很友好，强烈推荐大家直接用requests模块来进行相关操作。然后beautifulsoup的引入语句一般如下所示:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</pre></div>
<p>最简单的和requests的组合使用如下所示:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://www.pythonscraping.com/exercises/exercise1.html"</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</pre></div>
<p>在上面soup.title返回的是一个标签对象。然后标签对象里面如果有标签的话又可以继续点号索引标签:</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; soup.body …</pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/scrapy-module.html">scrapy模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2017-10-11T00:00:00+08:00">2017年 10月 11日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">简介</h2>
<p>Scrapy模块和Django模块在使用上包括在内容目录结构上都很相似，当然这两个项目干的完全是两个不同的事情，我想这种相似性更多的可以描述为类似于大多数GUI界面的那种类似。</p>
<p>我之前尝试过写过一个小的Spider网络爬虫程序，其实网络爬取大体过程都是类似的，因此我学习Scrapy项目大体只是一些基本配置的了解，对于其内部原理已经很熟悉了，所以本文不会在这些地方赘述了。</p>
<p>scrapy就是一个python模块，可以通过 <code>pip</code> 安装之，所以安装这块也不多说了。</p>
<h3 id="_2">新建一个项目</h3>
<div class="highlight"><pre><span></span><span class="n">scrapy</span><span class="w"> </span><span class="n">startproject</span><span class="w"> </span><span class="n">project_name</span><span class="w">  </span><span class="o">[</span><span class="n">path</span><span class="o">]</span><span class="w"> </span>
</pre></div>
<p>因为我喜欢创建python的venv虚拟环境，所以上面最后path设置为 <code>.</code> 当前目录下的意思。</p>
<p>然后接下来就是编写爬虫Spider脚本还有等等其他一些配置了。</p>
<h2 id="_3">第一个例子</h2>
<p>下面是一个简单的例子：</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">user_agent</span> <span class="o">=</span> <span class="n">get_random_user_agent</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"7yrt"</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'http://7yrt.com/html/rhrt/'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

        <span class="c1">## do …</span></pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/pytestmo-kuai.html">pytest模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2017-06-06T00:00:00+08:00">2017年 6月 6日
                                        </time>
                                    </div>
                                </section>
                                
<p>测试开发风格是如此重要，下面进一步讨论之来提高我们的测试驱动型开发。首先推荐使用pytest。</p>
<h2 id="pytest">pytest简介</h2>
<p>pytest模块是站在unittest基础上的，就简单的应用如下，通过pip安装pytest，然后你之前通过 unittest 写的测试案例，全部都不用更改照样有用，接下来你要写一个新的测试，不需要再新建一个 <code>unittest.TestCase</code> 类了（如果你希望多个测试在一个类里面，就新建一个类即可，这个类不需要继承自任何类了。），直接如下写测试函数就是了，然后也不确认就是最简单的 <code>assert</code> 确认返回为 True 即可。</p>
<div class="highlight"><pre><span></span><span class="err">def test_prime():</span>
<span class="err">    assert prime(4) == 7</span>
</pre></div>
<h3 id="_1">确认抛出某个异常</h3>
<p>把官方的例子copy过来了，看一下就懂了。</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_mytest</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">SystemExit</span><span class="p">):</span>
        <span class="n">f</span><span class="p">()</span>
</pre></div>
<p>完了，如果你赶时间的话 …</p>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/faker-module.html">faker模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2017-04-13T06:13:00+08:00">2017年 4月 13日
                                        </time>
                                    </div>
                                </section>
                                
<h1 id="_1">简介</h1>
<p>faker模块是一个很有特色的模块，所以其在github上得到的star也较多。其可以用来生成一些伪数据，比如用来做测试用途等等。其github项目地址在 <a href="https://github.com/joke2k/faker">这里</a> 。</p>
<p>该项目支持pip安装:</p>
<div class="highlight"><pre><span></span><span class="err">pip install Faker</span>
</pre></div>
<p>其使用还是很简单的，大概如下所示:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Factory</span>

<span class="n">faker</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">faker</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
</pre></div>
<p>然后中文名字例子如下，就是在Factory的create方法那里指定语言locale（默认是"en_EN"）:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Factory</span>

<span class="n">faker</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">'zh_CN'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">faker</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
</pre></div>
<h1 id="faker">faker所含方法清单</h1>
<ul>
<li><strong>address …</strong></li></ul>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/click-module.html">click模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2016-11-13T06:13:00+08:00">2016年 11月 13日
                                        </time>
                                    </div>
                                </section>
                                
<h2 id="_1">简介</h2>
<p>click模块是一个类似getopt和argparse的python第三方模块，在简单了解之后，觉得其简直就是python快速创建命令行工具的类似requests之于urllib的存在，writed human-friendly。click的官方文档在 <a href="http://click.pocoo.org">这里</a> ，下面就让我们来学习这么好的一个模块吧。</p>
<p>官方文档的第一个例子如下:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">'--count'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'Number of greetings.'</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">'--name'</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s1">'Your name'</span><span class="p">,</span>
              <span class="n">help</span><span class="o">=</span><span class="s1">'The person to greet.'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">"""Simple program that greets NAME for a total of COUNT times."""</span>
    <span class="k">for …</span></pre></div>
                            </article>


                            <article>

                                <h1 class="page-header"><a
                                        href="https://docs.cdwanze.work/articles/pelican-module.html">pelican模块
 </a></h1>

                                <section>
                                    posted in
                                    <a href="https://docs.cdwanze.work/categories.html#pythonhao-huo-ban-ref">python好伙伴
                                    </a>
                                    <div class="recent-posts-time">
                                        <time pubdate="pubdate"
                                              datetime="2016-09-25T00:00:00+08:00">2016年 9月 25日
                                        </time>
                                    </div>
                                </section>
                                
<h1 id="_1">简介</h1>
<p>pelican是一个静态网站生成工具，其是用python编写实现的，所以对于pythoner来说显得格外的亲切。</p>
<p>首先按照官方的quickstart简单的刷一遍吧，下面就一些问题作出一些讨论。</p>
<h2 id="_2">项目基本说明</h2>
<p>python的虚拟环境控制这里就不多说了，下面主要讨论 <code>pelicanconf.py</code> 和 <code>publishconf.py</code> 和 <code>Makefile</code> 这个文件作出一些说明，然后项目文档的基本结构相关作出一些说明。</p>
<p>首先说明下 <code>publishconf.py</code> 和 <code>pelicanconf.py</code> 的区别， <code>publishconf.py</code> 文件里面有这样一句话：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pelicanconf</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
<p>也就是其将继承所有来自 <code>pelicanconf.py</code> 里面的配置参量，不同的是 <code>publishconf.py</code> 是对阵发布到那边服务器上的，而 <code>pelicanconf …</code></p>
                            </article>

                     </div>
                </div>
            </div>
    </div>

    </div>
    <div class="col-md-1"></div>

</div>


<div id="push"></div>


<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a> and updated by <a href="http://docs.cdwanze.work" title="cdwanze Home Page">cdwanze</a></li>
    </ul>
</div>
</footer>

        <script src="https://docs.cdwanze.work/theme/js/jquery.min.js"></script>
    <script src="https://docs.cdwanze.work/theme/js/bootstrap.min.js"></script>
    <script>
        function validateForm(query) {
            return (query.length > 0);
        }
    </script>

    <script>
        function adjust_search_width() {
            var w = document.documentElement.clientWidth;
            if ((w > 755) && (w < 975)) {
                plus_width = w - 755;
                $('.navbar-form .form-control').outerWidth(210 + plus_width);
            } else if (w >= 975) {
                $('.navbar-form .form-control').outerWidth(210 + 220);
            } else if (w <= 755) {
                $('.navbar-form .form-control').css('width', '100%')
            }
        }

        function adjust_markdown_css(){
            $('table').addClass('table');
            $('table').addClass('table-striped');
        }

        $(document).ready(function () {
            adjust_search_width();
            adjust_markdown_css();
        });

        window.onresize = function () {
            adjust_search_width();
        }

    </script>


    <script>
        (function ($) {
            // custom css expression for a case-insensitive contains()
            jQuery.expr[':'].Contains = function (a, i, m) {
                return (a.textContent || a.innerText || "").toUpperCase().indexOf(m[3].toUpperCase()) >= 0;
            };

            function listFilter() {

                $('#findtag')
                    .change(function () {
                        var filter = $(this).val();
                        if (filter) {
                            // this finds all links in a list that contain the input,
                            // and hide the ones not containing the input while showing the ones that do
                            $('.list-of-tags').find("a:not(:Contains(" + filter + "))").parent().hide();
                            $('.list-of-tags').find("a:Contains(" + filter + ")").parent().show();
                        } else {
                            $('.list-of-tags').find("li").show();
                        }
                        return false;
                    })
                    .keyup(function () {
                        // fire the above change event after every letter
                        $(this).change();
                    });
            }

            //ondomready
            $(function () {
                listFilter($());
            });
        }(jQuery));

    </script>

    <script>
        $(function () {
            //点击回到顶部的元素
            $("#gotop").click(function (e) {
                //以1秒的间隔返回顶部
                $('body,html').animate({scrollTop: 0}, 1000);
            });
        });
    </script>

    <script>
        $('.page-header').hover(function () {
            $(this).css("color", '#3875d7')
        }, function () {
            $(this).css('color', '#8B0000')
        })
    </script>


    <script>
        $(document).ready(function () {
            $('a.slowscroll').click(function (event) {
                var $anchor = $(this);
                $('html, body').animate({scrollTop: $($anchor.attr('href')).offset().top}, 1500);
                event.preventDefault();
                // $('a.slowscroll').parent().removeClass('active');
                // $('.navbar-header').hide();
                // $anchor.parent().addClass('active');
            })
        })
        console.log('document init...')
    </script>




</body>
</html>